{"version":3,"file":"forum.js","sources":["../src/forum/components/WithdrawalPage.tsx","../src/common/models/WithdrawalPlatform.ts","../src/common/types/index.ts","../src/common/models/WithdrawalRequest.ts","../src/forum/index.ts"],"sourcesContent":["import app from 'flarum/forum/app';\r\nimport Page from 'flarum/common/components/Page';\r\nimport Button from 'flarum/common/components/Button';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport icon from 'flarum/common/helpers/icon';\r\nimport type Mithril from 'mithril';\r\n\r\ninterface WithdrawalPlatform {\r\n  id: number;\r\n  attributes: {\r\n    name: string;\r\n    symbol: string;\r\n    minAmount: number;\r\n    maxAmount: number;\r\n    fee: number;\r\n    iconUrl?: string;\r\n    iconClass?: string;\r\n  };\r\n}\r\n\r\ninterface WithdrawalRequest {\r\n  id: number;\r\n  attributes: {\r\n    amount: number;\r\n    accountDetails: string;\r\n    status: string;\r\n    createdAt: string;\r\n  };\r\n  relationships: {\r\n    platform: {\r\n      data: { id: number };\r\n    };\r\n  };\r\n}\r\n\r\n// Helper functions moved to outer scope to avoid recreating on every call\r\nconst getId = (obj: any) => typeof obj.id === 'function' ? obj.id() : obj.id;\r\nconst getAttr = (obj: any, attr: string) => {\r\n  if (typeof obj[attr] === 'function') {\r\n    return obj[attr]();\r\n  }\r\n  return obj.attributes ? obj.attributes[attr] : obj[attr];\r\n};\r\n\r\nexport default class WithdrawalPage extends Page {\r\n  private platforms: WithdrawalPlatform[] = [];\r\n  private requests: WithdrawalRequest[] = [];\r\n  private loading = true;\r\n  private submitting = false;\r\n  private loadingBalance = true;\r\n  private userBalance = 0;\r\n  private showDropdown = false;\r\n  private activeTab = Stream('withdrawal'); // 'withdrawal' or 'history'\r\n\r\n  private amount = Stream('');\r\n  private selectedPlatform = Stream<WithdrawalPlatform | null>(null);\r\n  private accountDetails = Stream('');\r\n  private saveAddress = Stream(false);\r\n\r\n  oninit(vnode: Mithril.VnodeDOM) {\r\n    super.oninit(vnode);\r\n\r\n    app.setTitle(app.translator.trans('withdrawal.forum.page.title'));\r\n\r\n    this.loadData();\r\n    this.loadUserBalance();\r\n  }\r\n\r\n  view() {\r\n    if (this.loading) {\r\n      return (\r\n        <div className=\"WithdrawalPage\">\r\n          <div className=\"WithdrawalPage-loading\">\r\n            <LoadingIndicator />\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    // Check if no platforms are available for the withdrawal tab\r\n    const validPlatforms = (this.platforms || []).filter(platform => !!platform);\r\n\r\n    if (validPlatforms.length === 0 && this.activeTab() === 'withdrawal') {\r\n      return (\r\n        <div className=\"WithdrawalPage\">\r\n          <div className=\"WithdrawalPage-modal\">\r\n            <div className=\"WithdrawalPage-header\">\r\n              <div className=\"WithdrawalPage-tabs\">\r\n                <div \r\n                  className={`WithdrawalPage-tab ${this.activeTab() === 'withdrawal' ? 'active' : ''}`}\r\n                  onclick={() => this.activeTab('withdrawal')}\r\n                >\r\n                  {app.translator.trans('withdrawal.forum.tabs.withdrawal')}\r\n                </div>\r\n                <div \r\n                  className={`WithdrawalPage-tab ${this.activeTab() === 'history' ? 'active' : ''}`}\r\n                  onclick={() => this.activeTab('history')}\r\n                >\r\n                  {app.translator.trans('withdrawal.forum.tabs.history')}\r\n                </div>\r\n              </div>\r\n              <button className=\"WithdrawalPage-close\" onclick={() => app.history.back()}>\r\n                {icon('fas fa-times')}\r\n              </button>\r\n            </div>\r\n            \r\n            <div className=\"WithdrawalPage-content\">\r\n              {this.activeTab() === 'withdrawal' ? (\r\n                <div className=\"WithdrawalPage-emptyState\">\r\n                  <div className=\"WithdrawalPage-emptyIcon\">\r\n                    {icon('fas fa-coins')}\r\n                  </div>\r\n                  <h3 className=\"WithdrawalPage-emptyTitle\">\r\n                    {app.translator.trans('withdrawal.forum.no_platforms')}\r\n                  </h3>\r\n                  <p className=\"WithdrawalPage-emptyDescription\">\r\n                    {app.translator.trans('withdrawal.forum.no_platforms_description')}\r\n                  </p>\r\n                </div>\r\n              ) : this.renderHistoryList()}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"WithdrawalPage\">\r\n        <div className=\"WithdrawalPage-modal\">\r\n          <div className=\"WithdrawalPage-header\">\r\n            <div className=\"WithdrawalPage-tabs\">\r\n              <div \r\n                className={`WithdrawalPage-tab ${this.activeTab() === 'withdrawal' ? 'active' : ''}`}\r\n                onclick={() => this.activeTab('withdrawal')}\r\n              >\r\n                {app.translator.trans('withdrawal.forum.tabs.withdrawal')}\r\n              </div>\r\n              <div \r\n                className={`WithdrawalPage-tab ${this.activeTab() === 'history' ? 'active' : ''}`}\r\n                onclick={() => this.activeTab('history')}\r\n              >\r\n                {app.translator.trans('withdrawal.forum.tabs.history')}\r\n              </div>\r\n            </div>\r\n            <button className=\"WithdrawalPage-close\" onclick={() => window.history.back()}>\r\n              {icon('fas fa-times')}\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"WithdrawalPage-content\">\r\n            {this.activeTab() === 'withdrawal' ? this.renderWithdrawalForm() : this.renderHistoryList()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderWithdrawalForm(): Mithril.Children {\r\n    return [\r\n      this.renderPlatformSelector(),\r\n      this.renderAmountSection(),\r\n      this.renderAddressSection(),\r\n      this.renderSubmitButton()\r\n    ];\r\n  }\r\n\r\n  private renderHistoryList(): Mithril.Children {\r\n    if (this.loading) {\r\n      return (\r\n        <div className=\"WithdrawalPage-loading\">\r\n          <LoadingIndicator />\r\n        </div>\r\n      );\r\n    }\r\n\r\n    if (!this.requests || this.requests.length === 0) {\r\n      return (\r\n        <div className=\"WithdrawalPage-emptyState\">\r\n          <div className=\"WithdrawalPage-emptyIcon\">\r\n            {icon('fas fa-history')}\r\n          </div>\r\n          <h3 className=\"WithdrawalPage-emptyTitle\">\r\n            {app.translator.trans('withdrawal.forum.history.empty')}\r\n          </h3>\r\n          <p className=\"WithdrawalPage-emptyDescription\">\r\n            {app.translator.trans('withdrawal.forum.history.empty_description')}\r\n          </p>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    // Filter out any null/undefined requests\r\n    const validRequests = this.requests.filter(request => {\r\n      if (!request) {\r\n        console.warn('Found null/undefined request in requests array');\r\n        return false;\r\n      }\r\n      return true;\r\n    });\r\n\r\n    if (validRequests.length === 0) {\r\n      return (\r\n        <div className=\"WithdrawalPage-emptyState\">\r\n          <div className=\"WithdrawalPage-emptyIcon\">\r\n            {icon('fas fa-history')}\r\n          </div>\r\n          <h3 className=\"WithdrawalPage-emptyTitle\">\r\n            {app.translator.trans('withdrawal.forum.history.empty')}\r\n          </h3>\r\n          <p className=\"WithdrawalPage-emptyDescription\">\r\n            {app.translator.trans('withdrawal.forum.history.empty_description')}\r\n          </p>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"WithdrawalPage-historyList\">\r\n        {validRequests.map(request => {\r\n          try {\r\n            return this.renderHistoryItem(request);\r\n          } catch (error) {\r\n            console.error('Error rendering history item:', error, request);\r\n            return null;\r\n          }\r\n        }).filter(item => item !== null)}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderHistoryItem(request: WithdrawalRequest): Mithril.Children {\r\n    // Add null checks and handle both Model instances and plain objects\r\n    if (!request) {\r\n      return null;\r\n    }\r\n\r\n    const platformId = typeof request.platformId === 'function' ? request.platformId() : \r\n                      (request.attributes ? request.attributes.platformId : request.platformId) ||\r\n                      (request.relationships?.platform?.data?.id);\r\n    \r\n    const platform = this.platforms.find(p => getId(p) === platformId);\r\n    \r\n    const status = getAttr(request, 'status') || 'pending';\r\n    const statusClass = this.getStatusClass(status);\r\n    const createdAt = getAttr(request, 'createdAt');\r\n    const date = createdAt ? new Date(createdAt) : new Date();\r\n    const amount = getAttr(request, 'amount') || 0;\r\n    const accountDetails = getAttr(request, 'accountDetails') || '';\r\n\r\n    return (\r\n      <div key={getId(request)} className=\"WithdrawalPage-historyItem\">\r\n        <div className=\"WithdrawalPage-historyHeader\">\r\n          <div className=\"WithdrawalPage-historyPlatform\">\r\n            <div className=\"WithdrawalPage-platformIcon\">\r\n              {platform ? this.renderPlatformIcon(platform) : icon('fas fa-coins')}\r\n            </div>\r\n            <div className=\"WithdrawalPage-historyInfo\">\r\n              <div className=\"WithdrawalPage-historyPlatformName\">\r\n                {platform ? (typeof platform.name === 'function' ? platform.name() : platform.attributes?.name) : 'Unknown Platform'}\r\n              </div>\r\n              <div className=\"WithdrawalPage-historyDate\">\r\n                {date.toLocaleDateString()} {date.toLocaleTimeString()}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className={`WithdrawalPage-historyStatus ${statusClass}`}>\r\n            {app.translator.trans(`withdrawal.forum.status.${status}`)}\r\n          </div>\r\n        </div>\r\n        <div className=\"WithdrawalPage-historyDetails\">\r\n          <div className=\"WithdrawalPage-historyAmount\">\r\n            <span className=\"WithdrawalPage-historyLabel\">\r\n              {app.translator.trans('withdrawal.forum.history.amount')}:\r\n            </span>\r\n            <span className=\"WithdrawalPage-historyValue\">\r\n              {amount} {platform ? (typeof platform.symbol === 'function' ? platform.symbol() : platform.attributes?.symbol) : ''}\r\n            </span>\r\n          </div>\r\n          <div className=\"WithdrawalPage-historyAddress\">\r\n            <span className=\"WithdrawalPage-historyLabel\">\r\n              {app.translator.trans('withdrawal.forum.history.address')}:\r\n            </span>\r\n            <span className=\"WithdrawalPage-historyValue\">\r\n              {accountDetails}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private getStatusClass(status: string): string {\r\n    switch (status) {\r\n      case 'approved':\r\n        return 'success';\r\n      case 'rejected':\r\n        return 'danger';\r\n      case 'pending':\r\n      default:\r\n        return 'warning';\r\n    }\r\n  }\r\n\r\n  private renderPlatformSelector(): Mithril.Children {\r\n    const selected = this.selectedPlatform();\r\n    \r\n    return (\r\n      <div className=\"WithdrawalPage-platformSelector\">\r\n        <div className=\"WithdrawalPage-label\">提取平台</div>\r\n        <div className=\"WithdrawalPage-platformDropdown\" onclick={() => this.showDropdown = !this.showDropdown}>\r\n          <div className=\"WithdrawalPage-platformSelected\">\r\n            <div className=\"WithdrawalPage-platformInfo\">\r\n              <div className=\"WithdrawalPage-platformIcon\">\r\n                {selected ? this.renderPlatformIcon(selected) : icon('fas fa-bitcoin', { className: 'default-icon' })}\r\n              </div>\r\n              <div className=\"WithdrawalPage-platformDetails\">\r\n                <div className=\"WithdrawalPage-platformName\">\r\n                  {selected ? (typeof selected.name === 'function' ? selected.name() : selected.attributes?.name) : '请选择平台'}\r\n                </div>\r\n                <div className=\"WithdrawalPage-platformFlow\">\r\n                  {app.translator.trans('withdrawal.forum.remaining_flow', { amount: '0.00000000' })}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          {icon('fas fa-chevron-down', { className: 'WithdrawalPage-dropdownIcon' })}\r\n        </div>\r\n\r\n        {this.showDropdown && this.renderPlatformDropdown()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderPlatformDropdown(): Mithril.Children {\r\n    // Ensure platforms array is valid and filter out invalid items\r\n    const validPlatforms = (this.platforms || []).filter(platform => !!platform);\r\n\r\n    if (validPlatforms.length === 0) {\r\n      return (\r\n        <div className=\"WithdrawalPage-dropdownMenu\">\r\n          <div className=\"WithdrawalPage-dropdownItem WithdrawalPage-noData\">\r\n            {app.translator.trans('withdrawal.forum.no_platforms')}\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"WithdrawalPage-dropdownMenu\">\r\n        {validPlatforms.map(platform => (\r\n          <div \r\n            key={platform.id}\r\n            className=\"WithdrawalPage-dropdownItem\"\r\n            onclick={() => {\r\n              this.selectedPlatform(platform);\r\n              this.showDropdown = false;\r\n              this.amount(''); // Clear amount when switching platforms\r\n            }}\r\n          >\r\n            <div className=\"WithdrawalPage-platformIcon\">\r\n              {this.renderPlatformIcon(platform)}\r\n            </div>\r\n            <div className=\"WithdrawalPage-platformName\">\r\n              {typeof platform.name === 'function' ? platform.name() : platform.attributes?.name}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderPlatformIcon(platform: WithdrawalPlatform): Mithril.Children {\r\n    // Add null checks to prevent errors\r\n    if (!platform) {\r\n      return icon('fas fa-coins', { className: 'crypto-icon default' });\r\n    }\r\n\r\n    // Handle both Model instances and plain objects\r\n    const iconUrl = typeof platform.iconUrl === 'function' ? platform.iconUrl() : platform.attributes?.iconUrl;\r\n    const iconClass = typeof platform.iconClass === 'function' ? platform.iconClass() : platform.attributes?.iconClass;\r\n    const name = typeof platform.name === 'function' ? platform.name() : platform.attributes?.name;\r\n    const symbol = typeof platform.symbol === 'function' ? platform.symbol() : platform.attributes?.symbol;\r\n\r\n    // Priority: iconUrl > iconClass > default\r\n    if (iconUrl) {\r\n      return (\r\n        <img \r\n          src={iconUrl} \r\n          alt={name || 'Platform'}\r\n          className=\"platform-icon-image\"\r\n          onerror={(e) => {\r\n            // Fallback to iconClass or default icon if image fails to load\r\n            const target = e.target as HTMLImageElement;\r\n            target.style.display = 'none';\r\n            const fallbackIcon = document.createElement('i');\r\n            const fallbackIconClass = iconClass || 'fas fa-coins';\r\n            fallbackIcon.className = `${fallbackIconClass} crypto-icon`;\r\n            target.parentElement?.appendChild(fallbackIcon);\r\n          }}\r\n        />\r\n      );\r\n    }\r\n\r\n    // Use Font Awesome icon class if specified, otherwise default\r\n    const finalIconClass = iconClass || 'fas fa-coins';\r\n    const finalSymbol = symbol?.toLowerCase() || 'default';\r\n    return icon(finalIconClass, { className: `crypto-icon ${finalSymbol}` });\r\n  }\r\n\r\n  private renderAmountSection(): Mithril.Children {\r\n    const selected = this.selectedPlatform();\r\n    const minAmount = selected ? (typeof selected.minAmount === 'function' ? selected.minAmount() : selected.attributes?.minAmount) : 0.001;\r\n    const maxAmount = selected ? (typeof selected.maxAmount === 'function' ? selected.maxAmount() : selected.attributes?.maxAmount) : 10;\r\n    const fee = selected ? (typeof selected.fee === 'function' ? selected.fee() : selected.attributes?.fee) : 0.0005;\r\n\r\n    return (\r\n      <div className=\"WithdrawalPage-amountSection\">\r\n        <div className=\"WithdrawalPage-formGroup\">\r\n          <div className=\"WithdrawalPage-balanceHeader\">\r\n            <span className=\"WithdrawalPage-label\">\r\n              {app.translator.trans('withdrawal.forum.form.amount')}\r\n            </span>\r\n            <span className=\"WithdrawalPage-balance\">\r\n              {app.translator.trans('withdrawal.forum.available_balance', { \r\n                amount: this.loadingBalance ? '0.00000000' : this.userBalance.toFixed(8) \r\n              })}\r\n            </span>\r\n          </div>\r\n\r\n          <div className=\"WithdrawalPage-amountInput\">\r\n            <input\r\n              type=\"text\"\r\n              className=\"WithdrawalPage-input\"\r\n              placeholder=\"0.00000000\"\r\n              value={this.amount()}\r\n              oninput={(e: Event) => this.amount((e.target as HTMLInputElement).value)}\r\n            />\r\n            <Button\r\n              className=\"WithdrawalPage-allButton\"\r\n              onclick={this.fillAllAmount.bind(this)}\r\n            >\r\n              {app.translator.trans('withdrawal.forum.form.all_button')}\r\n            </Button>\r\n          </div>\r\n\r\n          <div className=\"WithdrawalPage-amountLimits\">\r\n            <div className=\"WithdrawalPage-limitRow\">\r\n              <span className=\"WithdrawalPage-limitLabel\">\r\n                {app.translator.trans('withdrawal.forum.limits.min_max')}\r\n              </span>\r\n              <span className=\"WithdrawalPage-limitValue\">\r\n                {icon('fas fa-coins')} {minAmount} ~ {maxAmount}\r\n              </span>\r\n            </div>\r\n            <div className=\"WithdrawalPage-limitRow\">\r\n              <span className=\"WithdrawalPage-limitLabel\">\r\n                {app.translator.trans('withdrawal.forum.limits.fee')}\r\n              </span>\r\n              <span className=\"WithdrawalPage-limitValue\">\r\n                {icon('fas fa-coins')} {fee}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderAddressSection(): Mithril.Children {\r\n    const selected = this.selectedPlatform();\r\n    const symbol = selected ? (typeof selected.symbol === 'function' ? selected.symbol() : selected.attributes?.symbol) : '';\r\n\r\n    return (\r\n      <div className=\"WithdrawalPage-addressSection\">\r\n        <div className=\"WithdrawalPage-formGroup\">\r\n          <div className=\"WithdrawalPage-addressHeader\">\r\n            <span className=\"WithdrawalPage-label\">\r\n              {app.translator.trans('withdrawal.forum.form.address', { symbol })}\r\n              <span className=\"WithdrawalPage-required\">*</span>\r\n            </span>\r\n            <div className=\"WithdrawalPage-saveAddress\" onclick={() => this.saveAddress(!this.saveAddress())}>\r\n              {icon('fas fa-bookmark')}\r\n              {app.translator.trans('withdrawal.forum.form.save_address')}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"WithdrawalPage-addressInput\">\r\n            <input\r\n              type=\"text\"\r\n              className=\"WithdrawalPage-input\"\r\n              placeholder={app.translator.trans('withdrawal.forum.form.address_placeholder')}\r\n              value={this.accountDetails()}\r\n              oninput={(e: Event) => this.accountDetails((e.target as HTMLInputElement).value)}\r\n            />\r\n            <button className=\"WithdrawalPage-pasteButton\" onclick={this.pasteFromClipboard.bind(this)}>\r\n              {icon('fas fa-paste')}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderSubmitButton(): Mithril.Children {\r\n    const amount = parseFloat(this.amount()) || 0;\r\n    const selected = this.selectedPlatform();\r\n    const fee = selected ? (typeof selected.fee === 'function' ? selected.fee() : selected.attributes?.fee) : 0;\r\n    const finalAmount = Math.max(0, amount - fee);\r\n    const symbol = selected ? (typeof selected.symbol === 'function' ? selected.symbol() : selected.attributes?.symbol) : '';\r\n\r\n    return (\r\n      <div className=\"WithdrawalPage-submitSection\">\r\n        <Button\r\n          className=\"WithdrawalPage-submitButton\"\r\n          loading={this.submitting}\r\n          disabled={!this.canSubmit()}\r\n          onclick={this.submit.bind(this)}\r\n        >\r\n          {app.translator.trans('withdrawal.forum.form.submit')}\r\n        </Button>\r\n\r\n        {amount > 0 && (\r\n          <div className=\"WithdrawalPage-finalAmount\">\r\n            {app.translator.trans('withdrawal.forum.final_amount', { \r\n              amount: finalAmount.toFixed(8), \r\n              symbol \r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private canSubmit(): boolean {\r\n    return !!(\r\n      this.selectedPlatform() &&\r\n      this.amount() &&\r\n      this.accountDetails() &&\r\n      !this.submitting &&\r\n      parseFloat(this.amount()) > 0\r\n    );\r\n  }\r\n\r\n  private fillAllAmount(): void {\r\n    if (this.loadingBalance) return;\r\n    this.amount(this.userBalance.toFixed(8));\r\n  }\r\n\r\n  private async pasteFromClipboard(): Promise<void> {\r\n    try {\r\n      if (navigator.clipboard && navigator.clipboard.readText) {\r\n        const text = await navigator.clipboard.readText();\r\n        this.accountDetails(text.trim());\r\n        m.redraw();\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to read from clipboard:', error);\r\n      app.alerts.show({\r\n        type: 'error',\r\n        dismissible: true\r\n      }, app.translator.trans('withdrawal.forum.clipboard_error'));\r\n    }\r\n  }\r\n\r\n  private async submit(): Promise<void> {\r\n    if (!this.canSubmit()) return;\r\n\r\n    this.submitting = true;\r\n\r\n    try {\r\n      const platform = this.selectedPlatform()!;\r\n      \r\n      const response = await app.request({\r\n        method: 'POST',\r\n        url: app.forum.attribute('apiUrl') + '/withdrawal-requests',\r\n        body: {\r\n          data: {\r\n            type: 'withdrawal-requests',\r\n            attributes: {\r\n              platformId: typeof platform.id === 'function' ? platform.id() : platform.id,\r\n              amount: parseFloat(this.amount()),\r\n              accountDetails: this.accountDetails()\r\n            }\r\n          }\r\n        }\r\n      });\r\n      \r\n      if (response && response.data) {\r\n        app.store.pushPayload(response);\r\n      }\r\n\r\n      app.alerts.show({\r\n        type: 'success',\r\n        dismissible: true\r\n      }, app.translator.trans('withdrawal.forum.form.success'));\r\n\r\n      // Reset form\r\n      this.amount('');\r\n      this.accountDetails('');\r\n      this.saveAddress(false);\r\n\r\n      // Reload data\r\n      this.loadRequests();\r\n    } catch (error) {\r\n      console.error('Error submitting withdrawal request:', error);\r\n      app.alerts.show({\r\n        type: 'error',\r\n        dismissible: true\r\n      }, app.translator.trans('withdrawal.forum.form.error'));\r\n    } finally {\r\n      this.submitting = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private async loadData(): Promise<void> {\r\n    try {\r\n      await Promise.all([\r\n        this.loadPlatforms(),\r\n        this.loadRequests()\r\n      ]);\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n    } finally {\r\n      this.loading = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private async loadPlatforms(): Promise<void> {\r\n    try {\r\n      console.log('Loading withdrawal platforms...');\r\n      const response = await app.store.find('withdrawal-platforms');\r\n      console.log('Platform response:', response);\r\n      \r\n      this.platforms = Array.isArray(response) ? response.filter(p => p !== null) : (response ? [response] : []);\r\n      console.log('Processed platforms:', this.platforms);\r\n      \r\n      // Auto-select first platform if available\r\n      if (this.platforms.length > 0 && !this.selectedPlatform()) {\r\n        this.selectedPlatform(this.platforms[0]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading platforms:', error);\r\n      this.platforms = [];\r\n    }\r\n  }\r\n\r\n  private async loadRequests(): Promise<void> {\r\n    try {\r\n      console.log('Loading withdrawal requests...');\r\n      const response = await app.store.find('withdrawal-requests');\r\n      console.log('Requests response:', response);\r\n      this.requests = Array.isArray(response) ? response.filter(r => r !== null) : (response ? [response] : []);\r\n      console.log('Processed requests:', this.requests);\r\n    } catch (error) {\r\n      console.error('Error loading requests:', error);\r\n      this.requests = [];\r\n    }\r\n  }\r\n\r\n  private async loadUserBalance(): Promise<void> {\r\n    try {\r\n      // Integration with antoinefr/flarum-ext-money extension\r\n      this.userBalance = app.session.user?.attribute('money') || 0;\r\n      this.loadingBalance = false;\r\n      m.redraw();\r\n    } catch (error) {\r\n      console.error('Error loading user balance:', error);\r\n      this.loadingBalance = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n}","import Model from 'flarum/common/Model';\r\n\r\n/**\r\n * WithdrawalPlatform model for Flarum\r\n * \r\n * This model represents a withdrawal platform that users can use\r\n * to withdraw their virtual currency.\r\n */\r\nexport default class WithdrawalPlatform extends Model {\r\n  // Basic attributes\r\n  name = Model.attribute<string>('name');\r\n  symbol = Model.attribute<string>('symbol');\r\n  minAmount = Model.attribute<number>('minAmount');\r\n  maxAmount = Model.attribute<number>('maxAmount');\r\n  fee = Model.attribute<number>('fee');\r\n  \r\n  // Optional attributes\r\n  iconUrl = Model.attribute<string | null>('iconUrl');\r\n  iconClass = Model.attribute<string | null>('iconClass');\r\n  \r\n  // Status\r\n  isActive = Model.attribute<boolean>('isActive');\r\n  \r\n  // Timestamps\r\n  createdAt = Model.attribute('createdAt', Model.transformDate);\r\n  updatedAt = Model.attribute('updatedAt', Model.transformDate);\r\n  \r\n  // Computed properties\r\n  apiEndpoint() {\r\n    return `/withdrawal-platforms/${this.id()}`;\r\n  }\r\n  \r\n  // Helper methods\r\n  displayName(): string {\r\n    const symbol = this.symbol();\r\n    const name = this.name();\r\n    return symbol ? `${name} (${symbol})` : name;\r\n  }\r\n  \r\n  isValidAmount(amount: number): boolean {\r\n    const min = this.minAmount();\r\n    const max = this.maxAmount();\r\n    return amount >= min && amount <= max;\r\n  }\r\n  \r\n  getTotalCost(amount: number): number {\r\n    return amount + this.fee();\r\n  }\r\n}","/**\r\n * Shared type definitions for the Withdrawal extension\r\n */\r\n\r\n/**\r\n * Withdrawal platform data structure\r\n */\r\nexport interface WithdrawalPlatformData {\r\n  id: string | number;\r\n  name: string;\r\n  symbol: string;\r\n  minAmount: number;\r\n  maxAmount: number;\r\n  fee: number;\r\n  iconUrl?: string | null;\r\n  iconClass?: string | null;\r\n  isActive: boolean;\r\n  createdAt?: string;\r\n  updatedAt?: string;\r\n}\r\n\r\n/**\r\n * Withdrawal request data structure\r\n */\r\nexport interface WithdrawalRequestData {\r\n  id: string | number;\r\n  amount: number;\r\n  accountDetails: string;\r\n  status: 'pending' | 'approved' | 'rejected';\r\n  platformId: number;\r\n  userId: number;\r\n  createdAt?: string;\r\n  updatedAt?: string;\r\n}\r\n\r\n/**\r\n * User withdrawal data extension\r\n */\r\nexport interface UserWithdrawalData {\r\n  money?: number;\r\n  withdrawalRequests?: WithdrawalRequestData[];\r\n}\r\n\r\n/**\r\n * API response structures\r\n */\r\nexport interface ApiSuccessResponse<T = any> {\r\n  data: T;\r\n}\r\n\r\nexport interface ApiErrorResponse {\r\n  errors: Array<{\r\n    status: string;\r\n    code: string;\r\n    title: string;\r\n    detail?: string;\r\n  }>;\r\n}\r\n\r\n/**\r\n * Form validation errors\r\n */\r\nexport interface ValidationErrors {\r\n  [field: string]: string[];\r\n}\r\n\r\n/**\r\n * Configuration constants\r\n */\r\nexport const WITHDRAWAL_STATUS = {\r\n  PENDING: 'pending',\r\n  APPROVED: 'approved',\r\n  REJECTED: 'rejected',\r\n} as const;\r\n\r\nexport type WithdrawalStatus = typeof WITHDRAWAL_STATUS[keyof typeof WITHDRAWAL_STATUS];\r\n\r\n/**\r\n * Default values\r\n */\r\nexport const DEFAULT_MIN_AMOUNT = 0.001;\r\nexport const DEFAULT_MAX_AMOUNT = 10;\r\nexport const DEFAULT_FEE = 0.0005;\r\n\r\n/**\r\n * Helper type guards\r\n */\r\nexport function isWithdrawalPlatform(obj: any): obj is WithdrawalPlatformData {\r\n  return obj &&\r\n    typeof obj === 'object' &&\r\n    'id' in obj &&\r\n    'name' in obj &&\r\n    'symbol' in obj &&\r\n    'minAmount' in obj &&\r\n    'maxAmount' in obj;\r\n}\r\n\r\nexport function isWithdrawalRequest(obj: any): obj is WithdrawalRequestData {\r\n  return obj &&\r\n    typeof obj === 'object' &&\r\n    'id' in obj &&\r\n    'amount' in obj &&\r\n    'accountDetails' in obj &&\r\n    'status' in obj &&\r\n    'platformId' in obj &&\r\n    'userId' in obj;\r\n}","import Model from 'flarum/common/Model';\r\nimport User from 'flarum/common/models/User';\r\nimport WithdrawalPlatform from './WithdrawalPlatform';\r\nimport { WithdrawalStatus, WITHDRAWAL_STATUS } from '../types';\r\n\r\n/**\r\n * WithdrawalRequest model for Flarum\r\n * \r\n * This model represents a user's withdrawal request.\r\n */\r\nexport default class WithdrawalRequest extends Model {\r\n  // Basic attributes\r\n  amount = Model.attribute<number>('amount');\r\n  accountDetails = Model.attribute<string>('accountDetails');\r\n  status = Model.attribute<WithdrawalStatus>('status');\r\n  \r\n  // Foreign keys\r\n  platformId = Model.attribute<number>('platformId');\r\n  userId = Model.attribute<number>('userId');\r\n  \r\n  // Timestamps\r\n  createdAt = Model.attribute('createdAt', Model.transformDate);\r\n  updatedAt = Model.attribute('updatedAt', Model.transformDate);\r\n  \r\n  // Relationships\r\n  user = Model.hasOne<User>('user');\r\n  platform = Model.hasOne<WithdrawalPlatform>('platform');\r\n  \r\n  // Computed properties\r\n  apiEndpoint() {\r\n    return `/withdrawal-requests/${this.id()}`;\r\n  }\r\n  \r\n  // Status helpers\r\n  isPending(): boolean {\r\n    return this.status() === WITHDRAWAL_STATUS.PENDING;\r\n  }\r\n  \r\n  isApproved(): boolean {\r\n    return this.status() === WITHDRAWAL_STATUS.APPROVED;\r\n  }\r\n  \r\n  isRejected(): boolean {\r\n    return this.status() === WITHDRAWAL_STATUS.REJECTED;\r\n  }\r\n  \r\n  canBeModified(): boolean {\r\n    return this.isPending();\r\n  }\r\n  \r\n  // Display helpers\r\n  statusLabel(): string {\r\n    const status = this.status();\r\n    return app.translator.trans(`withdrawal.forum.status.${status}`);\r\n  }\r\n  \r\n  statusColor(): string {\r\n    const status = this.status();\r\n    switch (status) {\r\n      case WITHDRAWAL_STATUS.APPROVED:\r\n        return 'success';\r\n      case WITHDRAWAL_STATUS.REJECTED:\r\n        return 'danger';\r\n      case WITHDRAWAL_STATUS.PENDING:\r\n      default:\r\n        return 'warning';\r\n    }\r\n  }\r\n}","import app from 'flarum/forum/app';\r\nimport { extend } from 'flarum/common/extend';\r\nimport LinkButton from 'flarum/common/components/LinkButton';\r\nimport ItemList from 'flarum/common/utils/ItemList';\r\nimport HeaderSecondary from 'flarum/forum/components/HeaderSecondary';\r\nimport WithdrawalPage from './components/WithdrawalPage';\r\nimport WithdrawalPlatform from '../common/models/WithdrawalPlatform';\r\nimport WithdrawalRequest from '../common/models/WithdrawalRequest';\r\n\r\napp.initializers.add('wusong8899-withdrawal', () => {\r\n  // Register models in store\r\n  app.store.models['withdrawal-platforms'] = WithdrawalPlatform;\r\n  app.store.models['withdrawal-requests'] = WithdrawalRequest;\r\n  \r\n  app.routes.withdrawal = { path: '/withdrawal', component: WithdrawalPage };\r\n\r\n  extend(HeaderSecondary.prototype, 'items', function (items: ItemList<any>) {\r\n    if (app.session.user) {\r\n      items.add(\r\n        'withdrawal',\r\n        LinkButton.component(\r\n          {\r\n            href: app.route('withdrawal'),\r\n            icon: 'fas fa-money-bill-transfer',\r\n          },\r\n          app.translator.trans('withdrawal.forum.header.withdrawal_button')\r\n        ),\r\n        10\r\n      );\r\n    }\r\n  });\r\n});"],"names":["getId","obj","getAttr","attr","WithdrawalPage","Page","Stream","vnode","app","LoadingIndicator","platform","icon","validRequests","request","error","item","platformId","p","status","statusClass","createdAt","date","amount","accountDetails","selected","validPlatforms","iconUrl","iconClass","name","symbol","e","target","fallbackIcon","fallbackIconClass","finalIconClass","finalSymbol","minAmount","maxAmount","fee","Button","finalAmount","text","response","r","WithdrawalPlatform","Model","min","max","WITHDRAWAL_STATUS","WithdrawalRequest","extend","HeaderSecondary","items","LinkButton"],"mappings":"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"}