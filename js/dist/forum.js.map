{"version":3,"file":"forum.js","sources":["../src/forum/components/WithdrawalPage.tsx","../src/forum/index.ts"],"sourcesContent":["import app from 'flarum/forum/app';\nimport Page from 'flarum/common/components/Page';\nimport Button from 'flarum/common/components/Button';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport Select from 'flarum/common/components/Select';\nimport Stream from 'flarum/common/utils/Stream';\nimport dayjs from 'flarum/common/utils/dayjs';\nimport type Mithril from 'mithril';\n\ninterface WithdrawalPlatform {\n  id: number;\n  attributes: {\n    name: string;\n  };\n}\n\ninterface WithdrawalRequest {\n  id: number;\n  attributes: {\n    amount: number;\n    accountDetails: string;\n    status: string;\n    createdAt: string;\n  };\n  relationships: {\n    platform: {\n      data: { id: number };\n    };\n  };\n}\n\nexport default class WithdrawalPage extends Page {\n  private platforms: WithdrawalPlatform[] = [];\n  private requests: WithdrawalRequest[] = [];\n  private loading = true;\n  private submitting = false;\n\n  private amount = Stream('');\n  private selectedPlatform = Stream('');\n  private accountDetails = Stream('');\n\n  oninit(vnode: Mithril.VnodeDOM) {\n    super.oninit(vnode);\n\n    app.setTitle(app.translator.trans('withdrawal.forum.page.title'));\n\n    this.loadData();\n  }\n\n  view() {\n    if (this.loading) {\n      return (\n        <div className=\"WithdrawalPage\">\n          <div className=\"container\">\n            <LoadingIndicator />\n          </div>\n        </div>\n      );\n    }\n\n    const minAmount = app.forum.attribute('withdrawal.minAmount') || 0;\n    const maxAmount = app.forum.attribute('withdrawal.maxAmount') || 10000;\n    const fee = app.forum.attribute('withdrawal.fee') || 0;\n\n    return (\n      <div className=\"WithdrawalPage\">\n        <div className=\"container\">\n          <div className=\"WithdrawalPage-header\">\n            <h1>{app.translator.trans('withdrawal.forum.page.title')}</h1>\n            <p>{app.translator.trans('withdrawal.forum.page.description')}</p>\n          </div>\n\n          <div className=\"WithdrawalPage-content\">\n            <div className=\"WithdrawalPage-form\">\n              <h3>{app.translator.trans('withdrawal.forum.form.title')}</h3>\n              \n              <div className=\"WithdrawalPage-formGroup\">\n                <label>{app.translator.trans('withdrawal.forum.form.platform')}</label>\n                <Select\n                  options={this.getPlatformOptions()}\n                  value={this.selectedPlatform()}\n                  onchange={this.selectedPlatform}\n                />\n              </div>\n\n              <div className=\"WithdrawalPage-formGroup\">\n                <label>{app.translator.trans('withdrawal.forum.form.amount')}</label>\n                <input\n                  type=\"number\"\n                  className=\"FormControl\"\n                  placeholder={app.translator.trans('withdrawal.forum.form.amount_placeholder', { min: minAmount, max: maxAmount })}\n                  value={this.amount()}\n                  oninput={(e: Event) => this.amount((e.target as HTMLInputElement).value)}\n                  min={minAmount}\n                  max={maxAmount}\n                  step=\"0.01\"\n                />\n                <small className=\"helpText\">\n                  {app.translator.trans('withdrawal.forum.form.amount_help', { min: minAmount, max: maxAmount, fee: fee })}\n                </small>\n              </div>\n\n              <div className=\"WithdrawalPage-formGroup\">\n                <label>{app.translator.trans('withdrawal.forum.form.account_details')}</label>\n                <textarea\n                  className=\"FormControl\"\n                  placeholder={app.translator.trans('withdrawal.forum.form.account_details_placeholder')}\n                  value={this.accountDetails()}\n                  oninput={(e: Event) => this.accountDetails((e.target as HTMLTextAreaElement).value)}\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"WithdrawalPage-formGroup\">\n                <Button\n                  className=\"Button Button--primary\"\n                  loading={this.submitting}\n                  disabled={!this.canSubmit()}\n                  onclick={this.submit.bind(this)}\n                >\n                  {app.translator.trans('withdrawal.forum.form.submit')}\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"WithdrawalPage-history\">\n              <h3>{app.translator.trans('withdrawal.forum.history.title')}</h3>\n              {this.requests.length === 0 ? (\n                <p>{app.translator.trans('withdrawal.forum.history.empty')}</p>\n              ) : (\n                <div className=\"WithdrawalPage-historyList\">\n                  {this.requests.map((request) => this.renderRequest(request))}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  private renderRequest(request: WithdrawalRequest): Mithril.Children {\n    const platform = this.platforms.find(p => p.id == request.relationships.platform.data.id);\n    const statusClass = `status-${request.attributes.status}`;\n\n    return (\n      <div key={request.id} className={`WithdrawalRequest ${statusClass}`}>\n        <div className=\"WithdrawalRequest-info\">\n          <span className=\"WithdrawalRequest-amount\">${request.attributes.amount}</span>\n          <span className=\"WithdrawalRequest-platform\">{platform?.attributes.name}</span>\n          <span className=\"WithdrawalRequest-date\">\n            {dayjs(request.attributes.createdAt).format('YYYY-MM-DD HH:mm')}\n          </span>\n        </div>\n        <div className=\"WithdrawalRequest-status\">\n          <span className={`Badge Badge--${request.attributes.status}`}>\n            {app.translator.trans(`withdrawal.forum.status.${request.attributes.status}`)}\n          </span>\n        </div>\n      </div>\n    );\n  }\n\n  private getPlatformOptions(): Record<string, string> {\n    const options: Record<string, string> = {\n      '': app.translator.trans('withdrawal.forum.form.select_platform')\n    };\n\n    this.platforms.forEach(platform => {\n      options[platform.id.toString()] = platform.attributes.name;\n    });\n\n    return options;\n  }\n\n  private canSubmit(): boolean {\n    return !!(\n      this.selectedPlatform() &&\n      this.amount() &&\n      this.accountDetails() &&\n      !this.submitting\n    );\n  }\n\n  private async submit(): Promise<void> {\n    if (!this.canSubmit()) return;\n\n    this.submitting = true;\n\n    try {\n      const data = {\n        type: 'withdrawal-requests',\n        attributes: {\n          platformId: parseInt(this.selectedPlatform()),\n          amount: parseFloat(this.amount()),\n          accountDetails: this.accountDetails()\n        }\n      };\n\n      await app.store.createRecord('withdrawal-requests').save(data);\n\n      app.alerts.show({\n        type: 'success',\n        message: app.translator.trans('withdrawal.forum.form.success')\n      });\n\n      this.amount('');\n      this.selectedPlatform('');\n      this.accountDetails('');\n\n      this.loadRequests();\n    } catch (error) {\n      console.error('Error submitting withdrawal request:', error);\n      app.alerts.show({\n        type: 'error',\n        message: app.translator.trans('withdrawal.forum.form.error')\n      });\n    } finally {\n      this.submitting = false;\n      m.redraw();\n    }\n  }\n\n  private async loadData(): Promise<void> {\n    try {\n      await Promise.all([\n        this.loadPlatforms(),\n        this.loadRequests()\n      ]);\n    } catch (error) {\n      console.error('Error loading data:', error);\n    } finally {\n      this.loading = false;\n      m.redraw();\n    }\n  }\n\n  private async loadPlatforms(): Promise<void> {\n    const response = await app.store.find('withdrawal-platforms');\n    this.platforms = Array.isArray(response) ? response : [response];\n  }\n\n  private async loadRequests(): Promise<void> {\n    const response = await app.store.find('withdrawal-requests');\n    this.requests = Array.isArray(response) ? response : [response];\n  }\n}","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport HeaderSecondary from 'flarum/forum/components/HeaderSecondary';\nimport WithdrawalPage from './components/WithdrawalPage';\n\napp.initializers.add('wusong8899-flarum-withdrawal', () => {\n  app.routes.withdrawal = { path: '/withdrawal', component: WithdrawalPage };\n\n  extend(HeaderSecondary.prototype, 'items', function (items: ItemList<any>) {\n    if (app.session.user) {\n      items.add(\n        'withdrawal',\n        LinkButton.component(\n          {\n            href: app.route('withdrawal'),\n            icon: 'fas fa-money-bill-transfer',\n          },\n          app.translator.trans('withdrawal.forum.header.withdrawal_button')\n        ),\n        10\n      );\n    }\n  });\n});"],"names":["WithdrawalPage","Page","Stream","vnode","app","LoadingIndicator","minAmount","maxAmount","fee","Select","e","Button","request","platform","p","statusClass","dayjs","options","data","error","response","extend","HeaderSecondary","items","LinkButton"],"mappings":"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"}