(function(a,b,c,y,i,N,A,r,F){"use strict";class q extends b{constructor(){super(...arguments),this.platforms=[],this.requests=[],this.users={},this.loading=!0,this.newPlatformName=i(""),this.newPlatformSymbol=i(""),this.newPlatformMinAmount=i(""),this.newPlatformMaxAmount=i(""),this.newPlatformFee=i(""),this.newPlatformIconUrl=i(""),this.newPlatformIconClass=i(""),this.newPlatformIsActive=i(!0),this.submittingPlatform=!1}oninit(t){super.oninit(t),this.loadData()}content(){return this.loading?m(y,null):m("div",{className:"WithdrawalManagementPage"},m("div",{className:"container"},m("h2",null,a.translator.trans("withdrawal.admin.page.title")),this.renderSettings(),this.renderPlatformManagement(),this.renderRequestManagement()))}renderSettings(){return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,a.translator.trans("withdrawal.admin.settings.title")),m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.settings.fee")),this.buildSettingComponent({type:"number",setting:"withdrawal.fee",placeholder:"0"})),m("div",{className:"Form-group"},this.submitButton())))}renderPlatformManagement(){return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,a.translator.trans("withdrawal.admin.platforms.title")),m("div",{className:"WithdrawalManagementPage-addPlatform"},m("div",{className:"Form-group"},m("div",{className:"Form-row"},m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.name")),m("input",{type:"text",className:"FormControl",placeholder:a.translator.trans("withdrawal.admin.platforms.add_placeholder"),value:this.newPlatformName(),oninput:t=>this.newPlatformName(t.target.value)})),m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.symbol")),m("input",{type:"text",className:"FormControl",placeholder:"BTC, ETH, USDT...",value:this.newPlatformSymbol(),oninput:t=>this.newPlatformSymbol(t.target.value)}))),m("div",{className:"Form-row"},m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.min_amount")),m("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.001",value:this.newPlatformMinAmount(),oninput:t=>this.newPlatformMinAmount(t.target.value)})),m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.max_amount")),m("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"10.0",value:this.newPlatformMaxAmount(),oninput:t=>this.newPlatformMaxAmount(t.target.value)})),m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.fee")),m("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.0005",value:this.newPlatformFee(),oninput:t=>this.newPlatformFee(t.target.value)}))),m("div",{className:"Form-row"},m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.icon_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://example.com/icon.png",value:this.newPlatformIconUrl(),oninput:t=>this.newPlatformIconUrl(t.target.value)}),m("small",{className:"helpText"},a.translator.trans("withdrawal.admin.platforms.icon_url_help"))),m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.icon_class")),m("input",{type:"text",className:"FormControl",placeholder:"fas fa-coins",value:this.newPlatformIconClass(),oninput:t=>this.newPlatformIconClass(t.target.value)}),m("small",{className:"helpText"},a.translator.trans("withdrawal.admin.platforms.icon_class_help")))),m("div",{className:"Form-row"},m("div",{className:"Form-col"},m("label",null,m("input",{type:"checkbox",checked:this.newPlatformIsActive(),onchange:t=>this.newPlatformIsActive(t.target.checked)}),a.translator.trans("withdrawal.admin.platforms.is_active")))),m("div",{className:"Form-group"},m(c,{className:"Button Button--primary",loading:this.submittingPlatform,disabled:!this.canSubmitPlatform(),onclick:this.addPlatform.bind(this)},a.translator.trans("withdrawal.admin.platforms.add_button"))))),m("div",{className:"WithdrawalManagementPage-platformList"},this.platforms.length===0?m("p",null,a.translator.trans("withdrawal.admin.platforms.empty")):this.platforms.map(t=>this.renderPlatform(t))))}renderPlatform(t){const e=t.id(),s=t.name?t.name():"Unknown Platform",o=t.symbol?t.symbol():"N/A",n=t.minAmount?t.minAmount():"N/A",d=t.maxAmount?t.maxAmount():"N/A",P=t.fee?t.fee():"N/A",u=t.isActive?t.isActive():!1,h=t.createdAt?t.createdAt():null;let w="N/A";if(h)try{w=N(h)}catch(f){console.error("Error formatting date:",f),w="Invalid Date"}return m("div",{key:e,className:"WithdrawalPlatform"},m("div",{className:"WithdrawalPlatform-info"},m("div",{className:"WithdrawalPlatform-primary"},m("span",{className:"WithdrawalPlatform-name"},s),m("span",{className:`WithdrawalPlatform-symbol ${o}`},o),m("span",{className:`WithdrawalPlatform-status ${u?"active":"inactive"}`},u?a.translator.trans("withdrawal.admin.platforms.active"):a.translator.trans("withdrawal.admin.platforms.inactive"))),m("div",{className:"WithdrawalPlatform-details"},m("span",{className:"WithdrawalPlatform-amounts"},"Min: ",n," | Max: ",d," | Fee: ",P),m("span",{className:"WithdrawalPlatform-date"},w))),m(c,{className:"Button Button--danger",onclick:()=>this.deletePlatform(t)},a.translator.trans("withdrawal.admin.platforms.delete")))}canSubmitPlatform(){return!!(this.newPlatformName()&&this.newPlatformSymbol()&&this.newPlatformMinAmount()&&this.newPlatformMaxAmount()&&parseFloat(this.newPlatformMinAmount())>0&&parseFloat(this.newPlatformMaxAmount())>0&&parseFloat(this.newPlatformMaxAmount())>=parseFloat(this.newPlatformMinAmount()))}renderRequestManagement(){const t=this.requests.filter(s=>s.status?s.status()==="pending":!1),e=this.requests.filter(s=>s.status?s.status()!=="pending":!0);return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,a.translator.trans("withdrawal.admin.requests.title")),m("div",{className:"WithdrawalManagementPage-pendingRequests"},m("h4",null,a.translator.trans("withdrawal.admin.requests.pending_title")),t.length===0?m("p",null,a.translator.trans("withdrawal.admin.requests.no_pending")):t.map(s=>this.renderRequest(s,!0))),m("div",{className:"WithdrawalManagementPage-processedRequests"},m("h4",null,a.translator.trans("withdrawal.admin.requests.processed_title")),e.length===0?m("p",null,a.translator.trans("withdrawal.admin.requests.no_processed")):e.map(s=>this.renderRequest(s,!1))))}renderRequest(t,e){const s=t.id(),o=t.amount?t.amount():0,n=t.status?t.status():"pending",d=t.accountDetails?t.accountDetails():"N/A",P=t.createdAt?t.createdAt():null;let u="Unknown User";if(t.user){const l=t.user();l&&l.displayName&&(u=l.displayName())}else if(t.relationships?.user?.data?.id){const l=this.users[t.relationships.user.data.id];l&&l.displayName&&(u=l.displayName())}let h="Unknown Platform";if(t.platform){const l=t.platform();l&&l.name&&(h=l.name())}else if(t.relationships?.platform?.data?.id){const l=this.platforms.find(x=>x.id()==t.relationships.platform.data.id);l&&l.name&&(h=l.name())}const w=`status-${n}`;let f="N/A";if(P)try{f=N(P)}catch(l){console.error("Error formatting request date:",l),f="Invalid Date"}return m("div",{key:s,className:`WithdrawalRequest ${w}`},m("div",{className:"WithdrawalRequest-info"},m("div",{className:"WithdrawalRequest-user"},m("strong",null,u)),m("div",{className:"WithdrawalRequest-details"},m("span",{className:"amount"},"$",o),m("span",{className:"platform"},h),m("span",{className:"date"},f)),m("div",{className:"WithdrawalRequest-account"},m("strong",null,a.translator.trans("withdrawal.admin.requests.account_details"),":"),m("span",null,d)),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${n}`},a.translator.trans(`withdrawal.admin.requests.status.${n}`)))),e&&m("div",{className:"WithdrawalRequest-actions"},m(c,{className:"Button Button--primary",onclick:()=>this.updateRequestStatus(t,"approved")},a.translator.trans("withdrawal.admin.requests.approve")),m(c,{className:"Button Button--danger",onclick:()=>this.updateRequestStatus(t,"rejected")},a.translator.trans("withdrawal.admin.requests.reject"))))}async addPlatform(){if(!(!this.canSubmitPlatform()||this.submittingPlatform)){this.submittingPlatform=!0;try{const t=await a.request({method:"POST",url:a.forum.attribute("apiUrl")+"/withdrawal-platforms",body:{data:{type:"withdrawal-platforms",attributes:{name:this.newPlatformName(),symbol:this.newPlatformSymbol(),minAmount:parseFloat(this.newPlatformMinAmount()),maxAmount:parseFloat(this.newPlatformMaxAmount()),fee:parseFloat(this.newPlatformFee()||"0"),iconUrl:this.newPlatformIconUrl()||null,iconClass:this.newPlatformIconClass()||null,isActive:this.newPlatformIsActive()}}}});t&&t.data&&a.store.pushPayload(t),this.newPlatformName(""),this.newPlatformSymbol(""),this.newPlatformMinAmount(""),this.newPlatformMaxAmount(""),this.newPlatformFee(""),this.newPlatformIconUrl(""),this.newPlatformIconClass(""),this.newPlatformIsActive(!0),await this.loadPlatforms(),a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.admin.platforms.add_success"))}catch(t){console.error("Error adding platform:",t),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.platforms.add_error"))}finally{this.submittingPlatform=!1,m.redraw()}}}deletePlatform(t){const e=t.name?t.name():"Unknown Platform";a.modal.show(_,{platformName:e,onConfirm:async()=>{try{const s=a.store.getById("withdrawal-platforms",t.id());s&&(await s.delete(),await this.loadPlatforms(),a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.admin.platforms.delete_success")))}catch(s){console.error("Error deleting platform:",s),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.platforms.delete_error"))}}})}async updateRequestStatus(t,e){try{const s=a.store.getById("withdrawal-requests",t.id);s&&(await s.save({status:e}),await this.loadRequests(),a.alerts.show({type:"success",dismissible:!0},a.translator.trans(`withdrawal.admin.requests.${e}_success`)))}catch(s){console.error("Error updating request:",s),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.requests.update_error"))}}async loadData(){try{await Promise.all([this.loadPlatforms(),this.loadRequests()])}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,m.redraw()}}async loadPlatforms(){try{const t=await a.store.find("withdrawal-platforms");this.platforms=Array.isArray(t)?t.filter(e=>e!==null):t?[t]:[],console.log("Loaded platforms:",this.platforms)}catch(t){console.error("Error loading platforms:",t),this.platforms=[]}}async loadRequests(){try{const s=await a.store.find("withdrawal-requests");this.requests=Array.isArray(s)?s.filter(o=>o!==null):s?[s]:[],console.log("Loaded requests:",this.requests)}catch(s){console.error("Error loading requests:",s),this.requests=[]}const e=[...new Set(this.requests.map(s=>s.relationships.user.data.id))].filter(s=>!this.users[s]);if(e.length>0)try{const s=e.map(n=>a.store.find("users",n).catch(d=>(console.error(`Error loading user ${n}:`,d),null))),o=await Promise.all(s);e.forEach((n,d)=>{o[d]&&(this.users[n]=o[d])})}catch(s){console.error("Error loading users:",s)}}}class _ extends A{constructor(t){super(t),this.platformName=t.attrs.platformName,this.onConfirm=t.attrs.onConfirm}className(){return"ConfirmDeleteModal Modal--small"}title(){return a.translator.trans("withdrawal.admin.platforms.delete_confirm_title")}content(){return m("div",{className:"Modal-body"},m("p",null,a.translator.trans("withdrawal.admin.platforms.delete_confirm_message",{name:this.platformName})),m("div",{className:"Form-group"},m(c,{className:"Button Button--primary",onclick:this.confirm.bind(this)},a.translator.trans("withdrawal.admin.platforms.delete_confirm_button")),m(c,{className:"Button",onclick:this.hide.bind(this)},a.translator.trans("withdrawal.admin.platforms.delete_cancel_button"))))}confirm(){this.onConfirm(),this.hide()}}class p extends r{constructor(){super(...arguments),this.name=r.attribute("name"),this.symbol=r.attribute("symbol"),this.minAmount=r.attribute("minAmount"),this.maxAmount=r.attribute("maxAmount"),this.fee=r.attribute("fee"),this.iconUrl=r.attribute("iconUrl"),this.iconClass=r.attribute("iconClass"),this.isActive=r.attribute("isActive"),this.createdAt=r.attribute("createdAt",r.transformDate),this.updatedAt=r.attribute("updatedAt",r.transformDate)}}class v extends r{constructor(){super(...arguments),this.amount=r.attribute("amount"),this.accountDetails=r.attribute("accountDetails"),this.status=r.attribute("status"),this.createdAt=r.attribute("createdAt",r.transformDate),this.updatedAt=r.attribute("updatedAt",r.transformDate),this.user=r.hasOne("user"),this.platform=r.hasOne("withdrawal-platforms")}}new F.Store().add("withdrawal-platforms",p).add("withdrawal-requests",v),a.initializers.add("wusong8899-withdrawal",()=>{a.store.models["withdrawal-platforms"]=p,a.store.models["withdrawal-requests"]=v,a.extensionData.for("wusong8899-withdrawal").registerPage(q)})})(flarum.core.compat["admin/app"],flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/components/Modal"],flarum.core.compat["common/Model"],flarum.core.compat["common/extenders"]);
//# sourceMappingURL=admin.js.map

module.exports={};