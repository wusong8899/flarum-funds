(function(a,h,d,w,f,u,g,N,e){"use strict";class P extends h{constructor(){super(...arguments),this.platforms=[],this.requests=[],this.users={},this.loading=!0,this.newPlatformName=f(""),this.submittingPlatform=!1}oninit(t){super.oninit(t),this.loadData()}content(){return this.loading?m(w,null):m("div",{className:"WithdrawalManagementPage"},m("div",{className:"container"},m("h2",null,a.translator.trans("withdrawal.admin.page.title")),this.renderSettings(),this.renderPlatformManagement(),this.renderRequestManagement()))}renderSettings(){return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,a.translator.trans("withdrawal.admin.settings.title")),m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.settings.min_amount")),this.buildSettingComponent({type:"number",setting:"withdrawal.min_amount",placeholder:"0"})),m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.settings.max_amount")),this.buildSettingComponent({type:"number",setting:"withdrawal.max_amount",placeholder:"10000"})),m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.settings.fee")),this.buildSettingComponent({type:"number",setting:"withdrawal.fee",placeholder:"0"})),m("div",{className:"Form-group"},this.submitButton())))}renderPlatformManagement(){return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,a.translator.trans("withdrawal.admin.platforms.title")),m("div",{className:"WithdrawalManagementPage-addPlatform"},m("div",{className:"Form-group"},m("input",{type:"text",className:"FormControl",placeholder:a.translator.trans("withdrawal.admin.platforms.add_placeholder"),value:this.newPlatformName(),oninput:t=>this.newPlatformName(t.target.value)}),m(d,{className:"Button Button--primary",loading:this.submittingPlatform,disabled:!this.newPlatformName(),onclick:this.addPlatform.bind(this)},a.translator.trans("withdrawal.admin.platforms.add_button")))),m("div",{className:"WithdrawalManagementPage-platformList"},this.platforms.length===0?m("p",null,a.translator.trans("withdrawal.admin.platforms.empty")):this.platforms.map(t=>this.renderPlatform(t))))}renderPlatform(t){const r=t.attributes?.createdAt||t.attributes?.created_at||new Date().toISOString();return m("div",{key:t.id,className:"WithdrawalPlatform"},m("span",{className:"WithdrawalPlatform-name"},t.attributes?.name||"Unknown Platform"),m("span",{className:"WithdrawalPlatform-date"},r?u(r).format("YYYY-MM-DD"):"N/A"),m(d,{className:"Button Button--danger",onclick:()=>this.deletePlatform(t)},a.translator.trans("withdrawal.admin.platforms.delete")))}renderRequestManagement(){const t=this.requests.filter(s=>s.attributes.status==="pending"),r=this.requests.filter(s=>s.attributes.status!=="pending");return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,a.translator.trans("withdrawal.admin.requests.title")),m("div",{className:"WithdrawalManagementPage-pendingRequests"},m("h4",null,a.translator.trans("withdrawal.admin.requests.pending_title")),t.length===0?m("p",null,a.translator.trans("withdrawal.admin.requests.no_pending")):t.map(s=>this.renderRequest(s,!0))),m("div",{className:"WithdrawalManagementPage-processedRequests"},m("h4",null,a.translator.trans("withdrawal.admin.requests.processed_title")),r.length===0?m("p",null,a.translator.trans("withdrawal.admin.requests.no_processed")):r.map(s=>this.renderRequest(s,!1))))}renderRequest(t,r){const s=t.relationships?.user?.data?.id,l=t.relationships?.platform?.data?.id,n=s?this.users[s]:null,i=l?this.platforms.find(R=>R.id==l):null,q=`status-${t.attributes.status}`,c=t.attributes.createdAt||t.attributes.created_at,v=t.attributes.accountDetails||t.attributes.account_details;return m("div",{key:t.id,className:`WithdrawalRequest ${q}`},m("div",{className:"WithdrawalRequest-info"},m("div",{className:"WithdrawalRequest-user"},m("strong",null,n?.attributes?.displayName||"Unknown User")),m("div",{className:"WithdrawalRequest-details"},m("span",{className:"amount"},"$",t.attributes.amount),m("span",{className:"platform"},i?.attributes?.name||"Unknown Platform"),m("span",{className:"date"},c?u(c).format("YYYY-MM-DD HH:mm"):"N/A")),m("div",{className:"WithdrawalRequest-account"},m("strong",null,a.translator.trans("withdrawal.admin.requests.account_details"),":"),m("span",null,v||"N/A")),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${t.attributes.status}`},a.translator.trans(`withdrawal.admin.requests.status.${t.attributes.status}`)))),r&&m("div",{className:"WithdrawalRequest-actions"},m(d,{className:"Button Button--primary",onclick:()=>this.updateRequestStatus(t,"approved")},a.translator.trans("withdrawal.admin.requests.approve")),m(d,{className:"Button Button--danger",onclick:()=>this.updateRequestStatus(t,"rejected")},a.translator.trans("withdrawal.admin.requests.reject"))))}async addPlatform(){if(!(!this.newPlatformName()||this.submittingPlatform)){this.submittingPlatform=!0;try{const t={type:"withdrawal-platforms",attributes:{name:this.newPlatformName()}};await a.store.createRecord("withdrawal-platforms").save(t),this.newPlatformName(""),await this.loadPlatforms(),a.alerts.show({type:"success",message:a.translator.trans("withdrawal.admin.platforms.add_success")})}catch(t){console.error("Error adding platform:",t),a.alerts.show({type:"error",message:a.translator.trans("withdrawal.admin.platforms.add_error")})}finally{this.submittingPlatform=!1,m.redraw()}}}async deletePlatform(t){if(confirm(a.translator.trans("withdrawal.admin.platforms.delete_confirm",{name:t.attributes.name})))try{const r=a.store.getById("withdrawal-platforms",t.id);r&&(await r.delete(),await this.loadPlatforms(),a.alerts.show({type:"success",message:a.translator.trans("withdrawal.admin.platforms.delete_success")}))}catch(r){console.error("Error deleting platform:",r),a.alerts.show({type:"error",message:a.translator.trans("withdrawal.admin.platforms.delete_error")})}}async updateRequestStatus(t,r){try{const s=a.store.getById("withdrawal-requests",t.id);s&&(await s.save({status:r}),await this.loadRequests(),a.alerts.show({type:"success",message:a.translator.trans(`withdrawal.admin.requests.${r}_success`)}))}catch(s){console.error("Error updating request:",s),a.alerts.show({type:"error",message:a.translator.trans("withdrawal.admin.requests.update_error")})}}async loadData(){try{await Promise.all([this.loadPlatforms(),this.loadRequests()])}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,m.redraw()}}async loadPlatforms(){try{const t=await a.store.find("withdrawal-platforms");this.platforms=Array.isArray(t)?t:[t],console.log("Loaded platforms:",this.platforms)}catch(t){console.error("Error loading platforms:",t),this.platforms=[]}}async loadRequests(){try{const s=await a.store.find("withdrawal-requests");this.requests=Array.isArray(s)?s:[s],console.log("Loaded requests:",this.requests)}catch(s){console.error("Error loading requests:",s),this.requests=[]}const r=[...new Set(this.requests.map(s=>s.relationships.user.data.id))].filter(s=>!this.users[s]);if(r.length>0)try{const s=r.map(n=>a.store.find("users",n).catch(i=>(console.error(`Error loading user ${n}:`,i),null))),l=await Promise.all(s);r.forEach((n,i)=>{l[i]&&(this.users[n]=l[i])})}catch(s){console.error("Error loading users:",s)}}}class b extends e{constructor(){super(...arguments),this.name=e.attribute("name"),this.createdAt=e.attribute("created_at",e.transformDate)}}class p extends e{constructor(){super(...arguments),this.amount=e.attribute("amount"),this.accountDetails=e.attribute("account_details"),this.status=e.attribute("status"),this.createdAt=e.attribute("created_at",e.transformDate),this.user=e.hasOne("user"),this.platform=e.hasOne("withdrawal-platforms")}}function y(){g.extend(N.prototype,"models",function(o){o["withdrawal-platforms"]=b,o["withdrawal-requests"]=p})}a.initializers.add("wusong8899-withdrawal",()=>{y(),a.extensionData.for("wusong8899-withdrawal").registerPage(P)})})(flarum.core.compat["admin/app"],flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/utils/dayjs"],flarum.core.compat["common/extend"],flarum.core.compat["common/Store"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=admin.js.map

module.exports={};