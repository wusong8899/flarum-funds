(function(s,q,_,f,D,u,c,A,v,i){"use strict";class x extends f{view(){return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,"General Settings"),m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.settings.money_icon_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://i.mji.rip/2025/08/28/cd18932c68e9bbee9502b1fb6317cba9.png",value:s.forum.attribute("wusong8899-withdrawal.moneyIconUrl")||"",oninput:D("value",t=>this.attrs.onSettingChange("wusong8899-withdrawal.moneyIconUrl",t))}),m("small",{className:"helpText"},s.translator.trans("withdrawal.admin.settings.money_icon_url_help")))))}}class R extends f{constructor(){super(...arguments),this.name=c(""),this.symbol=c(""),this.minAmount=c(""),this.maxAmount=c(""),this.fee=c(""),this.iconUrl=c(""),this.iconClass=c("")}view(){return m("div",{className:"WithdrawalManagementPage-addPlatform"},m("div",{className:"Form-group"},m("div",{className:"Form-row"},m("div",{className:"Form-col"},m("label",null,s.translator.trans("withdrawal.admin.platforms.name")),m("input",{type:"text",className:"FormControl",placeholder:s.translator.trans("withdrawal.admin.platforms.add_placeholder"),bidi:this.name})),m("div",{className:"Form-col"},m("label",null,s.translator.trans("withdrawal.admin.platforms.symbol")),m("input",{type:"text",className:"FormControl",placeholder:"BTC, ETH, USDT...",bidi:this.symbol}))),m("div",{className:"Form-row"},m("div",{className:"Form-col"},m("label",null,s.translator.trans("withdrawal.admin.platforms.min_amount")),m("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.001",bidi:this.minAmount})),m("div",{className:"Form-col"},m("label",null,s.translator.trans("withdrawal.admin.platforms.max_amount")),m("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"10.0",bidi:this.maxAmount})),m("div",{className:"Form-col"},m("label",null,s.translator.trans("withdrawal.admin.platforms.fee")),m("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.0005",bidi:this.fee}))),m("div",{className:"Form-row"},m("div",{className:"Form-col"},m("label",null,s.translator.trans("withdrawal.admin.platforms.icon_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://example.com/icon.png",bidi:this.iconUrl}),m("small",{className:"helpText"},s.translator.trans("withdrawal.admin.platforms.icon_url_help"))),m("div",{className:"Form-col"},m("label",null,s.translator.trans("withdrawal.admin.platforms.icon_class")),m("input",{type:"text",className:"FormControl",placeholder:"fas fa-coins",bidi:this.iconClass}),m("small",{className:"helpText"},s.translator.trans("withdrawal.admin.platforms.icon_class_help")))),m("div",{className:"Form-group"},m(u,{className:"Button Button--primary",loading:this.attrs.submitting,disabled:!this.canSubmit(),onclick:this.handleSubmit.bind(this)},s.translator.trans("withdrawal.admin.platforms.add_button")))))}canSubmit(){return!!(this.name()&&this.name().trim()&&this.symbol()&&this.symbol().trim()&&this.minAmount()&&this.maxAmount()&&parseFloat(this.minAmount())>0&&parseFloat(this.maxAmount())>0&&parseFloat(this.maxAmount())>=parseFloat(this.minAmount()))}async handleSubmit(){if(!this.canSubmit()||this.attrs.submitting)return;const t={name:this.name(),symbol:this.symbol(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),iconUrl:this.iconUrl(),iconClass:this.iconClass()};try{await this.attrs.onSubmit(t),this.clearForm()}catch{}}clearForm(){this.name(""),this.symbol(""),this.minAmount(""),this.maxAmount(""),this.fee(""),this.iconUrl(""),this.iconClass(""),m.redraw()}}class F extends f{view(){const t=this.attrs.platform,e=typeof t.id=="function"?t.id():t.id,a=(typeof t.name=="function"?t.name():t.attributes?.name)||"Unknown Platform",n=(typeof t.symbol=="function"?t.symbol():t.attributes?.symbol)||"N/A",o=(typeof t.minAmount=="function"?t.minAmount():t.attributes?.minAmount)||"N/A",r=(typeof t.maxAmount=="function"?t.maxAmount():t.attributes?.maxAmount)||"N/A",g=(typeof t.fee=="function"?t.fee():t.attributes?.fee)||"N/A",h=(typeof t.isActive=="function"?t.isActive():t.attributes?.isActive)??!1,b=(typeof t.createdAt=="function"?t.createdAt():t.attributes?.createdAt)||null;let y="N/A";if(b)try{y=A(b)}catch(N){console.error("Error formatting date:",N),y="Invalid Date"}return m("div",{key:e,className:"WithdrawalPlatform"},m("div",{className:"WithdrawalPlatform-info"},m("div",{className:"WithdrawalPlatform-primary"},m("span",{className:`WithdrawalPlatform-status ${h?"active":"inactive"}`},h?"ðŸŸ¢":"ðŸ”´"),m("span",{className:"WithdrawalPlatform-name"},a),m("span",{className:"platform-id"},"#",e),m("span",{className:`WithdrawalPlatform-symbol ${n}`},n)),m("div",{className:"WithdrawalPlatform-details"},m("span",{className:"WithdrawalPlatform-amounts"},"Min: ",o," | Max: ",r," | Fee: ",g),m("span",{className:"WithdrawalPlatform-date"},y))),m("div",{className:"WithdrawalPlatform-actions"},m(u,{className:`Button ${h?"Button--secondary":"Button--primary"}`,onclick:()=>this.attrs.onToggleStatus(t)},s.translator.trans(`withdrawal.admin.platforms.${h?"disable":"enable"}`)),m(u,{className:"Button Button--danger",onclick:()=>this.attrs.onDelete(t)},s.translator.trans("withdrawal.admin.platforms.delete"))))}}class E extends f{view(){const{platforms:t,submittingPlatform:e,onAddPlatform:a,onTogglePlatformStatus:n,onDeletePlatform:o}=this.attrs;return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,s.translator.trans("withdrawal.admin.platforms.title")),m(R,{onSubmit:a,submitting:e}),m("div",{className:"WithdrawalManagementPage-platformList"},t.length===0?m("p",null,s.translator.trans("withdrawal.admin.platforms.empty")):t.map(r=>m(F,{key:typeof r.id=="function"?r.id():r.id,platform:r,onToggleStatus:n,onDelete:o}))))}}class P extends f{view(){const t=this.attrs.request,{showActions:e,showDelete:a=!1}=this.attrs,n=typeof t.id=="function"?t.id():t.id,o=typeof t.amount=="function"?t.amount():t.attributes?.amount||0,r=typeof t.status=="function"?t.status():t.attributes?.status||"pending",g=typeof t.accountDetails=="function"?t.accountDetails():t.attributes?.accountDetails||t.attributes?.account_details||"N/A",h=typeof t.createdAt=="function"?t.createdAt():t.attributes?.createdAt||null;let b="Unknown User";if(typeof t.user=="function"){const l=t.user();l&&typeof l.displayName=="function"?b=l.displayName():l&&l.attributes?.displayName&&(b=l.attributes.displayName)}let y="Unknown Platform",N="N/A";if(typeof t.platform=="function"){const l=t.platform();l&&(y=typeof l.name=="function"?l.name():l.attributes?.name||"Unknown Platform",N=typeof l.symbol=="function"?l.symbol():l.attributes?.symbol||"N/A")}const T=`status-${r}`;let p="N/A";if(h)try{p=A(h)}catch(l){console.error("Error formatting request date:",l),p="Invalid Date"}return m("div",{key:n,className:`WithdrawalRequest ${T}`},m("div",{className:"WithdrawalRequest-info"},m("div",{className:"WithdrawalRequest-user"},m("strong",null,b),m("span",{className:"request-id"},"#",n)),m("div",{className:"WithdrawalRequest-details"},m("span",{className:"amount"},o),m("span",{className:"platform"},y),m("span",{className:"symbol"},N),m("span",{className:"date"},p)),m("div",{className:"WithdrawalRequest-account"},m("strong",null,s.translator.trans("withdrawal.admin.requests.account_details"),":"),m("span",null,g)),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${r}`},s.translator.trans(`withdrawal.admin.requests.status.${r}`)))),(e||a)&&m("div",{className:"WithdrawalRequest-actions"},e&&this.attrs.onUpdateStatus&&m("[",null,m(u,{className:"Button Button--primary",onclick:()=>this.attrs.onUpdateStatus(t,"approved")},s.translator.trans("withdrawal.admin.requests.approve")),m(u,{className:"Button Button--danger",onclick:()=>this.attrs.onUpdateStatus(t,"rejected")},s.translator.trans("withdrawal.admin.requests.reject"))),this.attrs.onDelete&&m(u,{className:"Button Button--link",onclick:()=>this.attrs.onDelete(t)},m("i",{className:"fas fa-trash"}),s.translator.trans("withdrawal.admin.requests.delete"))))}}class S extends f{view(){const{requests:t,onUpdateRequestStatus:e,onDeleteRequest:a}=this.attrs,n=t.filter(r=>((typeof r.status=="function"?r.status():r.attributes?.status)||"pending")==="pending"),o=t.filter(r=>((typeof r.status=="function"?r.status():r.attributes?.status)||"pending")!=="pending");return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,s.translator.trans("withdrawal.admin.requests.title")),m("div",{className:"WithdrawalManagementPage-pendingRequests"},m("h4",null,s.translator.trans("withdrawal.admin.requests.pending_title")),n.length===0?m("p",null,s.translator.trans("withdrawal.admin.requests.no_pending")):n.map(r=>m(P,{key:typeof r.id=="function"?r.id():r.id,request:r,showActions:!0,showDelete:!0,onUpdateStatus:e,onDelete:a}))),m("div",{className:"WithdrawalManagementPage-processedRequests"},m("h4",null,s.translator.trans("withdrawal.admin.requests.processed_title")),o.length===0?m("p",null,s.translator.trans("withdrawal.admin.requests.no_processed")):o.map(r=>m(P,{key:typeof r.id=="function"?r.id():r.id,request:r,showActions:!1,showDelete:!0,onDelete:a}))))}}class W extends v{className(){return"ConfirmDeleteModal Modal--small"}title(){return s.translator.trans("withdrawal.admin.platforms.delete_confirm_title")}content(){return m("div",{className:"Modal-body"},m("p",null,s.translator.trans("withdrawal.admin.platforms.delete_confirm_message",{name:this.attrs.platformName})),m("div",{className:"Form-group"},m(u,{className:"Button Button--primary",onclick:this.confirm.bind(this)},s.translator.trans("withdrawal.admin.platforms.delete_confirm_button")),m(u,{className:"Button",onclick:this.hide.bind(this)},s.translator.trans("withdrawal.admin.platforms.delete_cancel_button"))))}confirm(){this.attrs.onConfirm(),s.modal.close()}}class C extends v{className(){return"ConfirmDeleteRequestModal Modal--small"}title(){return s.translator.trans("withdrawal.admin.requests.delete_confirm_title")}content(){return m("div",{className:"Modal-body"},m("p",null,s.translator.trans("withdrawal.admin.requests.delete_confirm_message",{info:this.attrs.requestInfo})),m("div",{className:"Form-group"},m(u,{className:"Button Button--danger",onclick:this.confirm.bind(this)},s.translator.trans("withdrawal.admin.requests.delete_confirm_button")),m(u,{className:"Button",onclick:this.hide.bind(this)},s.translator.trans("withdrawal.admin.requests.delete_cancel_button"))))}confirm(){this.attrs.onConfirm(),s.modal.close()}}class U extends q{constructor(){super(...arguments),this.platforms=[],this.requests=[],this.users={},this.loading=!0,this.submittingPlatform=!1}oninit(t){super.oninit(t),this.loadData()}content(){return this.loading?m(_,null):m("div",{className:"WithdrawalManagementPage"},m("div",{className:"container"},m("h2",null,s.translator.trans("withdrawal.admin.page.title")),m(x,{onSettingChange:this.saveSetting.bind(this)}),m(E,{platforms:this.platforms,submittingPlatform:this.submittingPlatform,onAddPlatform:this.addPlatform.bind(this),onTogglePlatformStatus:this.togglePlatformStatus.bind(this),onDeletePlatform:this.deletePlatform.bind(this)}),m(S,{requests:this.requests,onUpdateRequestStatus:this.updateRequestStatus.bind(this),onDeleteRequest:this.deleteRequest.bind(this)})))}async addPlatform(t){if(!this.submittingPlatform){this.submittingPlatform=!0;try{const e=await s.request({method:"POST",url:s.forum.attribute("apiUrl")+"/withdrawal-platforms",body:{data:{type:"withdrawal-platforms",attributes:{name:t.name,symbol:t.symbol,minAmount:parseFloat(t.minAmount),maxAmount:parseFloat(t.maxAmount),fee:parseFloat(t.fee||"0"),iconUrl:t.iconUrl||null,iconClass:t.iconClass||null,isActive:!0}}}});e&&e.data&&s.store.pushPayload(e),await this.loadPlatforms(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.platforms.add_success"))}catch(e){console.error("Error adding platform:",e),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.platforms.add_error"))}finally{this.submittingPlatform=!1,m.redraw()}}}async togglePlatformStatus(t){try{const e=typeof t.id=="function"?t.id():t.id,a=(typeof t.isActive=="function"?t.isActive():t.attributes?.isActive)??!1,n=s.store.getById("withdrawal-platforms",e);n&&(await n.save({isActive:!a}),await this.loadPlatforms(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans(`withdrawal.admin.platforms.${a?"disable":"enable"}_success`)))}catch(e){console.error("Error toggling platform status:",e),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.platforms.toggle_error"))}}deletePlatform(t){const e=(typeof t.name=="function"?t.name():t.attributes?.name)||"Unknown Platform";s.modal.show(W,{platformName:e,onConfirm:async()=>{try{const a=typeof t.id=="function"?t.id():t.id,n=s.store.getById("withdrawal-platforms",a);n&&(await n.delete(),await this.loadPlatforms(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.platforms.delete_success")))}catch(a){console.error("Error deleting platform:",a),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.platforms.delete_error"))}}})}async updateRequestStatus(t,e){try{const a=typeof t.id=="function"?t.id():t.id,n=s.store.getById("withdrawal-requests",a);n&&(await n.save({status:e}),await this.loadRequests(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans(`withdrawal.admin.requests.${e}_success`)))}catch(a){console.error("Error updating request:",a),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.requests.update_error"))}}deleteRequest(t){const e=typeof t.id=="function"?t.id():t.id,a=typeof t.amount=="function"?t.amount():t.attributes?.amount||0;let n="Unknown User";if(typeof t.user=="function"){const o=t.user();o&&typeof o.displayName=="function"?n=o.displayName():o&&o.attributes?.displayName&&(n=o.attributes.displayName)}s.modal.show(C,{requestInfo:`${n} - ${a}`,onConfirm:async()=>{try{const o=s.store.getById("withdrawal-requests",e);o&&(await o.delete(),await this.loadRequests(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.requests.delete_success")))}catch(o){console.error("Error deleting request:",o),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.requests.delete_error"))}}})}async loadData(){try{await this.loadPlatforms(),await this.loadRequests()}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,m.redraw()}}async loadPlatforms(){try{const t=await s.store.find("withdrawal-platforms");this.platforms=Array.isArray(t)?t.filter(e=>e!==null):t?[t]:[],console.log("Loaded platforms:",this.platforms)}catch(t){console.error("Error loading platforms:",t),this.platforms=[]}}async loadRequests(){try{const a=await s.store.find("withdrawal-requests",{include:"user,platform"});this.requests=Array.isArray(a)?a.filter(n=>n!==null):a?[a]:[],console.log("Loaded requests:",this.requests)}catch(a){console.error("Error loading requests:",a),this.requests=[]}if(this.requests.length===0)return;const e=[...new Set(this.requests.map(a=>{const n=a?.data?.relationships?.user?.data||a?.relationships?.user?.data;return n?n.id:null}).filter(a=>a!=null))].filter(a=>!this.users[a]);if(e.length>0)try{const a=e.map(o=>s.store.find("users",o).catch(r=>(console.error(`Error loading user ${o}:`,r),null))),n=await Promise.all(a);e.forEach((o,r)=>{n[r]&&(this.users[o]=n[r])})}catch(a){console.error("Error loading users:",a)}}async saveSetting(t,e){try{await s.request({method:"POST",url:s.forum.attribute("apiUrl")+"/settings",body:{[t]:e}}),s.forum.pushAttributes({[t]:e})}catch(a){console.error("Error saving setting:",a),s.alerts.show({type:"error",dismissible:!0},"Failed to save setting")}}}class I extends i{constructor(){super(...arguments),this.name=i.attribute("name"),this.symbol=i.attribute("symbol"),this.minAmount=i.attribute("minAmount"),this.maxAmount=i.attribute("maxAmount"),this.fee=i.attribute("fee"),this.iconUrl=i.attribute("iconUrl"),this.iconClass=i.attribute("iconClass"),this.isActive=i.attribute("isActive"),this.createdAt=i.attribute("createdAt",i.transformDate),this.updatedAt=i.attribute("updatedAt",i.transformDate)}apiEndpoint(){return`/withdrawal-platforms/${this.id()}`}displayName(){const t=this.symbol(),e=this.name();return t?`${e} (${t})`:e}isValidAmount(t){const e=this.minAmount(),a=this.maxAmount();return t>=e&&t<=a}getTotalCost(t){return t+this.fee()}}const w={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class k extends i{constructor(){super(...arguments),this.amount=i.attribute("amount"),this.accountDetails=i.attribute("accountDetails"),this.status=i.attribute("status"),this.platformId=i.attribute("platformId"),this.userId=i.attribute("userId"),this.createdAt=i.attribute("createdAt",i.transformDate),this.updatedAt=i.attribute("updatedAt",i.transformDate),this.user=i.hasOne("user"),this.platform=i.hasOne("platform")}apiEndpoint(){return`/withdrawal-requests/${this.id()}`}isPending(){return this.status()===w.PENDING}isApproved(){return this.status()===w.APPROVED}isRejected(){return this.status()===w.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const t=this.status();return app.translator.trans(`withdrawal.forum.status.${t}`)}statusColor(){switch(this.status()){case w.APPROVED:return"success";case w.REJECTED:return"danger";case w.PENDING:default:return"warning"}}}s.initializers.add("wusong8899-withdrawal",()=>{s.store.models["withdrawal-platforms"]=I,s.store.models["withdrawal-requests"]=k,s.extensionData.for("wusong8899-withdrawal").registerPage(U)})})(flarum.core.compat["admin/app"],flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/Component"],flarum.core.compat["common/utils/withAttr"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/components/Modal"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=admin.js.map

module.exports={};