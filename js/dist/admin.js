(function(a,e,V,U,W,f,b,A,D,H,u,k,I,G,o){"use strict";class R extends W{className(){return"ConfirmModal"}title(){const{title:t,dangerous:s=!1,icon:r=s?"fas fa-exclamation-triangle":"fas fa-question-circle"}=this.attrs;return m("span",null,r&&m("span",{className:`ConfirmModal-icon ${s?"dangerous":""}`},b(r)),t)}content(){const{message:t,confirmText:s="Confirm",cancelText:r="Cancel",onConfirm:l,onCancel:n,dangerous:c=!1}=this.attrs;return m("div",{className:"Modal-body"},m("div",{className:"ConfirmModal-message"},t),m("div",{className:"Form-group"},m("div",{className:"ButtonGroup"},m(f,{className:"Button",onclick:()=>{n(),A.modal.close()}},r),m(f,{className:`Button Button--${c?"danger":"primary"}`,onclick:()=>{l(),A.modal.close()}},s))))}}class J extends V{constructor(){super(),this.platforms=[],this.transactions=[],this.loading=!0,this.submittingPlatform=!1;const t=this.getConfig();this.activeTab=t.tabs[0]?.key||""}oninit(t){super.oninit(t),this.loadData()}content(){if(this.loading)return e(U,null);const t=this.getConfig();return e("div",{className:`${t.extensionId}ManagementPage`},e("div",{className:"container"},e("h2",null,t.pageTitle),t.settingsComponent&&e("div",{className:"SettingsSection"},e(t.settingsComponent,{onSettingChange:this.saveSetting.bind(this)})),t.tabs.length>1&&e("div",{className:"AdminTabs"},e("div",{className:"AdminTabs-nav"},t.tabs.map(s=>e("button",{key:s.key,className:`AdminTabs-tab ${this.activeTab===s.key?"active":""}`,onclick:()=>{this.activeTab=s.key}},s.label))),e("div",{className:"AdminTabs-content"},this.renderActiveTabContent())),t.tabs.length===1&&e("div",{className:"SingleTabContent"},this.renderActiveTabContent())))}renderActiveTabContent(){const t=this.getConfig(),s=t.tabs.find(l=>l.key===this.activeTab);if(!s)return null;const r={platforms:this.platforms,transactions:this.transactions,submittingPlatform:this.submittingPlatform,onAddPlatform:this.addPlatform.bind(this),onTogglePlatformStatus:this.togglePlatformStatus.bind(this),onDeletePlatform:this.deletePlatform.bind(this),...t.transactionOperations&&{onUpdateTransactionStatus:this.updateTransactionStatus.bind(this)},...s.props?s.props():{}};return e(s.component,r)}async addPlatform(t){if(this.submittingPlatform)return;this.submittingPlatform=!0;const s=this.getConfig();try{await s.platformOperations.create(t),await this.loadPlatforms()}catch(r){console.error("Error adding platform:",r)}finally{this.submittingPlatform=!1,e.redraw()}}async togglePlatformStatus(t){const s=this.getConfig();try{await s.platformOperations.toggleStatus(t),await this.loadPlatforms(),e.redraw()}catch(r){console.error("Error toggling platform status:",r)}}deletePlatform(t){const s=this.getConfig(),r=(typeof t.name=="function"?t.name():t.name)||"Unknown Platform";a.modal.show(R,{title:a.translator.trans(`${s.translations.platformPrefix}.delete_confirm_title`),message:a.translator.trans(`${s.translations.platformPrefix}.delete_confirm_message`,{name:r}),confirmText:a.translator.trans(`${s.translations.platformPrefix}.delete_confirm_button`),cancelText:a.translator.trans(`${s.translations.platformPrefix}.delete_cancel_button`),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{try{await s.platformOperations.delete(t),await this.loadPlatforms(),e.redraw(),a.alerts.show({type:"success",dismissible:!0},a.translator.trans(`${s.translations.platformPrefix}.delete_success`))}catch(l){console.error("Error deleting platform:",l),a.alerts.show({type:"error",dismissible:!0},a.translator.trans(`${s.translations.platformPrefix}.delete_error`))}},onCancel:()=>{a.modal.close()}})}async updateTransactionStatus(t,s){const r=this.getConfig();if(r.transactionOperations)try{await r.transactionOperations.updateStatus(t,s),await this.loadTransactions();const l=r.translations.transactionPrefix||r.translations.platformPrefix;a.alerts.show({type:"success",dismissible:!0},a.translator.trans(`${l}.${s}_success`))}catch(l){console.error("Error updating transaction:",l);const n=r.translations.transactionPrefix||r.translations.platformPrefix;a.alerts.show({type:"error",dismissible:!0},a.translator.trans(`${n}.update_error`))}}async loadData(){try{await this.loadPlatforms(),this.getConfig().transactionOperations&&await this.loadTransactions()}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,e.redraw()}}async loadPlatforms(){const t=this.getConfig();try{this.platforms=await t.platformOperations.load(),console.log("Loaded platforms:",this.platforms)}catch(s){console.error("Error loading platforms:",s),this.platforms=[]}}async loadTransactions(){const t=this.getConfig();if(t.transactionOperations)try{this.transactions=await t.transactionOperations.load(),console.log("Loaded transactions:",this.transactions)}catch(s){console.error("Error loading transactions:",s),this.transactions=[]}}async saveSetting(t,s){try{await a.request({method:"POST",url:a.forum.attribute("apiUrl")+"/settings",body:{[t]:s}}),a.forum.pushAttributes({[t]:s})}catch(r){console.error("Error saving setting:",r),a.alerts.show({type:"error",dismissible:!0},"Failed to save setting")}}}class z extends D{view(){return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,"General Settings"),m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.settings.money_icon_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://i.mji.rip/2025/08/28/cd18932c68e9bbee9502b1fb6317cba9.png",value:a.forum.attribute("wusong8899-withdrawal.moneyIconUrl")||"",oninput:H("value",t=>this.attrs.onSettingChange("wusong8899-withdrawal.moneyIconUrl",t))}),m("small",{className:"helpText"},a.translator.trans("withdrawal.admin.settings.money_icon_url_help")))))}}class E{constructor(){this.errors=[]}required(t,s,r){return(!t||typeof t=="string"&&t.trim()==="")&&this.errors.push({field:s,message:`${r||s} is required`}),this}minLength(t,s,r,l){return t&&t.length<s&&this.errors.push({field:r,message:`${l||r} must be at least ${s} characters`}),this}numberRange(t,s,r,l,n){const c=typeof t=="string"?parseFloat(t):t;return isNaN(c)?(this.errors.push({field:l||"number",message:`${n||"Value"} must be a valid number`}),this):(s!==void 0&&c<s&&this.errors.push({field:l||"number",message:`${n||"Value"} must be at least ${s}`}),r!==void 0&&c>r&&this.errors.push({field:l||"number",message:`${n||"Value"} must be at most ${r}`}),this)}url(t,s,r){if(t&&t.trim())try{const l=new URL(t)}catch{this.errors.push({field:s,message:`${r||s} must be a valid URL`})}return this}custom(t,s,r){return t||this.errors.push({field:s,message:r}),this}getResult(){return{isValid:this.errors.length===0,errors:this.errors,firstErrorMessage:this.errors.length>0?this.errors[0].message:void 0}}reset(){return this.errors=[],this}}class Y extends D{constructor(){super(...arguments),this.name=u(""),this.symbol=u(""),this.network=u(""),this.minAmount=u(""),this.maxAmount=u(""),this.fee=u(""),this.iconUrl=u(""),this.iconClass=u("")}view(){return e("div",{className:"WithdrawalManagementPage-addPlatform"},e("div",{className:"Form-group"},e("div",{className:"Form-row"},e("div",{className:"Form-col"},e("label",null,a.translator.trans("withdrawal.admin.platforms.name")),e("input",{type:"text",className:"FormControl",placeholder:a.translator.trans("withdrawal.admin.platforms.add_placeholder"),bidi:this.name})),e("div",{className:"Form-col"},e("label",null,a.translator.trans("withdrawal.admin.platforms.symbol")),e("input",{type:"text",className:"FormControl",placeholder:"BTC, ETH, USDT...",bidi:this.symbol})),e("div",{className:"Form-col"},e("label",null,a.translator.trans("withdrawal.admin.platforms.network")),e("input",{type:"text",className:"FormControl",placeholder:"TRC20, ERC20, BSC... (optional)",bidi:this.network}),e("small",{className:"helpText"},a.translator.trans("withdrawal.admin.platforms.network_help")))),e("div",{className:"Form-row"},e("div",{className:"Form-col"},e("label",null,a.translator.trans("withdrawal.admin.platforms.min_amount")),e("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.001",bidi:this.minAmount})),e("div",{className:"Form-col"},e("label",null,a.translator.trans("withdrawal.admin.platforms.max_amount")),e("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"10.0",bidi:this.maxAmount})),e("div",{className:"Form-col"},e("label",null,a.translator.trans("withdrawal.admin.platforms.fee")),e("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.0005",bidi:this.fee}))),e("div",{className:"Form-row"},e("div",{className:"Form-col"},e("label",null,a.translator.trans("withdrawal.admin.platforms.icon_url")),e("input",{type:"url",className:"FormControl",placeholder:"https://example.com/icon.png",bidi:this.iconUrl}),e("small",{className:"helpText"},a.translator.trans("withdrawal.admin.platforms.icon_url_help"))),e("div",{className:"Form-col"},e("label",null,a.translator.trans("withdrawal.admin.platforms.icon_class")),e("input",{type:"text",className:"FormControl",placeholder:"fas fa-coins",bidi:this.iconClass}),e("small",{className:"helpText"},a.translator.trans("withdrawal.admin.platforms.icon_class_help")))),e("div",{className:"Form-group"},e(f,{className:"Button Button--primary",loading:this.attrs.submitting,disabled:this.attrs.submitting,onclick:this.handleSubmit.bind(this)},a.translator.trans("withdrawal.admin.platforms.add_button")))))}validateForm(){const t=new E;try{t.required(this.name(),"name",a.translator.trans("withdrawal.admin.platforms.name")).required(this.symbol(),"symbol",a.translator.trans("withdrawal.admin.platforms.symbol")).numberRange(this.minAmount(),0,void 0,"minAmount",a.translator.trans("withdrawal.admin.platforms.min_amount")).numberRange(this.maxAmount(),0,void 0,"maxAmount",a.translator.trans("withdrawal.admin.platforms.max_amount")).numberRange(this.fee(),0,void 0,"fee",a.translator.trans("withdrawal.admin.platforms.fee"));const s=parseFloat(this.minAmount());return parseFloat(this.maxAmount())<s&&t.addError("maxAmount",a.translator.trans("withdrawal.admin.platforms.max_min_error")),this.iconUrl()&&this.iconUrl().trim()&&t.url(this.iconUrl(),"iconUrl",a.translator.trans("withdrawal.admin.platforms.icon_url")),t.isValid()}catch(s){return s instanceof Error&&a.alerts.show({type:"error",dismissible:!0},s.message),!1}}async handleSubmit(){if(this.attrs.submitting||!this.validateForm())return;const t={name:this.name(),symbol:this.symbol(),network:this.network(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),iconUrl:this.iconUrl(),iconClass:this.iconClass()};try{await this.attrs.onSubmit(t),this.clearForm()}catch{}}clearForm(){this.name(""),this.symbol(""),this.network(""),this.minAmount(""),this.maxAmount(""),this.fee(""),this.iconUrl(""),this.iconClass(""),e.redraw()}}class F extends D{view(t){const{platform:s,type:r,onToggleStatus:l,onDelete:n,style:c="card"}=t.attrs;return c==="card"?this.renderCardStyle(s,r,l,n):this.renderListStyle(s,r,l,n)}renderCardStyle(t,s,r,l){const n=this.extractPlatformData(t),c=s==="withdrawal"?"withdrawal.admin.platforms":"withdrawal.admin.deposit.platforms";return e("div",{key:n.id,className:`${s}Platform`},e("div",{className:`${s}Platform-info`},e("div",{className:`${s}Platform-primary`},e("span",{className:`${s}Platform-status ${n.isActive?"active":"inactive"}`},n.isActive?"ðŸŸ¢":"ðŸ”´"),e("span",{className:`${s}Platform-name`},n.displayName),e("span",{className:"platform-id"},"#",n.id),n.network&&e("span",{className:`${s}Platform-network`},"(",n.network,")")),e("div",{className:`${s}Platform-details`},e("span",{className:`${s}Platform-amounts`},"Min: ",n.minAmount," | Max: ",n.maxAmount,` | Fee: ${n.fee}`,s==="deposit"&&` | Address: ${n.address?"Static":"Template"}`),n.createdDate&&e("span",{className:`${s}Platform-date`},n.dateDisplay))),e("div",{className:`${s}Platform-actions`},e(f,{className:`Button ${n.isActive?"Button--secondary":"Button--primary"}`,onclick:()=>r(t)},a.translator.trans(`${c}.${n.isActive?"disable":"enable"}`)),e(f,{className:"Button Button--danger",onclick:()=>l(t)},a.translator.trans(`${c}.delete`))))}renderListStyle(t,s,r,l){const n=this.extractPlatformData(t),c=s==="withdrawal"?"withdrawal.admin.platforms":"withdrawal.admin.deposit.platforms";return e("div",{className:`${s}PlatformListItem`},e("div",{className:`${s}PlatformListItem-content`},e("div",{className:`${s}PlatformListItem-icon`},this.renderPlatformIcon(t)),e("div",{className:`${s}PlatformListItem-info`},e("div",{className:`${s}PlatformListItem-primary`},e("strong",null,n.name),e("span",{className:`${s}PlatformListItem-displayName`},n.symbol,n.network&&` (${n.network})`)),e("div",{className:`${s}PlatformListItem-details`},e("span",{className:`${s}PlatformListItem-detail`},"Min: ",n.minAmount," ",n.symbol),n.maxAmount&&e("span",{className:`${s}PlatformListItem-detail`},"Max: ",n.maxAmount," ",n.symbol),n.fee&&e("span",{className:`${s}PlatformListItem-detail`},"Fee: ",n.fee," ",n.symbol),s==="deposit"&&e("span",{className:`${s}PlatformListItem-detail`},"Address: ",n.address?"Static":"Template"))),e("div",{className:`${s}PlatformListItem-actions`},e(k,{state:n.isActive,onchange:async()=>{await r(t),e.redraw()}},n.isActive?a.translator.trans(`${c}.active`):a.translator.trans(`${c}.inactive`)),e(f,{className:"Button Button--icon Button--flat",icon:"fas fa-trash",onclick:async()=>{await l(t),e.redraw()},title:a.translator.trans(`${c}.delete`)}))))}extractPlatformData(t){const s=typeof t.id=="function"?t.id():t.id,r=(typeof t.name=="function"?t.name():t.attributes?.name)||"Unknown Platform",l=(typeof t.symbol=="function"?t.symbol():t.attributes?.symbol)||"",n=(typeof t.network=="function"?t.network():t.attributes?.network)||null,c=(typeof t.displayName=="function"?t.displayName():t.attributes?.displayName)||r,w=(typeof t.minAmount=="function"?t.minAmount():t.attributes?.minAmount)||"N/A",h=(typeof t.maxAmount=="function"?t.maxAmount():t.attributes?.maxAmount)||"N/A",p=(typeof t.fee=="function"?t.fee():t.attributes?.fee)||"N/A",y=(typeof t.address=="function"?t.address():t.attributes?.address)||null,d=(typeof t.isActive=="function"?t.isActive():t.attributes?.isActive)??!1,N=(typeof t.createdAt=="function"?t.createdAt():t.attributes?.createdAt)||null;let P="N/A";if(N)try{P=I(N)}catch(g){console.error("Error formatting date:",g),P="Invalid Date"}return{id:s,name:r,symbol:l,network:n,displayName:c,minAmount:w,maxAmount:h,fee:p,address:y,isActive:d,createdDate:N,dateDisplay:P}}renderPlatformIcon(t){const s=typeof t.iconUrl=="function"?t.iconUrl():t.attributes?.iconUrl,r=typeof t.iconClass=="function"?t.iconClass():t.attributes?.iconClass,l=typeof t.symbol=="function"?t.symbol():t.attributes?.symbol;if(s)return e("img",{src:s,alt:l,className:"PlatformListItem-img"});if(r)return b(r);switch(l){case"USDT":return e("span",{className:"PlatformListItem-currencyIcon usdt"},"â‚®");case"USDC":return e("span",{className:"PlatformListItem-currencyIcon usdc"},"$");case"BTC":return e("span",{className:"PlatformListItem-currencyIcon btc"},"â‚¿");case"ETH":return e("span",{className:"PlatformListItem-currencyIcon eth"},"Îž");default:return b("fas fa-coins")}}}class K extends D{view(){const{platforms:t,submittingPlatform:s,onAddPlatform:r,onTogglePlatformStatus:l,onDeletePlatform:n}=this.attrs;return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,a.translator.trans("withdrawal.admin.platforms.title")),m(Y,{onSubmit:r,submitting:s}),m("div",{className:"WithdrawalManagementPage-platformList"},t.length===0?m("p",null,a.translator.trans("withdrawal.admin.platforms.empty")):t.map(c=>m(F,{key:typeof c.id=="function"?c.id():c.id,platform:c,type:"withdrawal",style:"card",onToggleStatus:l,onDelete:n}))))}}class q extends D{view(){const t=this.attrs.request,{showActions:s,showDelete:r=!1}=this.attrs,l=typeof t.id=="function"?t.id():t.id,n=typeof t.amount=="function"?t.amount():t.attributes?.amount||0,c=typeof t.status=="function"?t.status():t.attributes?.status||"pending",w=typeof t.accountDetails=="function"?t.accountDetails():t.attributes?.accountDetails||t.attributes?.account_details||"N/A",h=typeof t.createdAt=="function"?t.createdAt():t.attributes?.createdAt||null;let p="Unknown User";if(typeof t.user=="function"){const g=t.user();g&&typeof g.displayName=="function"?p=g.displayName():g&&g.attributes?.displayName&&(p=g.attributes.displayName)}let y="Unknown Platform",d="N/A";if(typeof t.platform=="function"){const g=t.platform();g&&(y=typeof g.name=="function"?g.name():g.attributes?.name||"Unknown Platform",d=typeof g.symbol=="function"?g.symbol():g.attributes?.symbol||"N/A")}const N=`status-${c}`;let P="N/A";if(h)try{P=I(h)}catch(g){console.error("Error formatting request date:",g),P="Invalid Date"}return m("div",{key:l,className:`WithdrawalRequest ${N}`},m("div",{className:"WithdrawalRequest-info"},m("div",{className:"WithdrawalRequest-user"},m("strong",null,p),m("span",{className:"request-id"},"#",l)),m("div",{className:"WithdrawalRequest-details"},m("span",{className:"amount"},n),m("span",{className:"platform"},y),m("span",{className:"symbol"},d),m("span",{className:"date"},P)),m("div",{className:"WithdrawalRequest-account"},m("strong",null,a.translator.trans("withdrawal.admin.requests.account_details"),":"),m("span",null,w)),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${c}`},a.translator.trans(`withdrawal.admin.requests.status.${c}`)))),(s||r)&&m("div",{className:"WithdrawalRequest-actions"},s&&this.attrs.onUpdateStatus&&m("[",null,m(f,{className:"Button Button--primary",onclick:()=>this.attrs.onUpdateStatus(t,"approved")},a.translator.trans("withdrawal.admin.requests.approve")),m(f,{className:"Button Button--danger",onclick:()=>this.attrs.onUpdateStatus(t,"rejected")},a.translator.trans("withdrawal.admin.requests.reject"))),this.attrs.onDelete&&m(f,{className:"Button Button--link",onclick:()=>this.attrs.onDelete(t)},m("i",{className:"fas fa-trash"}),a.translator.trans("withdrawal.admin.requests.delete"))))}}class Q extends D{view(){const{requests:t,onUpdateRequestStatus:s,onDeleteRequest:r}=this.attrs,l=t.filter(c=>((typeof c.status=="function"?c.status():c.attributes?.status)||"pending")==="pending"),n=t.filter(c=>((typeof c.status=="function"?c.status():c.attributes?.status)||"pending")!=="pending");return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,a.translator.trans("withdrawal.admin.requests.title")),m("div",{className:"WithdrawalManagementPage-pendingRequests"},m("h4",null,a.translator.trans("withdrawal.admin.requests.pending_title")),l.length===0?m("p",null,a.translator.trans("withdrawal.admin.requests.no_pending")):l.map(c=>m(q,{key:typeof c.id=="function"?c.id():c.id,request:c,showActions:!0,showDelete:!0,onUpdateStatus:s,onDelete:r}))),m("div",{className:"WithdrawalManagementPage-processedRequests"},m("h4",null,a.translator.trans("withdrawal.admin.requests.processed_title")),n.length===0?m("p",null,a.translator.trans("withdrawal.admin.requests.no_processed")):n.map(c=>m(q,{key:typeof c.id=="function"?c.id():c.id,request:c,showActions:!1,showDelete:!0,onDelete:r}))))}}class X extends D{constructor(){super(...arguments),this.formData={name:u(""),symbol:u(""),network:u(""),minAmount:u(""),maxAmount:u(""),fee:u(""),address:u(""),qrCodeImageUrl:u(""),iconUrl:u(""),iconClass:u(""),warningText:u(""),isActive:u(!0)}}oninit(t){super.oninit(t)}view(t){const{submitting:s,onCancel:r}=t.attrs;return m("div",{className:"AddDepositPlatformForm"},m("div",{className:"Form"},m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.deposit.platforms.name"),m("span",{className:"Form-required"},"*")),m("input",{type:"text",className:"FormControl",placeholder:"e.g., Tether",bidi:this.formData.name,disabled:s})),m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.deposit.platforms.symbol"),m("span",{className:"Form-required"},"*")),m("input",{type:"text",className:"FormControl",placeholder:"e.g., USDT",bidi:this.formData.symbol,disabled:s}))),m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.deposit.platforms.network")),m("input",{type:"text",className:"FormControl",placeholder:"e.g., TRC20, ERC20, BSC (optional)",bidi:this.formData.network,disabled:s}),m("div",{className:"helpText"},"Optional. Specify the blockchain network for this platform."))),m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.deposit.platforms.min_amount")),m("input",{type:"number",step:"0.00000001",min:"0",className:"FormControl",placeholder:"0.0",bidi:this.formData.minAmount,disabled:s})),m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.deposit.platforms.max_amount")),m("input",{type:"number",step:"0.00000001",min:"0",className:"FormControl",placeholder:"Leave empty for unlimited",bidi:this.formData.maxAmount,disabled:s})),m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.deposit.platforms.fee")),m("input",{type:"number",step:"0.00000001",min:"0",className:"FormControl",placeholder:"0.0",bidi:this.formData.fee,disabled:s}),m("div",{className:"helpText"},a.translator.trans("withdrawal.admin.deposit.platforms.fee_help")))),m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.deposit.platforms.address"),m("span",{className:"Form-required"},"*")),m("input",{type:"text",className:"FormControl",placeholder:"Enter deposit address for this platform",bidi:this.formData.address,disabled:s}),m("div",{className:"helpText"},a.translator.trans("withdrawal.admin.deposit.platforms.address_help"))),m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.deposit.platforms.qr_code_image_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://example.com/qr-code.png",bidi:this.formData.qrCodeImageUrl,disabled:s}),m("div",{className:"helpText"},a.translator.trans("withdrawal.admin.deposit.platforms.qr_code_image_help"))),m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.deposit.platforms.icon_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://example.com/icon.png",bidi:this.formData.iconUrl,disabled:s})),m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.deposit.platforms.icon_class")),m("input",{type:"text",className:"FormControl",placeholder:"fas fa-coins",bidi:this.formData.iconClass,disabled:s}))),m("div",{className:"Form-group"},m("label",null,a.translator.trans("withdrawal.admin.deposit.platforms.warning_text")),m("textarea",{className:"FormControl",rows:3,placeholder:"Network-specific warning for users",bidi:this.formData.warningText,disabled:s})),m("div",{className:"Form-group"},m(k,{state:this.formData.isActive(),onchange:this.formData.isActive,disabled:s},a.translator.trans("withdrawal.admin.deposit.platforms.is_active"))),m("div",{className:"Form-actions"},m(f,{className:"Button Button--primary",type:"submit",loading:s,onclick:this.handleSubmit.bind(this,t.attrs)},a.translator.trans("withdrawal.admin.deposit.platforms.add_button")),m(f,{className:"Button",onclick:r,disabled:s},a.translator.trans("core.admin.basics.cancel_button")))))}validateForm(){const t=new E;try{if(t.required(this.formData.name(),"name",a.translator.trans("withdrawal.admin.deposit.platforms.name")).required(this.formData.symbol(),"symbol",a.translator.trans("withdrawal.admin.deposit.platforms.symbol")).required(this.formData.address(),"address",a.translator.trans("withdrawal.admin.deposit.platforms.address")),this.formData.minAmount()&&this.formData.minAmount().trim()&&t.numberRange(this.formData.minAmount(),0,void 0,"minAmount",a.translator.trans("withdrawal.admin.deposit.platforms.min_amount")),this.formData.maxAmount()&&this.formData.maxAmount().trim()&&t.numberRange(this.formData.maxAmount(),0,void 0,"maxAmount",a.translator.trans("withdrawal.admin.deposit.platforms.max_amount")),this.formData.fee()&&this.formData.fee().trim()&&t.numberRange(this.formData.fee(),0,void 0,"fee",a.translator.trans("withdrawal.admin.deposit.platforms.fee")),this.formData.minAmount()&&this.formData.maxAmount()){const r=parseFloat(this.formData.minAmount()),l=parseFloat(this.formData.maxAmount());!isNaN(r)&&!isNaN(l)&&l<r&&t.custom(!1,"maxAmount",a.translator.trans("withdrawal.admin.platforms.max_min_error"))}this.formData.iconUrl()&&this.formData.iconUrl().trim()&&t.url(this.formData.iconUrl(),"iconUrl",a.translator.trans("withdrawal.admin.deposit.platforms.icon_url")),this.formData.qrCodeImageUrl()&&this.formData.qrCodeImageUrl().trim()&&t.url(this.formData.qrCodeImageUrl(),"qrCodeImageUrl",a.translator.trans("withdrawal.admin.deposit.platforms.qr_code_image_url"));const s=t.getResult();return!s.isValid&&s.firstErrorMessage&&a.alerts.show({type:"error",dismissible:!0},s.firstErrorMessage),s.isValid}catch(s){return s instanceof Error&&a.alerts.show({type:"error",dismissible:!0},s.message),!1}}async handleSubmit(t){if(t.submitting||!this.validateForm())return;const s={name:this.formData.name(),symbol:this.formData.symbol(),network:this.formData.network(),minAmount:this.formData.minAmount(),maxAmount:this.formData.maxAmount(),fee:this.formData.fee(),address:this.formData.address(),qrCodeImageUrl:this.formData.qrCodeImageUrl(),iconUrl:this.formData.iconUrl(),iconClass:this.formData.iconClass(),warningText:this.formData.warningText(),isActive:this.formData.isActive()};try{await t.onSubmit(s),Object.keys(this.formData).forEach(r=>{r==="isActive"?this.formData[r](!0):this.formData[r]("")}),t.onCancel()}catch(r){console.error("Form submission error:",r)}}}class B extends D{view(t){const{transaction:s,showActions:r,onUpdateStatus:l}=t.attrs;return m("div",{className:"DepositTransactionItem"},m("div",{className:"DepositTransactionItem-header"},m("div",{className:"DepositTransactionItem-user"},m("strong",null,G(s.user)),m("span",{className:"DepositTransactionItem-time"},I(s.createdAt))),m("div",{className:"DepositTransactionItem-amount"},m("span",{className:"DepositTransactionItem-amountValue"},s.amount," ",s.platform.symbol),m("div",{className:`DepositTransactionItem-status status-${s.statusColor}`},this.getStatusIcon(s.status),this.getStatusText(s.status)))),m("div",{className:"DepositTransactionItem-details"},m("div",{className:"DepositTransactionItem-platform"},m("span",{className:"DepositTransactionItem-label"},"Platform:"),m("span",null,s.platform.name," (",s.platform.network,")")),s.transactionHash&&m("div",{className:"DepositTransactionItem-hash"},m("span",{className:"DepositTransactionItem-label"},"Hash:"),s.explorerUrl?m("a",{href:s.explorerUrl,target:"_blank",rel:"noopener noreferrer",className:"DepositTransactionItem-hashLink"},this.formatHash(s.transactionHash),b("fas fa-external-link-alt")):m("span",{className:"DepositTransactionItem-hashText"},this.formatHash(s.transactionHash))),s.fromAddress&&m("div",{className:"DepositTransactionItem-fromAddress"},m("span",{className:"DepositTransactionItem-label"},"From:"),m("span",{className:"DepositTransactionItem-address"},this.formatHash(s.fromAddress))),s.confirmations!==void 0&&m("div",{className:"DepositTransactionItem-confirmations"},m("span",{className:"DepositTransactionItem-label"},"Confirmations:"),m("span",null,s.confirmations,"/",s.requiredConfirmations,s.hasEnoughConfirmations&&m("span",{className:"DepositTransactionItem-confirmed"}," âœ“"))),s.adminNotes&&m("div",{className:"DepositTransactionItem-notes"},m("span",{className:"DepositTransactionItem-label"},"Notes:"),m("span",null,s.adminNotes))),r&&this.renderActions(s,l))}renderActions(t,s){const r=[];return t.status==="pending"&&r.push(m(f,{key:"confirm",className:"Button Button--primary Button--sm",onclick:()=>s("confirmed")},a.translator.trans("withdrawal.admin.deposit.transactions.confirm"))),t.status==="confirmed"&&t.canBeCompleted&&r.push(m(f,{key:"complete",className:"Button Button--success Button--sm",onclick:()=>s("completed")},a.translator.trans("withdrawal.admin.deposit.transactions.complete"))),(t.status==="pending"||t.status==="confirmed")&&r.push(m(f,{key:"reject",className:"Button Button--danger Button--sm",onclick:()=>s("failed")},a.translator.trans("withdrawal.admin.deposit.transactions.reject"))),r.length>0?m("div",{className:"DepositTransactionItem-actions"},r):null}getStatusIcon(t){switch(t){case"pending":return b("fas fa-clock");case"confirmed":return b("fas fa-check-circle");case"completed":return b("fas fa-check-double");case"failed":return b("fas fa-times-circle");case"cancelled":return b("fas fa-ban");default:return b("fas fa-question-circle")}}getStatusText(t){switch(t){case"pending":return a.translator.trans("withdrawal.admin.deposit.transactions.status.pending");case"confirmed":return a.translator.trans("withdrawal.admin.deposit.transactions.status.confirmed");case"completed":return a.translator.trans("withdrawal.admin.deposit.transactions.status.completed");case"failed":return a.translator.trans("withdrawal.admin.deposit.transactions.status.failed");case"cancelled":return a.translator.trans("withdrawal.admin.deposit.transactions.status.cancelled");default:return t}}formatHash(t){return t.length<=16?t:`${t.substring(0,8)}...${t.substring(t.length-8)}`}}class Z extends D{constructor(){super(...arguments),this.showPlatformForm=!1,this.activeTransactionTab="pending"}view(t){const{platforms:s,transactions:r,submittingPlatform:l,onAddPlatform:n,onTogglePlatformStatus:c,onDeletePlatform:w,onUpdateTransactionStatus:h}=t.attrs,p=r.filter(d=>d.status==="pending"||d.status==="confirmed"),y=r.filter(d=>d.status==="completed"||d.status==="failed"||d.status==="cancelled");return m("div",{className:"DepositManagementSection"},m("div",{className:"Form-group"},m("h3",null,a.translator.trans("withdrawal.admin.deposit.platforms.title")),m("div",{className:"DepositPlatforms"},m("div",{className:"DepositPlatforms-header"},m(f,{className:"Button Button--primary",onclick:()=>{this.showPlatformForm=!this.showPlatformForm}},a.translator.trans("withdrawal.admin.deposit.platforms.add_button"))),this.showPlatformForm&&m(X,{submitting:l,onSubmit:n,onCancel:()=>{this.showPlatformForm=!1}}),m("div",{className:"DepositPlatforms-list"},s.length===0?m("p",{className:"DepositPlatforms-empty"},a.translator.trans("withdrawal.admin.deposit.platforms.empty")):s.map(d=>m(F,{key:d.id,platform:d,type:"deposit",style:"list",onToggleStatus:()=>c(d),onDelete:()=>w(d)}))))),m("div",{className:"Form-group"},m("h3",null,a.translator.trans("withdrawal.admin.deposit.transactions.title")),m("div",{className:"DepositTransactions"},m("div",{className:"DepositTransactions-tabs"},m("button",{className:`DepositTransactions-tab ${this.activeTransactionTab==="pending"?"active":""}`,onclick:()=>{this.activeTransactionTab="pending"}},a.translator.trans("withdrawal.admin.deposit.transactions.pending_title")," (",p.length,")"),m("button",{className:`DepositTransactions-tab ${this.activeTransactionTab==="completed"?"active":""}`,onclick:()=>{this.activeTransactionTab="completed"}},a.translator.trans("withdrawal.admin.deposit.transactions.completed_title")," (",y.length,")")),m("div",{className:"DepositTransactions-content"},this.activeTransactionTab==="pending"?m("div",{className:"DepositTransactions-pending"},p.length===0?m("p",{className:"DepositTransactions-empty"},a.translator.trans("withdrawal.admin.deposit.transactions.no_pending")):p.map(d=>m(B,{key:d.id,transaction:d,onUpdateStatus:N=>h(d,N),showActions:!0}))):m("div",{className:"DepositTransactions-completed"},y.length===0?m("p",{className:"DepositTransactions-empty"},a.translator.trans("withdrawal.admin.deposit.transactions.no_completed")):y.map(d=>m(B,{key:d.id,transaction:d,onUpdateStatus:N=>h(d,N),showActions:!1})))))))}}class M extends D{constructor(){super(...arguments),this.state={processingRecords:new Set}}view(t){const{records:s,platforms:r,loading:l}=t.attrs;return l?e("div",{className:"DepositRecordManagementSection"},e("div",{className:"DepositRecordManagementSection-header"},e("h3",null,a.translator.trans("withdrawal.admin.deposit.records.title"))),e(U,null)):e("div",{className:"DepositRecordManagementSection"},e("div",{className:"DepositRecordManagementSection-header"},e("h3",null,a.translator.trans("withdrawal.admin.deposit.records.title")),e("div",{className:"DepositRecordManagementSection-stats"},e("span",{className:"DepositRecordManagementSection-count"},a.translator.trans("withdrawal.admin.deposit.records.total_count",{count:s.length})),e("span",{className:"DepositRecordManagementSection-pending"},a.translator.trans("withdrawal.admin.deposit.records.pending_count",{count:s.filter(n=>n.isPending()).length})))),e("div",{className:"DepositRecordManagementSection-content"},s.length===0?e("div",{className:"DepositRecordManagementSection-empty"},e("div",{className:"DepositRecordManagementSection-emptyIcon"},b("fas fa-receipt")),e("h4",null,a.translator.trans("withdrawal.admin.deposit.records.empty.title")),e("p",null,a.translator.trans("withdrawal.admin.deposit.records.empty.description"))):e("div",{className:"DepositRecordManagementSection-list"},s.map(n=>this.renderRecord(n,r,t.attrs)))))}renderRecord(t,s,r){const l=t.id(),n=this.state.processingRecords.has(l),c=this.findPlatform(s,t.platformId()),w=t.user?.(),h=t.status(),p=t.depositTime(),y=t.createdAt();return e("div",{key:`record-${l}`,className:`DepositRecordItem status-${h}`},e("div",{className:"DepositRecordItem-header"},e("div",{className:"DepositRecordItem-user"},e("span",{className:"DepositRecordItem-username"},w?.displayName?.()||"Unknown User"),e("span",{className:"DepositRecordItem-userId"},"ID: ",t.userId())),e("div",{className:"DepositRecordItem-amount"},e("span",{className:"DepositRecordItem-amountValue"},t.amount()," ",c?.symbol?.()||""),e("div",{className:`DepositRecordItem-status status-${this.getStatusColor(h)}`},this.renderStatusIcon(h),this.getStatusText(h)))),e("div",{className:"DepositRecordItem-details"},e("div",{className:"DepositRecordItem-row"},e("span",{className:"DepositRecordItem-label"},"Platform:"),e("span",{className:"DepositRecordItem-value"},c?.name?.()||"Unknown Platform"," ",c?.network?.()?`(${c.network()})`:"")),e("div",{className:"DepositRecordItem-row"},e("span",{className:"DepositRecordItem-label"},"Platform Account:"),e("span",{className:"DepositRecordItem-value"},t.platformAccount())),t.realName?.()&&e("div",{className:"DepositRecordItem-row"},e("span",{className:"DepositRecordItem-label"},"Real Name:"),e("span",{className:"DepositRecordItem-value"},t.realName())),e("div",{className:"DepositRecordItem-row"},e("span",{className:"DepositRecordItem-label"},"Deposit Time:"),e("span",{className:"DepositRecordItem-value"},p.toLocaleDateString()," ",p.toLocaleTimeString())),e("div",{className:"DepositRecordItem-row"},e("span",{className:"DepositRecordItem-label"},"Submitted:"),e("span",{className:"DepositRecordItem-value"},I(y))),t.userMessage?.()&&e("div",{className:"DepositRecordItem-row"},e("span",{className:"DepositRecordItem-label"},"Message:"),e("span",{className:"DepositRecordItem-value"},t.userMessage())),t.screenshotUrl?.()&&e("div",{className:"DepositRecordItem-row"},e("span",{className:"DepositRecordItem-label"},"Screenshot:"),e("a",{href:t.screenshotUrl(),target:"_blank",rel:"noopener noreferrer",className:"DepositRecordItem-link"},"View Screenshot ",b("fas fa-external-link-alt"))),t.processedAt?.()&&e("div",{className:"DepositRecordItem-processed"},e("div",{className:"DepositRecordItem-row"},e("span",{className:"DepositRecordItem-label"},"Processed:"),e("span",{className:"DepositRecordItem-value"},I(t.processedAt()))),t.creditedAmount?.()&&t.creditedAmount()!==t.amount()&&e("div",{className:"DepositRecordItem-row"},e("span",{className:"DepositRecordItem-label"},"Credited Amount:"),e("span",{className:"DepositRecordItem-value"},t.creditedAmount()," ",c?.symbol?.()||"")),t.adminNotes?.()&&e("div",{className:"DepositRecordItem-row"},e("span",{className:"DepositRecordItem-label"},"Admin Notes:"),e("span",{className:"DepositRecordItem-value"},t.adminNotes())))),h==="pending"&&e("div",{className:"DepositRecordItem-actions"},e(f,{className:"Button Button--primary DepositRecordItem-approveButton",onclick:()=>this.handleApprove(t,r),loading:n,disabled:n},a.translator.trans("withdrawal.admin.deposit.records.approve")),e(f,{className:"Button Button--danger DepositRecordItem-rejectButton",onclick:()=>this.handleReject(t,r),loading:n,disabled:n},a.translator.trans("withdrawal.admin.deposit.records.reject"))),e("div",{className:"DepositRecordItem-adminActions"},e(f,{className:"Button Button--link DepositRecordItem-deleteButton",onclick:()=>this.handleDelete(t,r),disabled:n},b("fas fa-trash"),a.translator.trans("withdrawal.admin.deposit.records.delete"))))}findPlatform(t,s){return t.find(r=>{const l=typeof r.id=="function"?r.id():r.id;return parseInt(l)===s})||null}getStatusColor(t){switch(t){case"pending":return"warning";case"approved":return"success";case"rejected":return"danger";default:return"secondary"}}renderStatusIcon(t){switch(t){case"pending":return b("fas fa-clock");case"approved":return b("fas fa-check-circle");case"rejected":return b("fas fa-times-circle");default:return b("fas fa-question-circle")}}getStatusText(t){switch(t){case"pending":return a.translator.trans("withdrawal.admin.deposit.records.status.pending");case"approved":return a.translator.trans("withdrawal.admin.deposit.records.status.approved");case"rejected":return a.translator.trans("withdrawal.admin.deposit.records.status.rejected");default:return"Unknown"}}async handleApprove(t,s){const r=t.id(),l=t.amount(),n=parseFloat(prompt(a.translator.trans("withdrawal.admin.deposit.records.approve_prompt",{amount:l}),l.toString())||l.toString()),c=prompt(a.translator.trans("withdrawal.admin.deposit.records.approve_notes_prompt"));if(isNaN(n)||n<=0){a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.deposit.records.invalid_amount"));return}this.state.processingRecords.add(r),e.redraw();try{await s.onApproveRecord(t,n,c||void 0),a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.admin.deposit.records.approve_success"))}catch(w){console.error("Error approving deposit record:",w),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.deposit.records.approve_error"))}finally{this.state.processingRecords.delete(r),e.redraw()}}async handleReject(t,s){const r=prompt(a.translator.trans("withdrawal.admin.deposit.records.reject_reason_prompt"));if(!r||r.trim()===""){a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.deposit.records.reject_reason_required"));return}const l=t.id();this.state.processingRecords.add(l),e.redraw();try{await s.onRejectRecord(t,r),a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.admin.deposit.records.reject_success"))}catch(n){console.error("Error rejecting deposit record:",n),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.deposit.records.reject_error"))}finally{this.state.processingRecords.delete(l),e.redraw()}}handleDelete(t,s){const l=t.user?.()?.displayName?.()||"Unknown User",n=t.amount();a.modal.show(R,{title:a.translator.trans("withdrawal.admin.deposit.records.delete_confirm_title"),message:a.translator.trans("withdrawal.admin.deposit.records.delete_confirm_message",{user:l,amount:n}),confirmText:a.translator.trans("withdrawal.admin.deposit.records.delete_confirm_button"),cancelText:a.translator.trans("withdrawal.admin.deposit.records.delete_cancel_button"),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{const c=t.id();this.state.processingRecords.add(c);try{await s.onDeleteRecord(t),a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.admin.deposit.records.delete_success"))}catch(w){console.error("Error deleting deposit record:",w),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.deposit.records.delete_error"))}finally{this.state.processingRecords.delete(c),e.redraw()}},onCancel:()=>{a.modal.close()}})}}const $=3e4,tt={"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"};function st(i){const{method:t,endpoint:s,body:r,params:l,headers:n,timeout:c}=i,w=s.startsWith("http")?s:`${A.forum.attribute("apiUrl")}${s}`,h={method:t,url:w,headers:{...tt,...n},timeout:c||$};if(r&&(t==="POST"||t==="PATCH"||t==="PUT")&&(h.body=r),l&&t==="GET"){const p=new URLSearchParams;Object.entries(l).forEach(([y,d])=>{d!=null&&p.append(y,String(d))}),h.url+=`?${p.toString()}`}return h}function at(i){if(i.name==="TypeError"||i.message==="Failed to fetch")return{message:A.translator.trans("core.lib.error.network_error"),status:0};if(i&&i.response)try{const t=typeof i.response=="string"?JSON.parse(i.response):i.response;if(t.errors&&Array.isArray(t.errors))return{message:t.errors[0].detail||"API error occurred",errors:t.errors,status:i.status}}catch{if(i.response.includes("<b>Fatal error</b>")||i.response.includes("<!DOCTYPE"))return{message:A.translator.trans("core.lib.error.generic_error"),status:i.status||500}}return i instanceof Error?{message:i.message,status:i.status}:{message:A.translator.trans("core.lib.error.generic_error"),status:500}}async function x(i,t={}){const{showSuccessAlert:s=!1,showErrorAlert:r=!0,successMessage:l,errorMessage:n,validateResponse:c,transformResponse:w,onSuccess:h,onError:p}=t;try{const y=st(i),d=await A.request(y);if(c&&!c(d))throw new Error("Response validation failed");const N=w?w(d):d;return s&&l&&A.alerts.show({type:"success",dismissible:!0},l),h&&h(N),N}catch(y){const d=at(y);if(p&&p(d),r){const N=n||d.message||"An error occurred";A.alerts.show({type:"error",dismissible:!0},N)}throw d}}async function _(i,t,s={}){return x({method:"GET",endpoint:i,params:t},s)}async function O(i,t,s={}){return x({method:"POST",endpoint:i,body:t},s)}async function L(i,t,s={}){return x({method:"PATCH",endpoint:i,body:t},s)}async function et(i,t={}){return x({method:"DELETE",endpoint:i},t)}const rt=()=>({async create(i){const t={type:"withdrawal-platforms",attributes:{name:i.name,symbol:i.symbol,network:i.network||null,minAmount:parseFloat(i.minAmount),maxAmount:parseFloat(i.maxAmount),fee:parseFloat(i.fee||"0"),iconUrl:i.iconUrl||null,iconClass:i.iconClass||null,isActive:!0}};return O("/withdrawal-platforms",{data:t},{showSuccessAlert:!0,successMessage:a.translator.trans("withdrawal.admin.platforms.add_success"),errorMessage:a.translator.trans("withdrawal.admin.platforms.add_error"),onSuccess:s=>{a.store.pushPayload(s)}})},async toggleStatus(i){const t=typeof i.id=="function"?i.id():i.id,s=(typeof i.isActive=="function"?i.isActive():i.attributes?.isActive)??!1,r=a.store.getById("withdrawal-platforms",t);r&&(await r.save({isActive:!s}),a.alerts.show({type:"success",dismissible:!0},a.translator.trans(`withdrawal.admin.platforms.${s?"disable":"enable"}_success`)))},async delete(i){const t=typeof i.id=="function"?i.id():i.id,s=a.store.getById("withdrawal-platforms",t);s&&await s.delete()},async load(){return _("/withdrawal-platforms",void 0,{errorMessage:a.translator.trans("withdrawal.admin.platforms.load_error"),transformResponse:i=>(a.store.pushPayload(i),a.store.all("withdrawal-platforms"))})}}),C=()=>({async create(i){const t={type:"deposit-platforms",attributes:{name:i.name,symbol:i.symbol,network:i.network,minAmount:parseFloat(i.minAmount)||0,maxAmount:i.maxAmount?parseFloat(i.maxAmount):null,address:i.address||null,qrCodeImageUrl:i.qrCodeImageUrl||null,iconUrl:i.iconUrl||null,iconClass:i.iconClass||null,warningText:i.warningText||null,isActive:i.isActive}};return O("/deposit-platforms",{data:t},{showSuccessAlert:!0,successMessage:a.translator.trans("withdrawal.admin.deposit.platforms.add_success"),errorMessage:a.translator.trans("withdrawal.admin.deposit.platforms.add_error"),onSuccess:s=>{a.store.pushPayload(s)}})},async toggleStatus(i){const t=typeof i.id=="function"?i.id():i.id,s=(typeof i.isActive=="function"?i.isActive():i.attributes?.isActive)??!1;return L(`/deposit-platforms/${t}`,{data:{type:"deposit-platforms",attributes:{isActive:!s}}},{showSuccessAlert:!0,successMessage:a.translator.trans(`withdrawal.admin.deposit.platforms.${s?"disable":"enable"}_success`),errorMessage:a.translator.trans("withdrawal.admin.deposit.platforms.toggle_error"),onSuccess:r=>{a.store.pushPayload(r)}})},async delete(i){const t=typeof i.id=="function"?i.id():i.id;return et(`/deposit-platforms/${t}`,{errorMessage:a.translator.trans("withdrawal.admin.deposit.platforms.delete_error")})},async load(){return _("/deposit-platforms",void 0,{errorMessage:a.translator.trans("withdrawal.admin.deposit.platforms.load_error"),transformResponse:i=>(a.store.pushPayload(i),a.store.all("deposit-platforms"))})}}),it=()=>({async updateStatus(i,t){const s=typeof i.id=="function"?i.id():i.id,r=a.store.getById("withdrawal-requests",s);r&&(await r.save({status:t}),a.alerts.show({type:"success",dismissible:!0},a.translator.trans(`withdrawal.admin.requests.${t}_success`)))},async load(){return _("/withdrawal-requests",{include:"user,platform"},{errorMessage:a.translator.trans("withdrawal.admin.requests.load_error"),transformResponse:i=>(a.store.pushPayload(i),Array.isArray(i.data)?i.data.filter(t=>t!==null):i.data?[i.data]:[])})}}),j=()=>({async updateStatus(i,t){const s=typeof i.id=="function"?i.id():i.id;return L(`/deposit-transactions/${s}`,{data:{type:"deposit-transactions",attributes:{status:t}}},{showSuccessAlert:!0,successMessage:a.translator.trans(`withdrawal.admin.deposit.transactions.${t}_success`),errorMessage:a.translator.trans("withdrawal.admin.deposit.transactions.update_error"),onSuccess:r=>{a.store.pushPayload(r)}})},async load(){return _("/deposit-transactions",void 0,{errorMessage:a.translator.trans("withdrawal.admin.deposit.transactions.load_error"),transformResponse:i=>(a.store.pushPayload(i),a.store.all("deposit-transactions"))})}});class ot extends J{constructor(){super(...arguments),this.depositPlatforms=[],this.depositTransactions=[],this.depositRecords=[],this.users={}}getConfig(){return{pageTitle:a.translator.trans("withdrawal.admin.page.title"),extensionId:"WithdrawalManagement",platformOperations:rt(),transactionOperations:it(),settingsComponent:z,tabs:[{key:"withdrawals",label:a.translator.trans("withdrawal.admin.tabs.withdrawals"),component:"div"},{key:"deposits",label:a.translator.trans("withdrawal.admin.tabs.deposits"),component:Z,props:()=>({platforms:this.depositPlatforms,transactions:this.depositTransactions,submittingPlatform:this.submittingPlatform,onAddPlatform:this.addDepositPlatform.bind(this),onTogglePlatformStatus:this.toggleDepositPlatformStatus.bind(this),onDeletePlatform:this.deleteDepositPlatform.bind(this),onUpdateTransactionStatus:this.updateDepositTransactionStatus.bind(this)})},{key:"deposit-records",label:a.translator.trans("withdrawal.admin.tabs.deposit_records"),component:"div"}],translations:{platformPrefix:"withdrawal.admin.platforms",transactionPrefix:"withdrawal.admin.requests"}}}renderActiveTabContent(){return this.activeTab==="withdrawals"?e("div",null,e(K,{platforms:this.platforms,submittingPlatform:this.submittingPlatform,onAddPlatform:this.addPlatform.bind(this),onTogglePlatformStatus:this.togglePlatformStatus.bind(this),onDeletePlatform:this.deletePlatform.bind(this)}),e(Q,{requests:this.transactions,onUpdateRequestStatus:this.updateTransactionStatus.bind(this),onDeleteRequest:this.deleteRequest.bind(this)})):this.activeTab==="deposit-records"?e(M,{records:this.depositRecords,platforms:this.depositPlatforms,loading:this.loading,onApproveRecord:this.approveDepositRecord.bind(this),onRejectRecord:this.rejectDepositRecord.bind(this),onDeleteRecord:this.deleteDepositRecord.bind(this)}):super.renderActiveTabContent()}async loadData(){try{await this.loadPlatforms(),await this.loadTransactions(),await this.loadUserData(),await this.loadDepositPlatforms(),await this.loadDepositTransactions(),await this.loadDepositRecords()}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,e.redraw()}}async addDepositPlatform(t){const s=C();if(!this.submittingPlatform){this.submittingPlatform=!0,e.redraw();try{await s.create(t),await this.loadDepositPlatforms()}catch(r){console.error("Error adding deposit platform:",r),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.deposit.platforms.add_error"))}finally{this.submittingPlatform=!1,e.redraw()}}}async toggleDepositPlatformStatus(t){const s=C();try{await s.toggleStatus(t),await this.loadDepositPlatforms(),e.redraw()}catch(r){console.error("Error toggling deposit platform status:",r)}}async deleteDepositPlatform(t){const s=C(),r=(typeof t.name=="function"?t.name():t.name)||"Unknown Platform";a.modal.show(R,{title:a.translator.trans("withdrawal.admin.platforms.delete_confirm_title"),message:a.translator.trans("withdrawal.admin.platforms.delete_confirm_message",{name:r}),confirmText:a.translator.trans("withdrawal.admin.platforms.delete_confirm_button"),cancelText:a.translator.trans("withdrawal.admin.platforms.delete_cancel_button"),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{try{await s.delete(t),await this.loadDepositPlatforms(),a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.admin.deposit.platforms.delete_success"))}catch(l){console.error("Error deleting deposit platform:",l),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.deposit.platforms.delete_error"))}e.redraw()},onCancel:()=>{a.modal.close()}})}async updateDepositTransactionStatus(t,s){const r=j();try{await r.updateStatus(t,s),await this.loadDepositTransactions(),e.redraw()}catch(l){console.error("Error updating deposit transaction:",l)}}deleteRequest(t){const s=typeof t.id=="function"?t.id():t.id,r=typeof t.amount=="function"?t.amount():t.attributes?.amount||0;let l="Unknown User";if(typeof t.user=="function"){const n=t.user();n&&typeof n.displayName=="function"?l=n.displayName():n&&n.attributes?.displayName&&(l=n.attributes.displayName)}a.modal.show(R,{title:a.translator.trans("withdrawal.admin.requests.delete_confirm_title"),message:a.translator.trans("withdrawal.admin.requests.delete_confirm_message",{info:`${l} - ${r}`}),confirmText:a.translator.trans("withdrawal.admin.requests.delete_confirm_button"),cancelText:a.translator.trans("withdrawal.admin.requests.delete_cancel_button"),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{try{const n=a.store.getById("withdrawal-requests",s);n&&(await n.delete(),await this.loadTransactions(),a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.admin.requests.delete_success")))}catch(n){console.error("Error deleting request:",n),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.requests.delete_error"))}},onCancel:()=>{a.modal.close()}})}async loadDepositPlatforms(){const t=C();try{this.depositPlatforms=await t.load(),console.log("Loaded deposit platforms:",this.depositPlatforms)}catch(s){console.error("Error loading deposit platforms:",s),this.depositPlatforms=[]}}async loadDepositTransactions(){const t=j();try{this.depositTransactions=await t.load(),console.log("Loaded deposit transactions:",this.depositTransactions)}catch(s){console.error("Error loading deposit transactions:",s),this.depositTransactions=[]}}async loadUserData(){if(this.transactions.length===0)return;const s=[...new Set(this.transactions.map(r=>{const l=r?.data?.relationships?.user?.data||r?.relationships?.user?.data;return l?l.id:null}).filter(r=>r!=null))].filter(r=>!this.users[r]);if(s.length>0)try{const r=s.map(n=>a.store.find("users",n).catch(c=>(console.error(`Error loading user ${n}:`,c),null))),l=await Promise.all(r);s.forEach((n,c)=>{l[c]&&(this.users[n]=l[c])})}catch(r){console.error("Error loading users:",r)}}async loadDepositRecords(){try{const t=await a.request({method:"GET",url:a.forum.attribute("apiUrl")+"/deposit-records"});a.store.pushPayload(t),this.depositRecords=a.store.all("deposit-records"),console.log("Loaded deposit records:",this.depositRecords)}catch(t){console.error("Error loading deposit records:",t),this.depositRecords=[]}}async approveDepositRecord(t,s,r){const l=typeof t.id=="function"?t.id():t.id;try{const n=await a.request({method:"PATCH",url:`${a.forum.attribute("apiUrl")}/deposit-records/${l}`,body:{data:{type:"deposit-records",id:l,attributes:{status:"approved",creditedAmount:s,adminNotes:r}}}});a.store.pushPayload(n),await this.loadDepositRecords(),e.redraw()}catch(n){throw console.error("Error approving deposit record:",n),n}}async rejectDepositRecord(t,s){const r=typeof t.id=="function"?t.id():t.id;try{const l=await a.request({method:"PATCH",url:`${a.forum.attribute("apiUrl")}/deposit-records/${r}`,body:{data:{type:"deposit-records",id:r,attributes:{status:"rejected",adminNotes:s}}}});a.store.pushPayload(l),await this.loadDepositRecords(),e.redraw()}catch(l){throw console.error("Error rejecting deposit record:",l),l}}async deleteDepositRecord(t){const s=typeof t.id=="function"?t.id():t.id;try{const r=a.store.getById("deposit-records",s);r&&(await r.delete(),await this.loadDepositRecords(),e.redraw())}catch(r){throw console.error("Error deleting deposit record:",r),r}}}class nt extends o{constructor(){super(...arguments),this.name=o.attribute("name"),this.symbol=o.attribute("symbol"),this.network=o.attribute("network"),this.displayName=o.attribute("displayName"),this.minAmount=o.attribute("minAmount"),this.maxAmount=o.attribute("maxAmount"),this.fee=o.attribute("fee"),this.iconUrl=o.attribute("iconUrl"),this.iconClass=o.attribute("iconClass"),this.isActive=o.attribute("isActive"),this.createdAt=o.attribute("createdAt",o.transformDate),this.updatedAt=o.attribute("updatedAt",o.transformDate)}apiEndpoint(){return`/withdrawal-platforms/${this.id()}`}getDisplayName(){return this.displayName()||this.name()}isValidAmount(t){const s=this.minAmount(),r=this.maxAmount();return t>=s&&t<=r}getTotalCost(t){return t+this.fee()}}const T={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class lt extends o{constructor(){super(...arguments),this.amount=o.attribute("amount"),this.accountDetails=o.attribute("accountDetails"),this.message=o.attribute("message"),this.status=o.attribute("status"),this.platformId=o.attribute("platformId"),this.userId=o.attribute("userId"),this.createdAt=o.attribute("createdAt",o.transformDate),this.updatedAt=o.attribute("updatedAt",o.transformDate),this.user=o.hasOne("user"),this.platform=o.hasOne("platform")}apiEndpoint(){return`/withdrawal-requests/${this.id()}`}isPending(){return this.status()===T.PENDING}isApproved(){return this.status()===T.APPROVED}isRejected(){return this.status()===T.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const t=this.status();return app.translator.trans(`withdrawal.forum.status.${t}`)}statusColor(){switch(this.status()){case T.APPROVED:return"success";case T.REJECTED:return"danger";case T.PENDING:default:return"warning"}}}class ct extends o{constructor(){super(...arguments),this.name=o.attribute("name"),this.symbol=o.attribute("symbol"),this.network=o.attribute("network"),this.networkTypeId=o.attribute("networkTypeId"),this.displayName=o.attribute("displayName"),this.minAmount=o.attribute("minAmount"),this.maxAmount=o.attribute("maxAmount"),this.fee=o.attribute("fee"),this.address=o.attribute("address"),this.qrCodeImageUrl=o.attribute("qrCodeImageUrl"),this.iconUrl=o.attribute("iconUrl"),this.iconClass=o.attribute("iconClass"),this.warningText=o.attribute("warningText"),this.networkConfig=o.attribute("networkConfig"),this.isActive=o.attribute("isActive"),this.createdAt=o.attribute("createdAt",o.transformDate),this.updatedAt=o.attribute("updatedAt",o.transformDate)}}class dt extends o{constructor(){super(...arguments),this.amount=o.attribute("amount"),this.fee=o.attribute("fee"),this.creditedAmount=o.attribute("creditedAmount"),this.transactionHash=o.attribute("transactionHash"),this.fromAddress=o.attribute("fromAddress"),this.memo=o.attribute("memo"),this.userMessage=o.attribute("userMessage"),this.status=o.attribute("status"),this.statusColor=o.attribute("statusColor"),this.blockchainData=o.attribute("blockchainData"),this.confirmations=o.attribute("confirmations"),this.requiredConfirmations=o.attribute("requiredConfirmations"),this.hasEnoughConfirmations=o.attribute("hasEnoughConfirmations"),this.canBeCompleted=o.attribute("canBeCompleted"),this.explorerUrl=o.attribute("explorerUrl"),this.detectedAt=o.attribute("detectedAt",o.transformDate),this.confirmedAt=o.attribute("confirmedAt",o.transformDate),this.completedAt=o.attribute("completedAt",o.transformDate),this.adminNotes=o.attribute("adminNotes"),this.createdAt=o.attribute("createdAt",o.transformDate),this.updatedAt=o.attribute("updatedAt",o.transformDate),this.user=o.hasOne("user"),this.platform=o.hasOne("platform"),this.depositAddress=o.hasOne("depositAddress"),this.processedBy=o.hasOne("processedBy")}}const v=class v extends o{constructor(){super(...arguments),this.id=o.attribute("id"),this.userId=o.attribute("userId"),this.platformId=o.attribute("platformId"),this.platformAccount=o.attribute("platformAccount"),this.realName=o.attribute("realName"),this.amount=o.attribute("amount"),this.depositTime=o.attribute("depositTime",o.transformDate),this.screenshotUrl=o.attribute("screenshotUrl"),this.userMessage=o.attribute("userMessage"),this.status=o.attribute("status"),this.processedAt=o.attribute("processedAt",o.transformDate),this.processedBy=o.attribute("processedBy"),this.adminNotes=o.attribute("adminNotes"),this.creditedAmount=o.attribute("creditedAmount"),this.createdAt=o.attribute("createdAt",o.transformDate),this.updatedAt=o.attribute("updatedAt",o.transformDate),this.user=o.hasOne("user"),this.platform=o.hasOne("platform"),this.processedByUser=o.hasOne("processedByUser")}isPending(){return this.status()===v.STATUS_PENDING}isApproved(){return this.status()===v.STATUS_APPROVED}isRejected(){return this.status()===v.STATUS_REJECTED}getStatusColor(){switch(this.status()){case v.STATUS_PENDING:return"warning";case v.STATUS_APPROVED:return"success";case v.STATUS_REJECTED:return"error";default:return"secondary"}}};v.STATUS_PENDING="pending",v.STATUS_APPROVED="approved",v.STATUS_REJECTED="rejected";let S=v;a.initializers.add("wusong8899-withdrawal",()=>{a.store.models["withdrawal-platforms"]=nt,a.store.models["withdrawal-requests"]=lt,a.store.models["deposit-platforms"]=ct,a.store.models["deposit-transactions"]=dt,a.store.models["deposit-records"]=S,a.extensionData.for("wusong8899-withdrawal").registerPage(ot)})})(flarum.core.compat["admin/app"],m,flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/components/Modal"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/helpers/icon"],flarum.core.compat["common/app"],flarum.core.compat["common/Component"],flarum.core.compat["common/utils/withAttr"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/components/Switch"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/helpers/username"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=admin.js.map

module.exports={};