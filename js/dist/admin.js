(function(s,a,B,U,j,b,v,A,y,V,u,F,R,d){"use strict";class I extends j{className(){return"ConfirmModal"}title(){const{title:t,dangerous:e=!1,icon:r=e?"fas fa-exclamation-triangle":"fas fa-question-circle"}=this.attrs;return m("span",null,r&&m("span",{className:`ConfirmModal-icon ${e?"dangerous":""}`},v(r)),t)}content(){const{message:t,confirmText:e="Confirm",cancelText:r="Cancel",onConfirm:n,onCancel:i,dangerous:l=!1}=this.attrs;return m("div",{className:"Modal-body"},m("div",{className:"ConfirmModal-message"},t),m("div",{className:"Form-group"},m("div",{className:"ButtonGroup"},m(b,{className:"Button",onclick:()=>{i(),A.modal.close()}},r),m(b,{className:`Button Button--${l?"danger":"primary"}`,onclick:()=>{n(),A.modal.close()}},e))))}}class W extends B{constructor(){super(),this.platforms=[],this.transactions=[],this.loading=!0,this.submittingPlatform=!1;const t=this.getConfig();this.activeTab=t.tabs[0]?.key||""}oninit(t){super.oninit(t),this.loadData()}content(){if(this.loading)return a(U,null);const t=this.getConfig();return a("div",{className:`${t.extensionId}ManagementPage`},a("div",{className:"container"},a("h2",null,t.pageTitle),t.settingsComponent&&a("div",{className:"SettingsSection"},a(t.settingsComponent,{onSettingChange:this.saveSetting.bind(this)})),t.tabs.length>1&&a("div",{className:"AdminTabs"},a("div",{className:"AdminTabs-nav"},t.tabs.map(e=>a("button",{key:e.key,className:`AdminTabs-tab ${this.activeTab===e.key?"active":""}`,onclick:()=>{this.activeTab=e.key}},e.label))),a("div",{className:"AdminTabs-content"},this.renderActiveTabContent())),t.tabs.length===1&&a("div",{className:"SingleTabContent"},this.renderActiveTabContent())))}renderActiveTabContent(){const t=this.getConfig(),e=t.tabs.find(n=>n.key===this.activeTab);if(!e)return null;const r={platforms:this.platforms,transactions:this.transactions,submittingPlatform:this.submittingPlatform,onAddPlatform:this.addPlatform.bind(this),onTogglePlatformStatus:this.togglePlatformStatus.bind(this),onDeletePlatform:this.deletePlatform.bind(this),...t.transactionOperations&&{onUpdateTransactionStatus:this.updateTransactionStatus.bind(this)},...e.props?e.props():{}};return a(e.component,r)}async addPlatform(t){if(this.submittingPlatform)return;this.submittingPlatform=!0;const e=this.getConfig();try{await e.platformOperations.create(t),await this.loadPlatforms()}catch(r){console.error("Error adding platform:",r)}finally{this.submittingPlatform=!1,a.redraw()}}async togglePlatformStatus(t){const e=this.getConfig();try{await e.platformOperations.toggleStatus(t),await this.loadPlatforms(),a.redraw()}catch(r){console.error("Error toggling platform status:",r)}}deletePlatform(t){const e=this.getConfig(),r=(typeof t.name=="function"?t.name():t.name)||"Unknown Platform";s.modal.show(I,{title:s.translator.trans(`${e.translations.platformPrefix}.delete_confirm_title`),message:s.translator.trans(`${e.translations.platformPrefix}.delete_confirm_message`,{name:r}),confirmText:s.translator.trans(`${e.translations.platformPrefix}.delete_confirm_button`),cancelText:s.translator.trans(`${e.translations.platformPrefix}.delete_cancel_button`),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{try{await e.platformOperations.delete(t),await this.loadPlatforms(),a.redraw(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans(`${e.translations.platformPrefix}.delete_success`))}catch(n){console.error("Error deleting platform:",n),s.alerts.show({type:"error",dismissible:!0},s.translator.trans(`${e.translations.platformPrefix}.delete_error`))}},onCancel:()=>{s.modal.close()}})}async updateTransactionStatus(t,e){const r=this.getConfig();if(r.transactionOperations)try{await r.transactionOperations.updateStatus(t,e),await this.loadTransactions();const n=r.translations.transactionPrefix||r.translations.platformPrefix;s.alerts.show({type:"success",dismissible:!0},s.translator.trans(`${n}.${e}_success`))}catch(n){console.error("Error updating transaction:",n);const i=r.translations.transactionPrefix||r.translations.platformPrefix;s.alerts.show({type:"error",dismissible:!0},s.translator.trans(`${i}.update_error`))}}async loadData(){try{await this.loadPlatforms(),this.getConfig().transactionOperations&&await this.loadTransactions()}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,a.redraw()}}async loadPlatforms(){const t=this.getConfig();try{this.platforms=await t.platformOperations.load(),console.log("Loaded platforms:",this.platforms)}catch(e){console.error("Error loading platforms:",e),this.platforms=[]}}async loadTransactions(){const t=this.getConfig();if(t.transactionOperations)try{this.transactions=await t.transactionOperations.load(),console.log("Loaded transactions:",this.transactions)}catch(e){console.error("Error loading transactions:",e),this.transactions=[]}}async saveSetting(t,e){try{await s.request({method:"POST",url:s.forum.attribute("apiUrl")+"/settings",body:{[t]:e}}),s.forum.pushAttributes({[t]:e})}catch(r){console.error("Error saving setting:",r),s.alerts.show({type:"error",dismissible:!0},"Failed to save setting")}}}class G extends y{view(){return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,"General Settings"),m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.settings.money_icon_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://i.mji.rip/2025/08/28/cd18932c68e9bbee9502b1fb6317cba9.png",value:s.forum.attribute("wusong8899-withdrawal.moneyIconUrl")||"",oninput:V("value",t=>this.attrs.onSettingChange("wusong8899-withdrawal.moneyIconUrl",t))}),m("small",{className:"helpText"},s.translator.trans("withdrawal.admin.settings.money_icon_url_help")))))}}class E{constructor(){this.errors=[]}required(t,e,r){return(!t||typeof t=="string"&&t.trim()==="")&&this.errors.push({field:e,message:`${r||e} is required`}),this}minLength(t,e,r,n){return t&&t.length<e&&this.errors.push({field:r,message:`${n||r} must be at least ${e} characters`}),this}numberRange(t,e,r,n,i){const l=typeof t=="string"?parseFloat(t):t;return isNaN(l)?(this.errors.push({field:n||"number",message:`${i||"Value"} must be a valid number`}),this):(e!==void 0&&l<e&&this.errors.push({field:n||"number",message:`${i||"Value"} must be at least ${e}`}),r!==void 0&&l>r&&this.errors.push({field:n||"number",message:`${i||"Value"} must be at most ${r}`}),this)}url(t,e,r){if(t&&t.trim())try{const n=new URL(t)}catch{this.errors.push({field:e,message:`${r||e} must be a valid URL`})}return this}custom(t,e,r){return t||this.errors.push({field:e,message:r}),this}getResult(){return{isValid:this.errors.length===0,errors:this.errors,firstErrorMessage:this.errors.length>0?this.errors[0].message:void 0}}reset(){return this.errors=[],this}}class H extends y{constructor(){super(...arguments),this.name=u(""),this.symbol=u(""),this.network=u(""),this.minAmount=u(""),this.maxAmount=u(""),this.fee=u(""),this.iconUrl=u(""),this.iconClass=u("")}view(){return a("div",{className:"WithdrawalManagementPage-addPlatform"},a("div",{className:"Form-group"},a("div",{className:"Form-row"},a("div",{className:"Form-col"},a("label",null,s.translator.trans("withdrawal.admin.platforms.name")),a("input",{type:"text",className:"FormControl",placeholder:s.translator.trans("withdrawal.admin.platforms.add_placeholder"),bidi:this.name})),a("div",{className:"Form-col"},a("label",null,s.translator.trans("withdrawal.admin.platforms.symbol")),a("input",{type:"text",className:"FormControl",placeholder:"BTC, ETH, USDT...",bidi:this.symbol})),a("div",{className:"Form-col"},a("label",null,s.translator.trans("withdrawal.admin.platforms.network")),a("input",{type:"text",className:"FormControl",placeholder:"TRC20, ERC20, BSC... (optional)",bidi:this.network}),a("small",{className:"helpText"},s.translator.trans("withdrawal.admin.platforms.network_help")))),a("div",{className:"Form-row"},a("div",{className:"Form-col"},a("label",null,s.translator.trans("withdrawal.admin.platforms.min_amount")),a("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.001",bidi:this.minAmount})),a("div",{className:"Form-col"},a("label",null,s.translator.trans("withdrawal.admin.platforms.max_amount")),a("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"10.0",bidi:this.maxAmount})),a("div",{className:"Form-col"},a("label",null,s.translator.trans("withdrawal.admin.platforms.fee")),a("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.0005",bidi:this.fee}))),a("div",{className:"Form-row"},a("div",{className:"Form-col"},a("label",null,s.translator.trans("withdrawal.admin.platforms.icon_url")),a("input",{type:"url",className:"FormControl",placeholder:"https://example.com/icon.png",bidi:this.iconUrl}),a("small",{className:"helpText"},s.translator.trans("withdrawal.admin.platforms.icon_url_help"))),a("div",{className:"Form-col"},a("label",null,s.translator.trans("withdrawal.admin.platforms.icon_class")),a("input",{type:"text",className:"FormControl",placeholder:"fas fa-coins",bidi:this.iconClass}),a("small",{className:"helpText"},s.translator.trans("withdrawal.admin.platforms.icon_class_help")))),a("div",{className:"Form-group"},a(b,{className:"Button Button--primary",loading:this.attrs.submitting,disabled:this.attrs.submitting,onclick:this.handleSubmit.bind(this)},s.translator.trans("withdrawal.admin.platforms.add_button")))))}validateForm(){const t=new E;try{const e=s.translator.trans("withdrawal.admin.platforms.name").toString(),r=s.translator.trans("withdrawal.admin.platforms.symbol").toString(),n=s.translator.trans("withdrawal.admin.platforms.min_amount").toString(),i=s.translator.trans("withdrawal.admin.platforms.max_amount").toString(),l=s.translator.trans("withdrawal.admin.platforms.fee").toString();t.required(this.name(),"name",e).required(this.symbol(),"symbol",r).numberRange(this.minAmount(),0,void 0,"minAmount",n).numberRange(this.maxAmount(),0,void 0,"maxAmount",i).numberRange(this.fee(),0,void 0,"fee",l);const c=parseFloat(this.minAmount());if(parseFloat(this.maxAmount())<c){const g=s.translator.trans("withdrawal.admin.platforms.max_min_error").toString();t.custom(!1,"maxAmount",g)}if(this.iconUrl()&&this.iconUrl().trim()){const g=s.translator.trans("withdrawal.admin.platforms.icon_url").toString();t.url(this.iconUrl(),"iconUrl",g)}const f=t.getResult();return!f.isValid&&f.firstErrorMessage&&s.alerts.show({type:"error",dismissible:!0},f.firstErrorMessage),f.isValid}catch(e){return console.error("Form validation error:",e),s.alerts.show({type:"error",dismissible:!0},"Validation failed"),!1}}async handleSubmit(){if(this.attrs.submitting||!this.validateForm())return;const t={name:this.name(),symbol:this.symbol(),network:this.network(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),iconUrl:this.iconUrl(),iconClass:this.iconClass()};try{await this.attrs.onSubmit(t),this.clearForm()}catch{}}clearForm(){this.name(""),this.symbol(""),this.network(""),this.minAmount(""),this.maxAmount(""),this.fee(""),this.iconUrl(""),this.iconClass(""),a.redraw()}}class k extends y{view(t){const{platform:e,type:r,onToggleStatus:n,onDelete:i,style:l="card"}=t.attrs;return l==="card"?this.renderCardStyle(e,r,n,i):this.renderListStyle(e,r,n,i)}renderCardStyle(t,e,r,n){const i=this.extractPlatformData(t),l=e==="withdrawal"?"withdrawal.admin.platforms":"withdrawal.admin.deposit.platforms";return a("div",{key:i.id,className:`${e}Platform`},a("div",{className:`${e}Platform-info`},a("div",{className:`${e}Platform-primary`},a("span",{className:`${e}Platform-status ${i.isActive?"active":"inactive"}`},i.isActive?"🟢":"🔴"),a("span",{className:`${e}Platform-name`},i.displayName),a("span",{className:"platform-id"},"#",i.id),i.network&&a("span",{className:`${e}Platform-network`},"(",i.network,")")),a("div",{className:`${e}Platform-details`},a("span",{className:`${e}Platform-amounts`},"Min: ",i.minAmount," | Max: ",i.maxAmount,` | Fee: ${i.fee}`,e==="deposit"&&` | Address: ${i.address?"Static":"Template"}`),i.createdDate&&a("span",{className:`${e}Platform-date`},i.dateDisplay))),a("div",{className:`${e}Platform-actions`},a(b,{className:`Button ${i.isActive?"Button--secondary":"Button--primary"}`,onclick:()=>r(t)},s.translator.trans(`${l}.${i.isActive?"disable":"enable"}`)),a(b,{className:"Button Button--danger",onclick:()=>n(t)},s.translator.trans(`${l}.delete`))))}renderListStyle(t,e,r,n){const i=this.extractPlatformData(t),l=e==="withdrawal"?"withdrawal.admin.platforms":"withdrawal.admin.deposit.platforms";return a("div",{className:`${e}PlatformListItem`},a("div",{className:`${e}PlatformListItem-content`},a("div",{className:`${e}PlatformListItem-icon`},this.renderPlatformIcon(t)),a("div",{className:`${e}PlatformListItem-info`},a("div",{className:`${e}PlatformListItem-primary`},a("strong",null,i.name),a("span",{className:`${e}PlatformListItem-displayName`},i.symbol,i.network&&` (${i.network})`)),a("div",{className:`${e}PlatformListItem-details`},a("span",{className:`${e}PlatformListItem-detail`},"Min: ",i.minAmount," ",i.symbol),i.maxAmount&&a("span",{className:`${e}PlatformListItem-detail`},"Max: ",i.maxAmount," ",i.symbol),i.fee&&a("span",{className:`${e}PlatformListItem-detail`},"Fee: ",i.fee," ",i.symbol),e==="deposit"&&a("span",{className:`${e}PlatformListItem-detail`},"Address: ",i.address?"Static":"Template"))),a("div",{className:`${e}PlatformListItem-actions`},a(F,{state:i.isActive,onchange:async()=>{await r(t),a.redraw()}},i.isActive?s.translator.trans(`${l}.active`):s.translator.trans(`${l}.inactive`)),a(b,{className:"Button Button--icon Button--flat",icon:"fas fa-trash",onclick:async()=>{await n(t),a.redraw()},title:s.translator.trans(`${l}.delete`)}))))}extractPlatformData(t){const e=typeof t.id=="function"?t.id():t.id,r=(typeof t.name=="function"?t.name():t.attributes?.name)||"Unknown Platform",n=(typeof t.symbol=="function"?t.symbol():t.attributes?.symbol)||"",i=(typeof t.network=="function"?t.network():t.attributes?.network)||null,l=(typeof t.displayName=="function"?t.displayName():t.attributes?.displayName)||r,c=(typeof t.minAmount=="function"?t.minAmount():t.attributes?.minAmount)||"N/A",h=(typeof t.maxAmount=="function"?t.maxAmount():t.attributes?.maxAmount)||"N/A",f=(typeof t.fee=="function"?t.fee():t.attributes?.fee)||"N/A",g=(typeof t.address=="function"?t.address():t.attributes?.address)||null,p=(typeof t.isActive=="function"?t.isActive():t.attributes?.isActive)??!1,D=(typeof t.createdAt=="function"?t.createdAt():t.attributes?.createdAt)||null;let P="N/A";if(D)try{P=R(D)}catch(w){console.error("Error formatting date:",w),P="Invalid Date"}return{id:e,name:r,symbol:n,network:i,displayName:l,minAmount:c,maxAmount:h,fee:f,address:g,isActive:p,createdDate:D,dateDisplay:P}}renderPlatformIcon(t){const e=typeof t.iconUrl=="function"?t.iconUrl():t.attributes?.iconUrl,r=typeof t.iconClass=="function"?t.iconClass():t.attributes?.iconClass,n=typeof t.symbol=="function"?t.symbol():t.attributes?.symbol;if(e)return a("img",{src:e,alt:n,className:"PlatformListItem-img"});if(r)return v(r);switch(n){case"USDT":return a("span",{className:"PlatformListItem-currencyIcon usdt"},"₮");case"USDC":return a("span",{className:"PlatformListItem-currencyIcon usdc"},"$");case"BTC":return a("span",{className:"PlatformListItem-currencyIcon btc"},"₿");case"ETH":return a("span",{className:"PlatformListItem-currencyIcon eth"},"Ξ");default:return v("fas fa-coins")}}}class J extends y{view(){const{platforms:t,submittingPlatform:e,onAddPlatform:r,onTogglePlatformStatus:n,onDeletePlatform:i}=this.attrs;return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,s.translator.trans("withdrawal.admin.platforms.title")),m(H,{onSubmit:r,submitting:e}),m("div",{className:"WithdrawalManagementPage-platformList"},t.length===0?m("p",null,s.translator.trans("withdrawal.admin.platforms.empty")):t.map(l=>m(k,{key:l.id?.()??l.id??Math.random(),platform:l,type:"withdrawal",style:"card",onToggleStatus:n,onDelete:i}))))}}class q extends y{view(){const t=this.attrs.request,{showActions:e,showDelete:r=!1}=this.attrs,n=typeof t.id=="function"?t.id():t.id,i=typeof t.amount=="function"?t.amount():t.attributes?.amount||0,l=typeof t.status=="function"?t.status():t.attributes?.status||"pending",c=typeof t.accountDetails=="function"?t.accountDetails():t.attributes?.accountDetails||t.attributes?.account_details||"N/A",h=typeof t.createdAt=="function"?t.createdAt():t.attributes?.createdAt||null;let f="Unknown User";if(typeof t.user=="function"){const w=t.user();w&&typeof w.displayName=="function"?f=w.displayName():w&&w.attributes?.displayName&&(f=w.attributes.displayName)}let g="Unknown Platform",p="N/A";if(typeof t.platform=="function"){const w=t.platform();w&&(g=typeof w.name=="function"?w.name():w.attributes?.name||"Unknown Platform",p=typeof w.symbol=="function"?w.symbol():w.attributes?.symbol||"N/A")}const D=`status-${l}`;let P="N/A";if(h)try{P=R(h)}catch(w){console.error("Error formatting request date:",w),P="Invalid Date"}return m("div",{key:n,className:`WithdrawalRequest ${D}`},m("div",{className:"WithdrawalRequest-info"},m("div",{className:"WithdrawalRequest-user"},m("strong",null,f),m("span",{className:"request-id"},"#",n)),m("div",{className:"WithdrawalRequest-details"},m("span",{className:"amount"},i),m("span",{className:"platform"},g),m("span",{className:"symbol"},p),m("span",{className:"date"},P)),m("div",{className:"WithdrawalRequest-account"},m("strong",null,s.translator.trans("withdrawal.admin.requests.account_details"),":"),m("span",null,c)),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${l}`},s.translator.trans(`withdrawal.admin.requests.status.${l}`)))),(e||r)&&m("div",{className:"WithdrawalRequest-actions"},e&&this.attrs.onUpdateStatus&&m("[",null,m(b,{className:"Button Button--primary",onclick:()=>this.attrs.onUpdateStatus(t,"approved")},s.translator.trans("withdrawal.admin.requests.approve")),m(b,{className:"Button Button--danger",onclick:()=>this.attrs.onUpdateStatus(t,"rejected")},s.translator.trans("withdrawal.admin.requests.reject"))),this.attrs.onDelete&&m(b,{className:"Button Button--link",onclick:()=>this.attrs.onDelete(t)},m("i",{className:"fas fa-trash"}),s.translator.trans("withdrawal.admin.requests.delete"))))}}class z extends y{view(){const{requests:t,onUpdateRequestStatus:e,onDeleteRequest:r}=this.attrs,n=t.filter(l=>((typeof l.status=="function"?l.status():l.attributes?.status)||"pending")==="pending"),i=t.filter(l=>((typeof l.status=="function"?l.status():l.attributes?.status)||"pending")!=="pending");return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,s.translator.trans("withdrawal.admin.requests.title")),m("div",{className:"WithdrawalManagementPage-pendingRequests"},m("h4",null,s.translator.trans("withdrawal.admin.requests.pending_title")),n.length===0?m("p",null,s.translator.trans("withdrawal.admin.requests.no_pending")):n.map(l=>m(q,{key:typeof l.id=="function"?l.id():l.id,request:l,showActions:!0,showDelete:!0,onUpdateStatus:e,onDelete:r}))),m("div",{className:"WithdrawalManagementPage-processedRequests"},m("h4",null,s.translator.trans("withdrawal.admin.requests.processed_title")),i.length===0?m("p",null,s.translator.trans("withdrawal.admin.requests.no_processed")):i.map(l=>m(q,{key:typeof l.id=="function"?l.id():l.id,request:l,showActions:!1,showDelete:!0,onDelete:r}))))}}class Y extends y{constructor(){super(...arguments),this.state={processingRecords:new Set}}view(t){const{records:e,platforms:r,loading:n}=t.attrs;return n?a("div",{className:"DepositRecordManagementSection"},a("div",{className:"DepositRecordManagementSection-header"},a("h3",null,s.translator.trans("withdrawal.admin.deposit.records.title"))),a(U,null)):a("div",{className:"DepositRecordManagementSection"},a("div",{className:"DepositRecordManagementSection-header"},a("h3",null,s.translator.trans("withdrawal.admin.deposit.records.title")),a("div",{className:"DepositRecordManagementSection-stats"},a("span",{className:"DepositRecordManagementSection-count"},s.translator.trans("withdrawal.admin.deposit.records.total_count",{count:e.length})),a("span",{className:"DepositRecordManagementSection-pending"},s.translator.trans("withdrawal.admin.deposit.records.pending_count",{count:e.filter(i=>i.isPending()).length})))),a("div",{className:"DepositRecordManagementSection-content"},e.length===0?a("div",{className:"DepositRecordManagementSection-empty"},a("div",{className:"DepositRecordManagementSection-emptyIcon"},v("fas fa-receipt")),a("h4",null,s.translator.trans("withdrawal.admin.deposit.records.empty.title")),a("p",null,s.translator.trans("withdrawal.admin.deposit.records.empty.description"))):a("div",{className:"DepositRecordManagementSection-list"},e.map(i=>this.renderRecord(i,r,t.attrs)))))}renderRecord(t,e,r){const n=t.id(),i=this.state.processingRecords.has(n),l=this.findPlatform(e,t.platformId()),c=t.user?.(),h=t.status(),f=t.depositTime(),g=t.createdAt();return a("div",{key:`record-${n}`,className:`DepositRecordItem status-${h}`},a("div",{className:"DepositRecordItem-header"},a("div",{className:"DepositRecordItem-user"},a("span",{className:"DepositRecordItem-username"},c?.displayName?.()||"Unknown User"),a("span",{className:"DepositRecordItem-userId"},"ID: ",t.userId())),a("div",{className:"DepositRecordItem-amount"},a("span",{className:"DepositRecordItem-amountValue"},t.amount()," ",l?.symbol?.()||""),a("div",{className:`DepositRecordItem-status status-${this.getStatusColor(h)}`},this.renderStatusIcon(h),this.getStatusText(h)))),a("div",{className:"DepositRecordItem-details"},a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Platform:"),a("span",{className:"DepositRecordItem-value"},l?.name?.()||"Unknown Platform"," ",l?.network?.()?`(${l.network()})`:"")),a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Platform Account:"),a("span",{className:"DepositRecordItem-value"},t.platformAccount())),t.realName?.()&&a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Real Name:"),a("span",{className:"DepositRecordItem-value"},t.realName())),a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Deposit Time:"),a("span",{className:"DepositRecordItem-value"},f.toLocaleDateString()," ",f.toLocaleTimeString())),a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Submitted:"),a("span",{className:"DepositRecordItem-value"},R(g))),t.userMessage?.()&&a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Message:"),a("span",{className:"DepositRecordItem-value"},t.userMessage())),t.screenshotUrl?.()&&a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Screenshot:"),a("a",{href:t.screenshotUrl(),target:"_blank",rel:"noopener noreferrer",className:"DepositRecordItem-link"},"View Screenshot ",v("fas fa-external-link-alt"))),t.processedAt?.()&&a("div",{className:"DepositRecordItem-processed"},a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Processed:"),a("span",{className:"DepositRecordItem-value"},R(t.processedAt()))),t.creditedAmount?.()&&t.creditedAmount()!==t.amount()&&a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Credited Amount:"),a("span",{className:"DepositRecordItem-value"},t.creditedAmount()," ",l?.symbol?.()||"")),t.adminNotes?.()&&a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Admin Notes:"),a("span",{className:"DepositRecordItem-value"},t.adminNotes())))),h==="pending"&&a("div",{className:"DepositRecordItem-actions"},a(b,{className:"Button Button--primary DepositRecordItem-approveButton",onclick:()=>this.handleApprove(t,r),loading:i,disabled:i},s.translator.trans("withdrawal.admin.deposit.records.approve")),a(b,{className:"Button Button--danger DepositRecordItem-rejectButton",onclick:()=>this.handleReject(t,r),loading:i,disabled:i},s.translator.trans("withdrawal.admin.deposit.records.reject"))),a("div",{className:"DepositRecordItem-adminActions"},a(b,{className:"Button Button--link DepositRecordItem-deleteButton",onclick:()=>this.handleDelete(t,r),disabled:i},v("fas fa-trash"),s.translator.trans("withdrawal.admin.deposit.records.delete"))))}findPlatform(t,e){return t.find(r=>{const n=typeof r.id=="function"?r.id():r.id;return parseInt(n)===e})||null}getStatusColor(t){switch(t){case"pending":return"warning";case"approved":return"success";case"rejected":return"danger";default:return"secondary"}}renderStatusIcon(t){switch(t){case"pending":return v("fas fa-clock");case"approved":return v("fas fa-check-circle");case"rejected":return v("fas fa-times-circle");default:return v("fas fa-question-circle")}}getStatusText(t){switch(t){case"pending":return s.translator.trans("withdrawal.admin.deposit.records.status.pending").toString();case"approved":return s.translator.trans("withdrawal.admin.deposit.records.status.approved").toString();case"rejected":return s.translator.trans("withdrawal.admin.deposit.records.status.rejected").toString();default:return"Unknown"}}async handleApprove(t,e){const r=t.id(),n=t.amount(),i=parseFloat(prompt(s.translator.trans("withdrawal.admin.deposit.records.approve_prompt",{amount:n}).toString(),n.toString())||n.toString()),l=prompt(s.translator.trans("withdrawal.admin.deposit.records.approve_notes_prompt").toString());if(isNaN(i)||i<=0){s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.records.invalid_amount"));return}this.state.processingRecords.add(r),a.redraw();try{await e.onApproveRecord(t,i,l||void 0),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.records.approve_success"))}catch(c){console.error("Error approving deposit record:",c),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.records.approve_error"))}finally{this.state.processingRecords.delete(r),a.redraw()}}async handleReject(t,e){const r=prompt(s.translator.trans("withdrawal.admin.deposit.records.reject_reason_prompt").toString());if(!r||r.trim()===""){s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.records.reject_reason_required"));return}const n=t.id();this.state.processingRecords.add(n),a.redraw();try{await e.onRejectRecord(t,r),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.records.reject_success"))}catch(i){console.error("Error rejecting deposit record:",i),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.records.reject_error"))}finally{this.state.processingRecords.delete(n),a.redraw()}}handleDelete(t,e){const n=t.user?.()?.displayName?.()||"Unknown User",i=t.amount();s.modal.show(I,{title:s.translator.trans("withdrawal.admin.deposit.records.delete_confirm_title"),message:s.translator.trans("withdrawal.admin.deposit.records.delete_confirm_message",{user:n,amount:i}),confirmText:s.translator.trans("withdrawal.admin.deposit.records.delete_confirm_button"),cancelText:s.translator.trans("withdrawal.admin.deposit.records.delete_cancel_button"),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{const l=t.id();this.state.processingRecords.add(l);try{await e.onDeleteRecord(t),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.records.delete_success"))}catch(c){console.error("Error deleting deposit record:",c),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.records.delete_error"))}finally{this.state.processingRecords.delete(l),a.redraw()}},onCancel:()=>{s.modal.close()}})}}class K extends y{constructor(){super(...arguments),this.formData={name:u(""),symbol:u(""),network:u(""),minAmount:u(""),maxAmount:u(""),fee:u(""),address:u(""),qrCodeImageUrl:u(""),iconUrl:u(""),iconClass:u(""),warningText:u(""),isActive:u(!0)}}oninit(t){super.oninit(t)}view(t){const{submitting:e,onCancel:r}=t.attrs;return m("div",{className:"AddDepositPlatformForm"},m("div",{className:"Form"},m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.name"),m("span",{className:"Form-required"},"*")),m("input",{type:"text",className:"FormControl",placeholder:"e.g., Tether",bidi:this.formData.name,disabled:e})),m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.symbol"),m("span",{className:"Form-required"},"*")),m("input",{type:"text",className:"FormControl",placeholder:"e.g., USDT",bidi:this.formData.symbol,disabled:e}))),m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.network")),m("input",{type:"text",className:"FormControl",placeholder:"e.g., TRC20, ERC20, BSC (optional)",bidi:this.formData.network,disabled:e}),m("div",{className:"helpText"},"Optional. Specify the blockchain network for this platform."))),m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.min_amount")),m("input",{type:"number",step:"0.00000001",min:"0",className:"FormControl",placeholder:"0.0",bidi:this.formData.minAmount,disabled:e})),m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.max_amount")),m("input",{type:"number",step:"0.00000001",min:"0",className:"FormControl",placeholder:"Leave empty for unlimited",bidi:this.formData.maxAmount,disabled:e})),m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.fee")),m("input",{type:"number",step:"0.00000001",min:"0",className:"FormControl",placeholder:"0.0",bidi:this.formData.fee,disabled:e}),m("div",{className:"helpText"},s.translator.trans("withdrawal.admin.deposit.platforms.fee_help")))),m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.address"),m("span",{className:"Form-required"},"*")),m("input",{type:"text",className:"FormControl",placeholder:"Enter deposit address for this platform",bidi:this.formData.address,disabled:e}),m("div",{className:"helpText"},s.translator.trans("withdrawal.admin.deposit.platforms.address_help"))),m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.qr_code_image_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://example.com/qr-code.png",bidi:this.formData.qrCodeImageUrl,disabled:e}),m("div",{className:"helpText"},s.translator.trans("withdrawal.admin.deposit.platforms.qr_code_image_help"))),m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.icon_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://example.com/icon.png",bidi:this.formData.iconUrl,disabled:e})),m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.icon_class")),m("input",{type:"text",className:"FormControl",placeholder:"fas fa-coins",bidi:this.formData.iconClass,disabled:e}))),m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.warning_text")),m("textarea",{className:"FormControl",rows:3,placeholder:"Network-specific warning for users",bidi:this.formData.warningText,disabled:e})),m("div",{className:"Form-group"},m(F,{state:this.formData.isActive(),onchange:this.formData.isActive,disabled:e},s.translator.trans("withdrawal.admin.deposit.platforms.is_active"))),m("div",{className:"Form-actions"},m(b,{className:"Button Button--primary",type:"submit",loading:e,onclick:this.handleSubmit.bind(this,t.attrs)},s.translator.trans("withdrawal.admin.deposit.platforms.add_button")),m(b,{className:"Button",onclick:r,disabled:e},s.translator.trans("core.admin.basics.cancel_button")))))}validateForm(){const t=new E;try{const e=s.translator.trans("withdrawal.admin.deposit.platforms.name").toString(),r=s.translator.trans("withdrawal.admin.deposit.platforms.symbol").toString(),n=s.translator.trans("withdrawal.admin.deposit.platforms.address").toString();if(t.required(this.formData.name(),"name",e).required(this.formData.symbol(),"symbol",r).required(this.formData.address(),"address",n),this.formData.minAmount()&&this.formData.minAmount().trim()){const l=s.translator.trans("withdrawal.admin.deposit.platforms.min_amount").toString();t.numberRange(this.formData.minAmount(),0,void 0,"minAmount",l)}if(this.formData.maxAmount()&&this.formData.maxAmount().trim()){const l=s.translator.trans("withdrawal.admin.deposit.platforms.max_amount").toString();t.numberRange(this.formData.maxAmount(),0,void 0,"maxAmount",l)}if(this.formData.fee()&&this.formData.fee().trim()){const l=s.translator.trans("withdrawal.admin.deposit.platforms.fee").toString();t.numberRange(this.formData.fee(),0,void 0,"fee",l)}if(this.formData.minAmount()&&this.formData.maxAmount()){const l=parseFloat(this.formData.minAmount()),c=parseFloat(this.formData.maxAmount());if(!isNaN(l)&&!isNaN(c)&&c<l){const h=s.translator.trans("withdrawal.admin.platforms.max_min_error").toString();t.custom(!1,"maxAmount",h)}}if(this.formData.iconUrl()&&this.formData.iconUrl().trim()){const l=s.translator.trans("withdrawal.admin.deposit.platforms.icon_url").toString();t.url(this.formData.iconUrl(),"iconUrl",l)}if(this.formData.qrCodeImageUrl()&&this.formData.qrCodeImageUrl().trim()){const l=s.translator.trans("withdrawal.admin.deposit.platforms.qr_code_image_url").toString();t.url(this.formData.qrCodeImageUrl(),"qrCodeImageUrl",l)}const i=t.getResult();return!i.isValid&&i.firstErrorMessage&&s.alerts.show({type:"error",dismissible:!0},i.firstErrorMessage),i.isValid}catch(e){return console.error("Form validation error:",e),s.alerts.show({type:"error",dismissible:!0},"Validation failed"),!1}}async handleSubmit(t,e){if(e.preventDefault(),!this.validateForm())return;const r={name:this.formData.name(),symbol:this.formData.symbol(),network:this.formData.network(),minAmount:this.formData.minAmount(),maxAmount:this.formData.maxAmount(),fee:this.formData.fee(),address:this.formData.address(),qrCodeImageUrl:this.formData.qrCodeImageUrl(),iconUrl:this.formData.iconUrl(),iconClass:this.formData.iconClass(),warningText:this.formData.warningText(),isActive:this.formData.isActive()};await t.onSubmit(r)}}class Q extends y{constructor(){super(...arguments),this.showAddForm=!1}view(t){const{platforms:e,submittingPlatform:r,onAddPlatform:n,onTogglePlatformStatus:i,onDeletePlatform:l}=t.attrs;return a("div",{className:"DepositPlatformManagementSection"},a("div",{className:"Section-header"},a("h3",null,s.translator.trans("withdrawal.admin.deposit.platforms.title")),a("div",{className:"Section-headerControls"},a(b,{className:"Button Button--primary",icon:"fas fa-plus",onclick:()=>{this.showAddForm=!this.showAddForm,a.redraw()}},s.translator.trans("withdrawal.admin.deposit.platforms.add_button")))),this.showAddForm&&a("div",{className:"Section-content"},a(K,{onSubmit:async c=>{await n(c),this.showAddForm=!1,a.redraw()},onCancel:()=>{this.showAddForm=!1,a.redraw()},submitting:r})),a("div",{className:"Section-content"},e.length===0?a("div",{className:"helpText"},s.translator.trans("withdrawal.admin.deposit.platforms.empty")):a("div",{className:"PlatformList"},e.map(c=>a(k,{key:typeof c.id=="function"?c.id():c.id,platform:c,type:"deposit",onToggleStatus:()=>i(c),onDelete:()=>l(c)})))))}}const X=3e4,Z={"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"};function M(o){const{method:t,endpoint:e,body:r,params:n,headers:i,timeout:l}=o,c=e.startsWith("http")?e:`${A.forum.attribute("apiUrl")}${e}`,h={method:t,url:c,headers:{...Z,...i},timeout:l||X};if(r&&(t==="POST"||t==="PATCH"||t==="PUT")&&(h.body=r),n&&t==="GET"){const f=new URLSearchParams;Object.entries(n).forEach(([g,p])=>{p!=null&&f.append(g,String(p))}),h.url+=`?${f.toString()}`}return h}function $(o){if(o.name==="TypeError"||o.message==="Failed to fetch")return{message:A.translator.trans("core.lib.error.network_error").toString(),status:0};if(o&&o.response)try{const t=typeof o.response=="string"?JSON.parse(o.response):o.response;if(t.errors&&Array.isArray(t.errors))return{message:t.errors[0].detail||"API error occurred",errors:t.errors,status:o.status}}catch{if(o.response.includes("<b>Fatal error</b>")||o.response.includes("<!DOCTYPE"))return{message:A.translator.trans("core.lib.error.generic_error").toString(),status:o.status||500}}return o instanceof Error?{message:o.message,status:o.status}:{message:A.translator.trans("core.lib.error.generic_error").toString(),status:500}}async function x(o,t={}){const{showSuccessAlert:e=!1,showErrorAlert:r=!0,successMessage:n,errorMessage:i,validateResponse:l,transformResponse:c,onSuccess:h,onError:f}=t;try{const g=M(o),p=await A.request(g);if(l&&!l(p))throw new Error("Response validation failed");const D=c?c(p):p;return e&&n&&A.alerts.show({type:"success",dismissible:!0},n),h&&h(D),D}catch(g){const p=$(g);if(f&&f(p),r){const D=i||p.message||"An error occurred";A.alerts.show({type:"error",dismissible:!0},D)}throw p}}async function T(o,t,e={}){return x({method:"GET",endpoint:o,params:t},e)}async function L(o,t,e={}){return x({method:"POST",endpoint:o,body:t},e)}async function O(o,t,e={}){return x({method:"PATCH",endpoint:o,body:t},e)}async function tt(o,t={}){return x({method:"DELETE",endpoint:o},t)}const st=()=>({async create(o){const t={type:"withdrawal-platforms",attributes:{name:o.name,symbol:o.symbol,network:o.network||null,minAmount:parseFloat(o.minAmount),maxAmount:parseFloat(o.maxAmount),fee:parseFloat(o.fee||"0"),iconUrl:o.iconUrl||null,iconClass:o.iconClass||null,isActive:!0}};return L("/withdrawal-platforms",{data:t},{showSuccessAlert:!0,successMessage:s.translator.trans("withdrawal.admin.platforms.add_success").toString(),errorMessage:s.translator.trans("withdrawal.admin.platforms.add_error").toString(),onSuccess:e=>{s.store.pushPayload(e)}})},async toggleStatus(o){const t=typeof o.id=="function"?o.id():o.id,e=(typeof o.isActive=="function"?o.isActive():o.attributes?.isActive)??!1,r=s.store.getById("withdrawal-platforms",t);r&&(await r.save({isActive:!e}),s.alerts.show({type:"success",dismissible:!0},s.translator.trans(`withdrawal.admin.platforms.${e?"disable":"enable"}_success`)))},async delete(o){const t=typeof o.id=="function"?o.id():o.id,e=s.store.getById("withdrawal-platforms",t);e&&await e.delete()},async load(){return T("/withdrawal-platforms",void 0,{errorMessage:s.translator.trans("withdrawal.admin.platforms.load_error").toString(),transformResponse:o=>(s.store.pushPayload(o),s.store.all("withdrawal-platforms"))})}}),_=()=>({async create(o){const t={type:"deposit-platforms",attributes:{name:o.name,symbol:o.symbol,network:o.network,minAmount:parseFloat(o.minAmount)||0,maxAmount:o.maxAmount?parseFloat(o.maxAmount):null,address:o.address||null,qrCodeImageUrl:o.qrCodeImageUrl||null,iconUrl:o.iconUrl||null,iconClass:o.iconClass||null,warningText:o.warningText||null,isActive:o.isActive}};return L("/deposit-platforms",{data:t},{showSuccessAlert:!0,successMessage:s.translator.trans("withdrawal.admin.deposit.platforms.add_success").toString(),errorMessage:s.translator.trans("withdrawal.admin.deposit.platforms.add_error").toString(),onSuccess:e=>{s.store.pushPayload(e)}})},async toggleStatus(o){const t=typeof o.id=="function"?o.id():o.id,e=(typeof o.isActive=="function"?o.isActive():o.attributes?.isActive)??!1;return O(`/deposit-platforms/${t}`,{data:{type:"deposit-platforms",attributes:{isActive:!e}}},{showSuccessAlert:!0,successMessage:s.translator.trans(`withdrawal.admin.deposit.platforms.${e?"disable":"enable"}_success`).toString(),errorMessage:s.translator.trans("withdrawal.admin.deposit.platforms.toggle_error").toString(),onSuccess:r=>{s.store.pushPayload(r)}})},async delete(o){const t=typeof o.id=="function"?o.id():o.id;return tt(`/deposit-platforms/${t}`,{errorMessage:s.translator.trans("withdrawal.admin.deposit.platforms.delete_error").toString()})},async load(){return T("/deposit-platforms",void 0,{errorMessage:s.translator.trans("withdrawal.admin.deposit.platforms.load_error").toString(),transformResponse:o=>(s.store.pushPayload(o),s.store.all("deposit-platforms"))})}}),et=()=>({async updateStatus(o,t){const e=typeof o.id=="function"?o.id():o.id,r=s.store.getById("withdrawal-requests",e);r&&(await r.save({status:t}),s.alerts.show({type:"success",dismissible:!0},s.translator.trans(`withdrawal.admin.requests.${t}_success`).toString()))},async load(){return T("/withdrawal-requests",{include:"user,platform"},{errorMessage:s.translator.trans("withdrawal.admin.requests.load_error").toString(),transformResponse:o=>(s.store.pushPayload(o),Array.isArray(o.data)?o.data.filter(t=>t!==null):o.data?[o.data]:[])})}}),at=()=>({async updateStatus(o,t){const e=typeof o.id=="function"?o.id():o.id;return O(`/deposit-records/${e}`,{data:{type:"deposit-records",attributes:{status:t}}},{showSuccessAlert:!0,successMessage:s.translator.trans(`withdrawal.admin.deposit.records.${t}_success`).toString(),errorMessage:s.translator.trans("withdrawal.admin.deposit.records.update_error").toString(),onSuccess:r=>{s.store.pushPayload(r)}})},async load(){return T("/deposit-records",void 0,{errorMessage:s.translator.trans("withdrawal.admin.deposit.records.load_error").toString(),transformResponse:o=>(s.store.pushPayload(o),s.store.all("deposit-records"))})}});function ct(o){return o}class rt extends y{view(){return a("div",null,"Withdrawals Content")}}class ot extends y{view(){return a("div",null,"Deposits Content")}}class it extends W{constructor(){super(...arguments),this.depositPlatforms=[],this.depositRecords=[],this.users={}}getConfig(){return{pageTitle:s.translator.trans("withdrawal.admin.page.title").toString(),extensionId:"WithdrawalManagement",platformOperations:st(),transactionOperations:et(),settingsComponent:G,tabs:[{key:"withdrawals",label:s.translator.trans("withdrawal.admin.tabs.withdrawals").toString(),component:rt},{key:"deposits",label:s.translator.trans("withdrawal.admin.tabs.deposits").toString(),component:ot}],translations:{platformPrefix:"withdrawal.admin.platforms",transactionPrefix:"withdrawal.admin.requests"}}}renderActiveTabContent(){return this.activeTab==="withdrawals"?a("div",null,a(J,{platforms:this.platforms,submittingPlatform:this.submittingPlatform,onAddPlatform:this.addPlatform.bind(this),onTogglePlatformStatus:this.togglePlatformStatus.bind(this),onDeletePlatform:this.deletePlatform.bind(this)}),a(z,{requests:this.transactions,onUpdateRequestStatus:this.updateTransactionStatus.bind(this),onDeleteRequest:this.deleteWithdrawalRequest.bind(this)})):this.activeTab==="deposits"?a("div",null,a(Q,{platforms:this.depositPlatforms,submittingPlatform:this.submittingPlatform,onAddPlatform:this.addDepositPlatform.bind(this),onTogglePlatformStatus:this.toggleDepositPlatformStatus.bind(this),onDeletePlatform:this.deleteDepositPlatform.bind(this)}),a(Y,{platforms:this.depositPlatforms,records:this.depositRecords,loading:this.loading,onApproveRecord:this.approveDepositRecord.bind(this),onRejectRecord:this.rejectDepositRecord.bind(this),onDeleteRecord:this.deleteDepositRecord.bind(this)})):super.renderActiveTabContent()}async loadData(){try{await this.loadPlatforms(),await this.loadTransactions(),await this.loadUserData(),await this.loadDepositPlatforms(),await this.loadDepositRecords()}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,a.redraw()}}async addDepositPlatform(t){const e=_();if(!this.submittingPlatform){this.submittingPlatform=!0,a.redraw();try{await e.create(t),await this.loadDepositPlatforms()}catch(r){console.error("Error adding deposit platform:",r),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.platforms.add_error"))}finally{this.submittingPlatform=!1,a.redraw()}}}async toggleDepositPlatformStatus(t){const e=_();try{await e.toggleStatus(t),await this.loadDepositPlatforms(),a.redraw()}catch(r){console.error("Error toggling deposit platform status:",r)}}async deleteDepositPlatform(t){const e=_(),r=(typeof t.name=="function"?t.name():t.name)||"Unknown Platform";s.modal.show(I,{title:s.translator.trans("withdrawal.admin.platforms.delete_confirm_title"),message:s.translator.trans("withdrawal.admin.platforms.delete_confirm_message",{name:r}),confirmText:s.translator.trans("withdrawal.admin.platforms.delete_confirm_button"),cancelText:s.translator.trans("withdrawal.admin.platforms.delete_cancel_button"),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{try{await e.delete(t),await this.loadDepositPlatforms(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.platforms.delete_success"))}catch(n){console.error("Error deleting deposit platform:",n),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.platforms.delete_error"))}a.redraw()},onCancel:()=>{s.modal.close()}})}async updateDepositRecordStatus(t,e){const r=at();try{await r.updateStatus(t,e),await this.loadDepositRecords(),a.redraw()}catch(n){console.error("Error updating deposit record:",n)}}deleteWithdrawalRequest(t){const e=typeof t.id=="function"?t.id():t.id,r=typeof t.amount=="function"?t.amount():t.attributes?.amount||0;let n="Unknown User";if(typeof t.user=="function"){const i=t.user();i&&typeof i.displayName=="function"?n=i.displayName():i&&i.attributes?.displayName&&(n=i.attributes.displayName)}s.modal.show(I,{title:s.translator.trans("withdrawal.admin.requests.delete_confirm_title"),message:s.translator.trans("withdrawal.admin.requests.delete_confirm_message",{info:`${n} - ${r}`}),confirmText:s.translator.trans("withdrawal.admin.requests.delete_confirm_button"),cancelText:s.translator.trans("withdrawal.admin.requests.delete_cancel_button"),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{try{const i=s.store.getById("withdrawal-requests",e);i&&(await i.delete(),await this.loadTransactions(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.requests.delete_success")))}catch(i){console.error("Error deleting request:",i),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.requests.delete_error"))}},onCancel:()=>{s.modal.close()}})}async loadDepositPlatforms(){const t=_();try{this.depositPlatforms=await t.load(),console.log("Loaded deposit platforms:",this.depositPlatforms)}catch(e){console.error("Error loading deposit platforms:",e),this.depositPlatforms=[]}}async loadUserData(){if(this.transactions.length===0)return;const e=[...new Set(this.transactions.map(r=>{const n=r?.data?.relationships?.user?.data||r?.relationships?.user?.data;return n?n.id:null}).filter(r=>r!=null))].filter(r=>!this.users[r]);if(e.length>0)try{const r=e.map(i=>s.store.find("users",i).catch(l=>(console.error(`Error loading user ${i}:`,l),null))),n=await Promise.all(r);e.forEach((i,l)=>{n[l]&&(this.users[i]=n[l])})}catch(r){console.error("Error loading users:",r)}}async loadDepositRecords(){try{const t=await s.request({method:"GET",url:s.forum.attribute("apiUrl")+"/deposit-records"});s.store.pushPayload(t),this.depositRecords=s.store.all("deposit-records"),console.log("Loaded deposit records:",this.depositRecords)}catch(t){console.error("Error loading deposit records:",t),this.depositRecords=[]}}async approveDepositRecord(t,e,r){const n=typeof t.id=="function"?t.id():t.id;try{const i=await s.request({method:"PATCH",url:`${s.forum.attribute("apiUrl")}/deposit-records/${n}`,body:{data:{type:"deposit-records",id:n,attributes:{status:"approved",creditedAmount:e,adminNotes:r}}}});s.store.pushPayload(i),await this.loadDepositRecords(),a.redraw()}catch(i){throw console.error("Error approving deposit record:",i),i}}async rejectDepositRecord(t,e){const r=typeof t.id=="function"?t.id():t.id;try{const n=await s.request({method:"PATCH",url:`${s.forum.attribute("apiUrl")}/deposit-records/${r}`,body:{data:{type:"deposit-records",id:r,attributes:{status:"rejected",adminNotes:e}}}});s.store.pushPayload(n),await this.loadDepositRecords(),a.redraw()}catch(n){throw console.error("Error rejecting deposit record:",n),n}}async deleteDepositRecord(t){const e=typeof t.id=="function"?t.id():t.id;try{const r=s.store.getById("deposit-records",e);r&&(await r.delete(),await this.loadDepositRecords(),a.redraw())}catch(r){throw console.error("Error deleting deposit record:",r),r}}}class nt extends d{constructor(){super(...arguments),this.name=d.attribute("name"),this.symbol=d.attribute("symbol"),this.network=d.attribute("network"),this.displayName=d.attribute("displayName"),this.minAmount=d.attribute("minAmount"),this.maxAmount=d.attribute("maxAmount"),this.fee=d.attribute("fee"),this.iconUrl=d.attribute("iconUrl"),this.iconClass=d.attribute("iconClass"),this.isActive=d.attribute("isActive"),this.createdAt=d.attribute("createdAt",d.transformDate),this.updatedAt=d.attribute("updatedAt",d.transformDate)}apiEndpoint(){return`/withdrawal-platforms/${this.id()}`}getDisplayName(){return this.displayName()||this.name()}isValidAmount(t){const e=this.minAmount(),r=this.maxAmount();return t>=e&&t<=r}getTotalCost(t){return t+this.fee()}}const S={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class lt extends d{constructor(){super(...arguments),this.amount=d.attribute("amount"),this.accountDetails=d.attribute("accountDetails"),this.message=d.attribute("message"),this.status=d.attribute("status"),this.platformId=d.attribute("platformId"),this.userId=d.attribute("userId"),this.createdAt=d.attribute("createdAt",d.transformDate),this.updatedAt=d.attribute("updatedAt",d.transformDate),this.user=d.hasOne("user"),this.platform=d.hasOne("platform")}apiEndpoint(){return`/withdrawal-requests/${this.id()}`}isPending(){return this.status()===S.PENDING}isApproved(){return this.status()===S.APPROVED}isRejected(){return this.status()===S.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const t=this.status();return A.translator.trans(`withdrawal.forum.status.${t}`).toString()}statusColor(){switch(this.status()){case S.APPROVED:return"success";case S.REJECTED:return"danger";case S.PENDING:default:return"warning"}}}class dt extends d{constructor(){super(...arguments),this.name=d.attribute("name"),this.symbol=d.attribute("symbol"),this.network=d.attribute("network"),this.networkTypeId=d.attribute("networkTypeId"),this.displayName=d.attribute("displayName"),this.minAmount=d.attribute("minAmount"),this.maxAmount=d.attribute("maxAmount"),this.fee=d.attribute("fee"),this.address=d.attribute("address"),this.qrCodeImageUrl=d.attribute("qrCodeImageUrl"),this.iconUrl=d.attribute("iconUrl"),this.iconClass=d.attribute("iconClass"),this.warningText=d.attribute("warningText"),this.networkConfig=d.attribute("networkConfig"),this.isActive=d.attribute("isActive"),this.createdAt=d.attribute("createdAt",d.transformDate),this.updatedAt=d.attribute("updatedAt",d.transformDate)}}const N=class N extends d{constructor(){super(...arguments),this.id=d.attribute("id"),this.userId=d.attribute("userId"),this.platformId=d.attribute("platformId"),this.platformAccount=d.attribute("platformAccount"),this.realName=d.attribute("realName"),this.amount=d.attribute("amount"),this.depositTime=d.attribute("depositTime",d.transformDate),this.screenshotUrl=d.attribute("screenshotUrl"),this.userMessage=d.attribute("userMessage"),this.status=d.attribute("status"),this.processedAt=d.attribute("processedAt",d.transformDate),this.processedBy=d.attribute("processedBy"),this.adminNotes=d.attribute("adminNotes"),this.creditedAmount=d.attribute("creditedAmount"),this.createdAt=d.attribute("createdAt",d.transformDate),this.updatedAt=d.attribute("updatedAt",d.transformDate),this.user=d.hasOne("user"),this.platform=d.hasOne("platform"),this.processedByUser=d.hasOne("processedByUser")}isPending(){return this.status()===N.STATUS_PENDING}isApproved(){return this.status()===N.STATUS_APPROVED}isRejected(){return this.status()===N.STATUS_REJECTED}getStatusColor(){switch(this.status()){case N.STATUS_PENDING:return"warning";case N.STATUS_APPROVED:return"success";case N.STATUS_REJECTED:return"error";default:return"secondary"}}};N.STATUS_PENDING="pending",N.STATUS_APPROVED="approved",N.STATUS_REJECTED="rejected";let C=N;s.initializers.add("wusong8899-withdrawal",()=>{s.store.models["withdrawal-platforms"]=nt,s.store.models["withdrawal-requests"]=lt,s.store.models["deposit-platforms"]=dt,s.store.models["deposit-records"]=C,s.extensionData.for("wusong8899-withdrawal").registerPage(it)})})(flarum.core.compat["admin/app"],m,flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/components/Modal"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/helpers/icon"],flarum.core.compat["common/app"],flarum.core.compat["common/Component"],flarum.core.compat["common/utils/withAttr"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/components/Switch"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=admin.js.map

module.exports={};