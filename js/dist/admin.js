(function(t,u,l,c,h,d){"use strict";class w extends u{constructor(){super(...arguments),this.platforms=[],this.requests=[],this.users={},this.loading=!0,this.newPlatformName=h(""),this.submittingPlatform=!1}oninit(a){super.oninit(a),this.loadData()}content(){return this.loading?m(c,null):m("div",{className:"WithdrawalManagementPage"},m("div",{className:"container"},m("h2",null,t.translator.trans("withdrawal.admin.page.title")),this.renderSettings(),this.renderPlatformManagement(),this.renderRequestManagement()))}renderSettings(){return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,t.translator.trans("withdrawal.admin.settings.title")),m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,t.translator.trans("withdrawal.admin.settings.min_amount")),this.buildSettingComponent({type:"number",setting:"withdrawal.min_amount",placeholder:"0"})),m("div",{className:"Form-group"},m("label",null,t.translator.trans("withdrawal.admin.settings.max_amount")),this.buildSettingComponent({type:"number",setting:"withdrawal.max_amount",placeholder:"10000"})),m("div",{className:"Form-group"},m("label",null,t.translator.trans("withdrawal.admin.settings.fee")),this.buildSettingComponent({type:"number",setting:"withdrawal.fee",placeholder:"0"})),m("div",{className:"Form-group"},this.submitButton())))}renderPlatformManagement(){return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,t.translator.trans("withdrawal.admin.platforms.title")),m("div",{className:"WithdrawalManagementPage-addPlatform"},m("div",{className:"Form-group"},m("input",{type:"text",className:"FormControl",placeholder:t.translator.trans("withdrawal.admin.platforms.add_placeholder"),value:this.newPlatformName(),oninput:a=>this.newPlatformName(a.target.value)}),m(l,{className:"Button Button--primary",loading:this.submittingPlatform,disabled:!this.newPlatformName(),onclick:this.addPlatform.bind(this)},t.translator.trans("withdrawal.admin.platforms.add_button")))),m("div",{className:"WithdrawalManagementPage-platformList"},this.platforms.length===0?m("p",null,t.translator.trans("withdrawal.admin.platforms.empty")):this.platforms.map(a=>this.renderPlatform(a))))}renderPlatform(a){return m("div",{key:a.id,className:"WithdrawalPlatform"},m("span",{className:"WithdrawalPlatform-name"},a.attributes.name),m("span",{className:"WithdrawalPlatform-date"},d(a.attributes.createdAt).format("YYYY-MM-DD")),m(l,{className:"Button Button--danger",onclick:()=>this.deletePlatform(a)},t.translator.trans("withdrawal.admin.platforms.delete")))}renderRequestManagement(){const a=this.requests.filter(s=>s.attributes.status==="pending"),e=this.requests.filter(s=>s.attributes.status!=="pending");return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,t.translator.trans("withdrawal.admin.requests.title")),m("div",{className:"WithdrawalManagementPage-pendingRequests"},m("h4",null,t.translator.trans("withdrawal.admin.requests.pending_title")),a.length===0?m("p",null,t.translator.trans("withdrawal.admin.requests.no_pending")):a.map(s=>this.renderRequest(s,!0))),m("div",{className:"WithdrawalManagementPage-processedRequests"},m("h4",null,t.translator.trans("withdrawal.admin.requests.processed_title")),e.length===0?m("p",null,t.translator.trans("withdrawal.admin.requests.no_processed")):e.map(s=>this.renderRequest(s,!1))))}renderRequest(a,e){const s=this.users[a.relationships.user.data.id],r=this.platforms.find(n=>n.id==a.relationships.platform.data.id),i=`status-${a.attributes.status}`;return m("div",{key:a.id,className:`WithdrawalRequest ${i}`},m("div",{className:"WithdrawalRequest-info"},m("div",{className:"WithdrawalRequest-user"},m("strong",null,s?.attributes.displayName||"Unknown User")),m("div",{className:"WithdrawalRequest-details"},m("span",{className:"amount"},"$",a.attributes.amount),m("span",{className:"platform"},r?.attributes.name),m("span",{className:"date"},d(a.attributes.createdAt).format("YYYY-MM-DD HH:mm"))),m("div",{className:"WithdrawalRequest-account"},m("strong",null,t.translator.trans("withdrawal.admin.requests.account_details"),":"),m("span",null,a.attributes.accountDetails)),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${a.attributes.status}`},t.translator.trans(`withdrawal.admin.requests.status.${a.attributes.status}`)))),e&&m("div",{className:"WithdrawalRequest-actions"},m(l,{className:"Button Button--primary",onclick:()=>this.updateRequestStatus(a,"approved")},t.translator.trans("withdrawal.admin.requests.approve")),m(l,{className:"Button Button--danger",onclick:()=>this.updateRequestStatus(a,"rejected")},t.translator.trans("withdrawal.admin.requests.reject"))))}async addPlatform(){if(!(!this.newPlatformName()||this.submittingPlatform)){this.submittingPlatform=!0;try{const a={type:"withdrawal-platforms",attributes:{name:this.newPlatformName()}};await t.request({method:"POST",url:t.forum.attribute("apiUrl")+"/withdrawal-platforms",body:{data:a}}),this.newPlatformName(""),await this.loadPlatforms(),t.alerts.show({type:"success",message:t.translator.trans("withdrawal.admin.platforms.add_success")})}catch(a){console.error("Error adding platform:",a),t.alerts.show({type:"error",message:t.translator.trans("withdrawal.admin.platforms.add_error")})}finally{this.submittingPlatform=!1,m.redraw()}}}async deletePlatform(a){if(confirm(t.translator.trans("withdrawal.admin.platforms.delete_confirm",{name:a.attributes.name})))try{await t.request({method:"DELETE",url:t.forum.attribute("apiUrl")+"/withdrawal-platforms/"+a.id}),await this.loadPlatforms(),t.alerts.show({type:"success",message:t.translator.trans("withdrawal.admin.platforms.delete_success")})}catch(e){console.error("Error deleting platform:",e),t.alerts.show({type:"error",message:t.translator.trans("withdrawal.admin.platforms.delete_error")})}}async updateRequestStatus(a,e){try{await t.request({method:"PATCH",url:t.forum.attribute("apiUrl")+"/withdrawal-requests/"+a.id,body:{data:{type:"withdrawal-requests",id:a.id,attributes:{status:e}}}}),await this.loadRequests(),t.alerts.show({type:"success",message:t.translator.trans(`withdrawal.admin.requests.${e}_success`)})}catch(s){console.error("Error updating request:",s),t.alerts.show({type:"error",message:t.translator.trans("withdrawal.admin.requests.update_error")})}}async loadData(){try{await Promise.all([this.loadPlatforms(),this.loadRequests()])}catch(a){console.error("Error loading data:",a)}finally{this.loading=!1,m.redraw()}}async loadPlatforms(){const a=await t.request({method:"GET",url:t.forum.attribute("apiUrl")+"/withdrawal-platforms"});this.platforms=a.data||[]}async loadRequests(){const a=await t.request({method:"GET",url:t.forum.attribute("apiUrl")+"/withdrawal-requests?include=user,platform"});this.requests=a.data||[];const s=[...new Set(this.requests.map(r=>r.relationships.user.data.id))].filter(r=>!this.users[r]);if(s.length>0)try{const r=s.map(n=>t.store.find("users",n).catch(o=>(console.error(`Error loading user ${n}:`,o),null))),i=await Promise.all(r);s.forEach((n,o)=>{i[o]&&(this.users[n]=i[o])})}catch(r){console.error("Error loading users:",r)}}}t.initializers.add("wusong8899-withdrawal",()=>{t.extensionData.for("wusong8899-withdrawal").registerPage(w)})})(flarum.core.compat["admin/app"],flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/utils/dayjs"]);
//# sourceMappingURL=admin.js.map

module.exports={};