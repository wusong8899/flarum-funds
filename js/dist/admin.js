(function(a,A,l,v,c,g,p,n){"use strict";class _ extends A{constructor(){super(...arguments),this.platforms=[],this.requests=[],this.users={},this.loading=!0,this.newPlatformName=c(""),this.newPlatformSymbol=c(""),this.newPlatformMinAmount=c(""),this.newPlatformMaxAmount=c(""),this.newPlatformFee=c(""),this.newPlatformIconUrl=c(""),this.newPlatformIconClass=c(""),this.submittingPlatform=!1}oninit(t){super.oninit(t),this.loadData()}content(){return this.loading?m(v,null):m("div",{className:"WithdrawalManagementPage"},m("div",{className:"container"},m("h2",null,a.translator.trans("withdrawal.admin.page.title")),this.renderPlatformManagement(),this.renderRequestManagement()))}renderPlatformManagement(){return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,a.translator.trans("withdrawal.admin.platforms.title")),m("div",{className:"WithdrawalManagementPage-addPlatform"},m("div",{className:"Form-group"},m("div",{className:"Form-row"},m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.name")),m("input",{type:"text",className:"FormControl",placeholder:a.translator.trans("withdrawal.admin.platforms.add_placeholder"),value:this.newPlatformName(),oninput:t=>this.newPlatformName(t.target.value)})),m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.symbol")),m("input",{type:"text",className:"FormControl",placeholder:"BTC, ETH, USDT...",value:this.newPlatformSymbol(),oninput:t=>this.newPlatformSymbol(t.target.value)}))),m("div",{className:"Form-row"},m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.min_amount")),m("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.001",value:this.newPlatformMinAmount(),oninput:t=>this.newPlatformMinAmount(t.target.value)})),m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.max_amount")),m("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"10.0",value:this.newPlatformMaxAmount(),oninput:t=>this.newPlatformMaxAmount(t.target.value)})),m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.fee")),m("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.0005",value:this.newPlatformFee(),oninput:t=>this.newPlatformFee(t.target.value)}))),m("div",{className:"Form-row"},m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.icon_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://example.com/icon.png",value:this.newPlatformIconUrl(),oninput:t=>this.newPlatformIconUrl(t.target.value)}),m("small",{className:"helpText"},a.translator.trans("withdrawal.admin.platforms.icon_url_help"))),m("div",{className:"Form-col"},m("label",null,a.translator.trans("withdrawal.admin.platforms.icon_class")),m("input",{type:"text",className:"FormControl",placeholder:"fas fa-coins",value:this.newPlatformIconClass(),oninput:t=>this.newPlatformIconClass(t.target.value)}),m("small",{className:"helpText"},a.translator.trans("withdrawal.admin.platforms.icon_class_help")))),m("div",{className:"Form-group"},m(l,{className:"Button Button--primary",loading:this.submittingPlatform,disabled:!this.canSubmitPlatform(),onclick:this.addPlatform.bind(this)},a.translator.trans("withdrawal.admin.platforms.add_button"))))),m("div",{className:"WithdrawalManagementPage-platformList"},this.platforms.length===0?m("p",null,a.translator.trans("withdrawal.admin.platforms.empty")):this.platforms.map(t=>this.renderPlatform(t))))}renderPlatform(t){const e=typeof t.id=="function"?t.id():t.id,s=(typeof t.name=="function"?t.name():t.attributes?.name)||"Unknown Platform",r=(typeof t.symbol=="function"?t.symbol():t.attributes?.symbol)||"N/A",i=(typeof t.minAmount=="function"?t.minAmount():t.attributes?.minAmount)||"N/A",u=(typeof t.maxAmount=="function"?t.maxAmount():t.attributes?.maxAmount)||"N/A",N=(typeof t.fee=="function"?t.fee():t.attributes?.fee)||"N/A",d=(typeof t.isActive=="function"?t.isActive():t.attributes?.isActive)??!1,f=(typeof t.createdAt=="function"?t.createdAt():t.attributes?.createdAt)||null;let w="N/A";if(f)try{w=g(f)}catch(b){console.error("Error formatting date:",b),w="Invalid Date"}return m("div",{key:e,className:"WithdrawalPlatform"},m("div",{className:"WithdrawalPlatform-info"},m("div",{className:"WithdrawalPlatform-primary"},m("span",{className:`WithdrawalPlatform-status ${d?"active":"inactive"}`},d?"ðŸŸ¢":"ðŸ”´"),m("span",{className:"WithdrawalPlatform-name"},s),m("span",{className:"platform-id"},"#",e),m("span",{className:`WithdrawalPlatform-symbol ${r}`},r)),m("div",{className:"WithdrawalPlatform-details"},m("span",{className:"WithdrawalPlatform-amounts"},"Min: ",i," | Max: ",u," | Fee: ",N),m("span",{className:"WithdrawalPlatform-date"},w))),m("div",{className:"WithdrawalPlatform-actions"},m(l,{className:`Button ${d?"Button--secondary":"Button--primary"}`,onclick:()=>this.togglePlatformStatus(t)},a.translator.trans(`withdrawal.admin.platforms.${d?"disable":"enable"}`)),m(l,{className:"Button Button--danger",onclick:()=>this.deletePlatform(t)},a.translator.trans("withdrawal.admin.platforms.delete"))))}canSubmitPlatform(){return!!(this.newPlatformName()&&this.newPlatformName().trim()&&this.newPlatformSymbol()&&this.newPlatformSymbol().trim()&&this.newPlatformMinAmount()&&this.newPlatformMaxAmount()&&parseFloat(this.newPlatformMinAmount())>0&&parseFloat(this.newPlatformMaxAmount())>0&&parseFloat(this.newPlatformMaxAmount())>=parseFloat(this.newPlatformMinAmount()))}renderRequestManagement(){const t=this.requests.filter(s=>((typeof s.status=="function"?s.status():s.attributes?.status)||"pending")==="pending"),e=this.requests.filter(s=>((typeof s.status=="function"?s.status():s.attributes?.status)||"pending")!=="pending");return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,a.translator.trans("withdrawal.admin.requests.title")),m("div",{className:"WithdrawalManagementPage-pendingRequests"},m("h4",null,a.translator.trans("withdrawal.admin.requests.pending_title")),t.length===0?m("p",null,a.translator.trans("withdrawal.admin.requests.no_pending")):t.map(s=>this.renderRequest(s,!0,!0))),m("div",{className:"WithdrawalManagementPage-processedRequests"},m("h4",null,a.translator.trans("withdrawal.admin.requests.processed_title")),e.length===0?m("p",null,a.translator.trans("withdrawal.admin.requests.no_processed")):e.map(s=>this.renderRequest(s,!1,!0))))}renderRequest(t,e,s=!1){const r=typeof t.id=="function"?t.id():t.id,i=typeof t.amount=="function"?t.amount():t.attributes?.amount||0,u=typeof t.status=="function"?t.status():t.attributes?.status||"pending",N=typeof t.accountDetails=="function"?t.accountDetails():t.attributes?.accountDetails||t.attributes?.account_details||"N/A",d=typeof t.createdAt=="function"?t.createdAt():t.attributes?.createdAt||null;let f="Unknown User";if(typeof t.user=="function"){const o=t.user();o&&typeof o.displayName=="function"?f=o.displayName():o&&o.attributes?.displayName&&(f=o.attributes.displayName)}let w="Unknown Platform",b="N/A";if(typeof t.platform=="function"){const o=t.platform();o&&(w=typeof o.name=="function"?o.name():o.attributes?.name||"Unknown Platform",b=typeof o.symbol=="function"?o.symbol():o.attributes?.symbol||"N/A")}const C=`status-${u}`;let P="N/A";if(d)try{P=g(d)}catch(o){console.error("Error formatting request date:",o),P="Invalid Date"}return m("div",{key:r,className:`WithdrawalRequest ${C}`},m("div",{className:"WithdrawalRequest-info"},m("div",{className:"WithdrawalRequest-user"},m("strong",null,f),m("span",{className:"request-id"},"#",r)),m("div",{className:"WithdrawalRequest-details"},m("span",{className:"amount"},i),m("span",{className:"platform"},w),m("span",{className:"symbol"},b),m("span",{className:"date"},P)),m("div",{className:"WithdrawalRequest-account"},m("strong",null,a.translator.trans("withdrawal.admin.requests.account_details"),":"),m("span",null,N)),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${u}`},a.translator.trans(`withdrawal.admin.requests.status.${u}`)))),(e||s)&&m("div",{className:"WithdrawalRequest-actions"},e&&m("[",null,m(l,{className:"Button Button--primary",onclick:()=>this.updateRequestStatus(t,"approved")},a.translator.trans("withdrawal.admin.requests.approve")),m(l,{className:"Button Button--danger",onclick:()=>this.updateRequestStatus(t,"rejected")},a.translator.trans("withdrawal.admin.requests.reject"))),m(l,{className:"Button Button--link",onclick:()=>this.deleteRequest(t)},m("i",{className:"fas fa-trash"}),a.translator.trans("withdrawal.admin.requests.delete"))))}async addPlatform(){if(!(!this.canSubmitPlatform()||this.submittingPlatform)){this.submittingPlatform=!0;try{const t=await a.request({method:"POST",url:a.forum.attribute("apiUrl")+"/withdrawal-platforms",body:{data:{type:"withdrawal-platforms",attributes:{name:this.newPlatformName(),symbol:this.newPlatformSymbol(),minAmount:parseFloat(this.newPlatformMinAmount()),maxAmount:parseFloat(this.newPlatformMaxAmount()),fee:parseFloat(this.newPlatformFee()||"0"),iconUrl:this.newPlatformIconUrl()||null,iconClass:this.newPlatformIconClass()||null,isActive:!0}}}});t&&t.data&&a.store.pushPayload(t),this.newPlatformName(""),this.newPlatformSymbol(""),this.newPlatformMinAmount(""),this.newPlatformMaxAmount(""),this.newPlatformFee(""),this.newPlatformIconUrl(""),this.newPlatformIconClass(""),await this.loadPlatforms(),a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.admin.platforms.add_success"))}catch(t){console.error("Error adding platform:",t),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.platforms.add_error"))}finally{this.submittingPlatform=!1,m.redraw()}}}async togglePlatformStatus(t){try{const e=typeof t.id=="function"?t.id():t.id,s=(typeof t.isActive=="function"?t.isActive():t.attributes?.isActive)??!1,r=a.store.getById("withdrawal-platforms",e);r&&(await r.save({isActive:!s}),await this.loadPlatforms(),a.alerts.show({type:"success",dismissible:!0},a.translator.trans(`withdrawal.admin.platforms.${s?"disable":"enable"}_success`)))}catch(e){console.error("Error toggling platform status:",e),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.platforms.toggle_error"))}}deletePlatform(t){const e=(typeof t.name=="function"?t.name():t.attributes?.name)||"Unknown Platform";a.modal.show(q,{platformName:e,onConfirm:async()=>{try{const s=typeof t.id=="function"?t.id():t.id,r=a.store.getById("withdrawal-platforms",s);r&&(await r.delete(),await this.loadPlatforms(),a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.admin.platforms.delete_success")))}catch(s){console.error("Error deleting platform:",s),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.platforms.delete_error"))}}})}async updateRequestStatus(t,e){try{const s=typeof t.id=="function"?t.id():t.id,r=a.store.getById("withdrawal-requests",s);r&&(await r.save({status:e}),await this.loadRequests(),a.alerts.show({type:"success",dismissible:!0},a.translator.trans(`withdrawal.admin.requests.${e}_success`)))}catch(s){console.error("Error updating request:",s),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.requests.update_error"))}}deleteRequest(t){const e=typeof t.id=="function"?t.id():t.id,s=typeof t.amount=="function"?t.amount():t.attributes?.amount||0;let r="Unknown User";if(typeof t.user=="function"){const i=t.user();i&&typeof i.displayName=="function"?r=i.displayName():i&&i.attributes?.displayName&&(r=i.attributes.displayName)}a.modal.show(R,{requestInfo:`${r} - ${s}`,onConfirm:async()=>{try{const i=a.store.getById("withdrawal-requests",e);i&&(await i.delete(),await this.loadRequests(),a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.admin.requests.delete_success")))}catch(i){console.error("Error deleting request:",i),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.admin.requests.delete_error"))}}})}async loadData(){try{await this.loadPlatforms(),await this.loadRequests()}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,m.redraw()}}async loadPlatforms(){try{const t=await a.store.find("withdrawal-platforms");this.platforms=Array.isArray(t)?t.filter(e=>e!==null):t?[t]:[],console.log("Loaded platforms:",this.platforms)}catch(t){console.error("Error loading platforms:",t),this.platforms=[]}}async loadRequests(){try{const s=await a.store.find("withdrawal-requests",{include:"user,platform"});this.requests=Array.isArray(s)?s.filter(r=>r!==null):s?[s]:[],console.log("Loaded requests:",this.requests)}catch(s){console.error("Error loading requests:",s),this.requests=[]}if(this.requests.length===0)return;const e=[...new Set(this.requests.map(s=>{const r=s?.data?.relationships?.user?.data||s?.relationships?.user?.data;return r?r.id:null}).filter(s=>s!=null))].filter(s=>!this.users[s]);if(e.length>0)try{const s=e.map(i=>a.store.find("users",i).catch(u=>(console.error(`Error loading user ${i}:`,u),null))),r=await Promise.all(s);e.forEach((i,u)=>{r[u]&&(this.users[i]=r[u])})}catch(s){console.error("Error loading users:",s)}}}class q extends p{constructor(t){super(t),this.platformName=t.attrs.platformName,this.onConfirm=t.attrs.onConfirm}className(){return"ConfirmDeleteModal Modal--small"}title(){return a.translator.trans("withdrawal.admin.platforms.delete_confirm_title")}content(){return m("div",{className:"Modal-body"},m("p",null,a.translator.trans("withdrawal.admin.platforms.delete_confirm_message",{name:this.platformName})),m("div",{className:"Form-group"},m(l,{className:"Button Button--primary",onclick:this.confirm.bind(this)},a.translator.trans("withdrawal.admin.platforms.delete_confirm_button")),m(l,{className:"Button",onclick:this.hide.bind(this)},a.translator.trans("withdrawal.admin.platforms.delete_cancel_button"))))}confirm(){this.onConfirm(),this.hide()}}class R extends p{constructor(t){super(t),this.requestInfo=t.attrs.requestInfo,this.onConfirm=t.attrs.onConfirm}className(){return"ConfirmDeleteRequestModal Modal--small"}title(){return a.translator.trans("withdrawal.admin.requests.delete_confirm_title")}content(){return m("div",{className:"Modal-body"},m("p",null,a.translator.trans("withdrawal.admin.requests.delete_confirm_message",{info:this.requestInfo})),m("div",{className:"Form-group"},m(l,{className:"Button Button--danger",onclick:this.confirm.bind(this)},a.translator.trans("withdrawal.admin.requests.delete_confirm_button")),m(l,{className:"Button",onclick:this.hide.bind(this)},a.translator.trans("withdrawal.admin.requests.delete_cancel_button"))))}confirm(){this.onConfirm(),this.hide()}}class D extends n{constructor(){super(...arguments),this.name=n.attribute("name"),this.symbol=n.attribute("symbol"),this.minAmount=n.attribute("minAmount"),this.maxAmount=n.attribute("maxAmount"),this.fee=n.attribute("fee"),this.iconUrl=n.attribute("iconUrl"),this.iconClass=n.attribute("iconClass"),this.isActive=n.attribute("isActive"),this.createdAt=n.attribute("createdAt",n.transformDate),this.updatedAt=n.attribute("updatedAt",n.transformDate)}apiEndpoint(){return`/withdrawal-platforms/${this.id()}`}displayName(){const t=this.symbol(),e=this.name();return t?`${e} (${t})`:e}isValidAmount(t){const e=this.minAmount(),s=this.maxAmount();return t>=e&&t<=s}getTotalCost(t){return t+this.fee()}}const h={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class I extends n{constructor(){super(...arguments),this.amount=n.attribute("amount"),this.accountDetails=n.attribute("accountDetails"),this.status=n.attribute("status"),this.platformId=n.attribute("platformId"),this.userId=n.attribute("userId"),this.createdAt=n.attribute("createdAt",n.transformDate),this.updatedAt=n.attribute("updatedAt",n.transformDate),this.user=n.hasOne("user"),this.platform=n.hasOne("platform")}apiEndpoint(){return`/withdrawal-requests/${this.id()}`}isPending(){return this.status()===h.PENDING}isApproved(){return this.status()===h.APPROVED}isRejected(){return this.status()===h.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const t=this.status();return app.translator.trans(`withdrawal.forum.status.${t}`)}statusColor(){switch(this.status()){case h.APPROVED:return"success";case h.REJECTED:return"danger";case h.PENDING:default:return"warning"}}}a.initializers.add("wusong8899-withdrawal",()=>{a.store.models["withdrawal-platforms"]=D,a.store.models["withdrawal-requests"]=I,a.extensionData.for("wusong8899-withdrawal").registerPage(_)})})(flarum.core.compat["admin/app"],flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/components/Modal"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=admin.js.map

module.exports={};