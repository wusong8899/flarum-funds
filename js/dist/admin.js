(function(h,r,a,Y,C,G,A,R,I,J,w,k,T,l){"use strict";const It="modulepreload",Rt=function(c){return"/"+c},Nt={},N=function(t,e,s){let n=Promise.resolve();function i(u){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=u,window.dispatchEvent(f),!f.defaultPrevented)throw u}return n.then(u=>{for(const f of u||[])f.status==="rejected"&&i(f.reason);return t().catch(i)})};class x extends G{className(){return"ConfirmModal"}title(){const{title:t,dangerous:e=!1,icon:s=e?"fas fa-exclamation-triangle":"fas fa-question-circle"}=this.attrs;return m("span",null,s&&m("span",{className:`ConfirmModal-icon ${e?"dangerous":""}`},R(s)),t)}content(){const{message:t,confirmText:e="Confirm",cancelText:s="Cancel",onConfirm:n,onCancel:i,dangerous:u=!1}=this.attrs;return m("div",{className:"Modal-body"},m("div",{className:"ConfirmModal-message"},t),m("div",{className:"Form-group"},m("div",{className:"ButtonGroup"},m(A,{className:"Button",onclick:()=>{i(),h.modal.close()}},s),m(A,{className:`Button Button--${u?"danger":"primary"}`,onclick:()=>{n(),h.modal.close()}},e))))}}class K extends Y{constructor(){super(),this.platforms=[],this.transactions=[],this.loading=!0,this.submittingPlatform=!1;const t=this.getConfig();this.activeTab=t.tabs[0]?.key||""}oninit(t){super.oninit(t),this.loadData()}content(){if(this.loading)return a(C,null);const t=this.getConfig();return a("div",{className:`${t.extensionId}ManagementPage`},a("div",{className:"container"},a("h2",null,t.pageTitle),t.settingsComponent&&a("div",{className:"SettingsSection"},a(t.settingsComponent,{onSettingChange:this.saveSetting.bind(this)})),t.tabs.length>1&&a("div",{className:"AdminTabs"},a("div",{className:"AdminTabs-nav"},t.tabs.map(e=>a("button",{key:e.key,className:`AdminTabs-tab ${this.activeTab===e.key?"active":""}`,onclick:()=>{this.activeTab=e.key}},e.label))),a("div",{className:"AdminTabs-content"},this.renderActiveTabContent())),t.tabs.length===1&&a("div",{className:"SingleTabContent"},this.renderActiveTabContent())))}renderActiveTabContent(){const t=this.getConfig(),e=t.tabs.find(n=>n.key===this.activeTab);if(!e)return null;const s={platforms:this.platforms,transactions:this.transactions,submittingPlatform:this.submittingPlatform,onAddPlatform:this.addPlatform.bind(this),onTogglePlatformStatus:this.togglePlatformStatus.bind(this),onDeletePlatform:this.deletePlatform.bind(this),...t.transactionOperations&&{onUpdateTransactionStatus:this.updateTransactionStatus.bind(this)},...e.props?e.props():{}};return a(e.component,s)}async addPlatform(t){if(this.submittingPlatform)return;this.submittingPlatform=!0;const e=this.getConfig();try{await e.platformOperations.create(t),await this.loadPlatforms()}catch(s){console.error("Error adding platform:",s)}finally{this.submittingPlatform=!1,a.redraw()}}async togglePlatformStatus(t){const e=this.getConfig();try{await e.platformOperations.toggleStatus(t),await this.loadPlatforms(),a.redraw()}catch(s){console.error("Error toggling platform status:",s)}}deletePlatform(t){const e=this.getConfig(),s=(typeof t.name=="function"?t.name():t.name)||"Unknown Platform";r.modal.show(x,{title:r.translator.trans(`${e.translations.platformPrefix}.delete_confirm_title`),message:r.translator.trans(`${e.translations.platformPrefix}.delete_confirm_message`,{name:s}),confirmText:r.translator.trans(`${e.translations.platformPrefix}.delete_confirm_button`),cancelText:r.translator.trans(`${e.translations.platformPrefix}.delete_cancel_button`),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{try{await e.platformOperations.delete(t),await this.loadPlatforms(),a.redraw(),r.alerts.show({type:"success",dismissible:!0},r.translator.trans(`${e.translations.platformPrefix}.delete_success`))}catch(n){console.error("Error deleting platform:",n),r.alerts.show({type:"error",dismissible:!0},r.translator.trans(`${e.translations.platformPrefix}.delete_error`))}},onCancel:()=>{r.modal.close()}})}async updateTransactionStatus(t,e){const s=this.getConfig();if(s.transactionOperations)try{await s.transactionOperations.updateStatus(t,e),await this.loadTransactions();const n=s.translations.transactionPrefix||s.translations.platformPrefix;r.alerts.show({type:"success",dismissible:!0},r.translator.trans(`${n}.${e}_success`))}catch(n){console.error("Error updating transaction:",n);const i=s.translations.transactionPrefix||s.translations.platformPrefix;r.alerts.show({type:"error",dismissible:!0},r.translator.trans(`${i}.update_error`))}}async loadData(){try{await this.loadPlatforms(),this.getConfig().transactionOperations&&await this.loadTransactions()}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,a.redraw()}}async loadPlatforms(){const t=this.getConfig();try{this.platforms=await t.platformOperations.load(),console.log("Loaded platforms:",this.platforms)}catch(e){console.error("Error loading platforms:",e),this.platforms=[]}}async loadTransactions(){const t=this.getConfig();if(t.transactionOperations)try{this.transactions=await t.transactionOperations.load(),console.log("Loaded transactions:",this.transactions)}catch(e){console.error("Error loading transactions:",e),this.transactions=[]}}async saveSetting(t,e){try{const{settingsService:s}=await N(async()=>{const{settingsService:n}=await Promise.resolve().then(()=>ct);return{settingsService:n}},void 0);await s.saveSetting(t,e)}catch(s){console.error("Error saving setting:",s),r.alerts.show({type:"error",dismissible:!0},s instanceof Error?s.message:"Failed to save setting")}}}class z extends I{view(){return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,"General Settings"),m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,r.translator.trans("withdrawal.admin.settings.money_icon_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://i.mji.rip/2025/08/28/cd18932c68e9bbee9502b1fb6317cba9.png",value:r.forum.attribute("wusong8899-withdrawal.moneyIconUrl")||"",oninput:J("value",t=>this.attrs.onSettingChange("wusong8899-withdrawal.moneyIconUrl",t))}),m("small",{className:"helpText"},r.translator.trans("withdrawal.admin.settings.money_icon_url_help")))))}}class q{constructor(){this.errors=[]}required(t,e,s){return(!t||typeof t=="string"&&t.trim()==="")&&this.errors.push({field:e,message:`${s||e} is required`}),this}minLength(t,e,s,n){return t&&t.length<e&&this.errors.push({field:s,message:`${n||s} must be at least ${e} characters`}),this}numberRange(t,e,s,n,i){const u=typeof t=="string"?parseFloat(t):t;return isNaN(u)?(this.errors.push({field:n||"number",message:`${i||"Value"} must be a valid number`}),this):(e!==void 0&&u<e&&this.errors.push({field:n||"number",message:`${i||"Value"} must be at least ${e}`}),s!==void 0&&u>s&&this.errors.push({field:n||"number",message:`${i||"Value"} must be at most ${s}`}),this)}url(t,e,s){if(t&&t.trim())try{const n=new URL(t)}catch{this.errors.push({field:e,message:`${s||e} must be a valid URL`})}return this}custom(t,e,s){return t||this.errors.push({field:e,message:s}),this}getResult(){return{isValid:this.errors.length===0,errors:this.errors,firstErrorMessage:this.errors.length>0?this.errors[0].message:void 0}}reset(){return this.errors=[],this}}class H extends I{constructor(){super(...arguments),this.name=w(""),this.symbol=w(""),this.network=w(""),this.minAmount=w(""),this.maxAmount=w(""),this.fee=w(""),this.currencyIconOverrideUrl=w(""),this.currencyIconOverrideClass=w(""),this.networkIconOverrideUrl=w(""),this.networkIconOverrideClass=w("")}view(){return a("div",{className:"WithdrawalManagementPage-addPlatform"},a("div",{className:"Form-group"},a("div",{className:"Form-row"},a("div",{className:"Form-col"},a("label",null,r.translator.trans("withdrawal.admin.platforms.name")),a("input",{type:"text",className:"FormControl",placeholder:r.translator.trans("withdrawal.admin.platforms.add_placeholder"),bidi:this.name})),a("div",{className:"Form-col"},a("label",null,r.translator.trans("withdrawal.admin.platforms.symbol")),a("input",{type:"text",className:"FormControl",placeholder:"BTC, ETH, USDT...",bidi:this.symbol})),a("div",{className:"Form-col"},a("label",null,r.translator.trans("withdrawal.admin.platforms.network")),a("input",{type:"text",className:"FormControl",placeholder:"TRC20, ERC20, BSC... (optional)",bidi:this.network}),a("small",{className:"helpText"},r.translator.trans("withdrawal.admin.platforms.network_help")))),a("div",{className:"Form-row"},a("div",{className:"Form-col"},a("label",null,r.translator.trans("withdrawal.admin.platforms.min_amount")),a("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.001",bidi:this.minAmount})),a("div",{className:"Form-col"},a("label",null,r.translator.trans("withdrawal.admin.platforms.max_amount")),a("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"10.0",bidi:this.maxAmount})),a("div",{className:"Form-col"},a("label",null,r.translator.trans("withdrawal.admin.platforms.fee")),a("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.0005",bidi:this.fee}))),a("div",{className:"Form-section"},a("h4",null,r.translator.trans("withdrawal.admin.platforms.icon_configuration")),a("p",{className:"helpText"},r.translator.trans("withdrawal.admin.platforms.icon_configuration_help")),a("div",{className:"Form-row"},a("div",{className:"Form-col"},a("label",null,r.translator.trans("withdrawal.admin.platforms.currency_icon_override_url")),a("input",{type:"url",className:"FormControl",placeholder:"https://example.com/currency-icon.png",bidi:this.currencyIconOverrideUrl}),a("small",{className:"helpText"},r.translator.trans("withdrawal.admin.platforms.currency_icon_override_url_help"))),a("div",{className:"Form-col"},a("label",null,r.translator.trans("withdrawal.admin.platforms.currency_icon_override_class")),a("input",{type:"text",className:"FormControl",placeholder:"fab fa-bitcoin",bidi:this.currencyIconOverrideClass}),a("small",{className:"helpText"},r.translator.trans("withdrawal.admin.platforms.currency_icon_override_class_help")))),a("div",{className:"Form-row"},a("div",{className:"Form-col"},a("label",null,r.translator.trans("withdrawal.admin.platforms.network_icon_override_url")),a("input",{type:"url",className:"FormControl",placeholder:"https://example.com/network-icon.png",bidi:this.networkIconOverrideUrl}),a("small",{className:"helpText"},r.translator.trans("withdrawal.admin.platforms.network_icon_override_url_help"))),a("div",{className:"Form-col"},a("label",null,r.translator.trans("withdrawal.admin.platforms.network_icon_override_class")),a("input",{type:"text",className:"FormControl",placeholder:"fas fa-network-wired",bidi:this.networkIconOverrideClass}),a("small",{className:"helpText"},r.translator.trans("withdrawal.admin.platforms.network_icon_override_class_help"))))),a("div",{className:"Form-group"},a(A,{className:"Button Button--primary",loading:this.attrs.submitting,disabled:this.attrs.submitting,onclick:this.handleSubmit.bind(this)},r.translator.trans("withdrawal.admin.platforms.add_button")))))}validateForm(){const t=new q;try{const e=r.translator.trans("withdrawal.admin.platforms.name").toString(),s=r.translator.trans("withdrawal.admin.platforms.symbol").toString(),n=r.translator.trans("withdrawal.admin.platforms.min_amount").toString(),i=r.translator.trans("withdrawal.admin.platforms.max_amount").toString(),u=r.translator.trans("withdrawal.admin.platforms.fee").toString();t.required(this.name(),"name",e).required(this.symbol(),"symbol",s).numberRange(this.minAmount(),0,void 0,"minAmount",n).numberRange(this.maxAmount(),0,void 0,"maxAmount",i).numberRange(this.fee(),0,void 0,"fee",u);const f=parseFloat(this.minAmount());if(parseFloat(this.maxAmount())<f){const v=r.translator.trans("withdrawal.admin.platforms.max_min_error").toString();t.custom(!1,"maxAmount",v)}if(this.currencyIconOverrideUrl()&&this.currencyIconOverrideUrl().trim()){const v=r.translator.trans("withdrawal.admin.platforms.currency_icon_override_url").toString();t.url(this.currencyIconOverrideUrl(),"currencyIconOverrideUrl",v)}if(this.networkIconOverrideUrl()&&this.networkIconOverrideUrl().trim()){const v=r.translator.trans("withdrawal.admin.platforms.network_icon_override_url").toString();t.url(this.networkIconOverrideUrl(),"networkIconOverrideUrl",v)}const y=t.getResult();return!y.isValid&&y.firstErrorMessage&&r.alerts.show({type:"error",dismissible:!0},y.firstErrorMessage),y.isValid}catch(e){return console.error("Form validation error:",e),r.alerts.show({type:"error",dismissible:!0},"Validation failed"),!1}}async handleSubmit(){if(this.attrs.submitting||!this.validateForm())return;const t={name:this.name(),symbol:this.symbol(),network:this.network(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),currencyIconOverrideUrl:this.currencyIconOverrideUrl(),currencyIconOverrideClass:this.currencyIconOverrideClass(),networkIconOverrideUrl:this.networkIconOverrideUrl(),networkIconOverrideClass:this.networkIconOverrideClass()};try{await this.attrs.onSubmit(t),this.clearForm()}catch{}}clearForm(){this.name(""),this.symbol(""),this.network(""),this.minAmount(""),this.maxAmount(""),this.fee(""),this.currencyIconOverrideUrl(""),this.currencyIconOverrideClass(""),this.networkIconOverrideUrl(""),this.networkIconOverrideClass(""),a.redraw()}}class L extends I{view(t){const{platform:e,type:s,onToggleStatus:n,onDelete:i,style:u="card"}=t.attrs;return u==="card"?this.renderCardStyle(e,s,n,i):this.renderListStyle(e,s,n,i)}renderCardStyle(t,e,s,n){const i=this.extractPlatformData(t),u=e==="withdrawal"?"withdrawal.admin.platforms":"withdrawal.admin.deposit.platforms";return a("div",{key:i.id,className:`${e}Platform`},a("div",{className:`${e}Platform-info`},a("div",{className:`${e}Platform-primary`},a("span",{className:`${e}Platform-status ${i.isActive?"active":"inactive"}`},i.isActive?"ðŸŸ¢":"ðŸ”´"),a("span",{className:`${e}Platform-name`},i.displayName),a("span",{className:"platform-id"},"#",i.id),i.network&&a("span",{className:`${e}Platform-network`},"(",i.network,")")),a("div",{className:`${e}Platform-details`},a("span",{className:`${e}Platform-amounts`},"Min: ",i.minAmount," | Max: ",i.maxAmount,` | Fee: ${i.fee}`,e==="deposit"&&` | Address: ${i.address?"Static":"Template"}`),i.createdDate&&a("span",{className:`${e}Platform-date`},i.dateDisplay))),a("div",{className:`${e}Platform-actions`},a(A,{className:`Button ${i.isActive?"Button--secondary":"Button--primary"}`,onclick:()=>s(t)},r.translator.trans(`${u}.${i.isActive?"disable":"enable"}`)),a(A,{className:"Button Button--danger",onclick:()=>n(t)},r.translator.trans(`${u}.delete`))))}renderListStyle(t,e,s,n){const i=this.extractPlatformData(t),u=e==="withdrawal"?"withdrawal.admin.platforms":"withdrawal.admin.deposit.platforms";return a("div",{className:`${e}PlatformListItem`},a("div",{className:`${e}PlatformListItem-content`},a("div",{className:`${e}PlatformListItem-icon`},this.renderPlatformIcon(t)),a("div",{className:`${e}PlatformListItem-info`},a("div",{className:`${e}PlatformListItem-primary`},a("strong",null,i.name),a("span",{className:`${e}PlatformListItem-displayName`},i.symbol,i.network&&` (${i.network})`)),a("div",{className:`${e}PlatformListItem-details`},a("span",{className:`${e}PlatformListItem-detail`},"Min: ",i.minAmount," ",i.symbol),i.maxAmount&&a("span",{className:`${e}PlatformListItem-detail`},"Max: ",i.maxAmount," ",i.symbol),i.fee&&a("span",{className:`${e}PlatformListItem-detail`},"Fee: ",i.fee," ",i.symbol),e==="deposit"&&a("span",{className:`${e}PlatformListItem-detail`},"Address: ",i.address?"Static":"Template"))),a("div",{className:`${e}PlatformListItem-actions`},a(k,{state:i.isActive,onchange:async()=>{await s(t),a.redraw()}},i.isActive?r.translator.trans(`${u}.active`):r.translator.trans(`${u}.inactive`)),a(A,{className:"Button Button--icon Button--flat",icon:"fas fa-trash",onclick:async()=>{await n(t),a.redraw()},title:r.translator.trans(`${u}.delete`)}))))}extractPlatformData(t){const e=typeof t.id=="function"?t.id():t.id,s=(typeof t.name=="function"?t.name():t.data?.attributes?.name)||"Unknown Platform",n=(typeof t.symbol=="function"?t.symbol():t.data?.attributes?.symbol)||"",i=(typeof t.network=="function"?t.network():t.data?.attributes?.network)||null,u=(typeof t.displayName=="function"?t.displayName():t.data?.attributes?.displayName)||s,f=(typeof t.minAmount=="function"?t.minAmount():t.data?.attributes?.minAmount)||"N/A",p=(typeof t.maxAmount=="function"?t.maxAmount():t.data?.attributes?.maxAmount)||"N/A",y=(typeof t.fee=="function"?t.fee():t.data?.attributes?.fee)||"N/A",v=(typeof t.address=="function"?t.address():t.data?.attributes?.address)||null,D=(typeof t.isActive=="function"?t.isActive():t.data?.attributes?.isActive)??!1,_=(typeof t.createdAt=="function"?t.createdAt():t.data?.attributes?.createdAt)||null;let E="N/A";if(_)try{E=T(_)}catch(g){console.error("Error formatting date:",g),E="Invalid Date"}return{id:e,name:s,symbol:n,network:i,displayName:u,minAmount:f,maxAmount:p,fee:y,address:v,isActive:D,createdDate:_,dateDisplay:E}}renderPlatformIcon(t){const e=typeof t.iconUrl=="function"?t.iconUrl():t.attributes?.iconUrl,s=typeof t.iconClass=="function"?t.iconClass():t.attributes?.iconClass,n=typeof t.symbol=="function"?t.symbol():t.attributes?.symbol;return e?a("img",{src:e,alt:n,className:"PlatformListItem-img"}):R(s||"fas fa-coins")}}class Q extends I{view(){const{platforms:t,submittingPlatform:e,onAddPlatform:s,onTogglePlatformStatus:n,onDeletePlatform:i}=this.attrs;return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,r.translator.trans("withdrawal.admin.platforms.title")),m(H,{onSubmit:s,submitting:e}),m("div",{className:"WithdrawalManagementPage-platformList"},t.length===0?m("p",null,r.translator.trans("withdrawal.admin.platforms.empty")):t.map(u=>m(L,{key:u.id?.()??u.id??Math.random(),platform:u,type:"withdrawal",style:"card",onToggleStatus:n,onDelete:i}))))}}class V extends I{view(){const t=this.attrs.request,{showActions:e,showDelete:s=!1}=this.attrs,n=typeof t.id=="function"?t.id():t.id,i=typeof t.amount=="function"?t.amount():t.attributes?.amount||0,u=typeof t.status=="function"?t.status():t.attributes?.status||"pending",f=typeof t.accountDetails=="function"?t.accountDetails():t.attributes?.accountDetails||t.attributes?.account_details||"N/A",p=typeof t.createdAt=="function"?t.createdAt():t.attributes?.createdAt||null;let y="Unknown User";if(typeof t.user=="function"){const g=t.user();g&&typeof g.displayName=="function"?y=g.displayName():g&&g.attributes?.displayName&&(y=g.attributes.displayName)}let v="Unknown Platform",D="N/A";if(typeof t.platform=="function"){const g=t.platform();g&&(v=typeof g.name=="function"?g.name():g.attributes?.name||"Unknown Platform",D=typeof g.symbol=="function"?g.symbol():g.attributes?.symbol||"N/A")}const _=`status-${u}`;let E="N/A";if(p)try{E=T(p)}catch(g){console.error("Error formatting request date:",g),E="Invalid Date"}return m("div",{key:n,className:`WithdrawalRequest ${_}`},m("div",{className:"WithdrawalRequest-info"},m("div",{className:"WithdrawalRequest-user"},m("strong",null,y),m("span",{className:"request-id"},"#",n)),m("div",{className:"WithdrawalRequest-details"},m("span",{className:"amount"},i),m("span",{className:"platform"},v),m("span",{className:"symbol"},D),m("span",{className:"date"},E)),m("div",{className:"WithdrawalRequest-account"},m("strong",null,r.translator.trans("withdrawal.admin.requests.account_details"),":"),m("span",null,f)),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${u}`},r.translator.trans(`withdrawal.admin.requests.status.${u}`)))),(e||s)&&m("div",{className:"WithdrawalRequest-actions"},e&&this.attrs.onUpdateStatus&&m("[",null,m(A,{className:"Button Button--primary",onclick:()=>this.attrs.onUpdateStatus(t,"approved")},r.translator.trans("withdrawal.admin.requests.approve")),m(A,{className:"Button Button--danger",onclick:()=>this.attrs.onUpdateStatus(t,"rejected")},r.translator.trans("withdrawal.admin.requests.reject"))),this.attrs.onDelete&&m(A,{className:"Button Button--link",onclick:()=>this.attrs.onDelete(t)},m("i",{className:"fas fa-trash"}),r.translator.trans("withdrawal.admin.requests.delete"))))}}class X extends I{view(){const{requests:t,onUpdateRequestStatus:e,onDeleteRequest:s}=this.attrs,n=t.filter(u=>((typeof u.status=="function"?u.status():u.attributes?.status)||"pending")==="pending"),i=t.filter(u=>((typeof u.status=="function"?u.status():u.attributes?.status)||"pending")!=="pending");return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,r.translator.trans("withdrawal.admin.requests.title")),m("div",{className:"WithdrawalManagementPage-pendingRequests"},m("h4",null,r.translator.trans("withdrawal.admin.requests.pending_title")),n.length===0?m("p",null,r.translator.trans("withdrawal.admin.requests.no_pending")):n.map(u=>m(V,{key:typeof u.id=="function"?u.id():u.id,request:u,showActions:!0,showDelete:!0,onUpdateStatus:e,onDelete:s}))),m("div",{className:"WithdrawalManagementPage-processedRequests"},m("h4",null,r.translator.trans("withdrawal.admin.requests.processed_title")),i.length===0?m("p",null,r.translator.trans("withdrawal.admin.requests.no_processed")):i.map(u=>m(V,{key:typeof u.id=="function"?u.id():u.id,request:u,showActions:!1,showDelete:!0,onDelete:s}))))}}class Z extends I{constructor(){super(...arguments),this.state={processingRecords:new Set}}view(t){const{records:e,platforms:s,loading:n}=t.attrs;return n?a("div",{className:"DepositRecordManagementSection"},a("div",{className:"ection-header"},a("h3",null,r.translator.trans("withdrawal.admin.deposit.records.title"))),a(C,null)):a("div",{className:"DepositRecordManagementSection"},a("div",{className:"DepositRecordManagementSection-header"},a("h3",null,r.translator.trans("withdrawal.admin.deposit.records.title")),a("div",{className:"DepositRecordManagementSection-stats"},a("span",{className:"DepositRecordManagementSection-count"},r.translator.trans("withdrawal.admin.deposit.records.total_count",{count:e.length})),a("span",{className:"DepositRecordManagementSection-pending"},r.translator.trans("withdrawal.admin.deposit.records.pending_count",{count:e.filter(i=>i.isPending()).length})))),a("div",{className:"DepositRecordManagementSection-content"},e.length===0?a("div",{className:"DepositRecordManagementSection-empty"},a("div",{className:"DepositRecordManagementSection-emptyIcon"},R("fas fa-receipt")),a("h4",null,r.translator.trans("withdrawal.admin.deposit.records.empty.title")),a("p",null,r.translator.trans("withdrawal.admin.deposit.records.empty.description"))):a("div",{className:"DepositRecordManagementSection-list"},e.map(i=>this.renderRecord(i,s,t.attrs)))))}renderRecord(t,e,s){const n=t.id(),i=this.state.processingRecords.has(n),u=this.findPlatform(e,t.platformId()),f=t.user?.(),p=t.status(),y=t.depositTime(),v=t.createdAt();return a("div",{key:`record-${n}`,className:`DepositRecordItem status-${p}`},a("div",{className:"DepositRecordItem-header"},a("div",{className:"DepositRecordItem-user"},a("span",{className:"DepositRecordItem-username"},f?.displayName?.()||"Unknown User"),a("span",{className:"DepositRecordItem-userId"},"ID: ",t.userId())),a("div",{className:"DepositRecordItem-amount"},a("span",{className:"DepositRecordItem-amountValue"},t.amount()," ",u?.symbol?.()||""),a("div",{className:`DepositRecordItem-status status-${this.getStatusColor(p)}`},this.renderStatusIcon(p),this.getStatusText(p)))),a("div",{className:"DepositRecordItem-details"},a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Platform:"),a("span",{className:"DepositRecordItem-value"},u?.name?.()||"Unknown Platform"," ",u?.network?.()?`(${u.network()})`:"")),a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Platform Account:"),a("span",{className:"DepositRecordItem-value"},t.platformAccount())),t.realName?.()&&a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Real Name:"),a("span",{className:"DepositRecordItem-value"},t.realName())),a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Deposit Time:"),a("span",{className:"DepositRecordItem-value"},y.toLocaleDateString()," ",y.toLocaleTimeString())),a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Submitted:"),a("span",{className:"DepositRecordItem-value"},T(v))),t.userMessage?.()&&a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Message:"),a("span",{className:"DepositRecordItem-value"},t.userMessage())),t.screenshotUrl?.()&&a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Screenshot:"),a("a",{href:t.screenshotUrl(),target:"_blank",rel:"noopener noreferrer",className:"DepositRecordItem-link"},"View Screenshot ",R("fas fa-external-link-alt"))),t.processedAt?.()&&a("div",{className:"DepositRecordItem-processed"},a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Processed:"),a("span",{className:"DepositRecordItem-value"},T(t.processedAt()))),t.creditedAmount?.()&&t.creditedAmount()!==t.amount()&&a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Credited Amount:"),a("span",{className:"DepositRecordItem-value"},t.creditedAmount()," ",u?.symbol?.()||"")),t.adminNotes?.()&&a("div",{className:"DepositRecordItem-row"},a("span",{className:"DepositRecordItem-label"},"Admin Notes:"),a("span",{className:"DepositRecordItem-value"},t.adminNotes())))),p==="pending"&&a("div",{className:"DepositRecordItem-actions"},a(A,{className:"Button Button--primary DepositRecordItem-approveButton",onclick:()=>this.handleApprove(t,s),loading:i,disabled:i},r.translator.trans("withdrawal.admin.deposit.records.approve")),a(A,{className:"Button Button--danger DepositRecordItem-rejectButton",onclick:()=>this.handleReject(t,s),loading:i,disabled:i},r.translator.trans("withdrawal.admin.deposit.records.reject"))),a("div",{className:"DepositRecordItem-adminActions"},a(A,{className:"Button Button--link DepositRecordItem-deleteButton",onclick:()=>this.handleDelete(t,s),disabled:i},R("fas fa-trash"),r.translator.trans("withdrawal.admin.deposit.records.delete"))))}findPlatform(t,e){return t.find(s=>{const n=typeof s.id=="function"?s.id():s.id;return parseInt(n)===e})||null}getStatusColor(t){switch(t){case"pending":return"warning";case"approved":return"success";case"rejected":return"danger";default:return"secondary"}}renderStatusIcon(t){switch(t){case"pending":return R("fas fa-clock");case"approved":return R("fas fa-check-circle");case"rejected":return R("fas fa-times-circle");default:return R("fas fa-question-circle")}}getStatusText(t){switch(t){case"pending":return r.translator.trans("withdrawal.admin.deposit.records.status.pending").toString();case"approved":return r.translator.trans("withdrawal.admin.deposit.records.status.approved").toString();case"rejected":return r.translator.trans("withdrawal.admin.deposit.records.status.rejected").toString();default:return"Unknown"}}async handleApprove(t,e){const s=t.id(),n=t.amount(),i=parseFloat(prompt(r.translator.trans("withdrawal.admin.deposit.records.approve_prompt",{amount:n}).toString(),n.toString())||n.toString()),u=prompt(r.translator.trans("withdrawal.admin.deposit.records.approve_notes_prompt").toString());if(isNaN(i)||i<=0){r.alerts.show({type:"error",dismissible:!0},r.translator.trans("withdrawal.admin.deposit.records.invalid_amount"));return}this.state.processingRecords.add(s),a.redraw();try{await e.onApproveRecord(t,i,u||void 0)}catch(f){console.error("Error approving deposit record:",f),r.alerts.show({type:"error",dismissible:!0},r.translator.trans("withdrawal.admin.deposit.records.approve_error"))}finally{this.state.processingRecords.delete(s),a.redraw()}}async handleReject(t,e){const s=prompt(r.translator.trans("withdrawal.admin.deposit.records.reject_reason_prompt").toString());if(!s||s.trim()===""){r.alerts.show({type:"error",dismissible:!0},r.translator.trans("withdrawal.admin.deposit.records.reject_reason_required"));return}const n=t.id();this.state.processingRecords.add(n),a.redraw();try{await e.onRejectRecord(t,s)}catch(i){console.error("Error rejecting deposit record:",i),r.alerts.show({type:"error",dismissible:!0},r.translator.trans("withdrawal.admin.deposit.records.reject_error"))}finally{this.state.processingRecords.delete(n),a.redraw()}}handleDelete(t,e){const s=t.user?.(),n=t.amount();r.modal.show(x,{title:r.translator.trans("withdrawal.admin.deposit.records.delete_confirm_title"),message:r.translator.trans("withdrawal.admin.deposit.records.delete_confirm_message",{user:s,amount:n}),confirmText:r.translator.trans("withdrawal.admin.deposit.records.delete_confirm_button"),cancelText:r.translator.trans("withdrawal.admin.deposit.records.delete_cancel_button"),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{const i=t.id();this.state.processingRecords.add(i);try{await e.onDeleteRecord(t)}catch(u){console.error("Error deleting deposit record:",u),r.alerts.show({type:"error",dismissible:!0},r.translator.trans("withdrawal.admin.deposit.records.delete_error"))}finally{this.state.processingRecords.delete(i),a.redraw()}},onCancel:()=>{r.modal.close()}})}}class $ extends I{constructor(){super(...arguments),this.formData={name:w(""),symbol:w(""),network:w(""),minAmount:w(""),maxAmount:w(""),fee:w(""),address:w(""),qrCodeImageUrl:w(""),iconUrl:w(""),iconClass:w(""),warningText:w(""),isActive:w(!0)}}oninit(t){super.oninit(t)}view(t){const{submitting:e,onCancel:s}=t.attrs;return m("div",{className:"AddDepositPlatformForm"},m("div",{className:"Form"},m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,r.translator.trans("withdrawal.admin.deposit.platforms.name"),m("span",{className:"Form-required"},"*")),m("input",{type:"text",className:"FormControl",placeholder:"e.g., Tether",bidi:this.formData.name,disabled:e})),m("div",{className:"Form-group"},m("label",null,r.translator.trans("withdrawal.admin.deposit.platforms.symbol"),m("span",{className:"Form-required"},"*")),m("input",{type:"text",className:"FormControl",placeholder:"e.g., USDT",bidi:this.formData.symbol,disabled:e}))),m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,r.translator.trans("withdrawal.admin.deposit.platforms.network")),m("input",{type:"text",className:"FormControl",placeholder:"e.g., TRC20, ERC20, BSC (optional)",bidi:this.formData.network,disabled:e}),m("div",{className:"helpText"},"Optional. Specify the blockchain network for this platform."))),m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,r.translator.trans("withdrawal.admin.deposit.platforms.min_amount")),m("input",{type:"number",step:"0.00000001",min:"0",className:"FormControl",placeholder:"0.0",bidi:this.formData.minAmount,disabled:e})),m("div",{className:"Form-group"},m("label",null,r.translator.trans("withdrawal.admin.deposit.platforms.max_amount")),m("input",{type:"number",step:"0.00000001",min:"0",className:"FormControl",placeholder:"Leave empty for unlimited",bidi:this.formData.maxAmount,disabled:e})),m("div",{className:"Form-group"},m("label",null,r.translator.trans("withdrawal.admin.deposit.platforms.fee")),m("input",{type:"number",step:"0.00000001",min:"0",className:"FormControl",placeholder:"0.0",bidi:this.formData.fee,disabled:e}),m("div",{className:"helpText"},r.translator.trans("withdrawal.admin.deposit.platforms.fee_help")))),m("div",{className:"Form-group"},m("label",null,r.translator.trans("withdrawal.admin.deposit.platforms.address"),m("span",{className:"Form-required"},"*")),m("input",{type:"text",className:"FormControl",placeholder:"Enter deposit address for this platform",bidi:this.formData.address,disabled:e}),m("div",{className:"helpText"},r.translator.trans("withdrawal.admin.deposit.platforms.address_help"))),m("div",{className:"Form-group"},m("label",null,r.translator.trans("withdrawal.admin.deposit.platforms.qr_code_image_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://example.com/qr-code.png",bidi:this.formData.qrCodeImageUrl,disabled:e}),m("div",{className:"helpText"},r.translator.trans("withdrawal.admin.deposit.platforms.qr_code_image_help"))),m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,r.translator.trans("withdrawal.admin.deposit.platforms.icon_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://example.com/usdt-trc20-icon.png",bidi:this.formData.iconUrl,disabled:e}),m("div",{className:"helpText"},r.translator.trans("withdrawal.admin.deposit.platforms.icon_url_help"))),m("div",{className:"Form-group"},m("label",null,r.translator.trans("withdrawal.admin.deposit.platforms.icon_class")),m("input",{type:"text",className:"FormControl",placeholder:"fas fa-coins",bidi:this.formData.iconClass,disabled:e}),m("div",{className:"helpText"},r.translator.trans("withdrawal.admin.deposit.platforms.icon_class_help")))),m("div",{className:"Form-group"},m("label",null,r.translator.trans("withdrawal.admin.deposit.platforms.warning_text")),m("textarea",{className:"FormControl",rows:3,placeholder:"Network-specific warning for users",bidi:this.formData.warningText,disabled:e})),m("div",{className:"Form-group"},m(k,{state:this.formData.isActive(),onchange:this.formData.isActive,disabled:e},r.translator.trans("withdrawal.admin.deposit.platforms.is_active"))),m("div",{className:"Form-actions"},m(A,{className:"Button Button--primary",type:"submit",loading:e,onclick:this.handleSubmit.bind(this,t.attrs)},r.translator.trans("withdrawal.admin.deposit.platforms.add_button")),m(A,{className:"Button",onclick:s,disabled:e},r.translator.trans("core.admin.basics.cancel_button")))))}validateForm(){const t=new q;try{const e=r.translator.trans("withdrawal.admin.deposit.platforms.name").toString(),s=r.translator.trans("withdrawal.admin.deposit.platforms.symbol").toString(),n=r.translator.trans("withdrawal.admin.deposit.platforms.address").toString();if(t.required(this.formData.name(),"name",e).required(this.formData.symbol(),"symbol",s).required(this.formData.address(),"address",n),this.formData.minAmount()&&this.formData.minAmount().trim()){const u=r.translator.trans("withdrawal.admin.deposit.platforms.min_amount").toString();t.numberRange(this.formData.minAmount(),0,void 0,"minAmount",u)}if(this.formData.maxAmount()&&this.formData.maxAmount().trim()){const u=r.translator.trans("withdrawal.admin.deposit.platforms.max_amount").toString();t.numberRange(this.formData.maxAmount(),0,void 0,"maxAmount",u)}if(this.formData.fee()&&this.formData.fee().trim()){const u=r.translator.trans("withdrawal.admin.deposit.platforms.fee").toString();t.numberRange(this.formData.fee(),0,void 0,"fee",u)}if(this.formData.minAmount()&&this.formData.maxAmount()){const u=parseFloat(this.formData.minAmount()),f=parseFloat(this.formData.maxAmount());if(!isNaN(u)&&!isNaN(f)&&f<u){const p=r.translator.trans("withdrawal.admin.platforms.max_min_error").toString();t.custom(!1,"maxAmount",p)}}if(this.formData.iconUrl()&&this.formData.iconUrl().trim()){const u=r.translator.trans("withdrawal.admin.deposit.platforms.icon_url").toString();t.url(this.formData.iconUrl(),"iconUrl",u)}if(this.formData.qrCodeImageUrl()&&this.formData.qrCodeImageUrl().trim()){const u=r.translator.trans("withdrawal.admin.deposit.platforms.qr_code_image_url").toString();t.url(this.formData.qrCodeImageUrl(),"qrCodeImageUrl",u)}const i=t.getResult();return!i.isValid&&i.firstErrorMessage&&r.alerts.show({type:"error",dismissible:!0},i.firstErrorMessage),i.isValid}catch(e){return console.error("Form validation error:",e),r.alerts.show({type:"error",dismissible:!0},"Validation failed"),!1}}async handleSubmit(t,e){if(e.preventDefault(),!this.validateForm())return;const s={name:this.formData.name(),symbol:this.formData.symbol(),network:this.formData.network(),minAmount:this.formData.minAmount(),maxAmount:this.formData.maxAmount(),fee:this.formData.fee(),address:this.formData.address(),qrCodeImageUrl:this.formData.qrCodeImageUrl(),iconUrl:this.formData.iconUrl(),iconClass:this.formData.iconClass(),warningText:this.formData.warningText(),isActive:this.formData.isActive()};await t.onSubmit(s)}}class tt extends I{constructor(){super(...arguments),this.showAddForm=!1}view(t){const{platforms:e,submittingPlatform:s,onAddPlatform:n,onTogglePlatformStatus:i,onDeletePlatform:u}=t.attrs;return a("div",{className:"DepositPlatformManagementSection"},a("div",{className:"Section-header"},a("h3",null,r.translator.trans("withdrawal.admin.deposit.platforms.title")),a("div",{className:"Section-headerControls"},a(A,{className:"Button Button--primary",icon:"fas fa-plus",onclick:()=>{this.showAddForm=!this.showAddForm,a.redraw()}},r.translator.trans("withdrawal.admin.deposit.platforms.add_button")))),this.showAddForm&&a("div",{className:"Section-content"},a($,{onSubmit:async f=>{await n(f),this.showAddForm=!1,a.redraw()},onCancel:()=>{this.showAddForm=!1,a.redraw()},submitting:s})),a("div",{className:"Section-content"},e.length===0?a("div",{className:"helpText"},r.translator.trans("withdrawal.admin.deposit.platforms.empty")):a("div",{className:"PlatformList"},e.map(f=>a(L,{key:typeof f.id=="function"?f.id():f.id,platform:f,type:"deposit",onToggleStatus:()=>i(f),onDelete:()=>u(f)})))))}}const et=()=>({async create(c){try{const{platformService:t}=await N(async()=>{const{platformService:n}=await Promise.resolve().then(()=>U);return{platformService:n}},void 0),e={name:c.name,symbol:c.symbol,network:c.network||null,minAmount:parseFloat(c.minAmount),maxAmount:parseFloat(c.maxAmount),fee:parseFloat(c.fee||"0"),iconUrl:c.iconUrl||null,iconClass:c.iconClass||null,isActive:!0},s=await t.create("withdrawal",e);return r.alerts.show({type:"success",dismissible:!0},r.translator.trans("withdrawal.admin.platforms.add_success").toString()),s}catch(t){throw r.alerts.show({type:"error",dismissible:!0},t instanceof Error?t.message:r.translator.trans("withdrawal.admin.platforms.add_error").toString()),t}},async toggleStatus(c){try{const{platformService:t}=await N(async()=>{const{platformService:n}=await Promise.resolve().then(()=>U);return{platformService:n}},void 0),e=await t.toggleStatus(c),s=e.isActive();return r.alerts.show({type:"success",dismissible:!0},r.translator.trans(`withdrawal.admin.platforms.${s?"enable":"disable"}_success`)),e}catch(t){throw r.alerts.show({type:"error",dismissible:!0},t instanceof Error?t.message:"Failed to toggle platform status"),t}},async delete(c){try{const{platformService:t}=await N(async()=>{const{platformService:e}=await Promise.resolve().then(()=>U);return{platformService:e}},void 0);await t.delete(c),r.alerts.show({type:"success",dismissible:!0},r.translator.trans("withdrawal.admin.platforms.delete_success").toString())}catch(t){throw r.alerts.show({type:"error",dismissible:!0},t instanceof Error?t.message:"Failed to delete platform"),t}},async load(){try{const{platformService:c}=await N(async()=>{const{platformService:t}=await Promise.resolve().then(()=>U);return{platformService:t}},void 0);return await c.find("withdrawal")}catch(c){throw r.alerts.show({type:"error",dismissible:!0},r.translator.trans("withdrawal.admin.platforms.load_error").toString()),c}}}),st=()=>({async updateStatus(c,t){try{const{withdrawalService:e}=await N(async()=>{const{withdrawalService:n}=await Promise.resolve().then(()=>j);return{withdrawalService:n}},void 0),s=await e.update(c,{status:t});return r.alerts.show({type:"success",dismissible:!0},r.translator.trans(`withdrawal.admin.requests.${t}_success`).toString()),s}catch(e){throw r.alerts.show({type:"error",dismissible:!0},e instanceof Error?e.message:`Failed to update request status to ${t}`),e}},async load(){try{const{withdrawalService:c}=await N(async()=>{const{withdrawalService:t}=await Promise.resolve().then(()=>j);return{withdrawalService:t}},void 0);return await c.find({include:"user,platform"})}catch(c){throw r.alerts.show({type:"error",dismissible:!0},r.translator.trans("withdrawal.admin.requests.load_error").toString()),c}}});var d=(c=>(c.NETWORK_ERROR="network_error",c.PERMISSION_DENIED="permission_denied",c.VALIDATION_ERROR="validation_error",c.NOT_FOUND="not_found",c.SERVER_ERROR="server_error",c.TIMEOUT="timeout",c))(d||{});class o extends Error{constructor(t,e="server_error",s,n){super(t),this.name="ServiceError",this.type=e,this.code=s,this.details=n}}class rt{constructor(){this.modelType="withdrawal-requests",this.platformModelType="withdrawal-platforms"}async find(t={}){try{const e={include:t.include||"user,platform",sort:t.sort||"-created_at",...t};t.page&&(e.page=t.page),t.filter&&(e.filter=t.filter);const s=await h.store.find(this.modelType,e);return Array.isArray(s)?s:[s]}catch(e){throw this.handleError(e,"Failed to fetch withdrawal requests")}}async findById(t,e={}){try{const s={include:e.include||"user,platform"};return await h.store.find(this.modelType,t,s)}catch(s){if(this.isNotFoundError(s))return null;throw this.handleError(s,`Failed to fetch withdrawal request ${t}`)}}async create(t){try{return this.validateCreateAttributes(t),await h.store.createRecord(this.modelType).save(t)}catch(e){throw this.handleError(e,"Failed to create withdrawal request")}}async update(t,e){try{if(!this.canModify(t))throw new o("You do not have permission to modify this withdrawal request",d.PERMISSION_DENIED);return await t.save(e)}catch(s){throw this.handleError(s,"Failed to update withdrawal request")}}async delete(t){try{if(!this.canDelete(t))throw new o("You do not have permission to delete this withdrawal request",d.PERMISSION_DENIED);await t.delete()}catch(e){throw this.handleError(e,"Failed to delete withdrawal request")}}async submitRequest(t){try{await this.validateWithdrawalRequest(t);const e={platformId:t.platformId,amount:t.amount,accountDetails:t.accountDetails,message:t.message||"",status:"pending"};return await this.create(e)}catch(e){throw this.handleError(e,"Failed to submit withdrawal request")}}async getUserHistory(t,e={}){const s=t||h.session.user?.id();if(!s)throw new o("User not authenticated",d.PERMISSION_DENIED);const n={...e,filter:{user:s,...e.filter},include:e.include||"platform",sort:e.sort||"-created_at"};return await this.find(n)}async getPendingRequests(t={}){if(!h.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);const e={...t,filter:{status:"pending",...t.filter},include:t.include||"user,platform",sort:t.sort||"created_at"};return await this.find(e)}async approve(t,e){if(!h.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);if(!t.isPending())throw new o("Only pending requests can be approved",d.VALIDATION_ERROR);const s={status:"approved"};return e&&(s.adminNote=e),await this.update(t,s)}async reject(t,e){if(!h.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);if(!t.isPending())throw new o("Only pending requests can be rejected",d.VALIDATION_ERROR);const s={status:"rejected"};return e&&(s.adminNote=e),await this.update(t,s)}async cancel(t){if(!t.canBeModified())throw new o("This request cannot be cancelled",d.VALIDATION_ERROR);const e=h.session.user;if(!e||t.userId()!==e.id()&&!e.isAdmin())throw new o("You can only cancel your own requests",d.PERMISSION_DENIED);return await this.delete(t)}canModify(t){const e=h.session.user;return e?e.isAdmin()?!0:t.userId()===e.id()&&t.canBeModified():!1}canCreate(){const t=h.session.user;return t&&!t.isGuest()}canDelete(t){const e=h.session.user;return e?e.isAdmin()?!0:t.userId()===e.id()&&t.canBeModified():!1}async getPlatforms(){try{const t=await h.store.find(this.platformModelType,{filter:{isActive:!0},sort:"name"});return Array.isArray(t)?t:[t]}catch(t){throw this.handleError(t,"Failed to fetch withdrawal platforms")}}async validateWithdrawalRequest(t){const{platformId:e,amount:s}=t,n=await h.store.find(this.platformModelType,e);if(!n)throw new o("Invalid platform selected",d.VALIDATION_ERROR);if(!n.isActive())throw new o("Selected platform is not available",d.VALIDATION_ERROR);const i=n.minAmount(),u=n.maxAmount();if(s<i)throw new o(`Minimum withdrawal amount is ${i}`,d.VALIDATION_ERROR);if(u&&s>u)throw new o(`Maximum withdrawal amount is ${u}`,d.VALIDATION_ERROR);const f=h.session.user;if(f){const p=parseFloat(f.attribute("money")||"0"),y=n.fee?n.fee():0,v=s+y;if(p<v)throw new o(`Insufficient balance. Required: ${v}, Available: ${p}`,d.VALIDATION_ERROR)}}validateCreateAttributes(t){const e=["platformId","amount","accountDetails"];for(const s of e)if(!t[s])throw new o(`${s} is required`,d.VALIDATION_ERROR);if(typeof t.amount!="number"||t.amount<=0)throw new o("Amount must be a positive number",d.VALIDATION_ERROR)}handleError(t,e){if(t instanceof o)return t;if(t.response&&t.response.errors){const s=t.response.errors[0];return new o(s.detail||e,d.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new o("Network error occurred",d.NETWORK_ERROR):new o(t.message||e,d.SERVER_ERROR)}isNotFoundError(t){return t.status===404||t.response?.status===404||t.message?.includes("not found")}}const at=new rt,j=Object.freeze(Object.defineProperty({__proto__:null,withdrawalService:at},Symbol.toStringTag,{value:"Module"}));class nt{constructor(){this.recordModelType="deposit-records",this.platformModelType="deposit-platforms",this.addressModelType="deposit-addresses"}async find(t={}){try{const e={include:t.include||"user,platform",sort:t.sort||"-created_at",...t};t.page&&(e.page=t.page),t.filter&&(e.filter=t.filter);const s=await h.store.find(this.recordModelType,e);return Array.isArray(s)?s:[s]}catch(e){throw this.handleError(e,"Failed to fetch deposit records")}}async findById(t,e={}){try{const s={include:e.include||"user,platform"};return await h.store.find(this.recordModelType,String(t),s)}catch(s){if(this.isNotFoundError(s))return null;throw this.handleError(s,`Failed to fetch deposit record ${t}`)}}async create(t){try{return this.validateCreateAttributes(t),await h.store.createRecord(this.recordModelType).save(t)}catch(e){throw this.handleError(e,"Failed to create deposit record")}}async update(t,e){try{if(!this.canModify(t))throw new o("You do not have permission to modify this deposit record",d.PERMISSION_DENIED);return await t.save(e)}catch(s){throw this.handleError(s,"Failed to update deposit record")}}async delete(t){try{if(!this.canDelete(t))throw new o("You do not have permission to delete this deposit record",d.PERMISSION_DENIED);await t.delete()}catch(e){throw this.handleError(e,"Failed to delete deposit record")}}async generateAddress(t){try{const{addressService:e}=await N(async()=>{const{addressService:s}=await Promise.resolve().then(()=>ut);return{addressService:s}},void 0);return await e.generateAddress(t)}catch(e){throw this.handleError(e,"Failed to generate deposit address")}}async getUserHistory(t,e={}){const s=t||h.session.user?.id();if(!s)throw new o("User not authenticated",d.PERMISSION_DENIED);const n={...e,filter:{user:s,...e.filter},include:e.include||"platform",sort:e.sort||"-created_at"};return await this.find(n)}async createRecord(t){try{await this.validateDepositRecord(t);const e={platformId:t.platformId,amount:t.amount,note:t.note||"",status:"pending"};return await this.create(e)}catch(e){throw this.handleError(e,"Failed to create deposit record")}}async getPendingDeposits(t={}){if(!h.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);const e={...t,filter:{status:"pending",...t.filter},include:t.include||"user,platform",sort:t.sort||"created_at"};return await this.find(e)}async confirm(t,e){if(!h.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);const s={status:"confirmed"};return e&&e!==t.amount()&&(s.confirmedAmount=e),await this.update(t,s)}async reject(t,e){if(!h.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);const s={status:"rejected"};return e&&(s.adminNote=e),await this.update(t,s)}canModify(t){const e=h.session.user;return e?e.isAdmin()?!0:String(t.userId())===String(e.id())&&t.status()==="pending":!1}canCreate(){const t=h.session.user;return t?!t.isGuest():!1}canDelete(t){const e=h.session.user;return e?e.isAdmin()?!0:String(t.userId())===String(e.id())&&t.status()==="pending":!1}async getPlatforms(){try{const t=await h.store.find(this.platformModelType,{sort:"name"});return Array.isArray(t)?t:[t]}catch(t){throw this.handleError(t,"Failed to fetch deposit platforms")}}async getPlatformsBySymbol(){const t=await this.getPlatforms(),e={};for(const s of t){const n=s.symbol();e[n]||(e[n]=[]),e[n].push(s)}return e}async validateDepositRecord(t){const{platformId:e,amount:s}=t,n=await h.store.find(this.platformModelType,e);if(!n)throw new o("Invalid platform selected",d.VALIDATION_ERROR);if(!n.isActive())throw new o("Selected platform is not available",d.VALIDATION_ERROR);const i=n.minAmount();if(s<i)throw new o(`Minimum deposit amount is ${i}`,d.VALIDATION_ERROR)}validateCreateAttributes(t){const e=["platformId","amount"];for(const s of e)if(!t[s])throw new o(`${s} is required`,d.VALIDATION_ERROR);if(typeof t.amount!="number"||t.amount<=0)throw new o("Amount must be a positive number",d.VALIDATION_ERROR)}handleError(t,e){if(t instanceof o)return t;if(t.response&&t.response.errors){const s=t.response.errors[0];return new o(s.detail||e,d.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new o("Network error occurred",d.NETWORK_ERROR):new o(t.message||e,d.SERVER_ERROR)}isNotFoundError(t){return t.status===404||t.response?.status===404||t.message?.includes("not found")}}const P=new nt;class it{constructor(){this.withdrawalModelType="withdrawal-platforms",this.depositModelType="deposit-platforms"}async find(t,e={}){const s=t==="withdrawal"?this.withdrawalModelType:this.depositModelType;try{const n={sort:e.sort||"name",...e};e.page&&(n.page=e.page),e.filter&&(n.filter=e.filter),e.include&&(n.include=e.include);const i=await h.store.find(s,n);return Array.isArray(i)?i:[i]}catch(n){throw this.handleError(n,`Failed to fetch ${t} platforms`)}}async findById(t,e,s={}){const n=t==="withdrawal"?this.withdrawalModelType:this.depositModelType;try{const i={};return s.include&&(i.include=s.include),await h.store.find(n,e,i)}catch(i){if(this.isNotFoundError(i))return null;throw this.handleError(i,`Failed to fetch ${t} platform ${e}`)}}async create(t,e){const s=t==="withdrawal"?this.withdrawalModelType:this.depositModelType;try{return this.validateCreateAttributes(t,e),await h.store.createRecord(s).save(e)}catch(n){throw this.handleError(n,`Failed to create ${t} platform`)}}async update(t,e){try{if(!this.canModify(t))throw new o("You do not have permission to modify this platform",d.PERMISSION_DENIED);return await t.save(e)}catch(s){throw this.handleError(s,"Failed to update platform")}}async delete(t){try{if(!this.canDelete(t))throw new o("You do not have permission to delete this platform",d.PERMISSION_DENIED);await t.delete()}catch(e){throw this.handleError(e,"Failed to delete platform")}}async getActive(t,e={}){const s={...e,filter:{isActive:!0,...e.filter}};return await this.find(t,s)}async toggleStatus(t){if(!h.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);const e=t.isActive();return await this.update(t,{isActive:!e})}async updateConfig(t,e){if(!h.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);return await this.update(t,e)}async getBySymbol(t,e){return await this.find(e,{filter:{symbol:t},sort:"name"})}validateAmount(t,e){const s=[];if(typeof e!="number"||e<=0)return s.push("Amount must be a positive number"),{valid:!1,errors:s};const n=t.minAmount?t.minAmount():0,i=t.maxAmount?t.maxAmount():null;return e<n&&s.push(`Amount must be at least ${n}`),i&&e>i&&s.push(`Amount cannot exceed ${i}`),{valid:s.length===0,errors:s}}async getPlatformStats(t,e){if(!h.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);const s=t==="withdrawal"?"withdrawal-requests":"deposit-records";try{const n=await h.store.find(s,{filter:{platform:e},include:"platform"}),i=Array.isArray(n)?n:[n];return{total:i.length,pending:i.filter(f=>f.status()==="pending").length,approved:i.filter(f=>f.status()==="approved"||f.status()==="confirmed").length,rejected:i.filter(f=>f.status()==="rejected").length,totalAmount:i.reduce((f,p)=>f+(p.amount()||0),0)}}catch(n){throw this.handleError(n,"Failed to fetch platform statistics")}}async getPlatformsBySymbolGrouped(t){const e=await this.getActive(t),s={};for(const n of e){const i=n.symbol();s[i]||(s[i]=[]),s[i].push(n)}return s}async getSortedPlatforms(t,e="name",s="asc"){const n=s==="desc"?`-${e}`:e;return await this.getActive(t,{sort:n})}canModify(t){const e=h.session.user;return e&&e.isAdmin()}canCreate(){const t=h.session.user;return t&&t.isAdmin()}canDelete(t){const e=h.session.user;return e&&e.isAdmin()}validateCreateAttributes(t,e){const n=["name","symbol","minAmount"];for(const i of n)if(!e[i])throw new o(`${i} is required for ${t} platforms`,d.VALIDATION_ERROR);if(typeof e.minAmount!="number"||e.minAmount<0)throw new o("minAmount must be a non-negative number",d.VALIDATION_ERROR);if(e.maxAmount!==void 0&&(typeof e.maxAmount!="number"||e.maxAmount<e.minAmount))throw new o("maxAmount must be a number greater than or equal to minAmount",d.VALIDATION_ERROR);if(e.fee!==void 0&&(typeof e.fee!="number"||e.fee<0))throw new o("fee must be a non-negative number",d.VALIDATION_ERROR);if(typeof e.symbol!="string"||!e.symbol.trim())throw new o("Symbol is required",d.VALIDATION_ERROR)}handleError(t,e){if(t instanceof o)return t;if(t.response&&t.response.errors){const s=t.response.errors[0];return new o(s.detail||e,d.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new o("Network error occurred",d.NETWORK_ERROR):new o(t.message||e,d.SERVER_ERROR)}isNotFoundError(t){return t.status===404||t.response?.status===404||t.message?.includes("not found")}}const O=new it,U=Object.freeze(Object.defineProperty({__proto__:null,platformService:O},Symbol.toStringTag,{value:"Module"}));class ot{constructor(){this.settingsEndpoint="/settings"}async getSetting(t,e){try{if(h.forum){const s=h.forum.attribute(t);if(s!=null)return s}return e}catch(s){throw this.handleError(s,`Failed to get setting: ${t}`)}}async saveSetting(t,e){try{if(!t||typeof t!="string")throw new o("Setting key must be a non-empty string",d.VALIDATION_ERROR);const s=this.prepareValueForStorage(e);await h.store.createRecord("settings").save({[t]:s}),h.forum&&h.forum.pushAttributes({[t]:e})}catch(s){throw this.handleError(s,`Failed to save setting: ${t}`)}}async saveSettings(t){try{if(!t||typeof t!="object")throw new o("Settings must be an object",d.VALIDATION_ERROR);const e={},s={};for(const[i,u]of Object.entries(t)){if(!i||typeof i!="string")throw new o(`Setting key '${i}' must be a non-empty string`,d.VALIDATION_ERROR);e[i]=this.prepareValueForStorage(u),s[i]=u}await h.store.createRecord("settings").save(e),h.forum&&h.forum.pushAttributes(s)}catch(e){throw this.handleError(e,"Failed to save multiple settings")}}async deleteSetting(t){try{if(!t||typeof t!="string")throw new o("Setting key must be a non-empty string",d.VALIDATION_ERROR);await this.saveSetting(t,null)}catch(e){throw this.handleError(e,`Failed to delete setting: ${t}`)}}async getSettingsWithPrefix(t){try{if(!t||typeof t!="string")throw new o("Prefix must be a non-empty string",d.VALIDATION_ERROR);const e={};if(h.forum){const s=h.forum.data.attributes;for(const[n,i]of Object.entries(s))n.startsWith(t)&&(e[n]=i)}return e}catch(e){throw this.handleError(e,`Failed to get settings with prefix: ${t}`)}}canManageSettings(){const t=h.session.user;return t&&t.isAdmin()}async getExtensionSetting(t,e,s){const n=`${t}.${e}`;return await this.getSetting(n,s)}async saveExtensionSetting(t,e,s){const n=`${t}.${e}`;return await this.saveSetting(n,s)}async getWithdrawalSetting(t,e){return await this.getExtensionSetting("wusong8899-withdrawal",t,e)}async saveWithdrawalSetting(t,e){return await this.saveExtensionSetting("wusong8899-withdrawal",t,e)}async getAllWithdrawalSettings(){return await this.getSettingsWithPrefix("wusong8899-withdrawal.")}prepareValueForStorage(t){return t==null?"":typeof t=="string"?t:typeof t=="boolean"?t?"1":"0":typeof t=="number"?String(t):JSON.stringify(t)}handleError(t,e){if(t instanceof o)return t;if(t.status===403||t.response?.status===403)return new o("Admin permissions required to manage settings",d.PERMISSION_DENIED);if(t.response&&t.response.errors){const s=t.response.errors[0];return new o(s.detail||e,d.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new o("Network error occurred while managing settings",d.NETWORK_ERROR):new o(t.message||e,d.SERVER_ERROR)}}const lt=new ot,ct=Object.freeze(Object.defineProperty({__proto__:null,settingsService:lt},Symbol.toStringTag,{value:"Module"}));class dt{async generateAddress(t,e){try{if(!h.session.user)throw new o("User not authenticated",d.PERMISSION_DENIED);const n=await h.store.find("deposit-platforms",t);if(!n)throw new o("Invalid platform selected",d.VALIDATION_ERROR);if(!n.isActive())throw new o("Platform is not currently active",d.VALIDATION_ERROR);if(!n.address())throw new o("Platform does not have a configured deposit address",d.VALIDATION_ERROR);return n.address()}catch(s){throw this.handleError(s,"Failed to get deposit address")}}canGenerateAddress(){const t=h.session.user;return t&&!t.isGuest()}handleError(t,e){if(t instanceof o)return t;if(t.response&&t.response.errors){const s=t.response.errors[0];return new o(s.detail||e,d.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new o("Network error occurred",d.NETWORK_ERROR):new o(t.message||e,d.SERVER_ERROR)}}const mt=new dt,ut=Object.freeze(Object.defineProperty({__proto__:null,addressService:mt},Symbol.toStringTag,{value:"Module"}));class ht extends I{view(){return a("div",null,"Withdrawals Content")}}class ft extends I{view(){return a("div",null,"Deposits Content")}}class wt extends K{constructor(){super(...arguments),this.depositPlatforms=[],this.depositRecords=[],this.users={}}getConfig(){return{pageTitle:r.translator.trans("withdrawal.admin.page.title").toString(),extensionId:"WithdrawalManagement",platformOperations:et(),transactionOperations:st(),settingsComponent:z,tabs:[{key:"withdrawals",label:r.translator.trans("withdrawal.admin.tabs.withdrawals").toString(),component:ht},{key:"deposits",label:r.translator.trans("withdrawal.admin.tabs.deposits").toString(),component:ft}],translations:{platformPrefix:"withdrawal.admin.platforms",transactionPrefix:"withdrawal.admin.requests"}}}renderActiveTabContent(){return this.activeTab==="withdrawals"?a("div",null,a(Q,{platforms:this.platforms,submittingPlatform:this.submittingPlatform,onAddPlatform:this.addPlatform.bind(this),onTogglePlatformStatus:this.togglePlatformStatus.bind(this),onDeletePlatform:this.deletePlatform.bind(this)}),a(X,{requests:this.transactions,onUpdateRequestStatus:this.updateTransactionStatus.bind(this),onDeleteRequest:this.deleteWithdrawalRequest.bind(this)})):this.activeTab==="deposits"?a("div",null,a(tt,{platforms:this.depositPlatforms,submittingPlatform:this.submittingPlatform,onAddPlatform:this.addDepositPlatform.bind(this),onTogglePlatformStatus:this.toggleDepositPlatformStatus.bind(this),onDeletePlatform:this.deleteDepositPlatform.bind(this)}),a(Z,{platforms:this.depositPlatforms,records:this.depositRecords,loading:this.loading,onApproveRecord:this.approveDepositRecord.bind(this),onRejectRecord:this.rejectDepositRecord.bind(this),onDeleteRecord:this.deleteDepositRecord.bind(this)})):super.renderActiveTabContent()}async loadData(){try{await this.loadPlatforms(),await this.loadTransactions(),await this.loadUserData(),await this.loadDepositPlatforms(),await this.loadDepositRecords()}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,a.redraw()}}async addDepositPlatform(t){if(!this.submittingPlatform){this.submittingPlatform=!0,a.redraw();try{const e={...t,minAmount:parseFloat(t.minAmount)||0,maxAmount:t.maxAmount&&t.maxAmount.trim()?parseFloat(t.maxAmount):null,fee:t.fee&&t.fee.trim()?parseFloat(t.fee):0,isActive:t.isActive!==void 0?t.isActive:!0};await O.create("deposit",e),await this.loadDepositPlatforms(),r.alerts.show({type:"success",dismissible:!0},r.translator.trans("withdrawal.admin.deposit.platforms.add_success"))}catch(e){console.error("Error adding deposit platform:",e);let s=r.translator.trans("withdrawal.admin.deposit.platforms.add_error").toString();e instanceof o&&(s=e.message),r.alerts.show({type:"error",dismissible:!0},s)}finally{this.submittingPlatform=!1,a.redraw()}}}async toggleDepositPlatformStatus(t){try{await O.toggleStatus(t),await this.loadDepositPlatforms(),r.alerts.show({type:"success",dismissible:!0},r.translator.trans("withdrawal.admin.deposit.platforms.status_updated")),a.redraw()}catch(e){console.error("Error toggling deposit platform status:",e);let s=r.translator.trans("withdrawal.admin.deposit.platforms.status_error").toString();e instanceof o&&(s=e.message),r.alerts.show({type:"error",dismissible:!0},s)}}async deleteDepositPlatform(t){const e=(typeof t.name=="function"?t.name():t.name)||"Unknown Platform";r.modal.show(x,{title:r.translator.trans("withdrawal.admin.platforms.delete_confirm_title"),message:r.translator.trans("withdrawal.admin.platforms.delete_confirm_message",{name:e}),confirmText:r.translator.trans("withdrawal.admin.platforms.delete_confirm_button"),cancelText:r.translator.trans("withdrawal.admin.platforms.delete_cancel_button"),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{try{await O.delete(t),await this.loadDepositPlatforms(),r.alerts.show({type:"success",dismissible:!0},r.translator.trans("withdrawal.admin.deposit.platforms.delete_success"))}catch(s){console.error("Error deleting deposit platform:",s);let n=r.translator.trans("withdrawal.admin.deposit.platforms.delete_error").toString();s instanceof o&&(n=s.message),r.alerts.show({type:"error",dismissible:!0},n)}a.redraw()},onCancel:()=>{r.modal.close()}})}async updateDepositRecordStatus(t,e){try{await P.update(t,{status:e}),await this.loadDepositRecords(),r.alerts.show({type:"success",dismissible:!0},r.translator.trans("withdrawal.admin.deposit.records.status_updated")),a.redraw()}catch(s){console.error("Error updating deposit record:",s);let n=r.translator.trans("withdrawal.admin.deposit.records.status_error").toString();s instanceof o&&(n=s.message),r.alerts.show({type:"error",dismissible:!0},n)}}deleteWithdrawalRequest(t){const e=typeof t.id=="function"?t.id():t.id,s=typeof t.amount=="function"?t.amount():t.attributes?.amount||0;let n="Unknown User";if(typeof t.user=="function"){const i=t.user();i&&typeof i.displayName=="function"?n=i.displayName():i&&i.attributes?.displayName&&(n=i.attributes.displayName)}r.modal.show(x,{title:r.translator.trans("withdrawal.admin.requests.delete_confirm_title"),message:r.translator.trans("withdrawal.admin.requests.delete_confirm_message",{info:`${n} - ${s}`}),confirmText:r.translator.trans("withdrawal.admin.requests.delete_confirm_button"),cancelText:r.translator.trans("withdrawal.admin.requests.delete_cancel_button"),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{try{const i=r.store.getById("withdrawal-requests",e);i&&(await i.delete(),await this.loadTransactions(),r.alerts.show({type:"success",dismissible:!0},r.translator.trans("withdrawal.admin.requests.delete_success")))}catch(i){console.error("Error deleting request:",i),r.alerts.show({type:"error",dismissible:!0},r.translator.trans("withdrawal.admin.requests.delete_error"))}},onCancel:()=>{r.modal.close()}})}async loadDepositPlatforms(){try{this.depositPlatforms=await O.find("deposit",{sort:"name"}),console.log("Loaded deposit platforms:",this.depositPlatforms)}catch(t){console.error("Error loading deposit platforms:",t),this.depositPlatforms=[]}}async loadUserData(){if(this.transactions.length===0)return;const e=[...new Set(this.transactions.map(s=>{const n=s?.data?.relationships?.user?.data||s?.relationships?.user?.data;return n?n.id:null}).filter(s=>s!=null))].filter(s=>!this.users[s]);if(e.length>0)try{const s=e.map(i=>r.store.find("users",i).catch(u=>(console.error(`Error loading user ${i}:`,u),null))),n=await Promise.all(s);e.forEach((i,u)=>{n[u]&&(this.users[i]=n[u])})}catch(s){console.error("Error loading users:",s)}}async loadDepositRecords(){try{const t=await P.find({include:"user,platform",sort:"-createdAt"});this.depositRecords=t,console.log("Loaded deposit records:",this.depositRecords)}catch(t){console.error("Error loading deposit records:",t),this.depositRecords=[]}}async approveDepositRecord(t,e,s){try{const n={status:"approved"};e!==void 0&&(n.creditedAmount=e),s&&(n.adminNotes=s),await P.update(t,n),await this.loadDepositRecords(),r.alerts.show({type:"success",dismissible:!0},r.translator.trans("withdrawal.admin.deposit.records.approve_success")),a.redraw()}catch(n){console.error("Error approving deposit record:",n);let i=r.translator.trans("withdrawal.admin.deposit.records.approve_error").toString();throw n instanceof o&&(i=n.message),r.alerts.show({type:"error",dismissible:!0},i),n}}async rejectDepositRecord(t,e){try{await P.update(t,{status:"rejected",adminNotes:e}),await this.loadDepositRecords(),r.alerts.show({type:"success",dismissible:!0},r.translator.trans("withdrawal.admin.deposit.records.reject_success")),a.redraw()}catch(s){console.error("Error rejecting deposit record:",s);let n=r.translator.trans("withdrawal.admin.deposit.records.reject_error").toString();throw s instanceof o&&(n=s.message),r.alerts.show({type:"error",dismissible:!0},n),s}}async deleteDepositRecord(t){try{await P.delete(t),await this.loadDepositRecords(),r.alerts.show({type:"success",dismissible:!0},r.translator.trans("withdrawal.admin.deposit.records.delete_success")),a.redraw()}catch(e){console.error("Error deleting deposit record:",e);let s=r.translator.trans("withdrawal.admin.deposit.records.delete_error").toString();throw e instanceof o&&(s=e.message),r.alerts.show({type:"error",dismissible:!0},s),e}}}function M(c){const t=[];return c.name!==void 0&&(!c.name||typeof c.name!="string")&&t.push("Platform name is required"),c.symbol!==void 0&&(!c.symbol||typeof c.symbol!="string")&&t.push("Symbol is required"),t}function B(c,t){const e=[];if(c.minAmount!==void 0&&(typeof c.minAmount!="number"||c.minAmount<0)&&e.push("Minimum amount must be a non-negative number"),c.maxAmount!==void 0&&c.maxAmount!==null){(typeof c.maxAmount!="number"||c.maxAmount<0)&&e.push("Maximum amount must be a non-negative number");const s=c.minAmount??t??0;c.maxAmount<s&&e.push("Maximum amount must be greater than or equal to minimum amount")}return c.fee!==void 0&&c.fee!==null&&(typeof c.fee!="number"||c.fee<0)&&e.push("Fee must be a non-negative number"),e}function pt(c){const t=[];return c.network!==void 0&&c.network!==null&&c.network!==""&&typeof c.network!="string"&&t.push("Network must be a string"),c.address!==void 0&&c.address!==null&&c.address!==""&&typeof c.address!="string"&&t.push("Deposit address must be a string"),t}function W(c){if(c.length>0)throw new o(c.join(", "),d.VALIDATION_ERROR)}function gt(c,t){const e=[...M(c),...B(c,t)];W(e)}function yt(c,t){const e=[...M(c),...B(c,t),...pt(c)];W(e)}class vt extends l{constructor(){super(...arguments),this.name=l.attribute("name"),this.symbol=l.attribute("symbol"),this.network=l.attribute("network"),this.displayName=l.attribute("displayName"),this.minAmount=l.attribute("minAmount"),this.maxAmount=l.attribute("maxAmount"),this.fee=l.attribute("fee"),this.currencyIconUrl=l.attribute("currencyIconUrl"),this.currencyIconClass=l.attribute("currencyIconClass"),this.currencyUnicodeSymbol=l.attribute("currencyUnicodeSymbol"),this.networkIconUrl=l.attribute("networkIconUrl"),this.networkIconClass=l.attribute("networkIconClass"),this.platformSpecificIconUrl=l.attribute("platformSpecificIconUrl"),this.platformSpecificIconClass=l.attribute("platformSpecificIconClass"),this.currencyIconOverrideUrl=l.attribute("currencyIconOverrideUrl"),this.currencyIconOverrideClass=l.attribute("currencyIconOverrideClass"),this.networkIconOverrideUrl=l.attribute("networkIconOverrideUrl"),this.networkIconOverrideClass=l.attribute("networkIconOverrideClass"),this.isActive=l.attribute("isActive"),this.createdAt=l.attribute("createdAt",l.transformDate),this.updatedAt=l.attribute("updatedAt",l.transformDate),this.bestIcon=l.attribute("bestIcon"),this.currencyIcon=l.attribute("currencyIcon"),this.networkIcon=l.attribute("networkIcon")}apiEndpoint(){const t=this.id();return t?`/withdrawal-platforms/${t}`:"/withdrawal-platforms"}getDisplayName(){return this.displayName()||this.name()}isValidAmount(t){const e=this.minAmount(),s=this.maxAmount();return t>=e&&t<=s}getTotalCost(t){return t+this.fee()}async save(t){t&&this.validateAttributes(t);try{return await super.save(t)}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new o("You do not have permission to delete this platform",d.PERMISSION_DENIED);if(await this.isInUse())throw new o("Cannot delete platform that has pending withdrawal requests",d.VALIDATION_ERROR);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}async toggleStatus(){if(!this.canModify())throw new o("You do not have permission to modify this platform",d.PERMISSION_DENIED);return await this.save({isActive:!this.isActive()})}clone(){const t=h.store.createRecord("withdrawal-platforms");return t.pushAttributes({name:this.name()+" (Copy)",symbol:this.symbol(),network:this.network(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),currencyIconOverrideUrl:this.currencyIconOverrideUrl(),currencyIconOverrideClass:this.currencyIconOverrideClass(),networkIconOverrideUrl:this.networkIconOverrideUrl(),networkIconOverrideClass:this.networkIconOverrideClass(),isActive:!1}),t}validateAmount(t){const e=[];return typeof t!="number"||t<=0?(e.push("Amount must be a positive number"),{valid:!1,errors:e}):(t<this.minAmount()&&e.push(`Amount must be at least ${this.minAmount()} ${this.symbol()}`),this.maxAmount()&&t>this.maxAmount()&&e.push(`Amount cannot exceed ${this.maxAmount()} ${this.symbol()}`),{valid:e.length===0,errors:e})}validateUserBalance(t,e){const s=[],n=this.getTotalCost(t);if(e<n){const i=this.fee()>0?` (including ${this.fee()} ${this.symbol()} fee)`:"";s.push(`Insufficient balance. Required: ${n} ${this.symbol()}${i}, Available: ${e} ${this.symbol()}`)}return{valid:s.length===0,errors:s}}canModify(){const t=h.session.user;return t&&t.isAdmin()}canDelete(){const t=h.session.user;return t&&t.isAdmin()}canView(){if(this.isActive())return!0;const t=h.session.user;return t&&t.isAdmin()}async isInUse(){try{const t=await h.store.find("withdrawal-requests",{filter:{platform:this.id(),status:"pending"}});return(Array.isArray(t)?t:[t]).length>0}catch{return!0}}getFormattedFee(){const t=this.fee();return t===0?"Free":`${t} ${this.symbol()}`}getFormattedLimits(){const t=this.minAmount(),e=this.maxAmount(),s=this.symbol();return e?`${t} - ${e} ${s}`:`Min: ${t} ${s}`}validateAttributes(t){gt(t,this.minAmount())}handleSaveError(t){if(t instanceof o)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new o(e.detail||"Failed to save withdrawal platform",d.VALIDATION_ERROR,e.code,e)}return new o(t.message||"Failed to save withdrawal platform",d.SERVER_ERROR)}handleDeleteError(t){return t instanceof o?t:t.status===403||t.response?.status===403?new o("You do not have permission to delete this platform",d.PERMISSION_DENIED):new o(t.message||"Failed to delete withdrawal platform",d.SERVER_ERROR)}}const S={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class At extends l{constructor(){super(...arguments),this.amount=l.attribute("amount"),this.accountDetails=l.attribute("accountDetails"),this.message=l.attribute("message"),this.status=l.attribute("status"),this.platformId=l.attribute("platformId"),this.userId=l.attribute("userId"),this.createdAt=l.attribute("createdAt",l.transformDate),this.updatedAt=l.attribute("updatedAt",l.transformDate),this.user=l.hasOne("user"),this.platform=l.hasOne("platform")}apiEndpoint(){const t=this.id();return t?`/withdrawal-requests/${t}`:"/withdrawal-requests"}isPending(){return this.status()===S.PENDING}isApproved(){return this.status()===S.APPROVED}isRejected(){return this.status()===S.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const t=this.status();return h.translator.trans(`withdrawal.forum.status.${t}`).toString()}statusColor(){switch(this.status()){case S.APPROVED:return"success";case S.REJECTED:return"danger";case S.PENDING:default:return"warning"}}async save(t){t&&this.validateAttributes(t);try{return await super.save(t)}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new o("You do not have permission to delete this request",d.PERMISSION_DENIED);if(!this.canBeModified())throw new o("This request cannot be deleted as it has already been processed",d.VALIDATION_ERROR);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}clone(){const t=h.store.createRecord("withdrawal-requests");return t.pushAttributes({platformId:this.platformId(),amount:this.amount(),accountDetails:this.accountDetails(),message:this.message()}),t}getTotalCost(){const t=this.platform(),e=t&&t.fee()||0;return this.amount()+e}getFormattedAmount(){const t=this.platform(),e=t?t.symbol():"";return`${this.amount()} ${e}`.trim()}getFormattedTotalCost(){const t=this.platform(),e=t?t.symbol():"",s=t&&t.fee()||0;return s>0?`${this.amount()} + ${s} (fee) = ${this.getTotalCost()} ${e}`.trim():this.getFormattedAmount()}canModify(){const t=h.session.user;return t?t.isAdmin()?!0:this.userId()===t.id()&&this.canBeModified():!1}canDelete(){const t=h.session.user;return t?t.isAdmin()?!0:this.userId()===t.id()&&this.canBeModified():!1}canView(){const t=h.session.user;return t?t.isAdmin()?!0:this.userId()===t.id():!1}validateAttributes(t){const e=[];if(t.amount!==void 0&&(typeof t.amount!="number"||t.amount<=0)&&e.push("Amount must be a positive number"),t.accountDetails!==void 0&&(!t.accountDetails||typeof t.accountDetails!="string")&&e.push("Account details are required"),t.platformId!==void 0&&(!t.platformId||typeof t.platformId!="number")&&e.push("Platform selection is required"),e.length>0)throw new o(e.join(", "),d.VALIDATION_ERROR)}handleSaveError(t){if(t instanceof o)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new o(e.detail||"Failed to save withdrawal request",d.VALIDATION_ERROR,e.code,e)}return new o(t.message||"Failed to save withdrawal request",d.SERVER_ERROR)}handleDeleteError(t){return t instanceof o?t:t.status===403||t.response?.status===403?new o("You do not have permission to delete this request",d.PERMISSION_DENIED):new o(t.message||"Failed to delete withdrawal request",d.SERVER_ERROR)}}class bt extends l{constructor(){super(...arguments),this.name=l.attribute("name"),this.symbol=l.attribute("symbol"),this.network=l.attribute("network"),this.networkTypeId=l.attribute("networkTypeId"),this.displayName=l.attribute("displayName"),this.minAmount=l.attribute("minAmount"),this.maxAmount=l.attribute("maxAmount"),this.fee=l.attribute("fee"),this.address=l.attribute("address"),this.qrCodeImageUrl=l.attribute("qrCodeImageUrl"),this.currencyIconUrl=l.attribute("currencyIconUrl"),this.currencyIconClass=l.attribute("currencyIconClass"),this.currencyUnicodeSymbol=l.attribute("currencyUnicodeSymbol"),this.networkIconUrl=l.attribute("networkIconUrl"),this.networkIconClass=l.attribute("networkIconClass"),this.platformSpecificIconUrl=l.attribute("platformSpecificIconUrl"),this.platformSpecificIconClass=l.attribute("platformSpecificIconClass"),this.currencyIconOverrideUrl=l.attribute("currencyIconOverrideUrl"),this.currencyIconOverrideClass=l.attribute("currencyIconOverrideClass"),this.networkIconOverrideUrl=l.attribute("networkIconOverrideUrl"),this.networkIconOverrideClass=l.attribute("networkIconOverrideClass"),this.warningText=l.attribute("warningText"),this.networkConfig=l.attribute("networkConfig"),this.isActive=l.attribute("isActive"),this.createdAt=l.attribute("createdAt",l.transformDate),this.updatedAt=l.attribute("updatedAt",l.transformDate),this.networkType=l.hasOne("networkType"),this.bestIcon=l.attribute("bestIcon"),this.currencyIcon=l.attribute("currencyIcon"),this.networkIcon=l.attribute("networkIcon")}getDisplayName(){return this.displayName()||this.name()}getFullDisplayName(){const t=this.getDisplayName(),e=this.network();return e?`${t} (${e})`:t}isValidAmount(t){const e=this.minAmount()||0,s=this.maxAmount();return t>=e&&(s===null||t<=s)}getTotalCost(t){return t+(this.fee()||0)}async save(t){t&&this.validateAttributes(t);try{return await super.save(t)}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new o("You do not have permission to delete this platform",d.PERMISSION_DENIED);if(await this.isInUse())throw new o("Cannot delete platform that has pending deposit records",d.VALIDATION_ERROR);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}async toggleStatus(){if(!this.canModify())throw new o("You do not have permission to modify this platform",d.PERMISSION_DENIED);return await this.save({isActive:!this.isActive()})}clone(){const t=h.store.createRecord("deposit-platforms");return t.pushAttributes({name:this.name()+" (Copy)",symbol:this.symbol(),network:this.network(),networkTypeId:this.networkTypeId(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),address:this.address(),qrCodeImageUrl:this.qrCodeImageUrl(),iconUrl:this.iconUrl(),iconClass:this.iconClass(),warningText:this.warningText(),isActive:!1}),t}validateAmount(t){const e=[];if(typeof t!="number"||t<=0)return e.push("Amount must be a positive number"),{valid:!1,errors:e};const s=this.minAmount()||0;t<s&&e.push(`Amount must be at least ${s} ${this.symbol()}`);const n=this.maxAmount();return n&&t>n&&e.push(`Amount cannot exceed ${n} ${this.symbol()}`),{valid:e.length===0,errors:e}}canModify(){const t=h.session.user;return t&&t.isAdmin()}canDelete(){const t=h.session.user;return t&&t.isAdmin()}canView(){if(this.isActive())return!0;const t=h.session.user;return t&&t.isAdmin()}async isInUse(){try{const t=await h.store.find("deposit-records",{filter:{platform:this.id(),status:"pending"}});return(Array.isArray(t)?t:[t]).length>0}catch{return!0}}getFormattedFee(){const t=this.fee()||0;return t===0?"Free":`${t} ${this.symbol()}`}getFormattedLimits(){const t=this.minAmount()||0,e=this.maxAmount(),s=this.symbol();return e?`${t} - ${e} ${s}`:`Min: ${t} ${s}`}generateDepositAddress(t){const e=this.address();if(e)return e;throw new o("No deposit address configured for this platform",d.VALIDATION_ERROR)}validateAttributes(t){yt(t,this.minAmount())}handleSaveError(t){if(t instanceof o)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new o(e.detail||"Failed to save deposit platform",d.VALIDATION_ERROR,e.code,e)}return new o(t.message||"Failed to save deposit platform",d.SERVER_ERROR)}handleDeleteError(t){return t instanceof o?t:t.status===403||t.response?.status===403?new o("You do not have permission to delete this platform",d.PERMISSION_DENIED):new o(t.message||"Failed to delete deposit platform",d.SERVER_ERROR)}}const b=class b extends l{constructor(){super(...arguments),this.id=l.attribute("id"),this.userId=l.attribute("userId"),this.platformId=l.attribute("platformId"),this.platformAccount=l.attribute("platformAccount"),this.realName=l.attribute("realName"),this.amount=l.attribute("amount"),this.depositTime=l.attribute("depositTime",l.transformDate),this.screenshotUrl=l.attribute("screenshotUrl"),this.userMessage=l.attribute("userMessage"),this.status=l.attribute("status"),this.processedAt=l.attribute("processedAt",l.transformDate),this.processedBy=l.attribute("processedBy"),this.adminNotes=l.attribute("adminNotes"),this.creditedAmount=l.attribute("creditedAmount"),this.createdAt=l.attribute("createdAt",l.transformDate),this.updatedAt=l.attribute("updatedAt",l.transformDate),this.user=l.hasOne("user"),this.platform=l.hasOne("platform"),this.processedByUser=l.hasOne("processedByUser")}isPending(){return this.status()===b.STATUS_PENDING}isApproved(){return this.status()===b.STATUS_APPROVED}isRejected(){return this.status()===b.STATUS_REJECTED}getStatusColor(){switch(this.status()){case b.STATUS_PENDING:return"warning";case b.STATUS_APPROVED:return"success";case b.STATUS_REJECTED:return"error";default:return"secondary"}}getStatusLabel(){const t=this.status();return h.translator.trans(`withdrawal.forum.deposit.status.${t}`).toString()}canBeModified(){return this.isPending()}async save(t){t&&this.validateAttributes(t);try{return await super.save(t)}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new o("You do not have permission to delete this deposit record",d.PERMISSION_DENIED);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}clone(){const t=h.store.createRecord("deposit-records");return t.pushAttributes({platformId:this.platformId(),amount:this.amount(),platformAccount:this.platformAccount(),realName:this.realName(),userMessage:this.userMessage(),screenshotUrl:this.screenshotUrl()}),t}getFormattedAmount(){const t=this.platform(),e=t?t.symbol():"";return`${this.amount()} ${e}`.trim()}getFinalAmount(){return this.creditedAmount()||this.amount()}getFormattedFinalAmount(){const t=this.platform(),e=t?t.symbol():"",s=this.getFinalAmount();return this.creditedAmount()&&this.creditedAmount()!==this.amount()?`${s} ${e} (credited: ${this.creditedAmount()})`.trim():`${s} ${e}`.trim()}canModify(){const t=h.session.user;return t?t.isAdmin()?!0:this.userId()===t.id()&&this.canBeModified():!1}canDelete(){const t=h.session.user;return t?t.isAdmin()?!0:this.userId()===t.id()&&this.canBeModified():!1}canView(){const t=h.session.user;return t?t.isAdmin()?!0:this.userId()===t.id():!1}canProcess(){const t=h.session.user;return t&&t.isAdmin()&&this.isPending()}async approve(t,e){if(!this.canProcess())throw new o("You do not have permission to approve this deposit",d.PERMISSION_DENIED);const s={status:b.STATUS_APPROVED,processedAt:new Date,processedBy:h.session.user?.id()};return t!==void 0&&(s.creditedAmount=t),e&&(s.adminNotes=e),await this.save(s)}async reject(t){if(!this.canProcess())throw new o("You do not have permission to reject this deposit",d.PERMISSION_DENIED);const e={status:b.STATUS_REJECTED,processedAt:new Date,processedBy:h.session.user?.id()};return t&&(e.adminNotes=t),await this.save(e)}validateAttributes(t){const e=[];if(t.amount!==void 0&&(typeof t.amount!="number"||t.amount<=0)&&e.push("Amount must be a positive number"),t.platformAccount!==void 0&&(!t.platformAccount||typeof t.platformAccount!="string")&&e.push("Platform account is required"),t.realName!==void 0&&(!t.realName||typeof t.realName!="string")&&e.push("Real name is required"),t.platformId!==void 0&&(!t.platformId||typeof t.platformId!="number")&&e.push("Platform selection is required"),t.creditedAmount!==void 0&&(typeof t.creditedAmount!="number"||t.creditedAmount<0)&&e.push("Credited amount must be a non-negative number"),e.length>0)throw new o(e.join(", "),d.VALIDATION_ERROR)}handleSaveError(t){if(t instanceof o)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new o(e.detail||"Failed to save deposit record",d.VALIDATION_ERROR,e.code,e)}return new o(t.message||"Failed to save deposit record",d.SERVER_ERROR)}handleDeleteError(t){return t instanceof o?t:t.status===403||t.response?.status===403?new o("You do not have permission to delete this record",d.PERMISSION_DENIED):new o(t.message||"Failed to delete deposit record",d.SERVER_ERROR)}};b.STATUS_PENDING="pending",b.STATUS_APPROVED="approved",b.STATUS_REJECTED="rejected";let F=b;r.initializers.add("wusong8899-withdrawal",()=>{r.store.models["withdrawal-platforms"]=vt,r.store.models["withdrawal-requests"]=At,r.store.models["deposit-platforms"]=bt,r.store.models["deposit-records"]=F,r.extensionData.for("wusong8899-withdrawal").registerPage(wt)})})(flarum.core.compat["common/app"],flarum.core.compat["admin/app"],m,flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/components/Modal"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/helpers/icon"],flarum.core.compat["common/Component"],flarum.core.compat["common/utils/withAttr"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/components/Switch"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=admin.js.map

module.exports={};