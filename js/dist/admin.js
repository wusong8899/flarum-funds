(function(s,L,C,e,v,x,h,u,w,P,k,A,B,O,i){"use strict";class W extends v{view(){return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,"General Settings"),m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.settings.money_icon_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://i.mji.rip/2025/08/28/cd18932c68e9bbee9502b1fb6317cba9.png",value:s.forum.attribute("wusong8899-withdrawal.moneyIconUrl")||"",oninput:x("value",t=>this.attrs.onSettingChange("wusong8899-withdrawal.moneyIconUrl",t))}),m("small",{className:"helpText"},s.translator.trans("withdrawal.admin.settings.money_icon_url_help")))))}}class q{constructor(){this.errors=[]}required(t,a,r){return(!t||typeof t=="string"&&t.trim()==="")&&this.errors.push({field:a,message:`${r||a} is required`}),this}minLength(t,a,r,n){return t&&t.length<a&&this.errors.push({field:r,message:`${n||r} must be at least ${a} characters`}),this}numberRange(t,a,r,n,o){const l=typeof t=="string"?parseFloat(t):t;return isNaN(l)?(this.errors.push({field:n||"number",message:`${o||"Value"} must be a valid number`}),this):(a!==void 0&&l<a&&this.errors.push({field:n||"number",message:`${o||"Value"} must be at least ${a}`}),r!==void 0&&l>r&&this.errors.push({field:n||"number",message:`${o||"Value"} must be at most ${r}`}),this)}url(t,a,r){if(t&&t.trim())try{const n=new URL(t)}catch{this.errors.push({field:a,message:`${r||a} must be a valid URL`})}return this}custom(t,a,r){return t||this.errors.push({field:a,message:r}),this}getResult(){return{isValid:this.errors.length===0,errors:this.errors,firstErrorMessage:this.errors.length>0?this.errors[0].message:void 0}}reset(){return this.errors=[],this}}class V extends v{constructor(){super(...arguments),this.name=u(""),this.symbol=u(""),this.network=u(""),this.minAmount=u(""),this.maxAmount=u(""),this.fee=u(""),this.iconUrl=u(""),this.iconClass=u("")}view(){return e("div",{className:"WithdrawalManagementPage-addPlatform"},e("div",{className:"Form-group"},e("div",{className:"Form-row"},e("div",{className:"Form-col"},e("label",null,s.translator.trans("withdrawal.admin.platforms.name")),e("input",{type:"text",className:"FormControl",placeholder:s.translator.trans("withdrawal.admin.platforms.add_placeholder"),bidi:this.name})),e("div",{className:"Form-col"},e("label",null,s.translator.trans("withdrawal.admin.platforms.symbol")),e("input",{type:"text",className:"FormControl",placeholder:"BTC, ETH, USDT...",bidi:this.symbol})),e("div",{className:"Form-col"},e("label",null,s.translator.trans("withdrawal.admin.platforms.network")),e("input",{type:"text",className:"FormControl",placeholder:"TRC20, ERC20, BSC... (optional)",bidi:this.network}),e("small",{className:"helpText"},s.translator.trans("withdrawal.admin.platforms.network_help")))),e("div",{className:"Form-row"},e("div",{className:"Form-col"},e("label",null,s.translator.trans("withdrawal.admin.platforms.min_amount")),e("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.001",bidi:this.minAmount})),e("div",{className:"Form-col"},e("label",null,s.translator.trans("withdrawal.admin.platforms.max_amount")),e("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"10.0",bidi:this.maxAmount})),e("div",{className:"Form-col"},e("label",null,s.translator.trans("withdrawal.admin.platforms.fee")),e("input",{type:"number",step:"0.00000001",className:"FormControl",placeholder:"0.0005",bidi:this.fee}))),e("div",{className:"Form-row"},e("div",{className:"Form-col"},e("label",null,s.translator.trans("withdrawal.admin.platforms.icon_url")),e("input",{type:"url",className:"FormControl",placeholder:"https://example.com/icon.png",bidi:this.iconUrl}),e("small",{className:"helpText"},s.translator.trans("withdrawal.admin.platforms.icon_url_help"))),e("div",{className:"Form-col"},e("label",null,s.translator.trans("withdrawal.admin.platforms.icon_class")),e("input",{type:"text",className:"FormControl",placeholder:"fas fa-coins",bidi:this.iconClass}),e("small",{className:"helpText"},s.translator.trans("withdrawal.admin.platforms.icon_class_help")))),e("div",{className:"Form-group"},e(h,{className:"Button Button--primary",loading:this.attrs.submitting,disabled:this.attrs.submitting,onclick:this.handleSubmit.bind(this)},s.translator.trans("withdrawal.admin.platforms.add_button")))))}validateForm(){const t=new q;try{t.required(this.name(),"name",s.translator.trans("withdrawal.admin.platforms.name")).required(this.symbol(),"symbol",s.translator.trans("withdrawal.admin.platforms.symbol")).numberRange(this.minAmount(),0,void 0,"minAmount",s.translator.trans("withdrawal.admin.platforms.min_amount")).numberRange(this.maxAmount(),0,void 0,"maxAmount",s.translator.trans("withdrawal.admin.platforms.max_amount")).numberRange(this.fee(),0,void 0,"fee",s.translator.trans("withdrawal.admin.platforms.fee"));const a=parseFloat(this.minAmount());return parseFloat(this.maxAmount())<a&&t.addError("maxAmount",s.translator.trans("withdrawal.admin.platforms.max_min_error")),this.iconUrl()&&this.iconUrl().trim()&&t.url(this.iconUrl(),"iconUrl",s.translator.trans("withdrawal.admin.platforms.icon_url")),t.isValid()}catch(a){return a instanceof Error&&s.alerts.show({type:"error",dismissible:!0},a.message),!1}}async handleSubmit(){if(this.attrs.submitting||!this.validateForm())return;const t={name:this.name(),symbol:this.symbol(),network:this.network(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),iconUrl:this.iconUrl(),iconClass:this.iconClass()};try{await this.attrs.onSubmit(t),this.clearForm()}catch{}}clearForm(){this.name(""),this.symbol(""),this.network(""),this.minAmount(""),this.maxAmount(""),this.fee(""),this.iconUrl(""),this.iconClass(""),e.redraw()}}class U extends v{view(t){const{platform:a,type:r,onToggleStatus:n,onDelete:o,style:l="card"}=t.attrs;return l==="card"?this.renderCardStyle(a,r,n,o):this.renderListStyle(a,r,n,o)}renderCardStyle(t,a,r,n){const o=this.extractPlatformData(t),l=a==="withdrawal"?"withdrawal.admin.platforms":"withdrawal.admin.deposit.platforms";return e("div",{key:o.id,className:`${a}Platform`},e("div",{className:`${a}Platform-info`},e("div",{className:`${a}Platform-primary`},e("span",{className:`${a}Platform-status ${o.isActive?"active":"inactive"}`},o.isActive?"ðŸŸ¢":"ðŸ”´"),e("span",{className:`${a}Platform-name`},o.displayName),e("span",{className:"platform-id"},"#",o.id),o.network&&e("span",{className:`${a}Platform-network`},"(",o.network,")")),e("div",{className:`${a}Platform-details`},e("span",{className:`${a}Platform-amounts`},"Min: ",o.minAmount," | Max: ",o.maxAmount,a==="withdrawal"&&` | Fee: ${o.fee}`,a==="deposit"&&` | Address: ${o.address?"Static":"Template"}`),o.createdDate&&e("span",{className:`${a}Platform-date`},o.dateDisplay))),e("div",{className:`${a}Platform-actions`},e(h,{className:`Button ${o.isActive?"Button--secondary":"Button--primary"}`,onclick:()=>r(t)},s.translator.trans(`${l}.${o.isActive?"disable":"enable"}`)),e(h,{className:"Button Button--danger",onclick:()=>n(t)},s.translator.trans(`${l}.delete`))))}renderListStyle(t,a,r,n){const o=this.extractPlatformData(t),l=a==="withdrawal"?"withdrawal.admin.platforms":"withdrawal.admin.deposit.platforms";return e("div",{className:`${a}PlatformListItem`},e("div",{className:`${a}PlatformListItem-content`},e("div",{className:`${a}PlatformListItem-icon`},this.renderPlatformIcon(t)),e("div",{className:`${a}PlatformListItem-info`},e("div",{className:`${a}PlatformListItem-primary`},e("strong",null,o.name),e("span",{className:`${a}PlatformListItem-displayName`},o.symbol,o.network&&` (${o.network})`)),e("div",{className:`${a}PlatformListItem-details`},e("span",{className:`${a}PlatformListItem-detail`},"Min: ",o.minAmount," ",o.symbol),o.maxAmount&&e("span",{className:`${a}PlatformListItem-detail`},"Max: ",o.maxAmount," ",o.symbol),a==="withdrawal"&&o.fee&&e("span",{className:`${a}PlatformListItem-detail`},"Fee: ",o.fee," ",o.symbol),a==="deposit"&&e("span",{className:`${a}PlatformListItem-detail`},"Address: ",o.address?"Static":"Template"))),e("div",{className:`${a}PlatformListItem-actions`},e(P,{state:o.isActive,onchange:async()=>{await r(t),e.redraw()}},o.isActive?s.translator.trans(`${l}.active`):s.translator.trans(`${l}.inactive`)),e(h,{className:"Button Button--icon Button--flat",icon:"fas fa-trash",onclick:async()=>{await n(t),e.redraw()},title:s.translator.trans(`${l}.delete`)}))))}extractPlatformData(t){const a=typeof t.id=="function"?t.id():t.id,r=(typeof t.name=="function"?t.name():t.attributes?.name)||"Unknown Platform",n=(typeof t.symbol=="function"?t.symbol():t.attributes?.symbol)||"",o=(typeof t.network=="function"?t.network():t.attributes?.network)||null,l=(typeof t.displayName=="function"?t.displayName():t.attributes?.displayName)||r,g=(typeof t.minAmount=="function"?t.minAmount():t.attributes?.minAmount)||"N/A",p=(typeof t.maxAmount=="function"?t.maxAmount():t.attributes?.maxAmount)||"N/A",b=(typeof t.fee=="function"?t.fee():t.attributes?.fee)||"N/A",y=(typeof t.address=="function"?t.address():t.attributes?.address)||null,c=(typeof t.isActive=="function"?t.isActive():t.attributes?.isActive)??!1,N=(typeof t.createdAt=="function"?t.createdAt():t.attributes?.createdAt)||null;let D="N/A";if(N)try{D=k(N)}catch(f){console.error("Error formatting date:",f),D="Invalid Date"}return{id:a,name:r,symbol:n,network:o,displayName:l,minAmount:g,maxAmount:p,fee:b,address:y,isActive:c,createdDate:N,dateDisplay:D}}renderPlatformIcon(t){const a=typeof t.iconUrl=="function"?t.iconUrl():t.attributes?.iconUrl,r=typeof t.iconClass=="function"?t.iconClass():t.attributes?.iconClass,n=typeof t.symbol=="function"?t.symbol():t.attributes?.symbol;if(a)return e("img",{src:a,alt:n,className:"PlatformListItem-img"});if(r)return A(r);switch(n){case"USDT":return e("span",{className:"PlatformListItem-currencyIcon usdt"},"â‚®");case"USDC":return e("span",{className:"PlatformListItem-currencyIcon usdc"},"$");case"BTC":return e("span",{className:"PlatformListItem-currencyIcon btc"},"â‚¿");case"ETH":return e("span",{className:"PlatformListItem-currencyIcon eth"},"Îž");default:return A("fas fa-coins")}}}class H extends v{view(){const{platforms:t,submittingPlatform:a,onAddPlatform:r,onTogglePlatformStatus:n,onDeletePlatform:o}=this.attrs;return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,s.translator.trans("withdrawal.admin.platforms.title")),m(V,{onSubmit:r,submitting:a}),m("div",{className:"WithdrawalManagementPage-platformList"},t.length===0?m("p",null,s.translator.trans("withdrawal.admin.platforms.empty")):t.map(l=>m(U,{key:typeof l.id=="function"?l.id():l.id,platform:l,type:"withdrawal",style:"card",onToggleStatus:n,onDelete:o}))))}}class I extends v{view(){const t=this.attrs.request,{showActions:a,showDelete:r=!1}=this.attrs,n=typeof t.id=="function"?t.id():t.id,o=typeof t.amount=="function"?t.amount():t.attributes?.amount||0,l=typeof t.status=="function"?t.status():t.attributes?.status||"pending",g=typeof t.accountDetails=="function"?t.accountDetails():t.attributes?.accountDetails||t.attributes?.account_details||"N/A",p=typeof t.createdAt=="function"?t.createdAt():t.attributes?.createdAt||null;let b="Unknown User";if(typeof t.user=="function"){const f=t.user();f&&typeof f.displayName=="function"?b=f.displayName():f&&f.attributes?.displayName&&(b=f.attributes.displayName)}let y="Unknown Platform",c="N/A";if(typeof t.platform=="function"){const f=t.platform();f&&(y=typeof f.name=="function"?f.name():f.attributes?.name||"Unknown Platform",c=typeof f.symbol=="function"?f.symbol():f.attributes?.symbol||"N/A")}const N=`status-${l}`;let D="N/A";if(p)try{D=k(p)}catch(f){console.error("Error formatting request date:",f),D="Invalid Date"}return m("div",{key:n,className:`WithdrawalRequest ${N}`},m("div",{className:"WithdrawalRequest-info"},m("div",{className:"WithdrawalRequest-user"},m("strong",null,b),m("span",{className:"request-id"},"#",n)),m("div",{className:"WithdrawalRequest-details"},m("span",{className:"amount"},o),m("span",{className:"platform"},y),m("span",{className:"symbol"},c),m("span",{className:"date"},D)),m("div",{className:"WithdrawalRequest-account"},m("strong",null,s.translator.trans("withdrawal.admin.requests.account_details"),":"),m("span",null,g)),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${l}`},s.translator.trans(`withdrawal.admin.requests.status.${l}`)))),(a||r)&&m("div",{className:"WithdrawalRequest-actions"},a&&this.attrs.onUpdateStatus&&m("[",null,m(h,{className:"Button Button--primary",onclick:()=>this.attrs.onUpdateStatus(t,"approved")},s.translator.trans("withdrawal.admin.requests.approve")),m(h,{className:"Button Button--danger",onclick:()=>this.attrs.onUpdateStatus(t,"rejected")},s.translator.trans("withdrawal.admin.requests.reject"))),this.attrs.onDelete&&m(h,{className:"Button Button--link",onclick:()=>this.attrs.onDelete(t)},m("i",{className:"fas fa-trash"}),s.translator.trans("withdrawal.admin.requests.delete"))))}}class G extends v{view(){const{requests:t,onUpdateRequestStatus:a,onDeleteRequest:r}=this.attrs,n=t.filter(l=>((typeof l.status=="function"?l.status():l.attributes?.status)||"pending")==="pending"),o=t.filter(l=>((typeof l.status=="function"?l.status():l.attributes?.status)||"pending")!=="pending");return m("div",{className:"WithdrawalManagementPage-section"},m("h3",null,s.translator.trans("withdrawal.admin.requests.title")),m("div",{className:"WithdrawalManagementPage-pendingRequests"},m("h4",null,s.translator.trans("withdrawal.admin.requests.pending_title")),n.length===0?m("p",null,s.translator.trans("withdrawal.admin.requests.no_pending")):n.map(l=>m(I,{key:typeof l.id=="function"?l.id():l.id,request:l,showActions:!0,showDelete:!0,onUpdateStatus:a,onDelete:r}))),m("div",{className:"WithdrawalManagementPage-processedRequests"},m("h4",null,s.translator.trans("withdrawal.admin.requests.processed_title")),o.length===0?m("p",null,s.translator.trans("withdrawal.admin.requests.no_processed")):o.map(l=>m(I,{key:typeof l.id=="function"?l.id():l.id,request:l,showActions:!1,showDelete:!0,onDelete:r}))))}}class j extends v{constructor(){super(...arguments),this.formData={name:u(""),symbol:u(""),network:u(""),networkTypeId:u(null),minAmount:u(""),maxAmount:u(""),address:u(""),qrCodeImageUrl:u(""),iconUrl:u(""),iconClass:u(""),warningText:u(""),isActive:u(!0)},this.networkTypes=[],this.loadingNetworkTypes=!1}oninit(t){super.oninit(t),this.loadNetworkTypes()}view(t){const{submitting:a,onCancel:r}=t.attrs;return e("div",{className:"AddDepositPlatformForm"},e("div",{className:"Form"},e("div",{className:"Form-row"},e("div",{className:"Form-group"},e("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.name"),e("span",{className:"Form-required"},"*")),e("input",{type:"text",className:"FormControl",placeholder:"e.g., Tether",bidi:this.formData.name,disabled:a})),e("div",{className:"Form-group"},e("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.symbol"),e("span",{className:"Form-required"},"*")),e("input",{type:"text",className:"FormControl",placeholder:"e.g., USDT",bidi:this.formData.symbol,disabled:a}))),e("div",{className:"Form-row"},e("div",{className:"Form-group"},e("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.network")),e("select",{className:"FormControl",value:this.formData.networkTypeId()||"",onchange:x("value",n=>{const o=n?parseInt(n):null;if(this.formData.networkTypeId(o),o){const l=this.networkTypes.find(g=>g.id()===o);l&&this.formData.network(l.code())}else this.formData.network("")}),disabled:a||this.loadingNetworkTypes},e("option",{value:""},this.loadingNetworkTypes?"Loading...":"Select Network Type (Optional)"),this.networkTypes.map(n=>e("option",{key:n.id(),value:n.id()},n.name())))),e("div",{className:"Form-group"},e("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.custom_network")),e("input",{type:"text",className:"FormControl",placeholder:"Custom network name (if not using predefined)",bidi:this.formData.network,disabled:a}),e("div",{className:"helpText"},"Leave empty to use the selected network type above, or enter a custom network name.")),e("div",{className:"Form-group"},e("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.min_amount")),e("input",{type:"number",step:"0.00000001",min:"0",className:"FormControl",placeholder:"0.0",bidi:this.formData.minAmount,disabled:a}))),e("div",{className:"Form-row"},e("div",{className:"Form-group"},e("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.max_amount")),e("input",{type:"number",step:"0.00000001",min:"0",className:"FormControl",placeholder:"Leave empty for unlimited",bidi:this.formData.maxAmount,disabled:a}))),e("div",{className:"Form-group"},e("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.address"),e("span",{className:"Form-required"},"*")),e("input",{type:"text",className:"FormControl",placeholder:"Enter deposit address for this platform",bidi:this.formData.address,disabled:a}),e("div",{className:"helpText"},s.translator.trans("withdrawal.admin.deposit.platforms.address_help"))),e("div",{className:"Form-group"},e("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.qr_code_image_url")),e("input",{type:"url",className:"FormControl",placeholder:"https://example.com/qr-code.png",bidi:this.formData.qrCodeImageUrl,disabled:a}),e("div",{className:"helpText"},s.translator.trans("withdrawal.admin.deposit.platforms.qr_code_image_help"))),e("div",{className:"Form-row"},e("div",{className:"Form-group"},e("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.icon_url")),e("input",{type:"url",className:"FormControl",placeholder:"https://example.com/icon.png",bidi:this.formData.iconUrl,disabled:a})),e("div",{className:"Form-group"},e("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.icon_class")),e("input",{type:"text",className:"FormControl",placeholder:"fas fa-coins",bidi:this.formData.iconClass,disabled:a}))),e("div",{className:"Form-group"},e("label",null,s.translator.trans("withdrawal.admin.deposit.platforms.warning_text")),e("textarea",{className:"FormControl",rows:3,placeholder:"Network-specific warning for users",bidi:this.formData.warningText,disabled:a})),e("div",{className:"Form-group"},e(P,{state:this.formData.isActive(),onchange:this.formData.isActive,disabled:a},s.translator.trans("withdrawal.admin.deposit.platforms.is_active"))),e("div",{className:"Form-actions"},e(h,{className:"Button Button--primary",type:"submit",loading:a,onclick:this.handleSubmit.bind(this,t.attrs)},s.translator.trans("withdrawal.admin.deposit.platforms.add_button")),e(h,{className:"Button",onclick:r,disabled:a},s.translator.trans("core.admin.basics.cancel_button")))))}async loadNetworkTypes(){this.loadingNetworkTypes=!0,e.redraw();try{const t=await s.request({method:"GET",url:s.forum.attribute("apiUrl")+"/network-types?filter[is_active]=1"});s.store.pushPayload(t),this.networkTypes=s.store.all("network-types")}catch(t){console.error("Failed to load network types:",t)}finally{this.loadingNetworkTypes=!1,e.redraw()}}validateForm(){const t=new q;try{if(t.required(this.formData.name(),"name",s.translator.trans("withdrawal.admin.deposit.platforms.name")).required(this.formData.symbol(),"symbol",s.translator.trans("withdrawal.admin.deposit.platforms.symbol")).required(this.formData.address(),"address",s.translator.trans("withdrawal.admin.deposit.platforms.address")),this.formData.minAmount()&&this.formData.minAmount().trim()&&t.numberRange(this.formData.minAmount(),0,void 0,"minAmount",s.translator.trans("withdrawal.admin.deposit.platforms.min_amount")),this.formData.maxAmount()&&this.formData.maxAmount().trim()&&t.numberRange(this.formData.maxAmount(),0,void 0,"maxAmount",s.translator.trans("withdrawal.admin.deposit.platforms.max_amount")),this.formData.minAmount()&&this.formData.maxAmount()){const a=parseFloat(this.formData.minAmount()),r=parseFloat(this.formData.maxAmount());!isNaN(a)&&!isNaN(r)&&r<a&&t.addError("maxAmount",s.translator.trans("withdrawal.admin.platforms.max_min_error"))}return this.formData.iconUrl()&&this.formData.iconUrl().trim()&&t.url(this.formData.iconUrl(),"iconUrl",s.translator.trans("withdrawal.admin.deposit.platforms.icon_url")),this.formData.qrCodeImageUrl()&&this.formData.qrCodeImageUrl().trim()&&t.url(this.formData.qrCodeImageUrl(),"qrCodeImageUrl",s.translator.trans("withdrawal.admin.deposit.platforms.qr_code_image_url")),t.isValid()}catch(a){return a instanceof Error&&s.alerts.show({type:"error",dismissible:!0},a.message),!1}}async handleSubmit(t){if(t.submitting||!this.validateForm())return;const a={name:this.formData.name(),symbol:this.formData.symbol(),network:this.formData.network(),networkTypeId:this.formData.networkTypeId(),minAmount:this.formData.minAmount(),maxAmount:this.formData.maxAmount(),address:this.formData.address(),qrCodeImageUrl:this.formData.qrCodeImageUrl(),iconUrl:this.formData.iconUrl(),iconClass:this.formData.iconClass(),warningText:this.formData.warningText(),isActive:this.formData.isActive()};try{await t.onSubmit(a),Object.keys(this.formData).forEach(r=>{r==="isActive"?this.formData[r](!0):r==="networkTypeId"?this.formData[r](null):this.formData[r]("")}),t.onCancel()}catch(r){console.error("Form submission error:",r)}}}class E extends v{view(t){const{transaction:a,showActions:r,onUpdateStatus:n}=t.attrs;return m("div",{className:"DepositTransactionItem"},m("div",{className:"DepositTransactionItem-header"},m("div",{className:"DepositTransactionItem-user"},m("strong",null,B(a.user)),m("span",{className:"DepositTransactionItem-time"},k(a.createdAt))),m("div",{className:"DepositTransactionItem-amount"},m("span",{className:"DepositTransactionItem-amountValue"},a.amount," ",a.platform.symbol),m("div",{className:`DepositTransactionItem-status status-${a.statusColor}`},this.getStatusIcon(a.status),this.getStatusText(a.status)))),m("div",{className:"DepositTransactionItem-details"},m("div",{className:"DepositTransactionItem-platform"},m("span",{className:"DepositTransactionItem-label"},"Platform:"),m("span",null,a.platform.name," (",a.platform.network,")")),a.transactionHash&&m("div",{className:"DepositTransactionItem-hash"},m("span",{className:"DepositTransactionItem-label"},"Hash:"),a.explorerUrl?m("a",{href:a.explorerUrl,target:"_blank",rel:"noopener noreferrer",className:"DepositTransactionItem-hashLink"},this.formatHash(a.transactionHash),A("fas fa-external-link-alt")):m("span",{className:"DepositTransactionItem-hashText"},this.formatHash(a.transactionHash))),a.fromAddress&&m("div",{className:"DepositTransactionItem-fromAddress"},m("span",{className:"DepositTransactionItem-label"},"From:"),m("span",{className:"DepositTransactionItem-address"},this.formatHash(a.fromAddress))),a.confirmations!==void 0&&m("div",{className:"DepositTransactionItem-confirmations"},m("span",{className:"DepositTransactionItem-label"},"Confirmations:"),m("span",null,a.confirmations,"/",a.requiredConfirmations,a.hasEnoughConfirmations&&m("span",{className:"DepositTransactionItem-confirmed"}," âœ“"))),a.adminNotes&&m("div",{className:"DepositTransactionItem-notes"},m("span",{className:"DepositTransactionItem-label"},"Notes:"),m("span",null,a.adminNotes))),r&&this.renderActions(a,n))}renderActions(t,a){const r=[];return t.status==="pending"&&r.push(m(h,{key:"confirm",className:"Button Button--primary Button--sm",onclick:()=>a("confirmed")},s.translator.trans("withdrawal.admin.deposit.transactions.confirm"))),t.status==="confirmed"&&t.canBeCompleted&&r.push(m(h,{key:"complete",className:"Button Button--success Button--sm",onclick:()=>a("completed")},s.translator.trans("withdrawal.admin.deposit.transactions.complete"))),(t.status==="pending"||t.status==="confirmed")&&r.push(m(h,{key:"reject",className:"Button Button--danger Button--sm",onclick:()=>a("failed")},s.translator.trans("withdrawal.admin.deposit.transactions.reject"))),r.length>0?m("div",{className:"DepositTransactionItem-actions"},r):null}getStatusIcon(t){switch(t){case"pending":return A("fas fa-clock");case"confirmed":return A("fas fa-check-circle");case"completed":return A("fas fa-check-double");case"failed":return A("fas fa-times-circle");case"cancelled":return A("fas fa-ban");default:return A("fas fa-question-circle")}}getStatusText(t){switch(t){case"pending":return s.translator.trans("withdrawal.admin.deposit.transactions.status.pending");case"confirmed":return s.translator.trans("withdrawal.admin.deposit.transactions.status.confirmed");case"completed":return s.translator.trans("withdrawal.admin.deposit.transactions.status.completed");case"failed":return s.translator.trans("withdrawal.admin.deposit.transactions.status.failed");case"cancelled":return s.translator.trans("withdrawal.admin.deposit.transactions.status.cancelled");default:return t}}formatHash(t){return t.length<=16?t:`${t.substring(0,8)}...${t.substring(t.length-8)}`}}class J extends v{constructor(){super(...arguments),this.showPlatformForm=!1,this.activeTransactionTab="pending"}view(t){const{platforms:a,transactions:r,submittingPlatform:n,onAddPlatform:o,onTogglePlatformStatus:l,onDeletePlatform:g,onUpdateTransactionStatus:p}=t.attrs,b=r.filter(c=>c.status==="pending"||c.status==="confirmed"),y=r.filter(c=>c.status==="completed"||c.status==="failed"||c.status==="cancelled");return m("div",{className:"DepositManagementSection"},m("div",{className:"Form-group"},m("h3",null,s.translator.trans("withdrawal.admin.deposit.platforms.title")),m("div",{className:"DepositPlatforms"},m("div",{className:"DepositPlatforms-header"},m(h,{className:"Button Button--primary",onclick:()=>{this.showPlatformForm=!this.showPlatformForm}},s.translator.trans("withdrawal.admin.deposit.platforms.add_button"))),this.showPlatformForm&&m(j,{submitting:n,onSubmit:o,onCancel:()=>{this.showPlatformForm=!1}}),m("div",{className:"DepositPlatforms-list"},a.length===0?m("p",{className:"DepositPlatforms-empty"},s.translator.trans("withdrawal.admin.deposit.platforms.empty")):a.map(c=>m(U,{key:c.id,platform:c,type:"deposit",style:"list",onToggleStatus:()=>l(c),onDelete:()=>g(c)}))))),m("div",{className:"Form-group"},m("h3",null,s.translator.trans("withdrawal.admin.deposit.transactions.title")),m("div",{className:"DepositTransactions"},m("div",{className:"DepositTransactions-tabs"},m("button",{className:`DepositTransactions-tab ${this.activeTransactionTab==="pending"?"active":""}`,onclick:()=>{this.activeTransactionTab="pending"}},s.translator.trans("withdrawal.admin.deposit.transactions.pending_title")," (",b.length,")"),m("button",{className:`DepositTransactions-tab ${this.activeTransactionTab==="completed"?"active":""}`,onclick:()=>{this.activeTransactionTab="completed"}},s.translator.trans("withdrawal.admin.deposit.transactions.completed_title")," (",y.length,")")),m("div",{className:"DepositTransactions-content"},this.activeTransactionTab==="pending"?m("div",{className:"DepositTransactions-pending"},b.length===0?m("p",{className:"DepositTransactions-empty"},s.translator.trans("withdrawal.admin.deposit.transactions.no_pending")):b.map(c=>m(E,{key:c.id,transaction:c,onUpdateStatus:N=>p(c,N),showActions:!0}))):m("div",{className:"DepositTransactions-completed"},y.length===0?m("p",{className:"DepositTransactions-empty"},s.translator.trans("withdrawal.admin.deposit.transactions.no_completed")):y.map(c=>m(E,{key:c.id,transaction:c,onUpdateStatus:N=>p(c,N),showActions:!1})))))))}}class z extends v{constructor(){super(...arguments),this.editing=!1,this.submitting=!1,this.formData={}}oninit(t){super.oninit(t),this.initFormData(t.attrs.networkType)}view(t){const{networkType:a}=t.attrs;return e("div",{className:"NetworkTypeListItem"},e("div",{className:"item-header"},e("div",{className:"item-info"},e("div",{className:"item-icon"},a.iconClass()?e("i",{className:a.iconClass()}):a.iconUrl()?e("img",{src:a.iconUrl(),alt:a.name(),style:"width: 24px; height: 24px;"}):e("i",{className:"fas fa-network-wired"})),e("div",{className:"item-details"},e("h4",null,a.name()),e("span",{className:"code"},a.code()),a.description()&&e("p",{className:"description"},a.description()))),e("div",{className:"item-actions"},e(h,{className:"Button Button--link",icon:"fas fa-edit",onclick:()=>this.toggleEdit(),disabled:this.submitting},this.editing?s.translator.trans("core.admin.basics.cancel_button"):s.translator.trans("core.admin.edit")),e(h,{className:"Button Button--link text-danger",icon:"fas fa-trash",onclick:()=>t.attrs.onDelete(a),disabled:this.submitting},s.translator.trans("core.admin.delete")))),this.editing&&e("div",{className:"item-edit-form"},e("div",{className:"Form"},e("div",{className:"Form-row"},e("div",{className:"Form-group"},e("label",null,"Name"),e("input",{type:"text",className:"FormControl",bidi:this.formData.name,disabled:this.submitting})),e("div",{className:"Form-group"},e("label",null,"Code"),e("input",{type:"text",className:"FormControl",bidi:this.formData.code,disabled:this.submitting}))),e("div",{className:"Form-group"},e("label",null,"Description"),e("textarea",{className:"FormControl",rows:2,bidi:this.formData.description,disabled:this.submitting})),e("div",{className:"Form-row"},e("div",{className:"Form-group"},e("label",null,"Icon URL"),e("input",{type:"url",className:"FormControl",bidi:this.formData.iconUrl,disabled:this.submitting})),e("div",{className:"Form-group"},e("label",null,"Icon Class"),e("input",{type:"text",className:"FormControl",bidi:this.formData.iconClass,disabled:this.submitting}))),e("div",{className:"Form-group"},e("label",null,"Sort Order"),e("input",{type:"number",min:"0",className:"FormControl",bidi:this.formData.sortOrder,disabled:this.submitting})),e("div",{className:"Form-group"},e(P,{state:this.formData.isActive(),onchange:this.formData.isActive,disabled:this.submitting},"Active")),e("div",{className:"Form-actions"},e(h,{className:"Button Button--primary",loading:this.submitting,onclick:this.handleSave.bind(this,t.attrs)},s.translator.trans("core.admin.basics.save_changes_button")),e(h,{className:"Button",onclick:()=>this.toggleEdit(),disabled:this.submitting},s.translator.trans("core.admin.basics.cancel_button"))))))}initFormData(t){this.formData={name:u(t.name()||""),code:u(t.code()||""),description:u(t.description()||""),iconUrl:u(t.iconUrl()||""),iconClass:u(t.iconClass()||""),isActive:u(t.isActive()??!0),sortOrder:u(String(t.sortOrder()||0))}}toggleEdit(){this.editing=!this.editing,this.editing||this.initFormData(this.attrs.networkType),e.redraw()}async handleSave(t){this.submitting=!0,e.redraw();const a={name:this.formData.name(),code:this.formData.code().toUpperCase(),description:this.formData.description()||null,iconUrl:this.formData.iconUrl()||null,iconClass:this.formData.iconClass()||null,isActive:this.formData.isActive(),sortOrder:parseInt(this.formData.sortOrder())||0};try{await t.onUpdate(t.networkType,a),this.editing=!1}catch{}finally{this.submitting=!1,e.redraw()}}}class K extends v{constructor(){super(...arguments),this.formData={name:u(""),code:u(""),description:u(""),iconUrl:u(""),iconClass:u(""),isActive:u(!0),sortOrder:u("0")}}view(t){const{submitting:a,onCancel:r}=t.attrs;return m("div",{className:"AddNetworkTypeForm"},m("div",{className:"Form"},m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.network_types.name"),m("span",{className:"Form-required"},"*")),m("input",{type:"text",className:"FormControl",placeholder:"e.g., TRON (TRC20)",bidi:this.formData.name,disabled:a})),m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.network_types.code"),m("span",{className:"Form-required"},"*")),m("input",{type:"text",className:"FormControl",placeholder:"e.g., TRC20",bidi:this.formData.code,disabled:a}))),m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.network_types.description")),m("textarea",{className:"FormControl",rows:3,placeholder:"Optional description of the network",bidi:this.formData.description,disabled:a})),m("div",{className:"Form-row"},m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.network_types.icon_url")),m("input",{type:"url",className:"FormControl",placeholder:"https://example.com/icon.png",bidi:this.formData.iconUrl,disabled:a})),m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.network_types.icon_class")),m("input",{type:"text",className:"FormControl",placeholder:"fab fa-tron",bidi:this.formData.iconClass,disabled:a}))),m("div",{className:"Form-group"},m("label",null,s.translator.trans("withdrawal.admin.network_types.sort_order")),m("input",{type:"number",min:"0",className:"FormControl",placeholder:"0",bidi:this.formData.sortOrder,disabled:a})),m("div",{className:"Form-group"},m(P,{state:this.formData.isActive(),onchange:this.formData.isActive,disabled:a},s.translator.trans("withdrawal.admin.network_types.is_active"))),m("div",{className:"Form-actions"},m(h,{className:"Button Button--primary",type:"submit",loading:a,onclick:this.handleSubmit.bind(this,t.attrs)},s.translator.trans("withdrawal.admin.network_types.add_button")),m(h,{className:"Button",onclick:r,disabled:a},s.translator.trans("core.admin.basics.cancel_button")))))}async handleSubmit(t){if(!this.formData.name()||!this.formData.code()){s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.network_types.required_fields_error"));return}const a={name:this.formData.name(),code:this.formData.code().toUpperCase(),description:this.formData.description(),iconUrl:this.formData.iconUrl(),iconClass:this.formData.iconClass(),isActive:this.formData.isActive(),sortOrder:parseInt(this.formData.sortOrder())||0};try{await t.onSubmit(a),Object.keys(this.formData).forEach(r=>{r==="isActive"?this.formData[r](!0):r==="sortOrder"?this.formData[r]("0"):this.formData[r]("")}),t.onCancel()}catch(r){console.error("Form submission error:",r)}}}class Y extends v{constructor(){super(...arguments),this.networkTypes=[],this.loading=!1,this.showAddForm=!1}oninit(t){super.oninit(t),this.loadNetworkTypes()}view(){return m("div",{className:"NetworkTypeManagementSection"},m("div",{className:"section-header"},m("h3",null,s.translator.trans("withdrawal.admin.network_types.title")),m(h,{className:"Button Button--primary",icon:"fas fa-plus",onclick:()=>this.toggleAddForm()},s.translator.trans("withdrawal.admin.network_types.add_button"))),this.showAddForm&&m("div",{className:"section-content"},m(K,{submitting:this.loading,onSubmit:this.handleAddNetworkType.bind(this),onCancel:()=>this.toggleAddForm()})),m("div",{className:"section-content"},this.loading&&!this.networkTypes.length?m(C,null):this.networkTypes.length===0?m("div",{className:"empty-state"},m("p",null,s.translator.trans("withdrawal.admin.network_types.empty"))):m("div",{className:"network-types-list"},this.networkTypes.map(t=>m(z,{key:t.id(),networkType:t,onUpdate:this.handleUpdateNetworkType.bind(this),onDelete:this.handleDeleteNetworkType.bind(this)})))))}toggleAddForm(){this.showAddForm=!this.showAddForm,m.redraw()}async loadNetworkTypes(){this.loading=!0,m.redraw();try{const t=await s.request({method:"GET",url:s.forum.attribute("apiUrl")+"/network-types"});s.store.pushPayload(t),this.networkTypes=s.store.all("network-types")}catch(t){console.error("Failed to load network types:",t),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.network_types.load_error"))}finally{this.loading=!1,m.redraw()}}async handleAddNetworkType(t){this.loading=!0,m.redraw();try{const a=await s.request({method:"POST",url:s.forum.attribute("apiUrl")+"/network-types",body:{data:{type:"network-types",attributes:t}}});s.store.pushPayload(a),this.networkTypes=s.store.all("network-types"),this.showAddForm=!1,s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.network_types.created"))}catch(a){throw console.error("Failed to create network type:",a),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.network_types.create_error")),a}finally{this.loading=!1,m.redraw()}}async handleUpdateNetworkType(t,a){try{const r=await s.request({method:"PATCH",url:s.forum.attribute("apiUrl")+"/network-types/"+t.id(),body:{data:{type:"network-types",id:t.id(),attributes:a}}});s.store.pushPayload(r),m.redraw(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.network_types.updated"))}catch(r){console.error("Failed to update network type:",r),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.network_types.update_error"))}}async handleDeleteNetworkType(t){if(confirm(s.translator.trans("withdrawal.admin.network_types.delete_confirm")))try{await s.request({method:"DELETE",url:s.forum.attribute("apiUrl")+"/network-types/"+t.id()}),this.networkTypes=this.networkTypes.filter(a=>a.id()!==t.id()),s.store.remove(t),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.network_types.deleted"))}catch(a){console.error("Failed to delete network type:",a);let r=s.translator.trans("withdrawal.admin.network_types.delete_error");a.responseJSON?.errors?.[0]?.detail&&(r=a.responseJSON.errors[0].detail),s.alerts.show({type:"error",dismissible:!0},r)}finally{m.redraw()}}}class _ extends O{className(){return"ConfirmModal"}title(){const{title:t,dangerous:a=!1,icon:r=a?"fas fa-exclamation-triangle":"fas fa-question-circle"}=this.attrs;return m("span",null,r&&m("span",{className:`ConfirmModal-icon ${a?"dangerous":""}`},A(r)),t)}content(){const{message:t,confirmText:a="Confirm",cancelText:r="Cancel",onConfirm:n,onCancel:o,dangerous:l=!1}=this.attrs;return m("div",{className:"Modal-body"},m("div",{className:"ConfirmModal-message"},t),m("div",{className:"Form-group"},m("div",{className:"ButtonGroup"},m(h,{className:"Button",onclick:()=>{o(),this.hide()}},r),m(h,{className:`Button Button--${l?"danger":"primary"}`,onclick:()=>{n(),this.hide()}},a))))}}const Q=3e4,X={"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"};function Z(d){const{method:t,endpoint:a,body:r,params:n,headers:o,timeout:l}=d,g=a.startsWith("http")?a:`${w.forum.attribute("apiUrl")}${a}`,p={method:t,url:g,headers:{...X,...o},timeout:l||Q};if(r&&(t==="POST"||t==="PATCH"||t==="PUT")&&(p.body=r),n&&t==="GET"){const b=new URLSearchParams;Object.entries(n).forEach(([y,c])=>{c!=null&&b.append(y,String(c))}),p.url+=`?${b.toString()}`}return p}function M(d){if(d.name==="TypeError"||d.message==="Failed to fetch")return{message:w.translator.trans("core.lib.error.network_error"),status:0};if(d&&d.response)try{const t=typeof d.response=="string"?JSON.parse(d.response):d.response;if(t.errors&&Array.isArray(t.errors))return{message:t.errors[0].detail||"API error occurred",errors:t.errors,status:d.status}}catch{if(d.response.includes("<b>Fatal error</b>")||d.response.includes("<!DOCTYPE"))return{message:w.translator.trans("core.lib.error.generic_error"),status:d.status||500}}return d instanceof Error?{message:d.message,status:d.status}:{message:w.translator.trans("core.lib.error.generic_error"),status:500}}async function R(d,t={}){const{showSuccessAlert:a=!1,showErrorAlert:r=!0,successMessage:n,errorMessage:o,validateResponse:l,transformResponse:g,onSuccess:p,onError:b}=t;try{const y=Z(d),c=await w.request(y);if(l&&!l(c))throw new Error("Response validation failed");const N=g?g(c):c;return a&&n&&w.alerts.show({type:"success",dismissible:!0},n),p&&p(N),N}catch(y){const c=M(y);if(b&&b(c),r){const N=o||c.message||"An error occurred";w.alerts.show({type:"error",dismissible:!0},N)}throw c}}async function S(d,t,a={}){return R({method:"GET",endpoint:d,params:t},a)}async function $(d,t,a={}){return R({method:"POST",endpoint:d,body:t},a)}const F={PlatformAPI:{async loadWithdrawalPlatforms(d){return S("/withdrawal-platforms",d,{errorMessage:w.translator.trans("withdrawal.admin.platforms.load_error"),transformResponse:t=>(w.store.pushPayload(t),w.store.all("withdrawal-platforms"))})},async createWithdrawalPlatform(d){return $("/withdrawal-platforms",{data:d},{showSuccessAlert:!0,successMessage:w.translator.trans("withdrawal.admin.platforms.add_success"),errorMessage:w.translator.trans("withdrawal.admin.platforms.add_error"),onSuccess:t=>{w.store.pushPayload(t)}})}},RequestAPI:{async loadWithdrawalRequests(d){return S("/withdrawal-requests",{include:"user,platform",...d},{errorMessage:w.translator.trans("withdrawal.admin.requests.load_error"),transformResponse:t=>(w.store.pushPayload(t),Array.isArray(t.data)?t.data.filter(a=>a!==null):t.data?[t.data]:[])})}}};class tt extends L{constructor(){super(...arguments),this.platforms=[],this.requests=[],this.depositPlatforms=[],this.depositTransactions=[],this.users={},this.loading=!0,this.submittingPlatform=!1,this.activeTab="withdrawals"}oninit(t){super.oninit(t),this.loadData()}content(){return this.loading?e(C,null):e("div",{className:"WithdrawalManagementPage"},e("div",{className:"container"},e("h2",null,s.translator.trans("withdrawal.admin.page.title")),e(W,{onSettingChange:this.saveSetting.bind(this)}),e("div",{className:"AdminTabs"},e("div",{className:"AdminTabs-nav"},e("button",{className:`AdminTabs-tab ${this.activeTab==="withdrawals"?"active":""}`,onclick:()=>{this.activeTab="withdrawals"}},s.translator.trans("withdrawal.admin.tabs.withdrawals")),e("button",{className:`AdminTabs-tab ${this.activeTab==="deposits"?"active":""}`,onclick:()=>{this.activeTab="deposits"}},s.translator.trans("withdrawal.admin.tabs.deposits")),e("button",{className:`AdminTabs-tab ${this.activeTab==="network-types"?"active":""}`,onclick:()=>{this.activeTab="network-types"}},s.translator.trans("withdrawal.admin.tabs.network_types"))),e("div",{className:"AdminTabs-content"},this.activeTab==="withdrawals"?e("div",null,e(H,{platforms:this.platforms,submittingPlatform:this.submittingPlatform,onAddPlatform:this.addPlatform.bind(this),onTogglePlatformStatus:this.togglePlatformStatus.bind(this),onDeletePlatform:this.deletePlatform.bind(this)}),e(G,{requests:this.requests,onUpdateRequestStatus:this.updateRequestStatus.bind(this),onDeleteRequest:this.deleteRequest.bind(this)})):this.activeTab==="deposits"?e(J,{platforms:this.depositPlatforms,transactions:this.depositTransactions,submittingPlatform:this.submittingPlatform,onAddPlatform:this.addDepositPlatform.bind(this),onTogglePlatformStatus:this.toggleDepositPlatformStatus.bind(this),onDeletePlatform:this.deleteDepositPlatform.bind(this),onUpdateTransactionStatus:this.updateDepositTransactionStatus.bind(this)}):this.activeTab==="network-types"?e(Y,null):null))))}async addPlatform(t){if(!this.submittingPlatform){this.submittingPlatform=!0;try{const a={type:"withdrawal-platforms",attributes:{name:t.name,symbol:t.symbol,network:t.network||null,minAmount:parseFloat(t.minAmount),maxAmount:parseFloat(t.maxAmount),fee:parseFloat(t.fee||"0"),iconUrl:t.iconUrl||null,iconClass:t.iconClass||null,isActive:!0}};await F.PlatformAPI.createWithdrawalPlatform(a),await this.loadPlatforms()}catch(a){console.error("Error adding platform:",a)}finally{this.submittingPlatform=!1,e.redraw()}}}async togglePlatformStatus(t){try{const a=typeof t.id=="function"?t.id():t.id,r=(typeof t.isActive=="function"?t.isActive():t.attributes?.isActive)??!1,n=s.store.getById("withdrawal-platforms",a);n&&(await n.save({isActive:!r}),await this.loadPlatforms(),e.redraw(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans(`withdrawal.admin.platforms.${r?"disable":"enable"}_success`)))}catch(a){console.error("Error toggling platform status:",a),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.platforms.toggle_error"))}}deletePlatform(t){const a=(typeof t.name=="function"?t.name():t.attributes?.name)||"Unknown Platform";s.modal.show(_,{title:s.translator.trans("withdrawal.admin.platforms.delete_confirm_title"),message:s.translator.trans("withdrawal.admin.platforms.delete_confirm_message",{name:a}),confirmText:s.translator.trans("withdrawal.admin.platforms.delete_confirm_button"),cancelText:s.translator.trans("withdrawal.admin.platforms.delete_cancel_button"),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{try{const r=typeof t.id=="function"?t.id():t.id,n=s.store.getById("withdrawal-platforms",r);n&&(await n.delete(),await this.loadPlatforms(),e.redraw(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.platforms.delete_success")))}catch(r){console.error("Error deleting platform:",r),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.platforms.delete_error"))}},onCancel:()=>{s.modal.close()}})}async updateRequestStatus(t,a){try{const r=typeof t.id=="function"?t.id():t.id,n=s.store.getById("withdrawal-requests",r);n&&(await n.save({status:a}),await this.loadRequests(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans(`withdrawal.admin.requests.${a}_success`)))}catch(r){console.error("Error updating request:",r),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.requests.update_error"))}}deleteRequest(t){const a=typeof t.id=="function"?t.id():t.id,r=typeof t.amount=="function"?t.amount():t.attributes?.amount||0;let n="Unknown User";if(typeof t.user=="function"){const o=t.user();o&&typeof o.displayName=="function"?n=o.displayName():o&&o.attributes?.displayName&&(n=o.attributes.displayName)}s.modal.show(_,{title:s.translator.trans("withdrawal.admin.requests.delete_confirm_title"),message:s.translator.trans("withdrawal.admin.requests.delete_confirm_message",{info:`${n} - ${r}`}),confirmText:s.translator.trans("withdrawal.admin.requests.delete_confirm_button"),cancelText:s.translator.trans("withdrawal.admin.requests.delete_cancel_button"),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{try{const o=s.store.getById("withdrawal-requests",a);o&&(await o.delete(),await this.loadRequests(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.requests.delete_success")))}catch(o){console.error("Error deleting request:",o),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.requests.delete_error"))}},onCancel:()=>{s.modal.close()}})}async loadData(){try{await this.loadPlatforms(),await this.loadRequests(),await this.loadDepositPlatforms(),await this.loadDepositTransactions()}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,e.redraw()}}async loadPlatforms(){try{this.platforms=await F.PlatformAPI.loadWithdrawalPlatforms(),console.log("Loaded platforms:",this.platforms)}catch(t){console.error("Error loading platforms:",t),this.platforms=[]}}async loadRequests(){try{this.requests=await F.RequestAPI.loadWithdrawalRequests(),console.log("Loaded requests:",this.requests)}catch(r){console.error("Error loading requests:",r),this.requests=[]}if(this.requests.length===0)return;const a=[...new Set(this.requests.map(r=>{const n=r?.data?.relationships?.user?.data||r?.relationships?.user?.data;return n?n.id:null}).filter(r=>r!=null))].filter(r=>!this.users[r]);if(a.length>0)try{const r=a.map(o=>s.store.find("users",o).catch(l=>(console.error(`Error loading user ${o}:`,l),null))),n=await Promise.all(r);a.forEach((o,l)=>{n[l]&&(this.users[o]=n[l])})}catch(r){console.error("Error loading users:",r)}}async saveSetting(t,a){try{await s.request({method:"POST",url:s.forum.attribute("apiUrl")+"/settings",body:{[t]:a}}),s.forum.pushAttributes({[t]:a})}catch(r){console.error("Error saving setting:",r),s.alerts.show({type:"error",dismissible:!0},"Failed to save setting")}}async addDepositPlatform(t){if(!this.submittingPlatform){this.submittingPlatform=!0;try{const a=await s.request({method:"POST",url:s.forum.attribute("apiUrl")+"/deposit-platforms",body:{data:{type:"deposit-platforms",attributes:{name:t.name,symbol:t.symbol,network:t.network,minAmount:parseFloat(t.minAmount)||0,maxAmount:t.maxAmount?parseFloat(t.maxAmount):null,address:t.address||null,qrCodeImageUrl:t.qrCodeImageUrl||null,iconUrl:t.iconUrl||null,iconClass:t.iconClass||null,warningText:t.warningText||null,isActive:t.isActive}}}});a&&a.data&&s.store.pushPayload(a),await this.loadDepositPlatforms(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.platforms.add_success"))}catch(a){console.error("Error adding deposit platform:",a),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.platforms.add_error"))}finally{this.submittingPlatform=!1}}}async toggleDepositPlatformStatus(t){try{const a=await s.request({method:"PATCH",url:`${s.forum.attribute("apiUrl")}/deposit-platforms/${t.id}`,body:{data:{type:"deposit-platforms",attributes:{isActive:!t.isActive}}}});a&&a.data&&s.store.pushPayload(a),await this.loadDepositPlatforms();const r=t.isActive?"disable_success":"enable_success";s.alerts.show({type:"success",dismissible:!0},s.translator.trans(`withdrawal.admin.deposit.platforms.${r}`))}catch(a){console.error("Error toggling platform status:",a),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.platforms.toggle_error"))}}deleteDepositPlatform(t){s.modal.show(_,{title:s.translator.trans("withdrawal.admin.platforms.delete_confirm_title"),message:s.translator.trans("withdrawal.admin.platforms.delete_confirm_message",{name:t.name()}),confirmText:s.translator.trans("withdrawal.admin.platforms.delete_confirm_button"),cancelText:s.translator.trans("withdrawal.admin.platforms.delete_cancel_button"),dangerous:!0,icon:"fas fa-trash",onConfirm:async()=>{try{await s.request({method:"DELETE",url:`${s.forum.attribute("apiUrl")}/deposit-platforms/${t.id()}`}),await this.loadDepositPlatforms(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.platforms.delete_success"))}catch(a){console.error("Error deleting deposit platform:",a),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.platforms.delete_error"))}},onCancel:()=>{s.modal.close()}})}async updateDepositTransactionStatus(t,a){try{const r=await s.request({method:"PATCH",url:`${s.forum.attribute("apiUrl")}/deposit-transactions/${t.id}`,body:{data:{type:"deposit-transactions",attributes:{status:a}}}});r&&r.data&&s.store.pushPayload(r),await this.loadDepositTransactions(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans(`withdrawal.admin.deposit.transactions.${a}_success`))}catch(r){console.error("Error updating deposit transaction:",r),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.admin.deposit.transactions.update_error"))}}async loadDepositPlatforms(){try{const t=await s.request({method:"GET",url:s.forum.attribute("apiUrl")+"/deposit-platforms"});s.store.pushPayload(t),this.depositPlatforms=s.store.all("deposit-platforms"),console.log("Loaded deposit platforms:",this.depositPlatforms)}catch(t){console.error("Error loading deposit platforms:",t),this.depositPlatforms=[]}}async loadDepositTransactions(){try{const t=await s.request({method:"GET",url:s.forum.attribute("apiUrl")+"/deposit-transactions"});s.store.pushPayload(t),this.depositTransactions=s.store.all("deposit-transactions"),console.log("Loaded deposit transactions:",this.depositTransactions)}catch(t){console.error("Error loading deposit transactions:",t),this.depositTransactions=[]}}}class st extends i{constructor(){super(...arguments),this.name=i.attribute("name"),this.symbol=i.attribute("symbol"),this.network=i.attribute("network"),this.displayName=i.attribute("displayName"),this.minAmount=i.attribute("minAmount"),this.maxAmount=i.attribute("maxAmount"),this.fee=i.attribute("fee"),this.iconUrl=i.attribute("iconUrl"),this.iconClass=i.attribute("iconClass"),this.isActive=i.attribute("isActive"),this.createdAt=i.attribute("createdAt",i.transformDate),this.updatedAt=i.attribute("updatedAt",i.transformDate)}apiEndpoint(){return`/withdrawal-platforms/${this.id()}`}getDisplayName(){return this.displayName()||this.name()}isValidAmount(t){const a=this.minAmount(),r=this.maxAmount();return t>=a&&t<=r}getTotalCost(t){return t+this.fee()}}const T={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class at extends i{constructor(){super(...arguments),this.amount=i.attribute("amount"),this.accountDetails=i.attribute("accountDetails"),this.message=i.attribute("message"),this.status=i.attribute("status"),this.platformId=i.attribute("platformId"),this.userId=i.attribute("userId"),this.createdAt=i.attribute("createdAt",i.transformDate),this.updatedAt=i.attribute("updatedAt",i.transformDate),this.user=i.hasOne("user"),this.platform=i.hasOne("platform")}apiEndpoint(){return`/withdrawal-requests/${this.id()}`}isPending(){return this.status()===T.PENDING}isApproved(){return this.status()===T.APPROVED}isRejected(){return this.status()===T.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const t=this.status();return app.translator.trans(`withdrawal.forum.status.${t}`)}statusColor(){switch(this.status()){case T.APPROVED:return"success";case T.REJECTED:return"danger";case T.PENDING:default:return"warning"}}}class et extends i{constructor(){super(...arguments),this.name=i.attribute("name"),this.symbol=i.attribute("symbol"),this.network=i.attribute("network"),this.networkTypeId=i.attribute("networkTypeId"),this.displayName=i.attribute("displayName"),this.minAmount=i.attribute("minAmount"),this.maxAmount=i.attribute("maxAmount"),this.address=i.attribute("address"),this.qrCodeImageUrl=i.attribute("qrCodeImageUrl"),this.iconUrl=i.attribute("iconUrl"),this.iconClass=i.attribute("iconClass"),this.warningText=i.attribute("warningText"),this.networkConfig=i.attribute("networkConfig"),this.isActive=i.attribute("isActive"),this.createdAt=i.attribute("createdAt",i.transformDate),this.updatedAt=i.attribute("updatedAt",i.transformDate)}}class rt extends i{constructor(){super(...arguments),this.amount=i.attribute("amount"),this.fee=i.attribute("fee"),this.creditedAmount=i.attribute("creditedAmount"),this.transactionHash=i.attribute("transactionHash"),this.fromAddress=i.attribute("fromAddress"),this.memo=i.attribute("memo"),this.userMessage=i.attribute("userMessage"),this.status=i.attribute("status"),this.statusColor=i.attribute("statusColor"),this.blockchainData=i.attribute("blockchainData"),this.confirmations=i.attribute("confirmations"),this.requiredConfirmations=i.attribute("requiredConfirmations"),this.hasEnoughConfirmations=i.attribute("hasEnoughConfirmations"),this.canBeCompleted=i.attribute("canBeCompleted"),this.explorerUrl=i.attribute("explorerUrl"),this.detectedAt=i.attribute("detectedAt",i.transformDate),this.confirmedAt=i.attribute("confirmedAt",i.transformDate),this.completedAt=i.attribute("completedAt",i.transformDate),this.adminNotes=i.attribute("adminNotes"),this.createdAt=i.attribute("createdAt",i.transformDate),this.updatedAt=i.attribute("updatedAt",i.transformDate),this.user=i.hasOne("user"),this.platform=i.hasOne("platform"),this.depositAddress=i.hasOne("depositAddress"),this.processedBy=i.hasOne("processedBy")}}class it extends i{constructor(){super(...arguments),this.id=i.attribute("id"),this.name=i.attribute("name"),this.code=i.attribute("code"),this.description=i.attribute("description"),this.iconUrl=i.attribute("iconUrl"),this.iconClass=i.attribute("iconClass"),this.config=i.attribute("config"),this.isActive=i.attribute("isActive"),this.sortOrder=i.attribute("sortOrder"),this.createdAt=i.attribute("createdAt",i.transformDate),this.updatedAt=i.attribute("updatedAt",i.transformDate)}}s.initializers.add("wusong8899-withdrawal",()=>{s.store.models["withdrawal-platforms"]=st,s.store.models["withdrawal-requests"]=at,s.store.models["deposit-platforms"]=et,s.store.models["deposit-transactions"]=rt,s.store.models["network-types"]=it,s.extensionData.for("wusong8899-withdrawal").registerPage(tt)})})(flarum.core.compat["admin/app"],flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/components/LoadingIndicator"],m,flarum.core.compat["common/Component"],flarum.core.compat["common/utils/withAttr"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/app"],flarum.core.compat["common/components/Switch"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/helpers/icon"],flarum.core.compat["common/helpers/username"],flarum.core.compat["common/components/Modal"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=admin.js.map

module.exports={};