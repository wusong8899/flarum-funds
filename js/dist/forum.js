(function(s,w,g,b,P,u,N,c,r,e){"use strict";class p extends P{constructor(){super(...arguments),this.platforms=[],this.requests=[],this.loading=!0,this.submitting=!1,this.loadingBalance=!0,this.userBalance=0,this.showDropdown=!1,this.amount=c(""),this.selectedPlatform=c(null),this.accountDetails=c(""),this.saveAddress=c(!1)}oninit(a){super.oninit(a),s.setTitle(s.translator.trans("withdrawal.forum.page.title")),this.loadData(),this.loadUserBalance()}view(){return this.loading?m("div",{className:"WithdrawalPage"},m("div",{className:"WithdrawalPage-loading"},m(N,null))):(this.platforms||[]).filter(t=>!!t).length===0?m("div",{className:"WithdrawalPage"},m("div",{className:"WithdrawalPage-modal"},m("div",{className:"WithdrawalPage-header"},m("div",{className:"WithdrawalPage-tabs"},m("div",{className:"WithdrawalPage-tab active"},s.translator.trans("withdrawal.forum.tabs.withdrawal"))),m("button",{className:"WithdrawalPage-close",onclick:()=>s.history.back()},r("fas fa-times"))),m("div",{className:"WithdrawalPage-content"},m("div",{className:"WithdrawalPage-emptyState"},m("div",{className:"WithdrawalPage-emptyIcon"},r("fas fa-coins")),m("h3",{className:"WithdrawalPage-emptyTitle"},s.translator.trans("withdrawal.forum.no_platforms")),m("p",{className:"WithdrawalPage-emptyDescription"},s.translator.trans("withdrawal.forum.no_platforms_description")))))):m("div",{className:"WithdrawalPage"},m("div",{className:"WithdrawalPage-modal"},m("div",{className:"WithdrawalPage-header"},m("div",{className:"WithdrawalPage-tabs"},m("div",{className:"WithdrawalPage-tab active"},s.translator.trans("withdrawal.forum.tabs.withdrawal"))),m("button",{className:"WithdrawalPage-close",onclick:()=>window.history.back()},r("fas fa-times"))),m("div",{className:"WithdrawalPage-content"},this.renderPlatformSelector(),this.renderAmountSection(),this.renderAddressSection(),this.renderSubmitButton())))}renderPlatformSelector(){const a=this.selectedPlatform();return m("div",{className:"WithdrawalPage-platformSelector"},m("div",{className:"WithdrawalPage-label"},"提取平台"),m("div",{className:"WithdrawalPage-platformDropdown",onclick:()=>this.showDropdown=!this.showDropdown},m("div",{className:"WithdrawalPage-platformSelected"},m("div",{className:"WithdrawalPage-platformInfo"},m("div",{className:"WithdrawalPage-platformIcon"},a?this.renderPlatformIcon(a):r("fas fa-bitcoin",{className:"default-icon"})),m("div",{className:"WithdrawalPage-platformDetails"},m("div",{className:"WithdrawalPage-platformName"},a?typeof a.name=="function"?a.name():a.attributes?.name:"请选择平台"),m("div",{className:"WithdrawalPage-platformFlow"},s.translator.trans("withdrawal.forum.remaining_flow",{amount:"0.00000000"}))))),r("fas fa-chevron-down",{className:"WithdrawalPage-dropdownIcon"})),this.showDropdown&&this.renderPlatformDropdown())}renderPlatformDropdown(){const a=(this.platforms||[]).filter(t=>!!t);return a.length===0?m("div",{className:"WithdrawalPage-dropdownMenu"},m("div",{className:"WithdrawalPage-dropdownItem WithdrawalPage-noData"},s.translator.trans("withdrawal.forum.no_platforms"))):m("div",{className:"WithdrawalPage-dropdownMenu"},a.map(t=>m("div",{key:t.id,className:"WithdrawalPage-dropdownItem",onclick:()=>{this.selectedPlatform(t),this.showDropdown=!1,this.amount("")}},m("div",{className:"WithdrawalPage-platformIcon"},this.renderPlatformIcon(t)),m("div",{className:"WithdrawalPage-platformName"},typeof t.name=="function"?t.name():t.attributes?.name))))}renderPlatformIcon(a){if(!a)return r("fas fa-coins",{className:"crypto-icon default"});const t=typeof a.iconUrl=="function"?a.iconUrl():a.attributes?.iconUrl,i=typeof a.iconClass=="function"?a.iconClass():a.attributes?.iconClass,l=typeof a.name=="function"?a.name():a.attributes?.name,n=typeof a.symbol=="function"?a.symbol():a.attributes?.symbol;if(t)return m("img",{src:t,alt:l||"Platform",className:"platform-icon-image",onerror:D=>{const h=D.target;h.style.display="none";const f=document.createElement("i"),I=i||"fas fa-coins";f.className=`${I} crypto-icon`,h.parentElement?.appendChild(f)}});const W=i||"fas fa-coins",A=n?.toLowerCase()||"default";return r(W,{className:`crypto-icon ${A}`})}renderAmountSection(){const a=this.selectedPlatform(),t=a?typeof a.minAmount=="function"?a.minAmount():a.attributes?.minAmount:.001,i=a?typeof a.maxAmount=="function"?a.maxAmount():a.attributes?.maxAmount:10,l=a?typeof a.fee=="function"?a.fee():a.attributes?.fee:5e-4;return m("div",{className:"WithdrawalPage-amountSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-balanceHeader"},m("span",{className:"WithdrawalPage-label"},s.translator.trans("withdrawal.forum.form.amount")),m("span",{className:"WithdrawalPage-balance"},s.translator.trans("withdrawal.forum.available_balance",{amount:this.loadingBalance?"0.00000000":this.userBalance.toFixed(8)}))),m("div",{className:"WithdrawalPage-amountInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:"0.00000000",value:this.amount(),oninput:n=>this.amount(n.target.value)}),m(u,{className:"WithdrawalPage-allButton",onclick:this.fillAllAmount.bind(this)},s.translator.trans("withdrawal.forum.form.all_button"))),m("div",{className:"WithdrawalPage-amountLimits"},m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},s.translator.trans("withdrawal.forum.limits.min_max")),m("span",{className:"WithdrawalPage-limitValue"},r("fas fa-coins")," ",t," ~ ",i)),m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},s.translator.trans("withdrawal.forum.limits.fee")),m("span",{className:"WithdrawalPage-limitValue"},r("fas fa-coins")," ",l)))))}renderAddressSection(){const a=this.selectedPlatform(),t=a?typeof a.symbol=="function"?a.symbol():a.attributes?.symbol:"";return m("div",{className:"WithdrawalPage-addressSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-addressHeader"},m("span",{className:"WithdrawalPage-label"},s.translator.trans("withdrawal.forum.form.address",{symbol:t}),m("span",{className:"WithdrawalPage-required"},"*")),m("div",{className:"WithdrawalPage-saveAddress",onclick:()=>this.saveAddress(!this.saveAddress())},r("fas fa-bookmark"),s.translator.trans("withdrawal.forum.form.save_address"))),m("div",{className:"WithdrawalPage-addressInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:s.translator.trans("withdrawal.forum.form.address_placeholder"),value:this.accountDetails(),oninput:i=>this.accountDetails(i.target.value)}),m("button",{className:"WithdrawalPage-pasteButton",onclick:this.pasteFromClipboard.bind(this)},r("fas fa-paste")))))}renderSubmitButton(){const a=parseFloat(this.amount())||0,t=this.selectedPlatform(),i=t?typeof t.fee=="function"?t.fee():t.attributes?.fee:0,l=Math.max(0,a-i),n=t?typeof t.symbol=="function"?t.symbol():t.attributes?.symbol:"";return m("div",{className:"WithdrawalPage-submitSection"},m(u,{className:"WithdrawalPage-submitButton",loading:this.submitting,disabled:!this.canSubmit(),onclick:this.submit.bind(this)},s.translator.trans("withdrawal.forum.form.submit")),a>0&&m("div",{className:"WithdrawalPage-finalAmount"},s.translator.trans("withdrawal.forum.final_amount",{amount:l.toFixed(8),symbol:n})))}canSubmit(){return!!(this.selectedPlatform()&&this.amount()&&this.accountDetails()&&!this.submitting&&parseFloat(this.amount())>0)}fillAllAmount(){this.loadingBalance||this.amount(this.userBalance.toFixed(8))}async pasteFromClipboard(){try{if(navigator.clipboard&&navigator.clipboard.readText){const a=await navigator.clipboard.readText();this.accountDetails(a.trim()),m.redraw()}}catch(a){console.error("Failed to read from clipboard:",a),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.forum.clipboard_error"))}}async submit(){if(this.canSubmit()){this.submitting=!0;try{const a=this.selectedPlatform(),t=await s.request({method:"POST",url:s.forum.attribute("apiUrl")+"/withdrawal-requests",body:{data:{type:"withdrawal-requests",attributes:{platformId:typeof a.id=="function"?a.id():a.id,amount:parseFloat(this.amount()),accountDetails:this.accountDetails()}}}});t&&t.data&&s.store.pushPayload(t),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.forum.form.success")),this.amount(""),this.accountDetails(""),this.saveAddress(!1),this.loadRequests()}catch(a){console.error("Error submitting withdrawal request:",a),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.forum.form.error"))}finally{this.submitting=!1,m.redraw()}}}async loadData(){try{await Promise.all([this.loadPlatforms(),this.loadRequests()])}catch(a){console.error("Error loading data:",a)}finally{this.loading=!1,m.redraw()}}async loadPlatforms(){try{console.log("Loading withdrawal platforms...");const a=await s.store.find("withdrawal-platforms");console.log("Platform response:",a),this.platforms=Array.isArray(a)?a.filter(t=>t!==null):a?[a]:[],console.log("Processed platforms:",this.platforms),this.platforms.length>0&&!this.selectedPlatform()&&this.selectedPlatform(this.platforms[0])}catch(a){console.error("Error loading platforms:",a),this.platforms=[]}}async loadRequests(){try{const a=await s.store.find("withdrawal-requests");this.requests=Array.isArray(a)?a.filter(t=>t!==null):a?[a]:[]}catch(a){console.error("Error loading requests:",a),this.requests=[]}}async loadUserBalance(){try{this.userBalance=s.session.user?.attribute("money")||0,this.loadingBalance=!1,m.redraw()}catch(a){console.error("Error loading user balance:",a),this.loadingBalance=!1,m.redraw()}}}class y extends e{constructor(){super(...arguments),this.name=e.attribute("name"),this.symbol=e.attribute("symbol"),this.minAmount=e.attribute("minAmount"),this.maxAmount=e.attribute("maxAmount"),this.fee=e.attribute("fee"),this.iconUrl=e.attribute("iconUrl"),this.iconClass=e.attribute("iconClass"),this.isActive=e.attribute("isActive"),this.createdAt=e.attribute("createdAt",e.transformDate),this.updatedAt=e.attribute("updatedAt",e.transformDate)}apiEndpoint(){return`/withdrawal-platforms/${this.id()}`}displayName(){const a=this.symbol(),t=this.name();return a?`${t} (${a})`:t}isValidAmount(a){const t=this.minAmount(),i=this.maxAmount();return a>=t&&a<=i}getTotalCost(a){return a+this.fee()}}const o={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class v extends e{constructor(){super(...arguments),this.amount=e.attribute("amount"),this.accountDetails=e.attribute("accountDetails"),this.status=e.attribute("status"),this.platformId=e.attribute("platformId"),this.userId=e.attribute("userId"),this.createdAt=e.attribute("createdAt",e.transformDate),this.updatedAt=e.attribute("updatedAt",e.transformDate),this.user=e.hasOne("user"),this.platform=e.hasOne("platform")}apiEndpoint(){return`/withdrawal-requests/${this.id()}`}isPending(){return this.status()===o.PENDING}isApproved(){return this.status()===o.APPROVED}isRejected(){return this.status()===o.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const a=this.status();return app.translator.trans(`withdrawal.forum.status.${a}`)}statusColor(){switch(this.status()){case o.APPROVED:return"success";case o.REJECTED:return"danger";case o.PENDING:default:return"warning"}}}s.initializers.add("wusong8899-withdrawal",()=>{s.store.models["withdrawal-platforms"]=y,s.store.models["withdrawal-requests"]=v,s.routes.withdrawal={path:"/withdrawal",component:p},w.extend(b.prototype,"items",function(d){s.session.user&&d.add("withdrawal",g.component({href:s.route("withdrawal"),icon:"fas fa-money-bill-transfer"},s.translator.trans("withdrawal.forum.header.withdrawal_button")),10)})})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["common/components/LinkButton"],flarum.core.compat["forum/components/HeaderSecondary"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/icon"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=forum.js.map

module.exports={};