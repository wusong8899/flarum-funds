(function(t,h,w,f,g,l,b,N,i,P,s,y){"use strict";class W extends g{constructor(){super(...arguments),this.platforms=[],this.requests=[],this.loading=!0,this.submitting=!1,this.loadingBalance=!0,this.userBalance=0,this.amount=i(""),this.selectedPlatform=i(""),this.accountDetails=i("")}oninit(a){super.oninit(a),t.setTitle(t.translator.trans("withdrawal.forum.page.title")),this.loadData(),this.loadUserBalance()}view(){if(this.loading)return m("div",{className:"WithdrawalPage"},m("div",{className:"container"},m(b,null)));const a=t.forum.attribute("withdrawal.minAmount")||0,r=t.forum.attribute("withdrawal.maxAmount")||1e4,o=t.forum.attribute("withdrawal.fee")||0;return m("div",{className:"WithdrawalPage"},m("div",{className:"container"},m("div",{className:"WithdrawalPage-header"},m("h1",null,t.translator.trans("withdrawal.forum.page.title")),m("p",null,t.translator.trans("withdrawal.forum.page.description"))),m("div",{className:"WithdrawalPage-content"},this.renderBalanceSection(),this.renderInfoSection(a,r,o),m("div",{className:"WithdrawalPage-form"},m("h3",null,t.translator.trans("withdrawal.forum.form.title")),m("div",{className:"WithdrawalPage-formGroup"},m("label",null,t.translator.trans("withdrawal.forum.form.platform")),m(N,{options:this.getPlatformOptions(),value:this.selectedPlatform(),onchange:this.selectedPlatform})),m("div",{className:"WithdrawalPage-formGroup"},m("label",null,t.translator.trans("withdrawal.forum.form.amount")),m("div",{className:"WithdrawalPage-amountInput"},m("input",{type:"number",className:"FormControl",placeholder:t.translator.trans("withdrawal.forum.form.amount_placeholder"),value:this.amount(),oninput:e=>this.amount(e.target.value),min:a,max:r,step:"0.01"}),m(l,{className:"Button Button--secondary WithdrawalPage-allButton",onclick:this.fillAllAmount.bind(this)},t.translator.trans("withdrawal.forum.form.all_button")))),this.renderFinalAmountCalculation(o),m("div",{className:"WithdrawalPage-formGroup"},m("label",null,t.translator.trans("withdrawal.forum.form.account_details")),m("div",{className:"WithdrawalPage-accountInput"},m("textarea",{className:"FormControl",placeholder:t.translator.trans("withdrawal.forum.form.account_details_placeholder"),value:this.accountDetails(),oninput:e=>this.accountDetails(e.target.value),rows:3}),m(l,{className:"Button Button--secondary WithdrawalPage-pasteButton",onclick:this.pasteFromClipboard.bind(this)},t.translator.trans("withdrawal.forum.form.paste_button")))),m("div",{className:"WithdrawalPage-formGroup"},m(l,{className:"Button Button--primary",loading:this.submitting,disabled:!this.canSubmit(),onclick:this.submit.bind(this)},t.translator.trans("withdrawal.forum.form.submit")))),m("div",{className:"WithdrawalPage-history"},m("h3",null,t.translator.trans("withdrawal.forum.history.title")),this.requests.length===0?m("p",null,t.translator.trans("withdrawal.forum.history.empty")):m("div",{className:"WithdrawalPage-historyList"},this.requests.map(e=>this.renderRequest(e)))))))}renderRequest(a){const r=this.platforms.find(c=>c.id==a.relationships.platform.data.id),o=`status-${a.attributes.status}`;let e="N/A";if(a.attributes.createdAt&&a.attributes.createdAt!==null)try{e=P(new Date(a.attributes.createdAt))}catch(c){console.error("Error formatting date:",c),e="Invalid Date"}return m("div",{key:a.id,className:`WithdrawalRequest ${o}`},m("div",{className:"WithdrawalRequest-info"},m("span",{className:"WithdrawalRequest-amount"},"$",a.attributes.amount),m("span",{className:"WithdrawalRequest-platform"},r?.attributes.name),m("span",{className:"WithdrawalRequest-date"},e)),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${a.attributes.status}`},t.translator.trans(`withdrawal.forum.status.${a.attributes.status}`))))}renderBalanceSection(){return m("div",{className:"WithdrawalPage-balance"},m("h3",null,t.translator.trans("withdrawal.forum.balance.title")),m("div",{className:"WithdrawalPage-balanceAmount"},this.loadingBalance?m("span",{className:"loading"},t.translator.trans("withdrawal.forum.balance.loading")):m("span",{className:"amount"},t.translator.trans("withdrawal.forum.balance.amount",{amount:this.userBalance}))))}renderInfoSection(a,r,o){return m("div",{className:"WithdrawalPage-info"},m("div",{className:"WithdrawalPage-infoRow"},m("span",{className:"WithdrawalPage-infoIcon"},"ðŸ’°"),m("span",{className:"WithdrawalPage-infoText"},t.translator.trans("withdrawal.forum.info.minimum_amount",{amount:a}))),m("div",{className:"WithdrawalPage-infoRow"},m("span",{className:"WithdrawalPage-infoIcon"},"ðŸ’°"),m("span",{className:"WithdrawalPage-infoText"},t.translator.trans("withdrawal.forum.info.maximum_amount",{amount:r}))),m("div",{className:"WithdrawalPage-infoRow"},m("span",{className:"WithdrawalPage-infoIcon"},"ðŸ’¸"),m("span",{className:"WithdrawalPage-infoText"},t.translator.trans("withdrawal.forum.info.withdrawal_fee",{amount:o}))))}renderFinalAmountCalculation(a){const r=parseFloat(this.amount())||0,o=Math.max(0,r-a);return r>0?m("div",{className:"WithdrawalPage-finalAmount"},m("span",{className:"WithdrawalPage-finalAmountLabel"},t.translator.trans("withdrawal.forum.info.final_amount",{amount:o.toFixed(2)}))):null}getPlatformOptions(){const a={"":t.translator.trans("withdrawal.forum.form.select_platform")};return this.platforms.forEach(r=>{a[r.id.toString()]=r.attributes.name}),a}canSubmit(){return!!(this.selectedPlatform()&&this.amount()&&this.accountDetails()&&!this.submitting)}fillAllAmount(){this.amount(this.userBalance.toString())}async pasteFromClipboard(){try{if(navigator.clipboard&&navigator.clipboard.readText){const a=await navigator.clipboard.readText();this.accountDetails(a),m.redraw()}}catch(a){console.error("Failed to read from clipboard:",a),t.alerts.show({type:"error",message:"Clipboard access not available. Please paste manually."})}}async submit(){if(this.canSubmit()){this.submitting=!0;try{const a={type:"withdrawal-requests",attributes:{platformId:parseInt(this.selectedPlatform()),amount:parseFloat(this.amount()),accountDetails:this.accountDetails()}};await t.store.createRecord("withdrawal-requests").save(a),t.alerts.show({type:"success",message:t.translator.trans("withdrawal.forum.form.success")}),this.amount(""),this.selectedPlatform(""),this.accountDetails(""),this.loadRequests()}catch(a){console.error("Error submitting withdrawal request:",a),t.alerts.show({type:"error",message:t.translator.trans("withdrawal.forum.form.error")})}finally{this.submitting=!1,m.redraw()}}}async loadData(){try{await Promise.all([this.loadPlatforms(),this.loadRequests()])}catch(a){console.error("Error loading data:",a)}finally{this.loading=!1,m.redraw()}}async loadPlatforms(){try{const a=await t.store.find("withdrawal-platforms");this.platforms=Array.isArray(a)?a.filter(r=>r!==null):a?[a]:[]}catch(a){console.error("Error loading platforms:",a),this.platforms=[]}}async loadRequests(){try{const a=await t.store.find("withdrawal-requests");this.requests=Array.isArray(a)?a.filter(r=>r!==null):a?[a]:[]}catch(a){console.error("Error loading requests:",a),this.requests=[]}}async loadUserBalance(){try{this.userBalance=t.session.user?.attribute("money")||0,this.loadingBalance=!1,m.redraw()}catch(a){console.error("Error loading user balance:",a),this.loadingBalance=!1,m.redraw()}}}class u extends s{constructor(){super(...arguments),this.name=s.attribute("name"),this.createdAt=s.attribute("created_at",s.transformDate)}}class d extends s{constructor(){super(...arguments),this.amount=s.attribute("amount"),this.accountDetails=s.attribute("account_details"),this.status=s.attribute("status"),this.createdAt=s.attribute("created_at",s.transformDate),this.user=s.hasOne("user"),this.platform=s.hasOne("withdrawal-platforms")}}new y.Store().add("withdrawal-platforms",u).add("withdrawal-requests",d),t.initializers.add("wusong8899-withdrawal",()=>{t.store.models["withdrawal-platforms"]=u,t.store.models["withdrawal-requests"]=d,t.routes.withdrawal={path:"/withdrawal",component:W},h.extend(f.prototype,"items",function(n){t.session.user&&n.add("withdrawal",w.component({href:t.route("withdrawal"),icon:"fas fa-money-bill-transfer"},t.translator.trans("withdrawal.forum.header.withdrawal_button")),10)})})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["common/components/LinkButton"],flarum.core.compat["forum/components/HeaderSecondary"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/components/Select"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/Model"],flarum.core.compat["common/extenders"]);
//# sourceMappingURL=forum.js.map

module.exports={};