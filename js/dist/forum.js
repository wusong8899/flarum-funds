(function(t,l,n,u,c,d,h,w,e,f){"use strict";class g extends c{constructor(){super(...arguments),this.platforms=[],this.requests=[],this.loading=!0,this.submitting=!1,this.amount=e(""),this.selectedPlatform=e(""),this.accountDetails=e("")}oninit(a){super.oninit(a),t.setTitle(t.translator.trans("withdrawal.forum.page.title")),this.loadData()}view(){if(this.loading)return m("div",{className:"WithdrawalPage"},m("div",{className:"container"},m(h,null)));const a=t.forum.attribute("withdrawal.minAmount")||0,r=t.forum.attribute("withdrawal.maxAmount")||1e4,o=t.forum.attribute("withdrawal.fee")||0;return m("div",{className:"WithdrawalPage"},m("div",{className:"container"},m("div",{className:"WithdrawalPage-header"},m("h1",null,t.translator.trans("withdrawal.forum.page.title")),m("p",null,t.translator.trans("withdrawal.forum.page.description"))),m("div",{className:"WithdrawalPage-content"},m("div",{className:"WithdrawalPage-form"},m("h3",null,t.translator.trans("withdrawal.forum.form.title")),m("div",{className:"WithdrawalPage-formGroup"},m("label",null,t.translator.trans("withdrawal.forum.form.platform")),m(w,{options:this.getPlatformOptions(),value:this.selectedPlatform(),onchange:this.selectedPlatform})),m("div",{className:"WithdrawalPage-formGroup"},m("label",null,t.translator.trans("withdrawal.forum.form.amount")),m("input",{type:"number",className:"FormControl",placeholder:t.translator.trans("withdrawal.forum.form.amount_placeholder",{min:a,max:r}),value:this.amount(),oninput:s=>this.amount(s.target.value),min:a,max:r,step:"0.01"}),m("small",{className:"helpText"},t.translator.trans("withdrawal.forum.form.amount_help",{min:a,max:r,fee:o}))),m("div",{className:"WithdrawalPage-formGroup"},m("label",null,t.translator.trans("withdrawal.forum.form.account_details")),m("textarea",{className:"FormControl",placeholder:t.translator.trans("withdrawal.forum.form.account_details_placeholder"),value:this.accountDetails(),oninput:s=>this.accountDetails(s.target.value),rows:3})),m("div",{className:"WithdrawalPage-formGroup"},m(d,{className:"Button Button--primary",loading:this.submitting,disabled:!this.canSubmit(),onclick:this.submit.bind(this)},t.translator.trans("withdrawal.forum.form.submit")))),m("div",{className:"WithdrawalPage-history"},m("h3",null,t.translator.trans("withdrawal.forum.history.title")),this.requests.length===0?m("p",null,t.translator.trans("withdrawal.forum.history.empty")):m("div",{className:"WithdrawalPage-historyList"},this.requests.map(s=>this.renderRequest(s)))))))}renderRequest(a){const r=this.platforms.find(s=>s.id==a.relationships.platform.data.id),o=`status-${a.attributes.status}`;return m("div",{key:a.id,className:`WithdrawalRequest ${o}`},m("div",{className:"WithdrawalRequest-info"},m("span",{className:"WithdrawalRequest-amount"},"$",a.attributes.amount),m("span",{className:"WithdrawalRequest-platform"},r?.attributes.name),m("span",{className:"WithdrawalRequest-date"},f(a.attributes.createdAt).format("YYYY-MM-DD HH:mm"))),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${a.attributes.status}`},t.translator.trans(`withdrawal.forum.status.${a.attributes.status}`))))}getPlatformOptions(){const a={"":t.translator.trans("withdrawal.forum.form.select_platform")};return this.platforms.forEach(r=>{a[r.id.toString()]=r.attributes.name}),a}canSubmit(){return!!(this.selectedPlatform()&&this.amount()&&this.accountDetails()&&!this.submitting)}async submit(){if(this.canSubmit()){this.submitting=!0;try{const a={type:"withdrawal-requests",attributes:{platformId:parseInt(this.selectedPlatform()),amount:parseFloat(this.amount()),accountDetails:this.accountDetails()}};await t.store.createRecord("withdrawal-requests").save(a),t.alerts.show({type:"success",message:t.translator.trans("withdrawal.forum.form.success")}),this.amount(""),this.selectedPlatform(""),this.accountDetails(""),this.loadRequests()}catch(a){console.error("Error submitting withdrawal request:",a),t.alerts.show({type:"error",message:t.translator.trans("withdrawal.forum.form.error")})}finally{this.submitting=!1,m.redraw()}}}async loadData(){try{await Promise.all([this.loadPlatforms(),this.loadRequests()])}catch(a){console.error("Error loading data:",a)}finally{this.loading=!1,m.redraw()}}async loadPlatforms(){const a=await t.store.find("withdrawal-platforms");this.platforms=Array.isArray(a)?a:[a]}async loadRequests(){const a=await t.store.find("withdrawal-requests");this.requests=Array.isArray(a)?a:[a]}}t.initializers.add("wusong8899/flarum-withdrawal",()=>{t.routes.withdrawal={path:"/withdrawal",component:g},l.extend(u.prototype,"items",function(i){t.session.user&&i.add("withdrawal",n.component({href:t.route("withdrawal"),icon:"fas fa-money-bill-transfer"},t.translator.trans("withdrawal.forum.header.withdrawal_button")),10)})})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["common/components/LinkButton"],flarum.core.compat["forum/components/HeaderSecondary"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/components/Select"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/utils/dayjs"]);
//# sourceMappingURL=forum.js.map

module.exports={};