(function(s,E,_,B,H,C,S,N,d,e,g,O,i){"use strict";const q=l=>typeof l.id=="function"?l.id():l.id,n=(l,t)=>typeof l[t]=="function"?l[t]():l.attributes?l.attributes[t]:l[t],k=l=>String(q(l)),L=(l,t)=>{const a=String(t);return l.find(r=>{const o=q(r);return String(o)===a})},F=(l,t)=>{const a=n(l,t);return a?new Date(a):new Date},R={pending:"warning",approved:"success",rejected:"danger"},v={MIN_AMOUNT:.001,MAX_AMOUNT:10,FEE:5e-4,BALANCE_PRECISION:8},D={COINS:"fas fa-coins",CHEVRON_DOWN:"fas fa-chevron-down",PASTE:"fas fa-paste",BOOKMARK:"fas fa-bookmark"};class T{view(t){const{platform:a,className:r="",size:o="medium"}=t.attrs;if(!a)return d(D.COINS,{className:`crypto-icon default ${r}`});const c=n(a,"iconUrl"),u=n(a,"iconClass"),w=n(a,"name"),f=n(a,"symbol"),h=`platform-icon-${o}`;if(c)return m("img",{src:c,alt:w||"Platform",className:`platform-icon-image ${h} ${r}`,onerror:y=>{const I=y.target;I.style.display="none";const U=document.createElement("i"),pt=u||D.COINS;U.className=`${pt} crypto-icon ${r}`,I.parentElement?.appendChild(U)}});const b=u||D.COINS,p=f?.toLowerCase()||"default";return d(b,{className:`crypto-icon ${p} ${h} ${r}`})}}class Q extends g{oninit(t){super.oninit(t),this.state={showDropdown:!1}}view(){const{selectedPlatform:t}=this.attrs,{showDropdown:a}=this.state;return m("div",{className:"WithdrawalPage-platformSelector"},m("div",{className:"WithdrawalPage-label"},"提取平台"),m("div",{className:"WithdrawalPage-platformDropdown",onclick:()=>this.toggleDropdown()},m("div",{className:"WithdrawalPage-platformSelected"},m("div",{className:"WithdrawalPage-platformInfo"},m("div",{className:"WithdrawalPage-platformIcon"},m(T,{platform:t,size:"medium"})),m("div",{className:"WithdrawalPage-platformDetails"},m("div",{className:"WithdrawalPage-platformName"},this.getPlatformName(t))))),d(D.CHEVRON_DOWN,{className:"WithdrawalPage-dropdownIcon"})),a&&this.renderPlatformDropdown())}toggleDropdown(){this.state.showDropdown=!this.state.showDropdown}getPlatformName(t){return t&&n(t,"name")||"请选择平台"}renderPlatformDropdown(){const{platforms:t}=this.attrs,a=(t||[]).filter(r=>!!r);return a.length===0?m("div",{className:"WithdrawalPage-dropdownMenu"},m("div",{className:"WithdrawalPage-dropdownItem WithdrawalPage-noData"},s.translator.trans("withdrawal.forum.no_platforms"))):m("div",{className:"WithdrawalPage-dropdownMenu"},a.map(r=>m("div",{key:r.id,className:"WithdrawalPage-dropdownItem",onclick:()=>this.selectPlatform(r)},m("div",{className:"WithdrawalPage-platformIcon"},m(T,{platform:r,size:"small"})),m("div",{className:"WithdrawalPage-platformName"},n(r,"name")))))}selectPlatform(t){const{onPlatformSelect:a,onAmountChange:r}=this.attrs;a(t),this.state.showDropdown=!1,r&&r()}}class z extends g{view(){const{amount:t,selectedPlatform:a,loadingBalance:r,onAmountChange:o,onFillAllAmount:c}=this.attrs,u=this.getMinAmount(a),w=this.getMaxAmount(a),f=this.getFee(a);return m("div",{className:"WithdrawalPage-amountSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-label"},s.translator.trans("withdrawal.forum.form.amount")),m("div",{className:"WithdrawalPage-amountInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:"0.00000000",value:t,oninput:h=>o(h.target.value)}),m(C,{className:"WithdrawalPage-allButton",onclick:c,disabled:r},s.translator.trans("withdrawal.forum.form.all_button"))),m("div",{className:"WithdrawalPage-amountLimits"},m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},s.translator.trans("withdrawal.forum.limits.min_max")),m("span",{className:"WithdrawalPage-limitValue"},d(D.COINS)," ",u," ~ ",w)),m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},s.translator.trans("withdrawal.forum.limits.fee")),m("span",{className:"WithdrawalPage-limitValue"},d(D.COINS)," ",f)))))}getMinAmount(t){return t&&n(t,"minAmount")||v.MIN_AMOUNT}getMaxAmount(t){return t&&n(t,"maxAmount")||v.MAX_AMOUNT}getFee(t){return t&&n(t,"fee")||v.FEE}}class G extends g{view(){const{accountDetails:t,selectedPlatform:a,saveAddress:r,onAccountDetailsChange:o,onSaveAddressToggle:c}=this.attrs,u=this.getSymbol(a);return m("div",{className:"WithdrawalPage-addressSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-addressHeader"},m("span",{className:"WithdrawalPage-label"},s.translator.trans("withdrawal.forum.form.address",{symbol:u}),m("span",{className:"WithdrawalPage-required"},"*")),m("div",{className:"WithdrawalPage-saveAddress",onclick:()=>c(!r)},d(D.BOOKMARK),s.translator.trans("withdrawal.forum.form.save_address"))),m("div",{className:"WithdrawalPage-addressInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:s.translator.trans("withdrawal.forum.form.address_placeholder"),value:t,oninput:w=>o(w.target.value)}),m("button",{className:"WithdrawalPage-pasteButton",onclick:()=>this.pasteFromClipboard()},d(D.PASTE)))))}getSymbol(t){return t&&n(t,"symbol")||""}async pasteFromClipboard(){const{onAccountDetailsChange:t}=this.attrs;try{if(navigator.clipboard&&navigator.clipboard.readText){const a=await navigator.clipboard.readText();t(a.trim()),m.redraw()}}catch(a){console.error("Failed to read from clipboard:",a),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.forum.clipboard_error"))}}}class V extends g{view(){const{amount:t,selectedPlatform:a,submitting:r,canSubmit:o,onSubmit:c}=this.attrs,u=parseFloat(t)||0,w=this.getFee(a),f=Math.max(0,u-w),h=this.getSymbol(a);return m("div",{className:"WithdrawalPage-submitSection"},m(C,{className:"WithdrawalPage-submitButton",loading:r,disabled:!o,onclick:c},s.translator.trans("withdrawal.forum.form.submit")),u>0&&m("div",{className:"WithdrawalPage-finalAmount"},s.translator.trans("withdrawal.forum.final_amount",{amount:f.toFixed(v.BALANCE_PRECISION),symbol:h})))}getFee(t){return t&&n(t,"fee")||v.FEE}getSymbol(t){return t&&n(t,"symbol")||""}}class K extends g{view(){const{platforms:t,formData:a,loadingBalance:r,submitting:o,onFormDataChange:c,onFillAllAmount:u,onSubmit:w}=this.attrs;return[m(Q,{platforms:t,selectedPlatform:a.selectedPlatform,onPlatformSelect:f=>c({selectedPlatform:f}),onAmountChange:()=>c({amount:""})}),m(z,{amount:a.amount,selectedPlatform:a.selectedPlatform,loadingBalance:r,onAmountChange:f=>c({amount:f}),onFillAllAmount:u}),m(G,{accountDetails:a.accountDetails,selectedPlatform:a.selectedPlatform,saveAddress:a.saveAddress,onAccountDetailsChange:f=>c({accountDetails:f}),onSaveAddressToggle:f=>c({saveAddress:f})}),m(V,{amount:a.amount,selectedPlatform:a.selectedPlatform,accountDetails:a.accountDetails,submitting:o,canSubmit:this.canSubmit(),onSubmit:w})]}canSubmit(){const{formData:t,submitting:a}=this.attrs,{selectedPlatform:r,amount:o,accountDetails:c}=t;return!!(r&&o&&c&&!a&&parseFloat(o)>0)}}class J extends g{view(){const{status:t,className:a=""}=this.attrs,r=this.getStatusClass(t),o=this.getStatusLabel(t);return m("div",{className:`WithdrawalPage-historyStatus ${r} ${a}`},o)}getStatusClass(t){return R[t]||R.pending}getStatusLabel(t){return s.translator.trans(`withdrawal.forum.status.${t}`)}}class Y extends g{view(){const{request:t,platforms:a}=this.attrs;if(!t)return null;const r=this.getPlatformId(t),o=L(a,r),c=n(t,"status")||"pending",u=F(t,"createdAt"),w=n(t,"amount")||0,f=n(t,"accountDetails")||"";return console.log("Looking for platform with ID:",r,"Available platforms:",a.map(h=>({id:k(h),name:n(h,"name")}))),m("div",{key:k(t),className:"WithdrawalPage-historyItem"},m("div",{className:"WithdrawalPage-historyHeader"},m("div",{className:"WithdrawalPage-historyPlatform"},m("div",{className:"WithdrawalPage-platformIcon"},m(T,{platform:o,size:"small"})),m("div",{className:"WithdrawalPage-historyInfo"},m("div",{className:"WithdrawalPage-historyPlatformName"},this.getPlatformName(o)),m("div",{className:"WithdrawalPage-historyDate"},u.toLocaleDateString()," ",u.toLocaleTimeString()))),m(J,{status:c})),m("div",{className:"WithdrawalPage-historyDetails"},m("div",{className:"WithdrawalPage-historyAmount"},m("span",{className:"WithdrawalPage-historyLabel"},s.translator.trans("withdrawal.forum.history.amount"),":"),m("span",{className:"WithdrawalPage-historyValue"},w," ",this.getPlatformSymbol(o))),m("div",{className:"WithdrawalPage-historyAddress"},m("span",{className:"WithdrawalPage-historyLabel"},s.translator.trans("withdrawal.forum.history.address"),":"),m("span",{className:"WithdrawalPage-historyValue"},f))))}getPlatformId(t){return n(t,"platformId")||t.relationships?.platform?.data?.id||""}getPlatformName(t){return t&&n(t,"name")||"Unknown Platform"}getPlatformSymbol(t){return t&&n(t,"symbol")||""}}class X extends g{view(){const{iconName:t,title:a,description:r,className:o=""}=this.attrs;return m("div",{className:`WithdrawalPage-emptyState ${o}`},m("div",{className:"WithdrawalPage-emptyIcon"},d(t)),m("h3",{className:"WithdrawalPage-emptyTitle"},a),m("p",{className:"WithdrawalPage-emptyDescription"},r))}}function Z(l){const{className:t=""}=l;return m("div",{className:`WithdrawalPage-loading ${t}`},m(S,null))}class j extends g{view(){const{requests:t,platforms:a,loading:r}=this.attrs;return r?m(Z,{className:"WithdrawalPage-historyLoading"}):!t||t.length===0?m(X,{iconName:"fas fa-history",title:s.translator.trans("withdrawal.forum.history.empty.title"),description:s.translator.trans("withdrawal.forum.history.empty.description"),className:"WithdrawalPage-historyEmpty"}):m("div",{className:"WithdrawalPage-historyList"},t.map(o=>m(Y,{key:this.getRequestKey(o),request:o,platforms:a})))}getRequestKey(t){return typeof t.id=="function"?`request-${t.id()}`:`request-${t.id||Math.random()}`}}class M extends H{constructor(){super(...arguments),this.state={platforms:[],requests:[],loading:!0,loadingBalance:!0,userBalance:0,submitting:!1,activeTab:N("withdrawal")},this.formData={amount:N(""),selectedPlatform:N(null),accountDetails:N(""),saveAddress:N(!1)}}oninit(t){super.oninit(t),s.setTitle(s.translator.trans("withdrawal.forum.page.title")),this.loadData(),this.loadUserBalance()}view(){return this.state.loading?e("div",{className:"WithdrawalPage"},e("div",{className:"WithdrawalPage-loading"},e(S,null))):e("div",{className:"WithdrawalPage"},e("div",{className:"WithdrawalPage-modal"},this.renderHeader(),e("div",{className:"WithdrawalPage-content"},this.state.activeTab()==="withdrawal"?this.renderWithdrawalTab():this.renderHistoryTab())))}renderHeader(){return e("div",{className:"WithdrawalPage-header"},e("div",{className:"WithdrawalPage-tabs"},e("div",{className:`WithdrawalPage-tab ${this.state.activeTab()==="withdrawal"?"active":""}`,onclick:()=>this.handleTabChange("withdrawal")},s.translator.trans("withdrawal.forum.tabs.withdrawal")),e("div",{className:`WithdrawalPage-tab ${this.state.activeTab()==="history"?"active":""}`,onclick:()=>this.handleTabChange("history")},s.translator.trans("withdrawal.forum.tabs.history"))),e(C,{className:"WithdrawalPage-close",icon:"fas fa-times",onclick:()=>s.history.back()}))}renderWithdrawalTab(){return(this.state.platforms||[]).filter(a=>!!a).length===0?e("div",{className:"WithdrawalPage-emptyState"},e("div",{className:"WithdrawalPage-emptyIcon"},d("fas fa-coins")),e("h3",{className:"WithdrawalPage-emptyTitle"},s.translator.trans("withdrawal.forum.no_platforms")),e("p",{className:"WithdrawalPage-emptyDescription"},s.translator.trans("withdrawal.forum.no_platforms_description"))):e(K,{platforms:this.state.platforms,formData:this.getFormDataForComponent(),loadingBalance:this.state.loadingBalance,submitting:this.state.submitting,onFormDataChange:this.handleFormDataChange.bind(this),onFillAllAmount:this.handleFillAllAmount.bind(this),onSubmit:this.handleSubmit.bind(this)})}renderHistoryTab(){return e(j,{requests:this.state.requests,platforms:this.state.platforms,loading:!1})}handleTabChange(t){this.state.activeTab(t)}getFormDataForComponent(){return{selectedPlatform:this.formData.selectedPlatform(),amount:this.formData.amount(),accountDetails:this.formData.accountDetails(),saveAddress:this.formData.saveAddress()}}handleFormDataChange(t){t.selectedPlatform!==void 0&&this.formData.selectedPlatform(t.selectedPlatform),t.amount!==void 0&&this.formData.amount(t.amount),t.accountDetails!==void 0&&this.formData.accountDetails(t.accountDetails),t.saveAddress!==void 0&&this.formData.saveAddress(t.saveAddress)}async handleFillAllAmount(){const t=this.formData.selectedPlatform();if(t&&!this.state.loadingBalance)try{await this.loadUserBalance(!0);const a=n(t,"fee")||0,r=n(t,"maxAmount")||1/0;let o=this.state.userBalance-a;r<1/0&&o>r&&(o=r),o>0?this.formData.amount(o.toString()):s.alerts.show({type:"warning",dismissible:!0},s.translator.trans("withdrawal.forum.insufficient_balance"))}catch(a){console.error("Error refreshing balance:",a),s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.forum.balance_refresh_error"))}}async handleSubmit(){if(this.state.submitting)return;const t=this.formData.selectedPlatform(),a=this.formData.amount(),r=this.formData.accountDetails();if(!t||!a||!r)return;const o=parseFloat(a);if(isNaN(o)||o<=0){s.alerts.show({type:"warning",dismissible:!0},s.translator.trans("withdrawal.forum.invalid_amount"));return}const c=n(t,"minAmount")||0,u=n(t,"maxAmount")||1/0;if(o<c){s.alerts.show({type:"warning",dismissible:!0},s.translator.trans("withdrawal.forum.amount_below_minimum",{amount:o,minimum:c,platform:n(t,"name")}));return}if(o>u){s.alerts.show({type:"warning",dismissible:!0},s.translator.trans("withdrawal.forum.amount_above_maximum",{amount:o,maximum:u,platform:n(t,"name")}));return}const w=n(t,"fee")||0,f=o+w;if(this.state.userBalance<f){const h=w>0?s.translator.trans("withdrawal.forum.including_fee",{fee:w}):"";s.alerts.show({type:"warning",dismissible:!0},s.translator.trans("withdrawal.forum.insufficient_balance_detailed",{required:f,available:this.state.userBalance,feeText:h}));return}this.state.submitting=!0;try{const h=await s.request({method:"POST",url:s.forum.attribute("apiUrl")+"/withdrawal-requests",body:{data:{type:"withdrawal-requests",attributes:{platformId:k(t),amount:parseFloat(a),accountDetails:r,saveAddress:this.formData.saveAddress()}}}});s.store.pushPayload(h),this.formData.amount(""),this.formData.accountDetails(""),this.formData.saveAddress()||this.formData.selectedPlatform(null),this.loadUserBalance(),this.loadWithdrawalRequests(),s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.forum.submit_success"))}catch(h){console.error("Withdrawal request failed:",h);let b=s.translator.trans("withdrawal.forum.error");if(h&&h.response&&h.response.errors){const p=h.response.errors;if(Array.isArray(p)&&p.length>0){const y=p[0];y.detail?b=y.detail:y.source&&y.source.pointer&&(b=`${y.source.pointer.split("/").pop()}: ${y.title||y.detail||"Validation error"}`)}}else if(h&&h.responseText)if(h.responseText.includes("<b>Fatal error</b>")||h.responseText.includes("<!DOCTYPE"))b=s.translator.trans("withdrawal.forum.server_error");else try{const p=JSON.parse(h.responseText);if(p.errors&&Array.isArray(p.errors)&&p.errors.length>0){const y=p.errors[0];y.detail&&(b=y.detail)}}catch(p){console.error("Failed to parse error response:",p),b=s.translator.trans("withdrawal.forum.server_error")}s.alerts.show({type:"error",dismissible:!0},b)}finally{this.state.submitting=!1}}async loadData(){try{console.log("Starting to load withdrawal data...");const[t,a]=await Promise.all([s.request({method:"GET",url:s.forum.attribute("apiUrl")+"/withdrawal-platforms"}),s.request({method:"GET",url:s.forum.attribute("apiUrl")+"/withdrawal-requests"})]);console.log("Platforms response:",t),console.log("Requests response:",a),s.store.pushPayload(t),s.store.pushPayload(a),this.state.platforms=s.store.all("withdrawal-platforms"),this.state.requests=s.store.all("withdrawal-requests"),console.log("Loaded platforms:",this.state.platforms),console.log("Loaded requests:",this.state.requests),this.state.loading=!1,e.redraw()}catch(t){console.error("Error loading data:",t),this.state.loading=!1,e.redraw()}}async loadUserBalance(t=!1){try{if(this.state.loadingBalance=!0,t&&s.session.user){const a=await s.request({method:"GET",url:`${s.forum.attribute("apiUrl")}/users/${s.session.user.id()}`});s.store.pushPayload(a);const r=s.store.getById("users",s.session.user.id());r?this.state.userBalance=parseFloat(r.attribute("money"))||0:this.state.userBalance=0}else this.state.userBalance=parseFloat(s.session.user?.attribute("money"))||0;this.state.loadingBalance=!1,e.redraw()}catch(a){console.error("Error loading user balance:",a),this.state.loadingBalance=!1,e.redraw()}}async loadWithdrawalRequests(){try{const t=await s.request({method:"GET",url:s.forum.attribute("apiUrl")+"/withdrawal-requests"});s.store.pushPayload(t),this.state.requests=s.store.all("withdrawal-requests")}catch(t){console.error("Error loading withdrawal requests:",t)}}}class $ extends g{constructor(){super(...arguments),this.isOpen=N(!1),this.handleOutsideClick=t=>{const a=this.element;a&&!a.contains(t.target)&&(this.isOpen(!1),e.redraw())}}view(t){const{currencies:a,selected:r,loading:o}=t.attrs;return e("div",{className:`CurrencySelector ${this.isOpen()?"open":""}`},e("div",{className:"CurrencySelector-trigger",onclick:()=>!o&&this.isOpen(!this.isOpen())},e("div",{className:"CurrencySelector-content"},o?e("div",{className:"CurrencySelector-loading"},e("i",{className:"fas fa-spinner fa-spin"}),e("span",null,"Loading currencies...")):r?e("div",{className:"CurrencySelector-selected"},e("div",{className:"CurrencySelector-icon"},this.getCurrencyIcon(r)),e("span",{className:"CurrencySelector-label"},r)):e("div",{className:"CurrencySelector-placeholder"},e("div",{className:"CurrencySelector-icon"},d("fas fa-coins")),e("span",{className:"CurrencySelector-label"},"Select Currency"))),e("div",{className:"CurrencySelector-arrow"},d("fas fa-chevron-down"))),this.isOpen()&&!o&&e("div",{className:"CurrencySelector-dropdown"},a.map(c=>e("div",{key:c,className:`CurrencySelector-option ${c===r?"selected":""}`,onclick:()=>this.handleSelect(c,t.attrs.onSelect)},e("div",{className:"CurrencySelector-optionIcon"},this.getCurrencyIcon(c)),e("span",{className:"CurrencySelector-optionLabel"},c)))))}oncreate(t){super.oncreate(t),document.addEventListener("click",this.handleOutsideClick)}onremove(t){super.onremove(t),document.removeEventListener("click",this.handleOutsideClick)}handleSelect(t,a){a(t),this.isOpen(!1)}getCurrencyIcon(t){switch(t){case"USDT":return e("span",{className:"CurrencySelector-currencyIcon usdt"},"₮");case"USDC":return e("span",{className:"CurrencySelector-currencyIcon usdc"},"$");case"BTC":return e("span",{className:"CurrencySelector-currencyIcon btc"},"₿");case"ETH":return e("span",{className:"CurrencySelector-currencyIcon eth"},"Ξ");default:return d("fas fa-coins")}}}class tt extends g{constructor(){super(...arguments),this.isOpen=N(!1),this.handleOutsideClick=t=>{const a=this.element;a&&!a.contains(t.target)&&(this.isOpen(!1),e.redraw())}}view(t){const{networks:a,selected:r,loading:o,disabled:c}=t.attrs;return e("div",{className:`NetworkSelector ${this.isOpen()?"open":""} ${c?"disabled":""}`},e("div",{className:"NetworkSelector-trigger",onclick:()=>!o&&!c&&this.isOpen(!this.isOpen())},e("div",{className:"NetworkSelector-content"},o?e("div",{className:"NetworkSelector-loading"},e("i",{className:"fas fa-spinner fa-spin"}),e("span",null,"Loading networks...")):c?e("div",{className:"NetworkSelector-placeholder"},e("div",{className:"NetworkSelector-icon"},d("fas fa-network-wired")),e("span",{className:"NetworkSelector-label"},"Select currency first")):r?e("div",{className:"NetworkSelector-selected"},e("div",{className:"NetworkSelector-icon"},this.getNetworkIcon(r)),e("span",{className:"NetworkSelector-label"},r)):e("div",{className:"NetworkSelector-placeholder"},e("div",{className:"NetworkSelector-icon"},d("fas fa-network-wired")),e("span",{className:"NetworkSelector-label"},"Select Network"))),e("div",{className:"NetworkSelector-arrow"},d("fas fa-chevron-down"))),this.isOpen()&&!o&&!c&&e("div",{className:"NetworkSelector-dropdown"},a.map(u=>e("div",{key:u,className:`NetworkSelector-option ${u===r?"selected":""}`,onclick:()=>this.handleSelect(u,t.attrs.onSelect)},e("div",{className:"NetworkSelector-optionIcon"},this.getNetworkIcon(u)),e("span",{className:"NetworkSelector-optionLabel"},u),e("span",{className:"NetworkSelector-optionDesc"},this.getNetworkDescription(u))))))}oncreate(t){super.oncreate(t),document.addEventListener("click",this.handleOutsideClick)}onremove(t){super.onremove(t),document.removeEventListener("click",this.handleOutsideClick)}handleSelect(t,a){a(t),this.isOpen(!1)}getNetworkIcon(t){switch(t){case"TRC20":return e("span",{className:"NetworkSelector-networkIcon trc20"},"T");case"ERC20":return e("span",{className:"NetworkSelector-networkIcon erc20"},"E");case"BSC":case"BEP20":return e("span",{className:"NetworkSelector-networkIcon bsc"},"B");case"POLYGON":return e("span",{className:"NetworkSelector-networkIcon polygon"},"P");default:return d("fas fa-network-wired")}}getNetworkDescription(t){switch(t){case"TRC20":return"TRON network - Low fees";case"ERC20":return"Ethereum network - High security";case"BSC":case"BEP20":return"Binance Smart Chain - Fast & cheap";case"POLYGON":return"Polygon network - Very low fees";default:return"Blockchain network"}}}class et extends g{view(t){const{address:a,loading:r,onCopy:o}=t.attrs;return e("div",{className:"AddressDisplay"},r?e("div",{className:"AddressDisplay-loading"},e("i",{className:"fas fa-spinner fa-spin"}),e("span",null,"Generating address...")):a?e("div",{className:"AddressDisplay-content"},e("div",{className:"AddressDisplay-address",title:a},a),e("div",{className:"AddressDisplay-actions"},e("button",{className:"AddressDisplay-copyBtn",onclick:o,title:"Copy address"},d("fas fa-copy")))):e("div",{className:"AddressDisplay-placeholder"},e("span",null,"No address available")))}}class at extends g{constructor(){super(...arguments),this.qrElement=null}view(t){const{loading:a,size:r=160}=t.attrs;return e("div",{className:"QRCodeDisplay",style:{width:`${r}px`,height:`${r}px`}},a?e("div",{className:"QRCodeDisplay-loading"},e("i",{className:"fas fa-spinner fa-spin"})):e("div",{className:"QRCodeDisplay-qr",ref:o=>{this.qrElement=o}}))}oncreate(t){super.oncreate(t),this.generateQR(t.attrs)}onupdate(t){super.onupdate(t),this.generateQR(t.attrs)}generateQR(t){if(!(!this.qrElement||t.loading||!t.data)){this.qrElement.innerHTML="";try{typeof QRCode<"u"?new QRCode(this.qrElement,{text:t.data,width:t.size||160,height:t.size||160,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.M}):this.generateQRWithService(t)}catch(a){console.error("Error generating QR code:",a),this.showQRError()}}}generateQRWithService(t){if(!this.qrElement)return;const a=t.size||160,r=encodeURIComponent(t.data),o=document.createElement("img");o.src=`https://api.qrserver.com/v1/create-qr-code/?size=${a}x${a}&data=${r}`,o.alt="QR Code",o.style.width="100%",o.style.height="100%",o.onerror=()=>this.showQRError(),this.qrElement.appendChild(o)}showQRError(){this.qrElement&&(this.qrElement.innerHTML=`
      <div class="QRCodeDisplay-error">
        <i class="fas fa-exclamation-triangle"></i>
        <span>Unable to generate QR code</span>
      </div>
    `)}}class st extends g{view(t){const{transactions:a,loading:r}=t.attrs;return r?e("div",{className:"DepositHistory"},e("div",{className:"DepositHistory-loading"},e("i",{className:"fas fa-spinner fa-spin"}),e("span",null,"Loading deposit history..."))):!a||a.length===0?e("div",{className:"DepositHistory"},e("div",{className:"DepositHistory-empty"},e("div",{className:"DepositHistory-emptyIcon"},d("fas fa-inbox")),e("h3",null,"No deposits yet"),e("p",null,"Your deposit transactions will appear here once you make a deposit."))):e("div",{className:"DepositHistory"},e("div",{className:"DepositHistory-header"},e("h3",null,"Deposit History"),e("span",{className:"DepositHistory-count"},a.length," transactions")),e("div",{className:"DepositHistory-list"},a.map(o=>this.renderTransaction(o))))}renderTransaction(t){const a=t.platform?.(),r=n(t,"amount")||0,o=n(t,"status")||"",c=n(t,"statusColor")||"secondary",u=n(t,"transactionHash"),w=n(t,"explorerUrl"),f=n(t,"createdAt"),h=n(t,"completedAt"),b=n(t,"confirmations")||0,p=n(t,"requiredConfirmations")||1;return e("div",{key:n(t,"id"),className:"DepositHistory-item"},e("div",{className:"DepositHistory-itemHeader"},e("div",{className:"DepositHistory-itemPlatform"},a&&e("[",null,e("div",{className:"DepositHistory-itemIcon"},this.renderPlatformIcon(a)),e("div",{className:"DepositHistory-itemInfo"},e("span",{className:"DepositHistory-itemCurrency"},n(a,"symbol")),e("span",{className:"DepositHistory-itemNetwork"},n(a,"network"))))),e("div",{className:"DepositHistory-itemAmount"},e("span",{className:"DepositHistory-itemAmountValue"},"+",r," ",a?n(a,"symbol"):""),e("div",{className:`DepositHistory-itemStatus status-${c}`},this.getStatusIcon(o),this.getStatusText(o)))),e("div",{className:"DepositHistory-itemDetails"},e("div",{className:"DepositHistory-itemMeta"},e("span",{className:"DepositHistory-itemTime"},f?O(f):"Unknown time"),o==="confirmed"||o==="completed"?e("span",{className:"DepositHistory-itemConfirmations"},b,"/",p," confirmations"):null),u&&e("div",{className:"DepositHistory-itemHash"},e("span",{className:"DepositHistory-itemHashLabel"},"Transaction:"),w?e("a",{href:w,target:"_blank",rel:"noopener noreferrer",className:"DepositHistory-itemHashLink"},this.formatHash(u),d("fas fa-external-link-alt")):e("span",{className:"DepositHistory-itemHashText"},this.formatHash(u))),h&&e("div",{className:"DepositHistory-itemCompleted"},e("span",null,"Credited: ",O(h)))))}renderPlatformIcon(t){const a=n(t,"iconUrl"),r=n(t,"iconClass"),o=n(t,"symbol");if(a)return e("img",{src:a,alt:o,className:"DepositHistory-platformImg"});if(r)return d(r);switch(o){case"USDT":return e("span",{className:"DepositHistory-currencyIcon usdt"},"₮");case"USDC":return e("span",{className:"DepositHistory-currencyIcon usdc"},"$");case"BTC":return e("span",{className:"DepositHistory-currencyIcon btc"},"₿");case"ETH":return e("span",{className:"DepositHistory-currencyIcon eth"},"Ξ");default:return d("fas fa-coins")}}getStatusIcon(t){switch(t){case"pending":return d("fas fa-clock");case"confirmed":return d("fas fa-check-circle");case"completed":return d("fas fa-check-double");case"failed":return d("fas fa-times-circle");case"cancelled":return d("fas fa-ban");default:return d("fas fa-question-circle")}}getStatusText(t){switch(t){case"pending":return"Pending";case"confirmed":return"Confirmed";case"completed":return"Completed";case"failed":return"Failed";case"cancelled":return"Cancelled";default:return"Unknown"}}formatHash(t){return t.length<=16?t:`${t.substring(0,8)}...${t.substring(t.length-8)}`}}class rt extends H{constructor(){super(...arguments),this.state={platforms:[],transactions:[],loading:!0,activeTab:N("deposit")},this.formData={selectedPlatform:N(null)},this.addressData={address:"",qrCodeData:"",platform:null,loading:!1},this.currencies=[],this.networks=[],this.selectedCurrency=N(""),this.selectedNetwork=N("")}oninit(t){super.oninit(t),s.setTitle(s.translator.trans("withdrawal.forum.deposit.page.title")),this.loadPlatforms(),this.loadTransactions()}view(){return this.state.loading?e("div",{className:"DepositPage"},e("div",{className:"DepositPage-loading"},e(S,null))):e("div",{className:"DepositPage"},e("div",{className:"DepositPage-modal"},this.renderHeader(),e("div",{className:"DepositPage-content"},this.state.activeTab()==="deposit"?this.renderDepositTab():this.renderHistoryTab())))}renderHeader(){return e("div",{className:"DepositPage-header"},e("div",{className:"DepositPage-tabs"},e("div",{className:`DepositPage-tab ${this.state.activeTab()==="deposit"?"active":""}`,onclick:()=>this.handleTabChange("deposit")},s.translator.trans("withdrawal.forum.deposit.tabs.deposit")),e("div",{className:`DepositPage-tab ${this.state.activeTab()==="history"?"active":""}`,onclick:()=>this.handleTabChange("history")},s.translator.trans("withdrawal.forum.deposit.tabs.history"))),e(C,{className:"DepositPage-close",icon:"fas fa-times",onclick:()=>s.history.back()}))}renderDepositTab(){return(this.state.platforms||[]).filter(a=>a&&n(a,"isActive")).length===0?e("div",{className:"DepositPage-emptyState"},e("div",{className:"DepositPage-emptyIcon"},d("fas fa-coins")),e("h3",{className:"DepositPage-emptyTitle"},s.translator.trans("withdrawal.forum.deposit.no_platforms")),e("p",{className:"DepositPage-emptyDescription"},s.translator.trans("withdrawal.forum.deposit.no_platforms_description"))):e("div",{className:"DepositPage-depositTab"},this.renderSelectors(),this.renderDepositInfo())}renderSelectors(){return e("div",{className:"DepositPage-selectors"},e($,{currencies:this.currencies,selected:this.selectedCurrency(),onSelect:t=>this.handleCurrencyChange(t),loading:this.state.loading}),e(tt,{networks:this.networks,selected:this.selectedNetwork(),onSelect:t=>this.handleNetworkChange(t),loading:this.state.loading||!this.selectedCurrency(),disabled:!this.selectedCurrency()}))}renderDepositInfo(){const t=this.formData.selectedPlatform();if(!t)return e("div",{className:"DepositPage-selectPrompt"},e("p",null,s.translator.trans("withdrawal.forum.deposit.select_currency_network")));const a=n(t,"minAmount")||0,r=n(t,"warningText")||s.translator.trans("withdrawal.forum.deposit.default_warning",{currency:n(t,"symbol"),network:n(t,"network"),minAmount:a});return e("div",{className:"DepositPage-depositInfo"},e("p",{className:"DepositPage-instructionText"},s.translator.trans("withdrawal.forum.deposit.scan_or_use_address")),e(et,{address:this.addressData.address,loading:this.addressData.loading,onCopy:this.handleCopyAddress.bind(this)}),e("p",{className:"DepositPage-minAmountText"},s.translator.trans("withdrawal.forum.deposit.min_amount",{amount:a,currency:n(t,"symbol")})),e("div",{className:"DepositPage-qrContainer"},e(at,{data:this.addressData.qrCodeData,loading:this.addressData.loading,size:160})),e("div",{className:"DepositPage-infoPanel"},e("i",{className:"fas fa-info-circle"}),e("span",null,r)))}renderHistoryTab(){return e(st,{transactions:this.state.transactions,platforms:this.state.platforms,loading:!1})}handleTabChange(t){this.state.activeTab(t)}handleCurrencyChange(t){this.selectedCurrency(t),this.selectedNetwork(""),this.formData.selectedPlatform(null),this.updateNetworks()}handleNetworkChange(t){this.selectedNetwork(t),this.updateSelectedPlatform()}handleCopyAddress(){this.addressData.address&&navigator.clipboard.writeText(this.addressData.address).then(()=>{s.alerts.show({type:"success",dismissible:!0},s.translator.trans("withdrawal.forum.deposit.address_copied"))}).catch(()=>{s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.forum.deposit.copy_failed"))})}updateNetworks(){const t=this.selectedCurrency();if(!t){this.networks=[];return}this.networks=this.state.platforms.filter(a=>n(a,"symbol")===t&&n(a,"isActive")).map(a=>n(a,"network")).filter((a,r,o)=>o.indexOf(a)===r)}updateSelectedPlatform(){const t=this.selectedCurrency(),a=this.selectedNetwork();if(!t||!a){this.formData.selectedPlatform(null);return}const r=this.state.platforms.find(o=>n(o,"symbol")===t&&n(o,"network")===a&&n(o,"isActive"));r&&(this.formData.selectedPlatform(r),this.loadDepositAddress(r))}async loadPlatforms(){try{const t=await s.request({method:"GET",url:s.forum.attribute("apiUrl")+"/deposit-platforms"});s.store.pushPayload(t),this.state.platforms=s.store.all("deposit-platforms"),this.currencies=this.state.platforms.filter(a=>n(a,"isActive")).map(a=>n(a,"symbol")).filter((a,r,o)=>o.indexOf(a)===r),this.state.loading=!1,e.redraw()}catch(t){console.error("Error loading deposit platforms:",t),this.state.loading=!1,e.redraw()}}async loadTransactions(){try{const t=await s.request({method:"GET",url:s.forum.attribute("apiUrl")+"/deposit-transactions"});s.store.pushPayload(t),this.state.transactions=s.store.all("deposit-transactions")}catch(t){console.error("Error loading deposit transactions:",t)}}async loadDepositAddress(t){this.addressData.loading=!0,e.redraw();try{const r=(await s.request({method:"GET",url:s.forum.attribute("apiUrl")+"/deposit-address",params:{platform_id:n(t,"id")}})).data;this.addressData={address:r.attributes.address,addressTag:r.attributes.addressTag,qrCodeData:r.attributes.qrCodeData,platform:t,loading:!1},e.redraw()}catch(a){console.error("Error loading deposit address:",a),this.addressData.loading=!1,s.alerts.show({type:"error",dismissible:!0},s.translator.trans("withdrawal.forum.deposit.address_load_error")),e.redraw()}}}class it extends i{constructor(){super(...arguments),this.name=i.attribute("name"),this.symbol=i.attribute("symbol"),this.minAmount=i.attribute("minAmount"),this.maxAmount=i.attribute("maxAmount"),this.fee=i.attribute("fee"),this.iconUrl=i.attribute("iconUrl"),this.iconClass=i.attribute("iconClass"),this.isActive=i.attribute("isActive"),this.createdAt=i.attribute("createdAt",i.transformDate),this.updatedAt=i.attribute("updatedAt",i.transformDate)}apiEndpoint(){return`/withdrawal-platforms/${this.id()}`}displayName(){const t=this.symbol(),a=this.name();return t?`${a} (${t})`:a}isValidAmount(t){const a=this.minAmount(),r=this.maxAmount();return t>=a&&t<=r}getTotalCost(t){return t+this.fee()}}const P={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class ot extends i{constructor(){super(...arguments),this.amount=i.attribute("amount"),this.accountDetails=i.attribute("accountDetails"),this.status=i.attribute("status"),this.platformId=i.attribute("platformId"),this.userId=i.attribute("userId"),this.createdAt=i.attribute("createdAt",i.transformDate),this.updatedAt=i.attribute("updatedAt",i.transformDate),this.user=i.hasOne("user"),this.platform=i.hasOne("platform")}apiEndpoint(){return`/withdrawal-requests/${this.id()}`}isPending(){return this.status()===P.PENDING}isApproved(){return this.status()===P.APPROVED}isRejected(){return this.status()===P.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const t=this.status();return app.translator.trans(`withdrawal.forum.status.${t}`)}statusColor(){switch(this.status()){case P.APPROVED:return"success";case P.REJECTED:return"danger";case P.PENDING:default:return"warning"}}}class nt extends i{constructor(){super(...arguments),this.name=i.attribute("name"),this.symbol=i.attribute("symbol"),this.network=i.attribute("network"),this.displayName=i.attribute("displayName"),this.minAmount=i.attribute("minAmount"),this.maxAmount=i.attribute("maxAmount"),this.address=i.attribute("address"),this.addressTemplate=i.attribute("addressTemplate"),this.iconUrl=i.attribute("iconUrl"),this.iconClass=i.attribute("iconClass"),this.qrCodeTemplate=i.attribute("qrCodeTemplate"),this.warningText=i.attribute("warningText"),this.networkConfig=i.attribute("networkConfig"),this.isActive=i.attribute("isActive"),this.createdAt=i.attribute("createdAt",i.transformDate),this.updatedAt=i.attribute("updatedAt",i.transformDate)}}class lt extends i{constructor(){super(...arguments),this.address=i.attribute("address"),this.addressTag=i.attribute("addressTag"),this.fullAddress=i.attribute("fullAddress"),this.qrCodeData=i.attribute("qrCodeData"),this.isActive=i.attribute("isActive"),this.lastUsedAt=i.attribute("lastUsedAt",i.transformDate),this.createdAt=i.attribute("createdAt",i.transformDate),this.updatedAt=i.attribute("updatedAt",i.transformDate),this.user=i.hasOne("user"),this.platform=i.hasOne("platform")}}class ct extends i{constructor(){super(...arguments),this.amount=i.attribute("amount"),this.fee=i.attribute("fee"),this.creditedAmount=i.attribute("creditedAmount"),this.transactionHash=i.attribute("transactionHash"),this.fromAddress=i.attribute("fromAddress"),this.memo=i.attribute("memo"),this.status=i.attribute("status"),this.statusColor=i.attribute("statusColor"),this.blockchainData=i.attribute("blockchainData"),this.confirmations=i.attribute("confirmations"),this.requiredConfirmations=i.attribute("requiredConfirmations"),this.hasEnoughConfirmations=i.attribute("hasEnoughConfirmations"),this.canBeCompleted=i.attribute("canBeCompleted"),this.explorerUrl=i.attribute("explorerUrl"),this.detectedAt=i.attribute("detectedAt",i.transformDate),this.confirmedAt=i.attribute("confirmedAt",i.transformDate),this.completedAt=i.attribute("completedAt",i.transformDate),this.adminNotes=i.attribute("adminNotes"),this.createdAt=i.attribute("createdAt",i.transformDate),this.updatedAt=i.attribute("updatedAt",i.transformDate),this.user=i.hasOne("user"),this.platform=i.hasOne("platform"),this.depositAddress=i.hasOne("depositAddress"),this.processedBy=i.hasOne("processedBy")}}class dt extends g{view(){if(!s.session.user)return null;const a=(s.forum.attribute("antoinefr-money.moneyname")||"[money]").replace("[money]",s.session.user.attribute("money")),r=s.forum.attribute("wusong8899-withdrawal.moneyIconUrl");return m("div",{id:"moneyDisplayContainer",className:"client1-header-adv-wrapper clientCustomizeWithdrawalHeaderTotalMoney"},m("div",{className:"clientCustomizeWithdrawalHeaderText"},r&&r.trim()&&m("span",{style:{borderRadius:"50%",padding:"6px 8px",marginRight:"8px",display:"inline-flex",alignItems:"center",justifyContent:"center"}},m("img",{src:r,alt:"Money icon",style:{width:"20px",height:"20px"},onError:o=>{const c=o.target;c.style.display="none"}})),a),m("div",{className:"clientCustomizeWithdrawalHeaderIcon"},m("i",{className:"fas fa-wallet"})),m("div",{className:"clientCustomizeWithdrawalButton",onclick:this.handleWithdrawalClick.bind(this),title:"提款"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",{style:{marginLeft:"4px",fontSize:"12px"}},"提款")))}handleWithdrawalClick(t){t.preventDefault(),t.stopPropagation(),window.location.href="/withdrawal"}}class mt extends g{view(){const t=s.session.user?.attribute("money")||0,a=s.forum.attribute("wusong8899-withdrawal.moneyIconUrl");return m("div",{className:"Navigation-mobileMoneyDisplay"},m("div",{className:"Navigation-moneySection",onclick:this.handleWithdrawalClick.bind(this),title:`余额: ${t} - 点击提款`},m("div",{className:"Navigation-moneyText"},a&&a.trim()&&m("span",{style:{borderRadius:"50%",padding:"4px 6px",marginRight:"6px",display:"inline-flex",alignItems:"center",justifyContent:"center"}},m("img",{src:a,alt:"Money icon",style:{width:"18px",height:"18px"},onError:r=>{const o=r.target;o.style.display="none"}})),m("span",{className:"Navigation-moneyAmount"},t)),m("div",{className:"Navigation-withdrawalButton"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",null,"提款"))))}handleWithdrawalClick(t){t.preventDefault(),t.stopPropagation(),console.log("MobileMoneyDisplay clicked!");try{window.location.href="/withdrawal"}catch(a){console.error("Navigation error:",a),window.location.href="/withdrawal"}}}class A{constructor(){}static getInstance(){return A.instance||(A.instance=new A),A.instance}isTagsPage(){try{return s.current?.get("routeName")==="index"}catch{return!1}}}function W(){return window.innerWidth<=767}function x(){return window.innerWidth>=768&&window.innerWidth<=1024}function ut(){return window.innerWidth>1024}function ht(){return W()||x()}function ft(){return W()?"mobile":x()?"tablet":"desktop"}function wt(){return"ontouchstart"in window||navigator.maxTouchPoints>0}const gt={isMobile:W,isTablet:x,isDesktop:ut,isMobileOrTablet:ht,getCurrentBreakpoint:ft,isTouchDevice:wt};s.initializers.add("wusong8899-withdrawal",()=>{s.store.models["withdrawal-platforms"]=it,s.store.models["withdrawal-requests"]=ot,s.store.models["deposit-platforms"]=nt,s.store.models["deposit-addresses"]=lt,s.store.models["deposit-transactions"]=ct,s.routes.withdrawal={path:"/withdrawal",component:M},s.routes.deposit={path:"/deposit",component:rt},E.extend(_.prototype,"view",function(l){const t=A.getInstance();s.session.user&&t.isTagsPage()&&!gt.isMobile()&&l.children.push(dt.component())}),E.extend(B.prototype,"view",function(l){if(window.innerWidth>768||s.current.get("routeName")!=="tags"||!s.session.user||!l||!l.children||!Array.isArray(l.children))return;l.children.some(r=>r&&r.attrs&&r.attrs.className&&r.attrs.className.includes("Navigation-mobileMoneyDisplay"))||l.children.push(mt.component({className:"item-withdrawal Navigation-mobileMoneyDisplay"}))})})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["forum/components/HeaderPrimary"],flarum.core.compat["common/components/Navigation"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/icon"],m,flarum.core.compat["common/Component"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=forum.js.map

module.exports={};