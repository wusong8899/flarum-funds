(function(e,v,O,B,p,q,D,T,b,h,g,o){"use strict";const E=r=>typeof r.id=="function"?r.id():r.id,n=(r,t)=>typeof r[t]=="function"?r[t]():r.attributes?r.attributes[t]:r[t],W=r=>String(E(r)),L=(r,t)=>{const a=String(t);return r.find(s=>{const i=E(s);return String(i)===a})},R=(r,t)=>{const a=n(r,t);return a?new Date(a):new Date},C={pending:"warning",approved:"success",rejected:"danger"},f={MIN_AMOUNT:.001,MAX_AMOUNT:10,FEE:5e-4,BALANCE_PRECISION:8},P={COINS:"fas fa-coins",CHEVRON_DOWN:"fas fa-chevron-down",PASTE:"fas fa-paste",BOOKMARK:"fas fa-bookmark"};class A{view(t){const{platform:a,className:s="",size:i="medium"}=t.attrs;if(!a)return g(P.COINS,{className:`crypto-icon default ${s}`});const l=n(a,"iconUrl"),d=n(a,"iconClass"),u=n(a,"name"),c=n(a,"symbol"),w=`platform-icon-${i}`;if(l)return m("img",{src:l,alt:u||"Platform",className:`platform-icon-image ${w} ${s}`,onerror:it=>{const F=it.target;F.style.display="none";const k=document.createElement("i"),ot=d||P.COINS;k.className=`${ot} crypto-icon ${s}`,F.parentElement?.appendChild(k)}});const st=d||P.COINS,rt=c?.toLowerCase()||"default";return g(st,{className:`crypto-icon ${rt} ${w} ${s}`})}}class U extends h{oninit(t){super.oninit(t),this.state={showDropdown:!1}}view(){const{selectedPlatform:t}=this.attrs,{showDropdown:a}=this.state;return m("div",{className:"WithdrawalPage-platformSelector"},m("div",{className:"WithdrawalPage-label"},"提取平台"),m("div",{className:"WithdrawalPage-platformDropdown",onclick:()=>this.toggleDropdown()},m("div",{className:"WithdrawalPage-platformSelected"},m("div",{className:"WithdrawalPage-platformInfo"},m("div",{className:"WithdrawalPage-platformIcon"},m(A,{platform:t,size:"medium"})),m("div",{className:"WithdrawalPage-platformDetails"},m("div",{className:"WithdrawalPage-platformName"},this.getPlatformName(t))))),g(P.CHEVRON_DOWN,{className:"WithdrawalPage-dropdownIcon"})),a&&this.renderPlatformDropdown())}toggleDropdown(){this.state.showDropdown=!this.state.showDropdown}getPlatformName(t){return t&&n(t,"name")||"请选择平台"}renderPlatformDropdown(){const{platforms:t}=this.attrs,a=(t||[]).filter(s=>!!s);return a.length===0?m("div",{className:"WithdrawalPage-dropdownMenu"},m("div",{className:"WithdrawalPage-dropdownItem WithdrawalPage-noData"},e.translator.trans("withdrawal.forum.no_platforms"))):m("div",{className:"WithdrawalPage-dropdownMenu"},a.map(s=>m("div",{key:s.id,className:"WithdrawalPage-dropdownItem",onclick:()=>this.selectPlatform(s)},m("div",{className:"WithdrawalPage-platformIcon"},m(A,{platform:s,size:"small"})),m("div",{className:"WithdrawalPage-platformName"},n(s,"name")))))}selectPlatform(t){const{onPlatformSelect:a,onAmountChange:s}=this.attrs;a(t),this.state.showDropdown=!1,s&&s()}}class _ extends h{view(){const{amount:t,selectedPlatform:a,loadingBalance:s,onAmountChange:i,onFillAllAmount:l}=this.attrs,d=this.getMinAmount(a),u=this.getMaxAmount(a),c=this.getFee(a);return m("div",{className:"WithdrawalPage-amountSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-label"},e.translator.trans("withdrawal.forum.form.amount")),m("div",{className:"WithdrawalPage-amountInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:"0.00000000",value:t,oninput:w=>i(w.target.value)}),m(D,{className:"WithdrawalPage-allButton",onclick:l,disabled:s},e.translator.trans("withdrawal.forum.form.all_button"))),m("div",{className:"WithdrawalPage-amountLimits"},m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},e.translator.trans("withdrawal.forum.limits.min_max")),m("span",{className:"WithdrawalPage-limitValue"},g(P.COINS)," ",d," ~ ",u)),m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},e.translator.trans("withdrawal.forum.limits.fee")),m("span",{className:"WithdrawalPage-limitValue"},g(P.COINS)," ",c)))))}getMinAmount(t){return t&&n(t,"minAmount")||f.MIN_AMOUNT}getMaxAmount(t){return t&&n(t,"maxAmount")||f.MAX_AMOUNT}getFee(t){return t&&n(t,"fee")||f.FEE}}class M extends h{view(){const{accountDetails:t,selectedPlatform:a,saveAddress:s,onAccountDetailsChange:i,onSaveAddressToggle:l}=this.attrs,d=this.getSymbol(a);return m("div",{className:"WithdrawalPage-addressSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-addressHeader"},m("span",{className:"WithdrawalPage-label"},e.translator.trans("withdrawal.forum.form.address",{symbol:d}),m("span",{className:"WithdrawalPage-required"},"*")),m("div",{className:"WithdrawalPage-saveAddress",onclick:()=>l(!s)},g(P.BOOKMARK),e.translator.trans("withdrawal.forum.form.save_address"))),m("div",{className:"WithdrawalPage-addressInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:e.translator.trans("withdrawal.forum.form.address_placeholder"),value:t,oninput:u=>i(u.target.value)}),m("button",{className:"WithdrawalPage-pasteButton",onclick:()=>this.pasteFromClipboard()},g(P.PASTE)))))}getSymbol(t){return t&&n(t,"symbol")||""}async pasteFromClipboard(){const{onAccountDetailsChange:t}=this.attrs;try{if(navigator.clipboard&&navigator.clipboard.readText){const a=await navigator.clipboard.readText();t(a.trim()),m.redraw()}}catch(a){console.error("Failed to read from clipboard:",a),e.alerts.show({type:"error",dismissible:!0},e.translator.trans("withdrawal.forum.clipboard_error"))}}}class H extends h{view(){const{amount:t,selectedPlatform:a,submitting:s,canSubmit:i,onSubmit:l}=this.attrs,d=parseFloat(t)||0,u=this.getFee(a),c=Math.max(0,d-u),w=this.getSymbol(a);return m("div",{className:"WithdrawalPage-submitSection"},m(D,{className:"WithdrawalPage-submitButton",loading:s,disabled:!i,onclick:l},e.translator.trans("withdrawal.forum.form.submit")),d>0&&m("div",{className:"WithdrawalPage-finalAmount"},e.translator.trans("withdrawal.forum.final_amount",{amount:c.toFixed(f.BALANCE_PRECISION),symbol:w})))}getFee(t){return t&&n(t,"fee")||f.FEE}getSymbol(t){return t&&n(t,"symbol")||""}}class z extends h{view(){const{platforms:t,formData:a,loadingBalance:s,submitting:i,onFormDataChange:l,onFillAllAmount:d,onSubmit:u}=this.attrs;return[m(U,{platforms:t,selectedPlatform:a.selectedPlatform,onPlatformSelect:c=>l({selectedPlatform:c}),onAmountChange:()=>l({amount:""})}),m(_,{amount:a.amount,selectedPlatform:a.selectedPlatform,loadingBalance:s,onAmountChange:c=>l({amount:c}),onFillAllAmount:d}),m(M,{accountDetails:a.accountDetails,selectedPlatform:a.selectedPlatform,saveAddress:a.saveAddress,onAccountDetailsChange:c=>l({accountDetails:c}),onSaveAddressToggle:c=>l({saveAddress:c})}),m(H,{amount:a.amount,selectedPlatform:a.selectedPlatform,accountDetails:a.accountDetails,submitting:i,canSubmit:this.canSubmit(),onSubmit:u})]}canSubmit(){const{formData:t,submitting:a}=this.attrs,{selectedPlatform:s,amount:i,accountDetails:l}=t;return!!(s&&i&&l&&!a&&parseFloat(i)>0)}}class V extends h{view(){const{status:t,className:a=""}=this.attrs,s=this.getStatusClass(t),i=this.getStatusLabel(t);return m("div",{className:`WithdrawalPage-historyStatus ${s} ${a}`},i)}getStatusClass(t){return C[t]||C.pending}getStatusLabel(t){return e.translator.trans(`withdrawal.forum.status.${t}`)}}class G extends h{view(){const{request:t,platforms:a}=this.attrs;if(!t)return null;const s=this.getPlatformId(t),i=L(a,s),l=n(t,"status")||"pending",d=R(t,"createdAt"),u=n(t,"amount")||0,c=n(t,"accountDetails")||"";return console.log("Looking for platform with ID:",s,"Available platforms:",a.map(w=>({id:W(w),name:n(w,"name")}))),m("div",{key:W(t),className:"WithdrawalPage-historyItem"},m("div",{className:"WithdrawalPage-historyHeader"},m("div",{className:"WithdrawalPage-historyPlatform"},m("div",{className:"WithdrawalPage-platformIcon"},m(A,{platform:i,size:"small"})),m("div",{className:"WithdrawalPage-historyInfo"},m("div",{className:"WithdrawalPage-historyPlatformName"},this.getPlatformName(i)),m("div",{className:"WithdrawalPage-historyDate"},d.toLocaleDateString()," ",d.toLocaleTimeString()))),m(V,{status:l})),m("div",{className:"WithdrawalPage-historyDetails"},m("div",{className:"WithdrawalPage-historyAmount"},m("span",{className:"WithdrawalPage-historyLabel"},e.translator.trans("withdrawal.forum.history.amount"),":"),m("span",{className:"WithdrawalPage-historyValue"},u," ",this.getPlatformSymbol(i))),m("div",{className:"WithdrawalPage-historyAddress"},m("span",{className:"WithdrawalPage-historyLabel"},e.translator.trans("withdrawal.forum.history.address"),":"),m("span",{className:"WithdrawalPage-historyValue"},c))))}getPlatformId(t){return n(t,"platformId")||t.relationships?.platform?.data?.id||""}getPlatformName(t){return t&&n(t,"name")||"Unknown Platform"}getPlatformSymbol(t){return t&&n(t,"symbol")||""}}class K extends h{view(){const{iconName:t,title:a,description:s,className:i=""}=this.attrs;return m("div",{className:`WithdrawalPage-emptyState ${i}`},m("div",{className:"WithdrawalPage-emptyIcon"},g(t)),m("h3",{className:"WithdrawalPage-emptyTitle"},a),m("p",{className:"WithdrawalPage-emptyDescription"},s))}}function J(r){const{className:t=""}=r;return m("div",{className:`WithdrawalPage-loading ${t}`},m(T,null))}class X extends h{view(){const{requests:t,platforms:a,loading:s}=this.attrs;return s?m(J,{className:"WithdrawalPage-historyLoading"}):!t||t.length===0?m(K,{iconName:"fas fa-history",title:e.translator.trans("withdrawal.forum.history.empty.title"),description:e.translator.trans("withdrawal.forum.history.empty.description"),className:"WithdrawalPage-historyEmpty"}):m("div",{className:"WithdrawalPage-historyList"},t.map(i=>m(G,{key:this.getRequestKey(i),request:i,platforms:a})))}getRequestKey(t){return typeof t.id=="function"?`request-${t.id()}`:`request-${t.id||Math.random()}`}}class Q extends q{constructor(){super(...arguments),this.state={platforms:[],requests:[],loading:!0,loadingBalance:!0,userBalance:0,submitting:!1,activeTab:b("withdrawal")},this.formData={amount:b(""),selectedPlatform:b(null),accountDetails:b(""),saveAddress:b(!1)}}oninit(t){super.oninit(t),e.setTitle(e.translator.trans("withdrawal.forum.page.title")),this.loadData(),this.loadUserBalance()}view(){return this.state.loading?m("div",{className:"WithdrawalPage"},m("div",{className:"WithdrawalPage-loading"},m(T,null))):m("div",{className:"WithdrawalPage"},m("div",{className:"WithdrawalPage-modal"},this.renderHeader(),m("div",{className:"WithdrawalPage-content"},this.state.activeTab()==="withdrawal"?this.renderWithdrawalTab():this.renderHistoryTab())))}renderHeader(){return m("div",{className:"WithdrawalPage-header"},m("div",{className:"WithdrawalPage-tabs"},m("div",{className:`WithdrawalPage-tab ${this.state.activeTab()==="withdrawal"?"active":""}`,onclick:()=>this.handleTabChange("withdrawal")},e.translator.trans("withdrawal.forum.tabs.withdrawal")),m("div",{className:`WithdrawalPage-tab ${this.state.activeTab()==="history"?"active":""}`,onclick:()=>this.handleTabChange("history")},e.translator.trans("withdrawal.forum.tabs.history"))),m(D,{className:"WithdrawalPage-close",icon:"fas fa-times",onclick:()=>e.history.back()}))}renderWithdrawalTab(){return(this.state.platforms||[]).filter(a=>!!a).length===0?m("div",{className:"WithdrawalPage-emptyState"},m("div",{className:"WithdrawalPage-emptyIcon"},icon("fas fa-coins")),m("h3",{className:"WithdrawalPage-emptyTitle"},e.translator.trans("withdrawal.forum.no_platforms")),m("p",{className:"WithdrawalPage-emptyDescription"},e.translator.trans("withdrawal.forum.no_platforms_description"))):m(z,{platforms:this.state.platforms,formData:this.getFormDataForComponent(),loadingBalance:this.state.loadingBalance,submitting:this.state.submitting,onFormDataChange:this.handleFormDataChange.bind(this),onFillAllAmount:this.handleFillAllAmount.bind(this),onSubmit:this.handleSubmit.bind(this)})}renderHistoryTab(){return m(X,{requests:this.state.requests,platforms:this.state.platforms,loading:!1})}handleTabChange(t){this.state.activeTab(t)}getFormDataForComponent(){return{selectedPlatform:this.formData.selectedPlatform(),amount:this.formData.amount(),accountDetails:this.formData.accountDetails(),saveAddress:this.formData.saveAddress()}}handleFormDataChange(t){t.selectedPlatform!==void 0&&this.formData.selectedPlatform(t.selectedPlatform),t.amount!==void 0&&this.formData.amount(t.amount),t.accountDetails!==void 0&&this.formData.accountDetails(t.accountDetails),t.saveAddress!==void 0&&this.formData.saveAddress(t.saveAddress)}handleFillAllAmount(){const t=this.formData.selectedPlatform();if(!t)return;const a=n(t,"fee")||0,s=n(t,"maxAmount")||1/0;let i=this.state.userBalance-a;s<1/0&&i>s&&(i=s),i>0&&this.formData.amount(i.toString())}async handleSubmit(){if(this.state.submitting)return;const t=this.formData.selectedPlatform(),a=this.formData.amount(),s=this.formData.accountDetails();if(!(!t||!a||!s)){this.state.submitting=!0;try{const i=await e.request({method:"POST",url:e.forum.attribute("apiUrl")+"/withdrawal-requests",body:{data:{type:"withdrawal-requests",attributes:{platformId:W(t),amount:parseFloat(a),accountDetails:s,saveAddress:this.formData.saveAddress()}}}});e.store.pushPayload(i),this.formData.amount(""),this.formData.accountDetails(""),this.formData.saveAddress()||this.formData.selectedPlatform(null),this.loadUserBalance(),this.loadWithdrawalRequests(),e.alerts.show({type:"success",dismissible:!0},e.translator.trans("withdrawal.forum.submit_success"))}catch(i){console.error("Withdrawal request failed:",i),e.alerts.show({type:"error",dismissible:!0},e.translator.trans("withdrawal.forum.submit_error"))}finally{this.state.submitting=!1}}}async loadData(){try{const[t,a]=await Promise.all([e.request({method:"GET",url:e.forum.attribute("apiUrl")+"/withdrawal-platforms"}),e.request({method:"GET",url:e.forum.attribute("apiUrl")+"/withdrawal-requests"})]);e.store.pushPayload(t),e.store.pushPayload(a),this.state.platforms=e.store.all("withdrawal-platforms"),this.state.requests=e.store.all("withdrawal-requests"),this.state.loading=!1}catch(t){console.error("Error loading data:",t),this.state.loading=!1}}async loadUserBalance(){try{this.state.loadingBalance=!0,this.state.userBalance=e.session.user?.attribute("money")||0,this.state.loadingBalance=!1}catch(t){console.error("Error loading user balance:",t),this.state.loadingBalance=!1}}async loadWithdrawalRequests(){try{const t=await e.request({method:"GET",url:e.forum.attribute("apiUrl")+"/withdrawal-requests"});e.store.pushPayload(t),this.state.requests=e.store.all("withdrawal-requests")}catch(t){console.error("Error loading withdrawal requests:",t)}}}class Y extends o{constructor(){super(...arguments),this.name=o.attribute("name"),this.symbol=o.attribute("symbol"),this.minAmount=o.attribute("minAmount"),this.maxAmount=o.attribute("maxAmount"),this.fee=o.attribute("fee"),this.iconUrl=o.attribute("iconUrl"),this.iconClass=o.attribute("iconClass"),this.isActive=o.attribute("isActive"),this.createdAt=o.attribute("createdAt",o.transformDate),this.updatedAt=o.attribute("updatedAt",o.transformDate)}apiEndpoint(){return`/withdrawal-platforms/${this.id()}`}displayName(){const t=this.symbol(),a=this.name();return t?`${a} (${t})`:a}isValidAmount(t){const a=this.minAmount(),s=this.maxAmount();return t>=a&&t<=s}getTotalCost(t){return t+this.fee()}}const N={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class Z extends o{constructor(){super(...arguments),this.amount=o.attribute("amount"),this.accountDetails=o.attribute("accountDetails"),this.status=o.attribute("status"),this.platformId=o.attribute("platformId"),this.userId=o.attribute("userId"),this.createdAt=o.attribute("createdAt",o.transformDate),this.updatedAt=o.attribute("updatedAt",o.transformDate),this.user=o.hasOne("user"),this.platform=o.hasOne("platform")}apiEndpoint(){return`/withdrawal-requests/${this.id()}`}isPending(){return this.status()===N.PENDING}isApproved(){return this.status()===N.APPROVED}isRejected(){return this.status()===N.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const t=this.status();return app.translator.trans(`withdrawal.forum.status.${t}`)}statusColor(){switch(this.status()){case N.APPROVED:return"success";case N.REJECTED:return"danger";case N.PENDING:default:return"warning"}}}class j extends h{view(){if(!e.session.user)return null;const a=(e.forum.attribute("antoinefr-money.moneyname")||"[money]").replace("[money]",e.session.user.attribute("money"));return m("div",{id:"moneyDisplayContainer",className:"client1-header-adv-wrapper clientCustomizeWithdrawalHeaderTotalMoney"},m("div",{className:"clientCustomizeWithdrawalHeaderText"},m("span",null,m("i",{className:"fab fa-bitcoin",style:{paddingRight:"8px",color:"gold"}})),a),m("div",{className:"clientCustomizeWithdrawalHeaderIcon"},m("i",{className:"fas fa-wallet"})),m("div",{className:"clientCustomizeWithdrawalButton",onclick:this.handleWithdrawalClick.bind(this),title:"提款"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",{style:{marginLeft:"4px",fontSize:"12px"}},"提款")))}handleWithdrawalClick(t){t.preventDefault(),t.stopPropagation(),window.location.href="/withdrawal"}}class y{constructor(){}static getInstance(){return y.instance||(y.instance=new y),y.instance}isTagsPage(){try{return e.current?.get("routeName")==="index"}catch{return!1}}}function S(){return window.innerWidth<=767}function I(){return window.innerWidth>=768&&window.innerWidth<=1024}function $(){return window.innerWidth>1024}function tt(){return S()||I()}function at(){return S()?"mobile":I()?"tablet":"desktop"}function et(){return"ontouchstart"in window||navigator.maxTouchPoints>0}const x={isMobile:S,isTablet:I,isDesktop:$,isMobileOrTablet:tt,getCurrentBreakpoint:at,isTouchDevice:et};e.initializers.add("wusong8899-withdrawal",()=>{e.store.models["withdrawal-platforms"]=Y,e.store.models["withdrawal-requests"]=Z,e.routes.withdrawal={path:"/withdrawal",component:Q},v.extend(B.prototype,"items",function(r){e.session.user&&r.add("withdrawal",O.component({href:e.route("withdrawal"),icon:"fas fa-money-bill-transfer"},e.translator.trans("withdrawal.forum.header.withdrawal_button")),10)}),v.extend(p.prototype,"view",function(r){const t=y.getInstance();e.session.user&&t.isTagsPage()&&!x.isMobile()&&r.children.push(j.component())}),v.extend(p.prototype,"oncreate",function(){e.session.user&&x.isMobile()&&this.insertMobileMoneyDisplay()}),p.prototype.insertMobileMoneyDisplay=function(){setTimeout(()=>{const r=document.querySelector("#app-navigation .Navigation.ButtonGroup.App-backControl");if(r&&!r.querySelector(".Navigation-mobileMoneyDisplay")){const t=document.createElement("div");t.className="Navigation-mobileMoneyDisplay";const a=e.session.user?.attribute("money")||0;t.innerHTML=`
          <div class="Navigation-moneySection" title="余额: ${a} - 点击提款">
            <div class="Navigation-moneyText">
              <i class="fab fa-bitcoin" style="color: #f7931a; margin-right: 4px;"></i>
              <span class="Navigation-moneyAmount">${a}</span>
            </div>
            <div class="Navigation-withdrawalButton">
              <i class="fas fa-money-bill-transfer"></i>
              <span>提款</span>
            </div>
          </div>
        `,t.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),console.log("Mobile money display clicked!");try{window.location.href="/withdrawal"}catch(i){console.error("Navigation error:",i),window.location.href="/withdrawal"}}),r.appendChild(t)}},200)}})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["common/components/LinkButton"],flarum.core.compat["forum/components/HeaderSecondary"],flarum.core.compat["forum/components/HeaderPrimary"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/Component"],flarum.core.compat["common/helpers/icon"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=forum.js.map

module.exports={};