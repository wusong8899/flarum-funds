(function(e,x,q,R,L,T,S,v,f,l,g,k,r){"use strict";const E=d=>typeof d.id=="function"?d.id():d.id,n=(d,t)=>typeof d[t]=="function"?d[t]():d.attributes?d.attributes[t]:d[t],H=d=>String(E(d)),z=(d,t)=>{const a=String(t);return d.find(s=>{const i=E(s);return String(i)===a})},G=(d,t)=>{const a=n(d,t);return a?new Date(a):new Date},U={pending:"warning",approved:"success",rejected:"danger"},b={MIN_AMOUNT:.001,MAX_AMOUNT:10,FEE:5e-4,BALANCE_PRECISION:8},N={COINS:"fas fa-coins",CHEVRON_DOWN:"fas fa-chevron-down",PASTE:"fas fa-paste",BOOKMARK:"fas fa-bookmark"};class F{view(t){const{platform:a,className:s="",size:i="medium"}=t.attrs;if(!a)return f(N.COINS,{className:`crypto-icon default ${s}`});const o=n(a,"iconUrl"),u=n(a,"iconClass"),w=n(a,"name"),h=n(a,"symbol"),c=`platform-icon-${i}`;if(o)return m("img",{src:o,alt:w||"Platform",className:`platform-icon-image ${c} ${s}`,onerror:P=>{const B=P.target;B.style.display="none";const O=document.createElement("i"),ft=u||N.COINS;O.className=`${ft} crypto-icon ${s}`,B.parentElement?.appendChild(O)}});const y=u||N.COINS,p=h?.toLowerCase()||"default";return f(y,{className:`crypto-icon ${p} ${c} ${s}`})}}class V extends g{oninit(t){super.oninit(t),this.state={showDropdown:!1}}view(){const{selectedPlatform:t}=this.attrs,{showDropdown:a}=this.state;return m("div",{className:"WithdrawalPage-platformSelector"},m("div",{className:"WithdrawalPage-label"},"提取平台"),m("div",{className:"WithdrawalPage-platformDropdown",onclick:()=>this.toggleDropdown()},m("div",{className:"WithdrawalPage-platformSelected"},m("div",{className:"WithdrawalPage-platformInfo"},m("div",{className:"WithdrawalPage-platformIcon"},m(F,{platform:t,size:"medium"})),m("div",{className:"WithdrawalPage-platformDetails"},m("div",{className:"WithdrawalPage-platformName"},this.getPlatformName(t))))),f(N.CHEVRON_DOWN,{className:"WithdrawalPage-dropdownIcon"})),a&&this.renderPlatformDropdown())}toggleDropdown(){this.state.showDropdown=!this.state.showDropdown}getPlatformName(t){return t&&(n(t,"displayName")||n(t,"name"))||"请选择平台"}renderPlatformDropdown(){const{platforms:t}=this.attrs,a=(t||[]).filter(s=>!!s);return a.length===0?m("div",{className:"WithdrawalPage-dropdownMenu"},m("div",{className:"WithdrawalPage-dropdownItem WithdrawalPage-noData"},e.translator.trans("withdrawal.forum.no_platforms"))):m("div",{className:"WithdrawalPage-dropdownMenu"},a.map(s=>m("div",{key:s.id,className:"WithdrawalPage-dropdownItem",onclick:()=>this.selectPlatform(s)},m("div",{className:"WithdrawalPage-platformIcon"},m(F,{platform:s,size:"small"})),m("div",{className:"WithdrawalPage-platformName"},n(s,"displayName")||n(s,"name")))))}selectPlatform(t){const{onPlatformSelect:a,onAmountChange:s}=this.attrs;a(t),this.state.showDropdown=!1,s&&s()}}class j extends g{view(){const{amount:t,selectedPlatform:a,loadingBalance:s,onAmountChange:i,onFillAllAmount:o}=this.attrs,u=this.getMinAmount(a),w=this.getMaxAmount(a),h=this.getFee(a);return m("div",{className:"WithdrawalPage-amountSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-label"},e.translator.trans("withdrawal.forum.form.amount")),m("div",{className:"WithdrawalPage-amountInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:"0.00000000",value:t,oninput:c=>i(c.target.value)}),m(T,{className:"WithdrawalPage-allButton",onclick:o,disabled:s},e.translator.trans("withdrawal.forum.form.all_button"))),m("div",{className:"WithdrawalPage-amountLimits"},m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},e.translator.trans("withdrawal.forum.limits.min_max")),m("span",{className:"WithdrawalPage-limitValue"},f(N.COINS)," ",u," ~ ",w)),m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},e.translator.trans("withdrawal.forum.limits.fee")),m("span",{className:"WithdrawalPage-limitValue"},f(N.COINS)," ",h)))))}getMinAmount(t){return t&&n(t,"minAmount")||b.MIN_AMOUNT}getMaxAmount(t){return t&&n(t,"maxAmount")||b.MAX_AMOUNT}getFee(t){return t&&n(t,"fee")||b.FEE}}class K extends g{view(){const{accountDetails:t,selectedPlatform:a,saveAddress:s,onAccountDetailsChange:i,onSaveAddressToggle:o}=this.attrs,u=this.getSymbol(a);return m("div",{className:"WithdrawalPage-addressSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-addressHeader"},m("span",{className:"WithdrawalPage-label"},e.translator.trans("withdrawal.forum.form.address",{symbol:u}),m("span",{className:"WithdrawalPage-required"},"*")),m("div",{className:"WithdrawalPage-saveAddress",onclick:()=>o(!s)},f(N.BOOKMARK),e.translator.trans("withdrawal.forum.form.save_address"))),m("div",{className:"WithdrawalPage-addressInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:e.translator.trans("withdrawal.forum.form.address_placeholder"),value:t,oninput:w=>i(w.target.value)}),m("button",{className:"WithdrawalPage-pasteButton",onclick:()=>this.pasteFromClipboard()},f(N.PASTE)))))}getSymbol(t){return t&&n(t,"symbol")||""}async pasteFromClipboard(){const{onAccountDetailsChange:t}=this.attrs;try{if(navigator.clipboard&&navigator.clipboard.readText){const a=await navigator.clipboard.readText();t(a.trim()),m.redraw()}}catch(a){console.error("Failed to read from clipboard:",a),e.alerts.show({type:"error",dismissible:!0},e.translator.trans("withdrawal.forum.clipboard_error"))}}}class J extends g{view(){const{message:t,onMessageChange:a}=this.attrs;return m("div",{className:"WithdrawalPage-messageSection"},m("div",{className:"WithdrawalPage-formGroup"},m("span",{className:"WithdrawalPage-label"},e.translator.trans("withdrawal.forum.form.message")),m("textarea",{className:"WithdrawalPage-textarea",placeholder:e.translator.trans("withdrawal.forum.form.message_placeholder"),value:t,rows:3,maxlength:500,oninput:s=>a(s.target.value)}),m("div",{className:"WithdrawalPage-helperText"},e.translator.trans("withdrawal.forum.form.message_helper")," (",t.length,"/500)")))}}class X extends g{view(){const{amount:t,selectedPlatform:a,submitting:s,canSubmit:i,onSubmit:o}=this.attrs,u=parseFloat(t)||0,w=this.getFee(a),h=Math.max(0,u-w),c=this.getSymbol(a);return m("div",{className:"WithdrawalPage-submitSection"},m(T,{className:"WithdrawalPage-submitButton",loading:s,disabled:!i,onclick:o},e.translator.trans("withdrawal.forum.form.submit")),u>0&&m("div",{className:"WithdrawalPage-finalAmount"},e.translator.trans("withdrawal.forum.final_amount",{amount:h.toFixed(b.BALANCE_PRECISION),symbol:c})))}getFee(t){return t&&n(t,"fee")||b.FEE}getSymbol(t){return t&&n(t,"symbol")||""}}class Y extends g{view(){const{platforms:t,formData:a,loadingBalance:s,submitting:i,onFormDataChange:o,onFillAllAmount:u,onSubmit:w}=this.attrs;return[m(V,{platforms:t,selectedPlatform:a.selectedPlatform,onPlatformSelect:h=>o({selectedPlatform:h}),onAmountChange:()=>o({amount:""})}),m(j,{amount:a.amount,selectedPlatform:a.selectedPlatform,loadingBalance:s,onAmountChange:h=>o({amount:h}),onFillAllAmount:u}),m(K,{accountDetails:a.accountDetails,selectedPlatform:a.selectedPlatform,saveAddress:a.saveAddress,onAccountDetailsChange:h=>o({accountDetails:h}),onSaveAddressToggle:h=>o({saveAddress:h})}),m(J,{message:a.message,onMessageChange:h=>o({message:h})}),m(X,{amount:a.amount,selectedPlatform:a.selectedPlatform,accountDetails:a.accountDetails,submitting:i,canSubmit:this.canSubmit(),onSubmit:w})]}canSubmit(){const{formData:t,submitting:a}=this.attrs,{selectedPlatform:s,amount:i,accountDetails:o}=t;return!!(s&&i&&o&&!a&&parseFloat(i)>0)}}class Q extends g{view(){const{status:t,className:a=""}=this.attrs,s=this.getStatusClass(t),i=this.getStatusLabel(t);return m("div",{className:`WithdrawalPage-historyStatus ${s} ${a}`},i)}getStatusClass(t){return U[t]||U.pending}getStatusLabel(t){return e.translator.trans(`withdrawal.forum.status.${t}`)}}class Z extends g{view(){const{iconName:t,title:a,description:s,className:i=""}=this.attrs;return m("div",{className:`WithdrawalPage-emptyState ${i}`},m("div",{className:"WithdrawalPage-emptyIcon"},f(t)),m("h3",{className:"WithdrawalPage-emptyTitle"},a),m("p",{className:"WithdrawalPage-emptyDescription"},s))}}function M(d){const{className:t=""}=d;return m("div",{className:`WithdrawalPage-loading ${t}`},m(S,null))}class _ extends g{view(t){const{transactions:a,platforms:s,loading:i,type:o}=t.attrs;return i?m(M,{className:`${o}History-loading`}):!a||a.length===0?m(Z,{iconName:o==="withdrawal"?"fas fa-history":"fas fa-inbox",title:e.translator.trans(`${o}.forum.history.empty.title`),description:e.translator.trans(`${o}.forum.history.empty.description`),className:`${o}History-empty`}):m("div",{className:`${o}History`},m("div",{className:`${o}History-header`},m("h3",null,e.translator.trans(`${o}.forum.history.title`)),m("span",{className:`${o}History-count`},a.length," ",e.translator.trans(`${o}.forum.history.transactions`))),m("div",{className:`${o}History-list`},a.map(u=>this.renderTransaction(u,s,o))))}renderTransaction(t,a,s){const i=this.getTransactionId(t),o=this.getPlatform(t,a),u=n(t,"amount")||0,w=n(t,"status")||"pending",h=n(t,"statusColor")||this.getStatusColor(w),c=G(t,"createdAt");return s==="deposit"?this.renderDepositTransaction(t,o,u,w,h,c,i):this.renderWithdrawalTransaction(t,o,u,w,c,i)}renderWithdrawalTransaction(t,a,s,i,o,u){const w=n(t,"accountDetails")||"";return m("div",{key:u,className:"WithdrawalPage-historyItem"},m("div",{className:"WithdrawalPage-historyHeader"},m("div",{className:"WithdrawalPage-historyPlatform"},m("div",{className:"WithdrawalPage-platformIcon"},m(F,{platform:a,size:"small"})),m("div",{className:"WithdrawalPage-historyInfo"},m("div",{className:"WithdrawalPage-historyPlatformName"},this.getPlatformName(a)),m("div",{className:"WithdrawalPage-historyDate"},o.toLocaleDateString()," ",o.toLocaleTimeString()))),m(Q,{status:i})),m("div",{className:"WithdrawalPage-historyDetails"},m("div",{className:"WithdrawalPage-historyAmount"},m("span",{className:"WithdrawalPage-historyLabel"},e.translator.trans("withdrawal.forum.history.amount"),":"),m("span",{className:"WithdrawalPage-historyValue"},s," ",this.getPlatformSymbol(a))),m("div",{className:"WithdrawalPage-historyAddress"},m("span",{className:"WithdrawalPage-historyLabel"},e.translator.trans("withdrawal.forum.history.address"),":"),m("span",{className:"WithdrawalPage-historyValue"},w))))}renderDepositTransaction(t,a,s,i,o,u,w){const h=n(t,"transactionHash"),c=n(t,"explorerUrl"),y=n(t,"completedAt"),p=n(t,"confirmations")||0,P=n(t,"requiredConfirmations")||1;return m("div",{key:w,className:"DepositHistory-item"},m("div",{className:"DepositHistory-itemHeader"},m("div",{className:"DepositHistory-itemPlatform"},a&&m("[",null,m("div",{className:"DepositHistory-itemIcon"},this.renderPlatformIcon(a)),m("div",{className:"DepositHistory-itemInfo"},m("span",{className:"DepositHistory-itemCurrency"},n(a,"symbol")),m("span",{className:"DepositHistory-itemNetwork"},n(a,"network"))))),m("div",{className:"DepositHistory-itemAmount"},m("span",{className:"DepositHistory-itemAmountValue"},"+",s," ",a?n(a,"symbol"):""),m("div",{className:`DepositHistory-itemStatus status-${o}`},this.getStatusIcon(i),this.getStatusText(i)))),m("div",{className:"DepositHistory-itemDetails"},m("div",{className:"DepositHistory-itemMeta"},m("span",{className:"DepositHistory-itemTime"},u?k(u):"Unknown time"),i==="confirmed"||i==="completed"?m("span",{className:"DepositHistory-itemConfirmations"},p,"/",P," confirmations"):null),h&&m("div",{className:"DepositHistory-itemHash"},m("span",{className:"DepositHistory-itemHashLabel"},"Transaction:"),c?m("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"DepositHistory-itemHashLink"},this.formatHash(h),f("fas fa-external-link-alt")):m("span",{className:"DepositHistory-itemHashText"},this.formatHash(h))),y&&m("div",{className:"DepositHistory-itemCompleted"},m("span",null,"Credited: ",k(y)))))}getTransactionId(t){return typeof t.id=="function"?`transaction-${t.id()}`:`transaction-${H(t)||Math.random()}`}getPlatform(t,a){const s=this.getPlatformId(t);return z(a,s)}getPlatformId(t){return n(t,"platformId")||t.relationships?.platform?.data?.id||""}getPlatformName(t){return t&&n(t,"name")||"Unknown Platform"}getPlatformSymbol(t){return t&&n(t,"symbol")||""}getStatusColor(t){switch(t){case"pending":return"warning";case"approved":case"confirmed":case"completed":return"success";case"rejected":case"failed":case"cancelled":return"danger";default:return"secondary"}}renderPlatformIcon(t){const a=n(t,"iconUrl"),s=n(t,"iconClass"),i=n(t,"symbol");if(a)return m("img",{src:a,alt:i,className:"DepositHistory-platformImg"});if(s)return f(s);switch(i){case"USDT":return m("span",{className:"DepositHistory-currencyIcon usdt"},"₮");case"USDC":return m("span",{className:"DepositHistory-currencyIcon usdc"},"$");case"BTC":return m("span",{className:"DepositHistory-currencyIcon btc"},"₿");case"ETH":return m("span",{className:"DepositHistory-currencyIcon eth"},"Ξ");default:return f("fas fa-coins")}}getStatusIcon(t){switch(t){case"pending":return f("fas fa-clock");case"approved":case"confirmed":return f("fas fa-check-circle");case"completed":return f("fas fa-check-double");case"rejected":case"failed":return f("fas fa-times-circle");case"cancelled":return f("fas fa-ban");default:return f("fas fa-question-circle")}}getStatusText(t){switch(t){case"pending":return"Pending";case"approved":return"Approved";case"confirmed":return"Confirmed";case"completed":return"Completed";case"rejected":return"Rejected";case"failed":return"Failed";case"cancelled":return"Cancelled";default:return"Unknown"}}formatHash(t){return t.length<=16?t:`${t.substring(0,8)}...${t.substring(t.length-8)}`}}class $ extends g{constructor(){super(...arguments),this.handleOutsideClick=t=>{const a=this.element;a&&!a.contains(t.target)&&(this.state.showDropdown=!1,m.redraw())}}oninit(t){super.oninit(t),this.state={showDropdown:!1}}view(){const{selectedPlatform:t}=this.attrs,{showDropdown:a}=this.state;return m("div",{className:"FundsPage-platformSelector"},m("div",{className:"FundsPage-label"},e.translator.trans("withdrawal.forum.deposit.platform_label")),m("div",{className:"FundsPage-platformDropdown",onclick:()=>this.toggleDropdown()},m("div",{className:"FundsPage-platformSelected"},m("div",{className:"FundsPage-platformInfo"},m("div",{className:"FundsPage-platformIcon"},this.renderPlatformIcon(t)),m("div",{className:"FundsPage-platformDetails"},m("div",{className:"FundsPage-platformName"},this.getPlatformDisplayName(t)),t&&this.renderPlatformSubtext(t)))),f(N.CHEVRON_DOWN,{className:"FundsPage-dropdownIcon"})),a&&this.renderPlatformDropdown())}oncreate(t){super.oncreate(t),document.addEventListener("click",this.handleOutsideClick)}onremove(t){super.onremove(t),document.removeEventListener("click",this.handleOutsideClick)}toggleDropdown(){this.state.showDropdown=!this.state.showDropdown}getPlatformDisplayName(t){if(!t)return e.translator.trans("withdrawal.forum.deposit.select_platform");const a=n(t,"name")||"",s=n(t,"network");return s?`${a} (${s})`:a}renderPlatformIcon(t){if(!t)return f("fas fa-coins");const a=n(t,"iconUrl"),s=n(t,"symbol");return a?m("img",{src:a,alt:s,className:"FundsPage-platformIconImage"}):this.getCurrencyIcon(s)}getCurrencyIcon(t){switch(t?.toUpperCase()){case"USDT":return m("span",{className:"FundsPage-currencyIcon usdt"},"₮");case"USDC":return m("span",{className:"FundsPage-currencyIcon usdc"},"$");case"BTC":return m("span",{className:"FundsPage-currencyIcon btc"},"₿");case"ETH":return m("span",{className:"FundsPage-currencyIcon eth"},"Ξ");default:return f("fas fa-coins")}}renderPlatformSubtext(t){const a=n(t,"minAmount"),s=n(t,"fee"),i=n(t,"symbol"),o=[];return a&&a>0&&o.push(e.translator.trans("withdrawal.forum.deposit.min_amount_short",{amount:a,symbol:i})),s&&s>0&&o.push(e.translator.trans("withdrawal.forum.deposit.fee_short",{fee:s,symbol:i})),o.length>0?m("div",{className:"FundsPage-platformSubtext"},o.join(" • ")):null}renderPlatformDropdown(){const{platforms:t}=this.attrs,a=this.groupPlatformsByCurrency(t);return Object.keys(a).length===0?m("div",{className:"FundsPage-dropdownMenu"},m("div",{className:"FundsPage-dropdownItem FundsPage-noData"},e.translator.trans("withdrawal.forum.deposit.no_platforms"))):m("div",{className:"FundsPage-dropdownMenu"},Object.entries(a).flatMap(([s,i])=>[m("div",{key:`${s}-header`,className:"FundsPage-dropdownHeader"},m("div",{className:"FundsPage-currencyHeader"},m("div",{className:"FundsPage-currencyIcon"},this.getCurrencyIcon(s)),m("span",{className:"FundsPage-currencyName"},s))),...i.map(o=>m("div",{key:o.id(),className:"FundsPage-dropdownItem",onclick:()=>this.selectPlatform(o)},m("div",{className:"FundsPage-platformIcon"},this.renderPlatformIcon(o)),m("div",{className:"FundsPage-platformInfo"},m("div",{className:"FundsPage-platformName"},this.getPlatformDisplayName(o)),this.renderPlatformSubtext(o))))]))}groupPlatformsByCurrency(t){const a={};return(t||[]).filter(i=>i&&n(i,"isActive")).forEach(i=>{const o=n(i,"symbol");a[o]||(a[o]=[]),a[o].push(i)}),Object.keys(a).forEach(i=>{a[i].sort((o,u)=>{const w=n(o,"network")||"",h=n(u,"network")||"";return w.localeCompare(h)})}),a}selectPlatform(t){const{onPlatformSelect:a}=this.attrs;a(t),this.state.showDropdown=!1}}class tt extends g{view(t){const{address:a,loading:s,onCopy:i}=t.attrs;return m("div",{className:"AddressDisplay"},s?m("div",{className:"AddressDisplay-loading"},m("i",{className:"fas fa-spinner fa-spin"}),m("span",null,"Generating address...")):a?m("div",{className:"AddressDisplay-content"},m("div",{className:"AddressDisplay-address",title:a},a),m("div",{className:"AddressDisplay-actions"},m("button",{className:"AddressDisplay-copyBtn",onclick:i,title:"Copy address"},f("fas fa-copy")))):m("div",{className:"AddressDisplay-placeholder"},m("span",null,"No address available")))}}class at extends g{view(t){const{platform:a,loading:s,size:i=160}=t.attrs;return m("div",{className:"ImageDisplay",style:{width:`${i}px`,height:`${i}px`}},s?m("div",{className:"ImageDisplay-loading"},m("i",{className:"fas fa-spinner fa-spin"})):a&&a.qrCodeImageUrl()?m("img",{src:a.qrCodeImageUrl(),alt:`${a.name()} Image`,className:"ImageDisplay-image",onerror:"this.style.display='none'; this.nextElementSibling.style.display='block';"}):m("div",{className:"ImageDisplay-placeholder"},m("i",{className:"fas fa-image"}),m("div",null,"No Image")),m("div",{className:"ImageDisplay-error",style:{display:"none"}},m("i",{className:"fas fa-exclamation-triangle"}),m("div",null,"Image Load Failed")))}}class I extends L{constructor(){super(...arguments),this.state={withdrawalPlatforms:[],withdrawalRequests:[],userBalance:0,loadingBalance:!0,submitting:!1,depositPlatforms:[],depositTransactions:[],loading:!0,activeTab:v("withdrawal")},this.withdrawalFormData={amount:v(""),selectedPlatform:v(null),accountDetails:v(""),message:v(""),saveAddress:v(!1)},this.depositFormData={selectedPlatform:v(null)},this.depositAddressData={address:"",platform:null,loading:!1},this.availablePlatforms=[]}oninit(t){super.oninit(t);const s=new URLSearchParams(window.location.search).get("tab"),i=this.getTabFromPath();i?this.state.activeTab(i):s&&this.isValidTab(s)&&this.state.activeTab(s),this.updatePageTitle(),this.loadAllData()}getTabFromPath(){const t=window.location.pathname;return t.includes("/funds/withdrawal")?"withdrawal":t.includes("/funds/deposit")?"deposit":t.includes("/funds/withdrawal-history")?"withdrawal-history":t.includes("/funds/deposit-history")?"deposit-history":null}isValidTab(t){return["withdrawal","deposit","withdrawal-history","deposit-history"].includes(t)}updatePageTitle(){const t=this.state.activeTab();let a="withdrawal.forum.page.title";switch(t){case"withdrawal":case"withdrawal-history":a="withdrawal.forum.page.title";break;case"deposit":case"deposit-history":a="withdrawal.forum.deposit.page.title";break}e.setTitle(e.translator.trans(a))}view(){return this.state.loading?l("div",{className:"FundsPage"},l("div",{className:"FundsPage-loading"},l(S,null))):l("div",{className:"FundsPage"},l("div",{className:"FundsPage-modal"},this.renderHeader(),l("div",{className:"FundsPage-content"},this.renderActiveTab())))}renderHeader(){const t=this.state.activeTab();return l("div",{className:"FundsPage-header"},l("div",{className:"FundsPage-tabs"},l("div",{className:`FundsPage-tab ${t==="withdrawal"?"active":""}`,onclick:()=>this.handleTabChange("withdrawal")},e.translator.trans("withdrawal.forum.tabs.withdrawal")),l("div",{className:`FundsPage-tab ${t==="deposit"?"active":""}`,onclick:()=>this.handleTabChange("deposit")},e.translator.trans("withdrawal.forum.deposit.tabs.deposit")),l("div",{className:`FundsPage-tab ${t==="withdrawal-history"?"active":""}`,onclick:()=>this.handleTabChange("withdrawal-history")},e.translator.trans("withdrawal.forum.tabs.history")),l("div",{className:`FundsPage-tab ${t==="deposit-history"?"active":""}`,onclick:()=>this.handleTabChange("deposit-history")},e.translator.trans("withdrawal.forum.deposit.tabs.history"))),l(T,{className:"FundsPage-close",icon:"fas fa-times",onclick:()=>e.history.back()}))}renderActiveTab(){switch(this.state.activeTab()){case"withdrawal":return this.renderWithdrawalTab();case"deposit":return this.renderDepositTab();case"withdrawal-history":return this.renderWithdrawalHistoryTab();case"deposit-history":return this.renderDepositHistoryTab();default:return this.renderWithdrawalTab()}}renderWithdrawalTab(){return(this.state.withdrawalPlatforms||[]).filter(a=>!!a).length===0?l("div",{className:"FundsPage-withdrawalTab"},l("div",{className:"WithdrawalPage-emptyState"},l("div",{className:"WithdrawalPage-emptyIcon"},f("fas fa-coins")),l("h3",{className:"WithdrawalPage-emptyTitle"},e.translator.trans("withdrawal.forum.no_platforms")),l("p",{className:"WithdrawalPage-emptyDescription"},e.translator.trans("withdrawal.forum.no_platforms_description")))):l("div",{className:"FundsPage-withdrawalTab"},l(Y,{platforms:this.state.withdrawalPlatforms,formData:this.getWithdrawalFormDataForComponent(),loadingBalance:this.state.loadingBalance,submitting:this.state.submitting,onFormDataChange:this.handleWithdrawalFormDataChange.bind(this),onFillAllAmount:this.handleFillAllAmount.bind(this),onSubmit:this.handleWithdrawalSubmit.bind(this)}))}renderDepositTab(){return(this.state.depositPlatforms||[]).filter(a=>a&&n(a,"isActive")).length===0?l("div",{className:"FundsPage-emptyState"},l("div",{className:"FundsPage-emptyIcon"},f("fas fa-coins")),l("h3",{className:"FundsPage-emptyTitle"},e.translator.trans("withdrawal.forum.deposit.no_platforms")),l("p",{className:"FundsPage-emptyDescription"},e.translator.trans("withdrawal.forum.deposit.no_platforms_description"))):l("div",{className:"FundsPage-depositTab"},this.renderDepositSelectors(),this.renderDepositInfo())}renderDepositSelectors(){return l("div",{className:"FundsPage-selectors"},l($,{platforms:this.availablePlatforms,selectedPlatform:this.depositFormData.selectedPlatform(),onPlatformSelect:t=>this.handlePlatformSelect(t)}))}renderDepositInfo(){const t=this.depositFormData.selectedPlatform();if(!t)return l("div",{className:"FundsPage-selectPrompt"},l("p",null,e.translator.trans("withdrawal.forum.deposit.select_platform")));const a=n(t,"minAmount")||0,s=n(t,"warningText")||e.translator.trans("withdrawal.forum.deposit.default_warning",{currency:n(t,"symbol"),network:n(t,"network"),minAmount:a});return l("div",{className:"FundsPage-depositInfo"},l("p",{className:"FundsPage-instructionText"},e.translator.trans("withdrawal.forum.deposit.scan_or_use_address")),l(tt,{address:this.depositAddressData.address,loading:this.depositAddressData.loading,onCopy:this.handleCopyAddress.bind(this)}),l("p",{className:"FundsPage-minAmountText"},e.translator.trans("withdrawal.forum.deposit.min_amount",{amount:a,currency:n(t,"symbol")})),(()=>{const i=n(t,"fee")||0;return i>0?l("p",{className:"FundsPage-feeText"},e.translator.trans("withdrawal.forum.deposit.fee",{fee:i,currency:n(t,"symbol")})):null})(),l("div",{className:"FundsPage-imageContainer"},l(at,{platform:this.depositAddressData.platform,loading:this.depositAddressData.loading,size:160})),l("div",{className:"FundsPage-infoPanel"},l("i",{className:"fas fa-info-circle"}),l("span",null,s)))}renderWithdrawalHistoryTab(){return l("div",{className:"FundsPage-withdrawalTab"},l(_,{transactions:this.state.withdrawalRequests,platforms:this.state.withdrawalPlatforms,loading:!1,type:"withdrawal"}))}renderDepositHistoryTab(){return l(_,{transactions:this.state.depositTransactions,platforms:this.state.depositPlatforms,loading:!1,type:"deposit"})}handleTabChange(t){this.state.activeTab(t),this.updatePageTitle();const a=new URL(window.location.href);a.searchParams.set("tab",t),window.history.replaceState({},"",a.toString())}getWithdrawalFormDataForComponent(){return{selectedPlatform:this.withdrawalFormData.selectedPlatform(),amount:this.withdrawalFormData.amount(),accountDetails:this.withdrawalFormData.accountDetails(),message:this.withdrawalFormData.message(),saveAddress:this.withdrawalFormData.saveAddress()}}handleWithdrawalFormDataChange(t){t.selectedPlatform!==void 0&&this.withdrawalFormData.selectedPlatform(t.selectedPlatform),t.amount!==void 0&&this.withdrawalFormData.amount(t.amount),t.accountDetails!==void 0&&this.withdrawalFormData.accountDetails(t.accountDetails),t.message!==void 0&&this.withdrawalFormData.message(t.message),t.saveAddress!==void 0&&this.withdrawalFormData.saveAddress(t.saveAddress)}async handleFillAllAmount(){const t=this.withdrawalFormData.selectedPlatform();if(t&&!this.state.loadingBalance)try{await this.loadUserBalance(!0);const a=n(t,"fee")||0,s=n(t,"maxAmount")||1/0;let i=this.state.userBalance-a;s<1/0&&i>s&&(i=s),i>0?this.withdrawalFormData.amount(i.toString()):e.alerts.show({type:"warning",dismissible:!0},e.translator.trans("withdrawal.forum.insufficient_balance"))}catch(a){console.error("Error refreshing balance:",a),e.alerts.show({type:"error",dismissible:!0},e.translator.trans("withdrawal.forum.balance_refresh_error"))}}async handleWithdrawalSubmit(){if(this.state.submitting)return;const t=this.withdrawalFormData.selectedPlatform(),a=this.withdrawalFormData.amount(),s=this.withdrawalFormData.accountDetails();if(!t||!a||!s)return;const i=parseFloat(a);if(isNaN(i)||i<=0){e.alerts.show({type:"warning",dismissible:!0},e.translator.trans("withdrawal.forum.invalid_amount"));return}const o=n(t,"minAmount")||0,u=n(t,"maxAmount")||1/0;if(i<o){e.alerts.show({type:"warning",dismissible:!0},e.translator.trans("withdrawal.forum.amount_below_minimum",{amount:i,minimum:o,platform:n(t,"name")}));return}if(i>u){e.alerts.show({type:"warning",dismissible:!0},e.translator.trans("withdrawal.forum.amount_above_maximum",{amount:i,maximum:u,platform:n(t,"name")}));return}const w=n(t,"fee")||0,h=i+w;if(this.state.userBalance<h){const c=w>0?e.translator.trans("withdrawal.forum.including_fee",{fee:w}):"";e.alerts.show({type:"warning",dismissible:!0},e.translator.trans("withdrawal.forum.insufficient_balance_detailed",{required:h,available:this.state.userBalance,feeText:c}));return}this.state.submitting=!0;try{const c=await e.request({method:"POST",url:e.forum.attribute("apiUrl")+"/withdrawal-requests",body:{data:{type:"withdrawal-requests",attributes:{platformId:H(t),amount:parseFloat(a),accountDetails:s,message:this.withdrawalFormData.message(),saveAddress:this.withdrawalFormData.saveAddress()}}}});e.store.pushPayload(c),this.withdrawalFormData.amount(""),this.withdrawalFormData.accountDetails(""),this.withdrawalFormData.message(""),this.withdrawalFormData.saveAddress()||this.withdrawalFormData.selectedPlatform(null),this.loadUserBalance(),this.loadWithdrawalRequests(),e.alerts.show({type:"success",dismissible:!0},e.translator.trans("withdrawal.forum.submit_success"))}catch(c){console.error("Withdrawal request failed:",c);let y=e.translator.trans("withdrawal.forum.error");if(c&&c.response&&c.response.errors){const p=c.response.errors;if(Array.isArray(p)&&p.length>0){const P=p[0];P.detail&&(y=P.detail)}}else if(c&&c.responseText)if(c.responseText.includes("<b>Fatal error</b>")||c.responseText.includes("<!DOCTYPE"))y=e.translator.trans("withdrawal.forum.server_error");else try{const p=JSON.parse(c.responseText);if(p.errors&&Array.isArray(p.errors)&&p.errors.length>0){const P=p.errors[0];P.detail&&(y=P.detail)}}catch{y=e.translator.trans("withdrawal.forum.server_error")}e.alerts.show({type:"error",dismissible:!0},y)}finally{this.state.submitting=!1}}handlePlatformSelect(t){this.depositFormData.selectedPlatform(t),this.loadDepositAddress(t)}handleCopyAddress(){this.depositAddressData.address&&navigator.clipboard.writeText(this.depositAddressData.address).then(()=>{e.alerts.show({type:"success",dismissible:!0},e.translator.trans("withdrawal.forum.deposit.address_copied"))}).catch(()=>{e.alerts.show({type:"error",dismissible:!0},e.translator.trans("withdrawal.forum.deposit.copy_failed"))})}async loadAllData(){try{await Promise.all([this.loadWithdrawalData(),this.loadDepositData(),this.loadUserBalance()]),this.state.loading=!1,l.redraw()}catch(t){console.error("Error loading data:",t),this.state.loading=!1,l.redraw()}}async loadWithdrawalData(){const[t,a]=await Promise.all([e.request({method:"GET",url:e.forum.attribute("apiUrl")+"/withdrawal-platforms"}),e.request({method:"GET",url:e.forum.attribute("apiUrl")+"/withdrawal-requests"})]);e.store.pushPayload(t),e.store.pushPayload(a),this.state.withdrawalPlatforms=e.store.all("withdrawal-platforms"),this.state.withdrawalRequests=e.store.all("withdrawal-requests")}async loadDepositData(){const[t,a]=await Promise.all([e.request({method:"GET",url:e.forum.attribute("apiUrl")+"/deposit-platforms"}),e.request({method:"GET",url:e.forum.attribute("apiUrl")+"/deposit-transactions"})]);e.store.pushPayload(t),e.store.pushPayload(a),this.state.depositPlatforms=e.store.all("deposit-platforms"),this.state.depositTransactions=e.store.all("deposit-transactions"),this.availablePlatforms=this.state.depositPlatforms.filter(s=>n(s,"isActive"))}async loadUserBalance(t=!1){try{if(this.state.loadingBalance=!0,t&&e.session.user){const a=await e.request({method:"GET",url:`${e.forum.attribute("apiUrl")}/users/${e.session.user.id()}`});e.store.pushPayload(a);const s=e.store.getById("users",e.session.user.id());s?this.state.userBalance=parseFloat(s.attribute("money"))||0:this.state.userBalance=0}else this.state.userBalance=parseFloat(e.session.user?.attribute("money"))||0;this.state.loadingBalance=!1,l.redraw()}catch(a){console.error("Error loading user balance:",a),this.state.loadingBalance=!1,l.redraw()}}async loadWithdrawalRequests(){try{const t=await e.request({method:"GET",url:e.forum.attribute("apiUrl")+"/withdrawal-requests"});e.store.pushPayload(t),this.state.withdrawalRequests=e.store.all("withdrawal-requests")}catch(t){console.error("Error loading withdrawal requests:",t)}}async loadDepositAddress(t){this.depositAddressData.loading=!0,l.redraw();try{const s=(await e.request({method:"GET",url:e.forum.attribute("apiUrl")+"/deposit-address",params:{platform_id:n(t,"id")}})).data;this.depositAddressData={address:s.attributes.address,addressTag:s.attributes.addressTag,platform:t,loading:!1},l.redraw()}catch(a){console.error("Error loading deposit address:",a),this.depositAddressData.loading=!1,e.alerts.show({type:"error",dismissible:!0},e.translator.trans("withdrawal.forum.deposit.address_load_error")),l.redraw()}}}class et extends r{constructor(){super(...arguments),this.name=r.attribute("name"),this.symbol=r.attribute("symbol"),this.network=r.attribute("network"),this.displayName=r.attribute("displayName"),this.minAmount=r.attribute("minAmount"),this.maxAmount=r.attribute("maxAmount"),this.fee=r.attribute("fee"),this.iconUrl=r.attribute("iconUrl"),this.iconClass=r.attribute("iconClass"),this.isActive=r.attribute("isActive"),this.createdAt=r.attribute("createdAt",r.transformDate),this.updatedAt=r.attribute("updatedAt",r.transformDate)}apiEndpoint(){return`/withdrawal-platforms/${this.id()}`}getDisplayName(){return this.displayName()||this.name()}isValidAmount(t){const a=this.minAmount(),s=this.maxAmount();return t>=a&&t<=s}getTotalCost(t){return t+this.fee()}}const D={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class st extends r{constructor(){super(...arguments),this.amount=r.attribute("amount"),this.accountDetails=r.attribute("accountDetails"),this.message=r.attribute("message"),this.status=r.attribute("status"),this.platformId=r.attribute("platformId"),this.userId=r.attribute("userId"),this.createdAt=r.attribute("createdAt",r.transformDate),this.updatedAt=r.attribute("updatedAt",r.transformDate),this.user=r.hasOne("user"),this.platform=r.hasOne("platform")}apiEndpoint(){return`/withdrawal-requests/${this.id()}`}isPending(){return this.status()===D.PENDING}isApproved(){return this.status()===D.APPROVED}isRejected(){return this.status()===D.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const t=this.status();return app.translator.trans(`withdrawal.forum.status.${t}`)}statusColor(){switch(this.status()){case D.APPROVED:return"success";case D.REJECTED:return"danger";case D.PENDING:default:return"warning"}}}class rt extends r{constructor(){super(...arguments),this.name=r.attribute("name"),this.symbol=r.attribute("symbol"),this.network=r.attribute("network"),this.networkTypeId=r.attribute("networkTypeId"),this.displayName=r.attribute("displayName"),this.minAmount=r.attribute("minAmount"),this.maxAmount=r.attribute("maxAmount"),this.fee=r.attribute("fee"),this.address=r.attribute("address"),this.qrCodeImageUrl=r.attribute("qrCodeImageUrl"),this.iconUrl=r.attribute("iconUrl"),this.iconClass=r.attribute("iconClass"),this.warningText=r.attribute("warningText"),this.networkConfig=r.attribute("networkConfig"),this.isActive=r.attribute("isActive"),this.createdAt=r.attribute("createdAt",r.transformDate),this.updatedAt=r.attribute("updatedAt",r.transformDate)}}class it extends r{constructor(){super(...arguments),this.address=r.attribute("address"),this.addressTag=r.attribute("addressTag"),this.fullAddress=r.attribute("fullAddress"),this.isActive=r.attribute("isActive"),this.lastUsedAt=r.attribute("lastUsedAt",r.transformDate),this.createdAt=r.attribute("createdAt",r.transformDate),this.updatedAt=r.attribute("updatedAt",r.transformDate),this.user=r.hasOne("user"),this.platform=r.hasOne("platform")}}class nt extends r{constructor(){super(...arguments),this.amount=r.attribute("amount"),this.fee=r.attribute("fee"),this.creditedAmount=r.attribute("creditedAmount"),this.transactionHash=r.attribute("transactionHash"),this.fromAddress=r.attribute("fromAddress"),this.memo=r.attribute("memo"),this.userMessage=r.attribute("userMessage"),this.status=r.attribute("status"),this.statusColor=r.attribute("statusColor"),this.blockchainData=r.attribute("blockchainData"),this.confirmations=r.attribute("confirmations"),this.requiredConfirmations=r.attribute("requiredConfirmations"),this.hasEnoughConfirmations=r.attribute("hasEnoughConfirmations"),this.canBeCompleted=r.attribute("canBeCompleted"),this.explorerUrl=r.attribute("explorerUrl"),this.detectedAt=r.attribute("detectedAt",r.transformDate),this.confirmedAt=r.attribute("confirmedAt",r.transformDate),this.completedAt=r.attribute("completedAt",r.transformDate),this.adminNotes=r.attribute("adminNotes"),this.createdAt=r.attribute("createdAt",r.transformDate),this.updatedAt=r.attribute("updatedAt",r.transformDate),this.user=r.hasOne("user"),this.platform=r.hasOne("platform"),this.depositAddress=r.hasOne("depositAddress"),this.processedBy=r.hasOne("processedBy")}}class ot extends g{view(){if(!e.session.user)return null;const a=(e.forum.attribute("antoinefr-money.moneyname")||"[money]").replace("[money]",e.session.user.attribute("money")),s=e.forum.attribute("wusong8899-withdrawal.moneyIconUrl");return m("div",{id:"moneyDisplayContainer",className:"client1-header-adv-wrapper clientCustomizeWithdrawalHeaderTotalMoney"},m("div",{className:"clientCustomizeWithdrawalHeaderText"},s&&s.trim()&&m("span",{style:{borderRadius:"50%",padding:"6px 8px",marginRight:"8px",display:"inline-flex",alignItems:"center",justifyContent:"center"}},m("img",{src:s,alt:"Money icon",style:{width:"20px",height:"20px"},onError:i=>{const o=i.target;o.style.display="none"}})),a),m("div",{className:"clientCustomizeWithdrawalHeaderIcon"},m("i",{className:"fas fa-wallet"})),m("div",{className:"clientCustomizeWithdrawalButtons"},m("div",{className:"clientCustomizeWithdrawalButton",onclick:this.handleWithdrawalClick.bind(this),title:"提款"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",{style:{marginLeft:"4px",fontSize:"12px"}},"提款")),m("div",{className:"clientCustomizeDepositButton",onclick:this.handleDepositClick.bind(this),title:"存款",style:{marginLeft:"8px"}},m("i",{className:"fas fa-coins"}),m("span",{style:{marginLeft:"4px",fontSize:"12px"}},"存款"))))}handleWithdrawalClick(t){t.preventDefault(),t.stopPropagation(),window.location.href="/funds?tab=withdrawal"}handleDepositClick(t){t.preventDefault(),t.stopPropagation(),window.location.href="/funds?tab=deposit"}}class lt extends g{view(){const t=e.session.user?.attribute("money")||0,a=e.forum.attribute("wusong8899-withdrawal.moneyIconUrl");return m("div",{className:"Navigation-mobileMoneyDisplay"},m("div",{className:"Navigation-moneySection",onclick:this.handleWithdrawalClick.bind(this),title:`余额: ${t} - 点击提款`},m("div",{className:"Navigation-moneyText"},a&&a.trim()&&m("span",{style:{borderRadius:"50%",padding:"4px 6px",marginRight:"6px",display:"inline-flex",alignItems:"center",justifyContent:"center"}},m("img",{src:a,alt:"Money icon",style:{width:"18px",height:"18px"},onError:s=>{const i=s.target;i.style.display="none"}})),m("span",{className:"Navigation-moneyAmount"},t)),m("div",{className:"Navigation-withdrawalButton"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",null,"提款"))))}handleWithdrawalClick(t){t.preventDefault(),t.stopPropagation(),console.log("MobileMoneyDisplay clicked!");try{window.location.href="/funds?tab=withdrawal"}catch(a){console.error("Navigation error:",a),window.location.href="/funds?tab=withdrawal"}}}class A{constructor(){}static getInstance(){return A.instance||(A.instance=new A),A.instance}isTagsPage(){try{return e.current?.get("routeName")==="index"}catch{return!1}}}function W(){return window.innerWidth<=767}function C(){return window.innerWidth>=768&&window.innerWidth<=1024}function dt(){return window.innerWidth>1024}function mt(){return W()||C()}function ct(){return W()?"mobile":C()?"tablet":"desktop"}function ut(){return"ontouchstart"in window||navigator.maxTouchPoints>0}const ht={isMobile:W,isTablet:C,isDesktop:dt,isMobileOrTablet:mt,getCurrentBreakpoint:ct,isTouchDevice:ut};e.initializers.add("wusong8899-withdrawal",()=>{e.store.models["withdrawal-platforms"]=et,e.store.models["withdrawal-requests"]=st,e.store.models["deposit-platforms"]=rt,e.store.models["deposit-addresses"]=it,e.store.models["deposit-transactions"]=nt,e.routes.funds={path:"/funds",component:I},e.routes.withdrawal={path:"/withdrawal",component:I},e.routes.deposit={path:"/deposit",component:I},x.extend(q.prototype,"view",function(d){const t=A.getInstance();e.session.user&&t.isTagsPage()&&!ht.isMobile()&&d.children.push(ot.component())}),x.extend(R.prototype,"view",function(d){if(window.innerWidth>768||e.current.get("routeName")!=="tags"||!e.session.user||!d||!d.children||!Array.isArray(d.children))return;d.children.some(s=>s&&s.attrs&&s.attrs.className&&s.attrs.className.includes("Navigation-mobileMoneyDisplay"))||d.children.push(lt.component({className:"item-withdrawal Navigation-mobileMoneyDisplay"}))})})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["forum/components/HeaderPrimary"],flarum.core.compat["common/components/Navigation"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/icon"],m,flarum.core.compat["common/Component"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=forum.js.map

module.exports={};