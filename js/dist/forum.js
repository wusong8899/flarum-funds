(function(n,q,Z,$,tt,R,k,v,y,u,b,V,E,d,a){"use strict";const L={pending:"warning",approved:"success",rejected:"danger"},N={MIN_AMOUNT:.001,MAX_AMOUNT:10,FEE:5e-4,BALANCE_PRECISION:8},S={COINS:"fas fa-coins",CHEVRON_DOWN:"fas fa-chevron-down",PASTE:"fas fa-paste"};function et(r){const t=r.platformSpecificIconUrl?.();if(t)return{type:"currency_url",value:t,alt:r.name?.()||"Platform icon"};const e=r.platformSpecificIconClass?.();if(e)return{type:"currency_class",value:e};const s=r.networkIconUrl?.();if(s)return{type:"currency_url",value:s,alt:r.network?.()||"Network icon"};const i=r.networkIconClass?.();if(i)return{type:"currency_class",value:i};const l=r.currencyIconUrl?.();if(l)return{type:"currency_url",value:l,alt:r.symbol?.()||"Currency icon"};const f=r.currencyIconClass?.();if(f)return{type:"currency_class",value:f};const p=r.currencyUnicodeSymbol?.();return p?{type:"currency_unicode",value:p}:{type:"fallback",value:"fas fa-coins"}}function st(r,t=""){const e="icon",s=t?`${e} ${t}`:e;switch(r.type){case"currency_url":return m("img",{src:r.value,alt:r.alt||"Icon",className:`${s} icon--image`,style:{width:"1em",height:"1em",objectFit:"contain",display:"inline-block",verticalAlign:"middle"}});case"currency_class":return m("i",{className:`${s} ${r.value}`,"aria-hidden":"true"});case"currency_unicode":return m("span",{className:`${s} icon--unicode`,"aria-hidden":"true"},r.value);case"fallback":default:return m("i",{className:`${s} ${r.value}`,"aria-hidden":"true"})}}class T{view(t){const{platform:e,className:s="",size:i="medium"}=t.attrs;if(!e)return y(S.COINS,{className:`crypto-icon default ${s}`});const f=`crypto-icon ${`platform-icon-${i}`} ${s}`,p=et(e);return st(p,f)}}const B=r=>typeof r.id=="function"?r.id():r.id,h=(r,t)=>typeof r[t]=="function"?r[t]():r.attributes?r.attributes[t]:r[t],H=r=>String(B(r)),rt=(r,t)=>{const e=String(t);return r.find(s=>{const i=B(s);return String(i)===e})},O=(r,t)=>{const e=h(r,t);return e?new Date(e):new Date};class at extends b{oninit(t){super.oninit(t),this.state={showDropdown:!1}}view(){const{selectedPlatform:t}=this.attrs,{showDropdown:e}=this.state;return m("div",{className:"WithdrawalPage-platformSelector"},m("div",{className:"WithdrawalPage-label"},"提取平台"),m("div",{className:"WithdrawalPage-platformDropdown",onclick:()=>this.toggleDropdown()},m("div",{className:"WithdrawalPage-platformSelected"},m("div",{className:"WithdrawalPage-platformInfo"},m("div",{className:"WithdrawalPage-platformIcon"},m(T,{platform:t,size:"medium"})),m("div",{className:"WithdrawalPage-platformDetails"},m("div",{className:"WithdrawalPage-platformName"},this.getPlatformName(t))))),y(S.CHEVRON_DOWN,{className:"WithdrawalPage-dropdownIcon"})),e&&this.renderPlatformDropdown())}toggleDropdown(){this.state.showDropdown=!this.state.showDropdown}getPlatformName(t){return t&&(h(t,"displayName")||h(t,"name"))||"请选择平台"}renderPlatformDropdown(){const{platforms:t}=this.attrs,e=(t||[]).filter(s=>!!s);return e.length===0?m("div",{className:"WithdrawalPage-dropdownMenu"},m("div",{className:"WithdrawalPage-dropdownItem WithdrawalPage-noData"},n.translator.trans("funds.forum.no_platforms"))):m("div",{className:"WithdrawalPage-dropdownMenu"},e.map(s=>m("div",{key:s.id(),className:"WithdrawalPage-dropdownItem",onclick:()=>this.selectPlatform(s)},m("div",{className:"WithdrawalPage-platformIcon"},m(T,{platform:s,size:"small"})),m("div",{className:"WithdrawalPage-platformName"},h(s,"displayName")||h(s,"name")))))}selectPlatform(t){const{onPlatformSelect:e,onAmountChange:s}=this.attrs;e(t),this.state.showDropdown=!1,s&&s()}}class it extends b{view(){const{amount:t,selectedPlatform:e,loadingBalance:s,onAmountChange:i,onFillAllAmount:l}=this.attrs,f=this.getMinAmount(e),p=this.getMaxAmount(e),w=this.getFee(e);return m("div",{className:"WithdrawalPage-amountSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-label"},n.translator.trans("funds.forum.form.amount")),m("div",{className:"WithdrawalPage-amountInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:"0.00000000",value:t,oninput:A=>i(A.target.value)}),m(R,{className:"WithdrawalPage-allButton",onclick:l,disabled:s},n.translator.trans("funds.forum.form.all_button"))),m("div",{className:"WithdrawalPage-amountLimits"},m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},n.translator.trans("funds.forum.limits.min_max")),m("span",{className:"WithdrawalPage-limitValue"},y(S.COINS)," ",f," ~ ",p)),m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},n.translator.trans("funds.forum.limits.fee")),m("span",{className:"WithdrawalPage-limitValue"},y(S.COINS)," ",w)))))}getMinAmount(t){return t&&h(t,"minAmount")||N.MIN_AMOUNT}getMaxAmount(t){return t&&h(t,"maxAmount")||N.MAX_AMOUNT}getFee(t){return t&&h(t,"fee")||N.FEE}}class nt extends b{view(){const{accountDetails:t,selectedPlatform:e,onAccountDetailsChange:s}=this.attrs,i=this.getSymbol(e);return u("div",{className:"WithdrawalPage-addressSection"},u("div",{className:"WithdrawalPage-formGroup"},u("div",{className:"WithdrawalPage-addressHeader"},u("span",{className:"WithdrawalPage-label"},n.translator.trans("funds.forum.form.address",{symbol:i}),u("span",{className:"WithdrawalPage-required"},"*"))),u("div",{className:"WithdrawalPage-addressInput"},u("input",{type:"text",className:"WithdrawalPage-input",placeholder:n.translator.trans("funds.forum.form.address_placeholder"),value:t,oninput:l=>s(l.target.value)}),u("button",{className:"WithdrawalPage-pasteButton",onclick:()=>this.pasteFromClipboard()},y(S.PASTE)))))}getSymbol(t){return t&&h(t,"symbol")||""}async pasteFromClipboard(){const{onAccountDetailsChange:t}=this.attrs;try{if(navigator.clipboard&&navigator.clipboard.readText){const e=await navigator.clipboard.readText();t(e.trim()),u.redraw()}}catch(e){console.error("Failed to read from clipboard:",e),n.alerts.show({type:"error",dismissible:!0},n.translator.trans("funds.forum.clipboard_error"))}}}class ot extends b{view(){const{message:t,onMessageChange:e}=this.attrs;return m("div",{className:"WithdrawalPage-messageSection"},m("div",{className:"WithdrawalPage-formGroup"},m("span",{className:"WithdrawalPage-label"},n.translator.trans("funds.forum.form.message")),m("textarea",{className:"WithdrawalPage-textarea",placeholder:n.translator.trans("funds.forum.form.message_placeholder"),value:t,rows:3,maxlength:500,oninput:s=>e(s.target.value)}),m("div",{className:"WithdrawalPage-helperText"},n.translator.trans("funds.forum.form.message_helper")," (",t.length,"/500)")))}}class lt extends b{view(){const{amount:t,selectedPlatform:e,submitting:s,canSubmit:i,onSubmit:l}=this.attrs,f=parseFloat(t)||0,p=this.getFee(e),w=Math.max(0,f-p),A=this.getSymbol(e);return m("div",{className:"WithdrawalPage-submitSection"},m(R,{className:"WithdrawalPage-submitButton",loading:s,disabled:!i,onclick:l},n.translator.trans("funds.forum.form.submit")),f>0&&m("div",{className:"WithdrawalPage-finalAmount"},n.translator.trans("funds.forum.final_amount",{amount:w.toFixed(N.BALANCE_PRECISION),symbol:A})))}getFee(t){return t&&h(t,"fee")||N.FEE}getSymbol(t){return t&&h(t,"symbol")||""}}class ut extends b{view(){const{platforms:t,formData:e,loadingBalance:s,submitting:i,onFormDataChange:l,onFillAllAmount:f,onSubmit:p}=this.attrs;return[m(at,{platforms:t,selectedPlatform:e.selectedPlatform,onPlatformSelect:w=>l({selectedPlatform:w}),onAmountChange:()=>l({amount:""})}),m(it,{amount:e.amount,selectedPlatform:e.selectedPlatform,loadingBalance:s,onAmountChange:w=>l({amount:w}),onFillAllAmount:f}),m(nt,{accountDetails:e.accountDetails,selectedPlatform:e.selectedPlatform,onAccountDetailsChange:w=>l({accountDetails:w})}),m(ot,{message:e.message,onMessageChange:w=>l({message:w})}),m(lt,{amount:e.amount,selectedPlatform:e.selectedPlatform,accountDetails:e.accountDetails,submitting:i,canSubmit:this.canSubmit(),onSubmit:p})]}canSubmit(){const{formData:t,submitting:e}=this.attrs,{selectedPlatform:s,amount:i,accountDetails:l}=t;return!!(s&&i&&l&&!e&&parseFloat(i)>0)}}class ct extends b{view(){const{status:t,className:e=""}=this.attrs,s=this.getStatusClass(t),i=this.getStatusLabel(t);return m("div",{className:`WithdrawalPage-historyStatus ${s} ${e}`},i)}getStatusClass(t){return L[t]||L.pending}getStatusLabel(t){return n.translator.trans(`funds.forum.status.${t}`).toString()}}class dt extends b{view(){const{iconName:t,title:e,description:s,className:i=""}=this.attrs;return m("div",{className:`WithdrawalPage-emptyState ${i}`},m("div",{className:"WithdrawalPage-emptyIcon"},y(t)),m("h3",{className:"WithdrawalPage-emptyTitle"},e),m("p",{className:"WithdrawalPage-emptyDescription"},s))}}function mt(r){const{className:t=""}=r;return m("div",{className:`WithdrawalPage-loading ${t}`},m(k,null))}class ht extends b{view(t){const{transactions:e,platforms:s,loading:i,type:l}=t.attrs;return i?m(mt,{className:`${l}History-loading`}):!e||e.length===0?m(dt,{iconName:l==="funds"?"fas fa-history":"fas fa-inbox",title:n.translator.trans("funds.forum.history.empty.title"),description:n.translator.trans("funds.forum.history.empty.description"),className:`${l}History-empty`}):m("div",{className:`${l}History`},m("div",{className:`${l}History-header`},m("h3",null,n.translator.trans("funds.forum.history.title")),m("span",{className:`${l}History-count`},e.length," ",n.translator.trans("funds.forum.history.transactions"))),m("div",{className:`${l}History-list`},e.map(f=>this.renderTransaction(f,s,l))))}renderTransaction(t,e,s){const i=this.getTransactionId(t),l=this.getPlatform(t,e),f=h(t,"amount")||0,p=h(t,"status")||"pending",w=h(t,"statusColor")||this.getStatusColor(p),A=O(t,"createdAt");return s==="deposit"?this.renderDepositRecord(t,l,f,p,w,A,i):this.renderWithdrawalTransaction(t,l,f,p,A,i)}renderWithdrawalTransaction(t,e,s,i,l,f){const p=h(t,"accountDetails")||"";return m("div",{key:f,className:"WithdrawalPage-historyItem"},m("div",{className:"WithdrawalPage-historyHeader"},m("div",{className:"WithdrawalPage-historyPlatform"},m("div",{className:"WithdrawalPage-platformIcon"},m(T,{platform:e,size:"small"})),m("div",{className:"WithdrawalPage-historyInfo"},m("div",{className:"WithdrawalPage-historyPlatformName"},this.getPlatformName(e)),m("div",{className:"WithdrawalPage-historyDate"},l.toLocaleDateString()," ",l.toLocaleTimeString()))),m(ct,{status:i})),m("div",{className:"WithdrawalPage-historyDetails"},m("div",{className:"WithdrawalPage-historyAmount"},m("span",{className:"WithdrawalPage-historyLabel"},n.translator.trans("funds.forum.history.amount"),":"),m("span",{className:"WithdrawalPage-historyValue"},s," ",this.getPlatformSymbol(e))),m("div",{className:"WithdrawalPage-historyAddress"},m("span",{className:"WithdrawalPage-historyLabel"},n.translator.trans("funds.forum.history.address"),":"),m("span",{className:"WithdrawalPage-historyValue"},p))))}renderDepositRecord(t,e,s,i,l,f,p){const w=h(t,"platformAccount"),A=h(t,"realName"),P=O(t,"depositTime"),J=h(t,"screenshotUrl"),K=h(t,"userMessage"),X=O(t,"processedAt"),Q=h(t,"adminNotes"),W=h(t,"creditedAmount");return m("div",{key:p,className:"DepositRecord-item"},m("div",{className:"DepositRecord-itemHeader"},m("div",{className:"DepositRecord-itemPlatform"},e&&m("[",null,m("div",{className:"DepositRecord-itemIcon"},this.renderPlatformIcon(e)),m("div",{className:"DepositRecord-itemInfo"},m("span",{className:"DepositRecord-itemCurrency"},h(e,"symbol")," ",h(e,"network")&&`(${h(e,"network")})`),m("span",{className:"DepositRecord-itemType"},"Manual Deposit")))),m("div",{className:"DepositRecord-itemAmount"},m("span",{className:"DepositRecord-itemAmountValue"},"+",s," ",e?h(e,"symbol"):""),m("div",{className:`DepositRecord-itemStatus status-${l}`},this.getStatusIcon(i),this.getStatusText(i)))),m("div",{className:"DepositRecord-itemDetails"},m("div",{className:"DepositRecord-itemMeta"},m("span",{className:"DepositRecord-itemTime"},"Submitted: ",f?V(f):"Unknown time"),P&&m("span",{className:"DepositRecord-itemDepositTime"},"Deposit Time: ",P.toLocaleDateString()," ",P.toLocaleTimeString())),m("div",{className:"DepositRecord-itemInfo"},m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Platform Account:"),m("span",{className:"DepositRecord-itemValue"},w)),A&&m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Real Name:"),m("span",{className:"DepositRecord-itemValue"},A)),K&&m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Message:"),m("span",{className:"DepositRecord-itemValue"},K)),J&&m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Screenshot:"),m("a",{href:J,target:"_blank",rel:"noopener noreferrer",className:"DepositRecord-itemLink"},"View Screenshot ",y("fas fa-external-link-alt")))),X&&m("div",{className:"DepositRecord-itemProcessed"},m("div",{className:"DepositRecord-itemProcessedTime"},"Processed: ",V(X)),W&&W!==s&&m("div",{className:"DepositRecord-itemCredited"},"Credited Amount: ",W," ",e?h(e,"symbol"):""),Q&&m("div",{className:"DepositRecord-itemNotes"},m("span",{className:"DepositRecord-itemLabel"},"Admin Notes:"),m("span",{className:"DepositRecord-itemValue"},Q)))))}getTransactionId(t){return typeof t.id=="function"?`transaction-${t.id()}`:`transaction-${H(t)||Math.random()}`}getPlatform(t,e){const s=this.getPlatformId(t);return rt(e,s)}getPlatformId(t){return h(t,"platformId")||t.relationships?.platform?.data?.id||""}getPlatformName(t){return t&&h(t,"name")||"Unknown Platform"}getPlatformSymbol(t){return t&&h(t,"symbol")||""}getStatusColor(t){switch(t){case"pending":return"warning";case"approved":case"confirmed":case"completed":return"success";case"rejected":case"failed":case"cancelled":return"danger";default:return"secondary"}}renderPlatformIcon(t){const e=h(t,"iconUrl"),s=h(t,"iconClass"),i=h(t,"symbol");return e?m("img",{src:e,alt:i,className:"DepositHistory-platformImg"}):y(s||"fas fa-coins")}getStatusIcon(t){switch(t){case"pending":return y("fas fa-clock");case"approved":case"confirmed":return y("fas fa-check-circle");case"completed":return y("fas fa-check-double");case"rejected":case"failed":return y("fas fa-times-circle");case"cancelled":return y("fas fa-ban");default:return y("fas fa-question-circle")}}getStatusText(t){switch(t){case"pending":return"Pending";case"approved":return"Approved";case"confirmed":return"Confirmed";case"completed":return"Completed";case"rejected":return"Rejected";case"failed":return"Failed";case"cancelled":return"Cancelled";default:return"Unknown"}}}class ft extends b{oninit(t){super.oninit(t),this.state={depositAddress:v(""),qrCodeUrl:v(""),userMessage:v("")}}view(t){const{submitting:e}=t.attrs;return m("div",{className:"SimpleDepositForm"},m("div",{className:"SimpleDepositForm-header"},m("div",{className:"SimpleDepositForm-title"},m("i",{className:"fas fa-plus-circle"}),n.translator.trans("funds.forum.deposit.simple.form_title",{},"存款申请")),m("div",{className:"SimpleDepositForm-description"},n.translator.trans("funds.forum.deposit.simple.form_description",{},"请填写您的存款地址和收款二维码，我们会尽快处理您的申请。"))),m("form",{onsubmit:this.handleSubmit.bind(this),className:"SimpleDepositForm-form"},m("div",{className:"SimpleDepositForm-field"},m("label",{className:"SimpleDepositForm-label"},n.translator.trans("funds.forum.deposit.simple.deposit_address",{},"存款地址"),m("span",{className:"SimpleDepositForm-required"},"*")),m("input",{type:"text",className:"SimpleDepositForm-input",placeholder:n.translator.trans("funds.forum.deposit.simple.deposit_address_placeholder",{},"请输入您的存款地址..."),value:this.state.depositAddress(),oninput:E("value",this.state.depositAddress),required:!0,disabled:e}),m("div",{className:"SimpleDepositForm-help"},n.translator.trans("funds.forum.deposit.simple.deposit_address_help",{},"请输入您用于接收存款的钱包地址或账号"))),m("div",{className:"SimpleDepositForm-field"},m("label",{className:"SimpleDepositForm-label"},n.translator.trans("funds.forum.deposit.simple.qr_code_url",{},"收款二维码"),m("span",{className:"SimpleDepositForm-optional"},"(",n.translator.trans("funds.forum.deposit.simple.optional",{},"可选"),")")),m("input",{type:"url",className:"SimpleDepositForm-input",placeholder:n.translator.trans("funds.forum.deposit.simple.qr_code_url_placeholder",{},"请输入二维码图片链接..."),value:this.state.qrCodeUrl(),oninput:E("value",this.state.qrCodeUrl),disabled:e}),m("div",{className:"SimpleDepositForm-help"},n.translator.trans("funds.forum.deposit.simple.qr_code_url_help",{},"可选：上传您的收款二维码图片链接，方便其他人扫码转账"))),m("div",{className:"SimpleDepositForm-field"},m("label",{className:"SimpleDepositForm-label"},n.translator.trans("funds.forum.deposit.simple.user_message",{},"留言"),m("span",{className:"SimpleDepositForm-optional"},"(",n.translator.trans("funds.forum.deposit.simple.optional",{},"可选"),")")),m("textarea",{className:"SimpleDepositForm-textarea",placeholder:n.translator.trans("funds.forum.deposit.simple.user_message_placeholder",{},"请输入您的留言或说明..."),value:this.state.userMessage(),oninput:E("value",this.state.userMessage),rows:4,disabled:e}),m("div",{className:"SimpleDepositForm-help"},n.translator.trans("funds.forum.deposit.simple.user_message_help",{},"可选：添加您的存款说明或特殊要求"))),m("div",{className:"SimpleDepositForm-actions"},m(R,{type:"button",className:"Button Button--secondary SimpleDepositForm-cancelButton",onclick:t.attrs.onCancel,disabled:e},n.translator.trans("funds.forum.deposit.simple.cancel",{},"取消")),m(R,{type:"submit",className:"Button Button--primary SimpleDepositForm-submitButton",loading:e,disabled:e},n.translator.trans("funds.forum.deposit.simple.submit",{},"提交申请")))))}handleSubmit(t){t.preventDefault();const{onSubmit:e}=this.attrs;if(!this.state.depositAddress()){n.alerts.show({type:"error",dismissible:!0},n.translator.trans("funds.forum.deposit.simple.validation.address_required",{},"请输入存款地址"));return}const s=this.state.qrCodeUrl();if(s&&!this.isValidUrl(s)){n.alerts.show({type:"error",dismissible:!0},n.translator.trans("funds.forum.deposit.simple.validation.invalid_url",{},"请输入有效的二维码图片链接"));return}const i={depositAddress:this.state.depositAddress(),qrCodeUrl:s||void 0,userMessage:this.state.userMessage()||void 0};e(i)}isValidUrl(t){try{return new URL(t),!0}catch{return!1}}resetForm(){this.state.depositAddress(""),this.state.qrCodeUrl(""),this.state.userMessage("")}}class pt{async create(t){const e=await d.request({method:"POST",url:d.forum.attribute("apiUrl")+"/simple-deposit-records",body:{data:{type:"simple-deposit-records",attributes:{depositAddress:t.depositAddress,qrCodeUrl:t.qrCodeUrl,userMessage:t.userMessage}}}}),s=d.store.pushPayload(e);return Array.isArray(s)?s[0]:s}async getUserHistory(){const t=await d.request({method:"GET",url:d.forum.attribute("apiUrl")+"/simple-deposit-records",params:{include:"user,processedByUser"}});return d.store.pushPayload(t)}async getAll(t={}){const e={include:"user,processedByUser"};Object.keys(t).length>0&&(e.filter=t);const s=await d.request({method:"GET",url:d.forum.attribute("apiUrl")+"/simple-deposit-records",params:e});return d.store.pushPayload(s)}async update(t,e){const s=await d.request({method:"PATCH",url:`${d.forum.attribute("apiUrl")}/simple-deposit-records/${t}`,body:{data:{type:"simple-deposit-records",id:t,attributes:e}}}),i=d.store.pushPayload(s);return Array.isArray(i)?i[0]:i}async approve(t,e){return this.update(t,{status:"approved",adminNotes:e})}async reject(t,e){return this.update(t,{status:"rejected",adminNotes:e})}}const j=new pt;var c=(r=>(r.NETWORK_ERROR="network_error",r.PERMISSION_DENIED="permission_denied",r.VALIDATION_ERROR="validation_error",r.NOT_FOUND="not_found",r.SERVER_ERROR="server_error",r.TIMEOUT="timeout",r))(c||{});class o extends Error{constructor(t,e="server_error",s,i){super(t),this.name="ServiceError",this.type=e,this.code=s,this.details=i}}class wt{constructor(){this.modelType="funds-requests",this.platformModelType="funds-platforms"}async find(t={}){try{const e={include:t.include||"user,platform",sort:t.sort||"-created_at",...t};t.page&&(e.page=t.page),t.filter&&(e.filter=t.filter);const s=await d.store.find(this.modelType,e);return Array.isArray(s)?s:[s]}catch(e){throw this.handleError(e,"Failed to fetch funds requests")}}async findById(t,e={}){try{const s={include:e.include||"user,platform"};return await d.store.find(this.modelType,t,s)}catch(s){if(this.isNotFoundError(s))return null;throw this.handleError(s,`Failed to fetch funds request ${t}`)}}async create(t){try{return this.validateCreateAttributes(t),await d.store.createRecord(this.modelType).save(t)}catch(e){throw this.handleError(e,"Failed to create funds request")}}async update(t,e){try{if(!this.canModify(t))throw new o("You do not have permission to modify this funds request",c.PERMISSION_DENIED);return await t.save(e)}catch(s){throw this.handleError(s,"Failed to update funds request")}}async delete(t){try{if(!this.canDelete(t))throw new o("You do not have permission to delete this funds request",c.PERMISSION_DENIED);await t.delete()}catch(e){throw this.handleError(e,"Failed to delete funds request")}}async submitRequest(t){try{await this.validateWithdrawalRequest(t);const e={platformId:t.platformId,amount:t.amount,accountDetails:t.accountDetails,message:t.message||"",status:"pending"};return await this.create(e)}catch(e){throw this.handleError(e,"Failed to submit funds request")}}async getUserHistory(t,e={}){const s=t||d.session.user?.id();if(!s)throw new o("User not authenticated",c.PERMISSION_DENIED);const i={...e,filter:{user:s,...e.filter},include:e.include||"platform",sort:e.sort||"-created_at"};return await this.find(i)}async getPendingRequests(t={}){if(!d.session.user?.isAdmin())throw new o("Admin permissions required",c.PERMISSION_DENIED);const e={...t,filter:{status:"pending",...t.filter},include:t.include||"user,platform",sort:t.sort||"created_at"};return await this.find(e)}async approve(t,e){if(!d.session.user?.isAdmin())throw new o("Admin permissions required",c.PERMISSION_DENIED);if(!t.isPending())throw new o("Only pending requests can be approved",c.VALIDATION_ERROR);const s={status:"approved"};return e&&(s.adminNote=e),await this.update(t,s)}async reject(t,e){if(!d.session.user?.isAdmin())throw new o("Admin permissions required",c.PERMISSION_DENIED);if(!t.isPending())throw new o("Only pending requests can be rejected",c.VALIDATION_ERROR);const s={status:"rejected"};return e&&(s.adminNote=e),await this.update(t,s)}async cancel(t){if(!t.canBeModified())throw new o("This request cannot be cancelled",c.VALIDATION_ERROR);const e=d.session.user;if(!e||t.userId()!==e.id()&&!e.isAdmin())throw new o("You can only cancel your own requests",c.PERMISSION_DENIED);return await this.delete(t)}canModify(t){const e=d.session.user;return e?e.isAdmin()?!0:t.userId()===e.id()&&t.canBeModified():!1}canCreate(){const t=d.session.user;return t&&!t.isGuest()}canDelete(t){const e=d.session.user;return e?e.isAdmin()?!0:t.userId()===e.id()&&t.canBeModified():!1}async getPlatforms(){try{const t=await d.store.find(this.platformModelType,{filter:{isActive:!0},sort:"name"});return Array.isArray(t)?t:[t]}catch(t){throw this.handleError(t,"Failed to fetch funds platforms")}}async validateWithdrawalRequest(t){const{platformId:e,amount:s}=t,i=await d.store.find(this.platformModelType,e);if(!i)throw new o("Invalid platform selected",c.VALIDATION_ERROR);if(!i.isActive())throw new o("Selected platform is not available",c.VALIDATION_ERROR);const l=i.minAmount(),f=i.maxAmount();if(s<l)throw new o(`Minimum funds amount is ${l}`,c.VALIDATION_ERROR);if(f&&s>f)throw new o(`Maximum funds amount is ${f}`,c.VALIDATION_ERROR);const p=d.session.user;if(p){const w=parseFloat(p.attribute("money")||"0"),A=i.fee?i.fee():0,P=s+A;if(w<P)throw new o(`Insufficient balance. Required: ${P}, Available: ${w}`,c.VALIDATION_ERROR)}}validateCreateAttributes(t){const e=["platformId","amount","accountDetails"];for(const s of e)if(!t[s])throw new o(`${s} is required`,c.VALIDATION_ERROR);if(typeof t.amount!="number"||t.amount<=0)throw new o("Amount must be a positive number",c.VALIDATION_ERROR)}handleError(t,e){if(t instanceof o)return t;if(t.response&&t.response.errors){const s=t.response.errors[0];return new o(s.detail||e,c.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new o("Network error occurred",c.NETWORK_ERROR):new o(t.message||e,c.SERVER_ERROR)}isNotFoundError(t){return t.status===404||t.response?.status===404||t.message?.includes("not found")}}const F=new wt;class yt{constructor(){this.withdrawalModelType="funds-platforms",this.depositModelType="deposit-platforms"}async find(t,e={}){const s=t==="funds"?this.withdrawalModelType:this.depositModelType;try{const i={sort:e.sort||"name",...e};e.page&&(i.page=e.page),e.filter&&(i.filter=e.filter),e.include&&(i.include=e.include);const l=await d.store.find(s,i);return Array.isArray(l)?l:[l]}catch(i){throw this.handleError(i,`Failed to fetch ${t} platforms`)}}async findById(t,e,s={}){const i=t==="funds"?this.withdrawalModelType:this.depositModelType;try{const l={};return s.include&&(l.include=s.include),await d.store.find(i,e,l)}catch(l){if(this.isNotFoundError(l))return null;throw this.handleError(l,`Failed to fetch ${t} platform ${e}`)}}async create(t,e){const s=t==="funds"?this.withdrawalModelType:this.depositModelType;try{return this.validateCreateAttributes(t,e),await d.store.createRecord(s).save(e)}catch(i){throw this.handleError(i,`Failed to create ${t} platform`)}}async update(t,e){try{if(!this.canModify(t))throw new o("You do not have permission to modify this platform",c.PERMISSION_DENIED);return await t.save(e)}catch(s){throw this.handleError(s,"Failed to update platform")}}async delete(t){try{if(!this.canDelete(t))throw new o("You do not have permission to delete this platform",c.PERMISSION_DENIED);await t.delete()}catch(e){throw this.handleError(e,"Failed to delete platform")}}async getActive(t,e={}){const s={...e,filter:{isActive:!0,...e.filter}};return await this.find(t,s)}async toggleStatus(t){if(!d.session.user?.isAdmin())throw new o("Admin permissions required",c.PERMISSION_DENIED);const e=t.isActive();return await this.update(t,{isActive:!e})}async updateConfig(t,e){if(!d.session.user?.isAdmin())throw new o("Admin permissions required",c.PERMISSION_DENIED);return await this.update(t,e)}async getBySymbol(t,e){return await this.find(e,{filter:{symbol:t},sort:"name"})}validateAmount(t,e){const s=[];if(typeof e!="number"||e<=0)return s.push("Amount must be a positive number"),{valid:!1,errors:s};const i=t.minAmount?t.minAmount():0,l=t.maxAmount?t.maxAmount():null;return e<i&&s.push(`Amount must be at least ${i}`),l&&e>l&&s.push(`Amount cannot exceed ${l}`),{valid:s.length===0,errors:s}}async getPlatformStats(t,e){if(!d.session.user?.isAdmin())throw new o("Admin permissions required",c.PERMISSION_DENIED);const s=t==="funds"?"funds-requests":"deposit-records";try{const i=await d.store.find(s,{filter:{platform:e},include:"platform"}),l=Array.isArray(i)?i:[i];return{total:l.length,pending:l.filter(p=>p.status()==="pending").length,approved:l.filter(p=>p.status()==="approved"||p.status()==="confirmed").length,rejected:l.filter(p=>p.status()==="rejected").length,totalAmount:l.reduce((p,w)=>p+(w.amount()||0),0)}}catch(i){throw this.handleError(i,"Failed to fetch platform statistics")}}async getPlatformsBySymbolGrouped(t){const e=await this.getActive(t),s={};for(const i of e){const l=i.symbol();s[l]||(s[l]=[]),s[l].push(i)}return s}async getSortedPlatforms(t,e="name",s="asc"){const i=s==="desc"?`-${e}`:e;return await this.getActive(t,{sort:i})}canModify(t){const e=d.session.user;return e&&e.isAdmin()}canCreate(){const t=d.session.user;return t&&t.isAdmin()}canDelete(t){const e=d.session.user;return e&&e.isAdmin()}validateCreateAttributes(t,e){const i=["name","symbol","minAmount"];for(const l of i)if(!e[l])throw new o(`${l} is required for ${t} platforms`,c.VALIDATION_ERROR);if(typeof e.minAmount!="number"||e.minAmount<0)throw new o("minAmount must be a non-negative number",c.VALIDATION_ERROR);if(e.maxAmount!==void 0&&(typeof e.maxAmount!="number"||e.maxAmount<e.minAmount))throw new o("maxAmount must be a number greater than or equal to minAmount",c.VALIDATION_ERROR);if(e.fee!==void 0&&(typeof e.fee!="number"||e.fee<0))throw new o("fee must be a non-negative number",c.VALIDATION_ERROR);if(typeof e.symbol!="string"||!e.symbol.trim())throw new o("Symbol is required",c.VALIDATION_ERROR)}handleError(t,e){if(t instanceof o)return t;if(t.response&&t.response.errors){const s=t.response.errors[0];return new o(s.detail||e,c.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new o("Network error occurred",c.NETWORK_ERROR):new o(t.message||e,c.SERVER_ERROR)}isNotFoundError(t){return t.status===404||t.response?.status===404||t.message?.includes("not found")}}const gt=new yt;function Y(r,t="An error occurred"){if(!r)return t;if(r.response&&r.response.errors&&Array.isArray(r.response.errors)){const e=r.response.errors[0];if(e&&e.detail)return e.detail}if(r.responseText){if(r.responseText.includes("<b>Fatal error</b>")||r.responseText.includes("<!DOCTYPE"))return"Server error occurred. Please try again later.";try{const e=JSON.parse(r.responseText);if(e.errors&&Array.isArray(e.errors))return e.errors[0].detail||t}catch{return"Server error occurred. Please try again later."}}return t}class C extends tt{constructor(){super(...arguments),this.state={withdrawalPlatforms:[],withdrawalRequests:[],userBalance:0,loadingBalance:!0,submitting:!1,depositRecords:[],submittingDeposit:!1,loading:!0,activeTab:v("withdrawal"),withdrawalSubTab:v("form"),depositSubTab:v("form")},this.withdrawalFormData={amount:v(""),selectedPlatform:v(null),accountDetails:v(""),message:v("")}}oninit(t){super.oninit(t);const s=new URLSearchParams(window.location.search).get("tab");s&&(s==="withdrawal"||s==="withdrawal-history"?(this.state.activeTab("withdrawal"),this.state.withdrawalSubTab(s==="withdrawal-history"?"history":"form")):s==="deposit"||s==="deposit-history"?(this.state.activeTab("deposit"),this.state.depositSubTab(s==="deposit-history"?"history":"form")):this.isValidTab(s)&&this.state.activeTab(s)),this.updatePageTitle(),this.loadAllData()}isValidTab(t){return["withdrawal","deposit"].includes(t)}isValidSubTab(t){return["form","history"].includes(t)}handleSubTabChange(t,e){t==="withdrawal"?this.state.withdrawalSubTab(e):t==="deposit"&&this.state.depositSubTab(e),this.updateUrl(),u.redraw()}updateUrl(){const t=this.state.activeTab(),e=new URLSearchParams;t==="withdrawal"?this.state.withdrawalSubTab()==="history"?e.set("tab","withdrawal-history"):e.set("tab","withdrawal"):t==="deposit"&&(this.state.depositSubTab()==="history"?e.set("tab","deposit-history"):e.set("tab","deposit"));const s=`${window.location.pathname}?${e.toString()}`;window.history.replaceState({},"",s)}updatePageTitle(){const t=this.state.activeTab();let e="funds.forum.page.title";switch(t){case"withdrawal":case"withdrawal-history":e="funds.forum.page.title";break;case"deposit":case"deposit-history":e="funds.forum.deposit.page.title";break}const s=n.translator.trans(e);n.setTitle(typeof s=="string"?s:s.toString())}view(){return this.state.loading?u("div",{className:"FundsPage"},u("div",{className:"FundsPage-loading"},u(k,null))):u("div",{className:"FundsPage"},u("div",{className:"FundsPage-modal"},this.renderHeader(),u("div",{className:"FundsPage-content"},this.renderActiveTab())))}renderHeader(){const t=this.state.activeTab();return u("div",{className:"FundsPage-header"},u("div",{className:"FundsPage-tabs"},u("div",{className:`FundsPage-tab ${t==="withdrawal"?"active":""}`,onclick:()=>this.handleTabChange("withdrawal")},n.translator.trans("funds.forum.tabs.funds")),u("div",{className:`FundsPage-tab ${t==="deposit"?"active":""}`,onclick:()=>this.handleTabChange("deposit")},n.translator.trans("funds.forum.deposit.tabs.deposit"))),u(R,{className:"FundsPage-close",icon:"fas fa-times",onclick:()=>n.history.back()}))}renderActiveTab(){switch(this.state.activeTab()){case"withdrawal":return this.renderWithdrawalTab();case"deposit":return this.renderDepositTab();default:return this.renderWithdrawalTab()}}renderWithdrawalTab(){const t=this.state.withdrawalSubTab();return u("div",{className:"FundsPage-withdrawalTab"},u("div",{className:"FundsPage-subTabs"},u("div",{className:`FundsPage-subTab ${t==="form"?"active":""}`,onclick:()=>this.handleSubTabChange("withdrawal","form")},n.translator.trans("funds.forum.tabs.funds")),u("div",{className:`FundsPage-subTab ${t==="history"?"active":""}`,onclick:()=>this.handleSubTabChange("withdrawal","history")},n.translator.trans("funds.forum.tabs.history"))),t==="form"?this.renderWithdrawalForm():this.renderWithdrawalHistory())}renderWithdrawalForm(){return(this.state.withdrawalPlatforms||[]).filter(e=>!!e).length===0?u("div",{className:"FundsPage-withdrawalContent"},u("div",{className:"WithdrawalPage-emptyState"},u("div",{className:"WithdrawalPage-emptyIcon"},y("fas fa-coins")),u("h3",{className:"WithdrawalPage-emptyTitle"},n.translator.trans("funds.forum.no_platforms")),u("p",{className:"WithdrawalPage-emptyDescription"},n.translator.trans("funds.forum.no_platforms_description")))):u("div",{className:"FundsPage-withdrawalContent"},u(ut,{platforms:this.state.withdrawalPlatforms,formData:this.getWithdrawalFormDataForComponent(),loadingBalance:this.state.loadingBalance,submitting:this.state.submitting,onFormDataChange:this.handleWithdrawalFormDataChange.bind(this),onFillAllAmount:this.handleFillAllAmount.bind(this),onSubmit:this.handleWithdrawalSubmit.bind(this)}))}renderWithdrawalHistory(){return u("div",{className:"FundsPage-withdrawalContent"},u(ht,{transactions:this.state.withdrawalRequests,platforms:this.state.withdrawalPlatforms,loading:!1,type:"withdrawal"}))}renderDepositTab(){const t=this.state.depositSubTab();return u("div",{className:"FundsPage-depositTab"},u("div",{className:"FundsPage-subTabs"},u("div",{className:`FundsPage-subTab ${t==="form"?"active":""}`,onclick:()=>this.handleSubTabChange("deposit","form")},n.translator.trans("funds.forum.deposit.tabs.deposit")),u("div",{className:`FundsPage-subTab ${t==="history"?"active":""}`,onclick:()=>this.handleSubTabChange("deposit","history")},n.translator.trans("funds.forum.deposit.tabs.history"))),t==="form"?this.renderDepositForm():this.renderDepositHistory())}renderDepositForm(){return u("div",{className:"FundsPage-depositContent"},u(ft,{onSubmit:this.handleSimpleDepositSubmit.bind(this),onCancel:this.handleCancelDepositForm.bind(this),submitting:this.state.submittingDeposit}))}renderDepositHistory(){const t=this.state.depositRecords||[];return t.length===0?u("div",{className:"FundsPage-depositContent"},u("div",{className:"FundsPage-emptyState"},u("div",{className:"FundsPage-emptyIcon"},y("fas fa-history")),u("h3",{className:"FundsPage-emptyTitle"},n.translator.trans("funds.forum.deposit.simple.no_history",{},"暂无存款记录")),u("p",{className:"FundsPage-emptyDescription"},n.translator.trans("funds.forum.deposit.simple.no_history_description",{},"您还没有提交过任何存款申请")))):u("div",{className:"FundsPage-depositContent"},u("div",{className:"SimpleDepositHistory"},t.map(e=>u("div",{key:e.id(),className:"SimpleDepositHistory-item"},u("div",{className:"SimpleDepositHistory-header"},u("span",{className:`Badge Badge--${e.getStatusColor()}`},u("i",{className:e.getStatusIcon()}),e.statusText()),u("span",{className:"SimpleDepositHistory-date"},e.formattedCreatedAt())),u("div",{className:"SimpleDepositHistory-content"},u("div",{className:"SimpleDepositHistory-address"},u("strong",null,n.translator.trans("funds.forum.deposit.simple.deposit_address",{},"存款地址"),":"),u("code",null,e.getDisplayAddress())),e.hasQrCode()&&u("div",{className:"SimpleDepositHistory-qr"},u("strong",null,n.translator.trans("funds.forum.deposit.simple.qr_code_url",{},"收款二维码"),":"),u("a",{href:e.qrCodeUrl(),target:"_blank",rel:"noopener noreferrer"},n.translator.trans("funds.forum.deposit.simple.view_qr",{},"查看二维码"))),e.userMessage()&&u("div",{className:"SimpleDepositHistory-message"},u("strong",null,n.translator.trans("funds.forum.deposit.simple.user_message",{},"留言"),":"),u("p",null,e.userMessage())),e.adminNotes()&&u("div",{className:"SimpleDepositHistory-adminNotes"},u("strong",null,n.translator.trans("funds.forum.deposit.simple.admin_notes",{},"管理员备注"),":"),u("p",null,e.adminNotes())))))))}handleTabChange(t){this.state.activeTab(t),this.updatePageTitle();const e=new URL(window.location.href);e.searchParams.set("tab",t);const s=t==="withdrawal"?this.state.withdrawalSubTab():this.state.depositSubTab();e.searchParams.set("subtab",s),window.history.replaceState({},"",e.toString())}getWithdrawalFormDataForComponent(){return{selectedPlatform:this.withdrawalFormData.selectedPlatform(),amount:this.withdrawalFormData.amount(),accountDetails:this.withdrawalFormData.accountDetails(),message:this.withdrawalFormData.message()}}handleWithdrawalFormDataChange(t){t.selectedPlatform!==void 0&&this.withdrawalFormData.selectedPlatform(t.selectedPlatform),t.amount!==void 0&&this.withdrawalFormData.amount(t.amount),t.accountDetails!==void 0&&this.withdrawalFormData.accountDetails(t.accountDetails),t.message!==void 0&&this.withdrawalFormData.message(t.message)}async handleFillAllAmount(){const t=this.withdrawalFormData.selectedPlatform();if(t&&!this.state.loadingBalance)try{await this.loadUserBalance(!0);const e=h(t,"fee")||0,s=h(t,"maxAmount")||1/0;let i=this.state.userBalance-e;s<1/0&&i>s&&(i=s),i>0?this.withdrawalFormData.amount(i.toString()):n.alerts.show({type:"warning",dismissible:!0},n.translator.trans("funds.forum.insufficient_balance"))}catch(e){console.error("Error refreshing balance:",e),n.alerts.show({type:"error",dismissible:!0},n.translator.trans("funds.forum.balance_refresh_error"))}}async handleWithdrawalSubmit(){if(this.state.submitting)return;const t=this.withdrawalFormData.selectedPlatform(),e=this.withdrawalFormData.amount(),s=this.withdrawalFormData.accountDetails();if(!t||!e||!s)return;const i=parseFloat(e);if(isNaN(i)||i<=0){n.alerts.show({type:"warning",dismissible:!0},n.translator.trans("funds.forum.invalid_amount"));return}this.state.submitting=!0;try{await F.submitRequest({platformId:parseInt(H(t),10),amount:i,accountDetails:s,message:this.withdrawalFormData.message()}),this.withdrawalFormData.amount(""),this.withdrawalFormData.accountDetails(""),this.withdrawalFormData.message(""),this.withdrawalFormData.selectedPlatform(null),await Promise.all([this.loadUserBalance(!0),this.loadWithdrawalRequests()]),n.alerts.show({type:"success",dismissible:!0},n.translator.trans("funds.forum.submit_success"))}catch(l){console.error("Withdrawal request failed:",l);let f=n.translator.trans("funds.forum.error").toString();l instanceof o?f=l.message:f=Y(l,f),n.alerts.show({type:"error",dismissible:!0},f)}finally{this.state.submitting=!1}}handleCancelDepositForm(){u.redraw()}async handleSimpleDepositSubmit(t){if(!this.state.submittingDeposit){this.state.submittingDeposit=!0,u.redraw();try{await j.create(t),n.alerts.show({type:"success",dismissible:!0},n.translator.trans("funds.forum.deposit.simple.submit_success",{},"存款申请提交成功，请等待管理员审核")),await this.loadSimpleDepositRecords(),this.state.depositSubTab("history")}catch(e){console.error("Simple deposit submission failed:",e);let s=n.translator.trans("funds.forum.deposit.simple.submit_error",{},"提交失败，请重试").toString();e instanceof o?s=e.message:s=Y(e,s),n.alerts.show({type:"error",dismissible:!0},s)}finally{this.state.submittingDeposit=!1,u.redraw()}}}async loadAllData(){try{await Promise.all([this.loadWithdrawalData(),this.loadSimpleDepositRecords(),this.loadUserBalance()]),this.state.loading=!1,u.redraw()}catch(t){console.error("Error loading data:",t),this.state.loading=!1,u.redraw()}}async loadWithdrawalData(){try{const[t,e]=await Promise.all([gt.getActive("withdrawal"),F.getUserHistory()]);this.state.withdrawalPlatforms=t,this.state.withdrawalRequests=e}catch(t){console.error("Error loading funds data:",t),this.state.withdrawalPlatforms=[],this.state.withdrawalRequests=[]}}async loadSimpleDepositRecords(){try{const t=await j.getUserHistory();this.state.depositRecords=t}catch(t){console.error("Error loading simple deposit records:",t),this.state.depositRecords=[]}}async loadUserBalance(t=!1){try{if(this.state.loadingBalance=!0,t&&n.session.user){const e=n.session.user.id();if(!e)throw new Error("User ID not available");const s=await n.store.find("users",e);s?this.state.userBalance=parseFloat(s.attribute("money"))||0:this.state.userBalance=0}else this.state.userBalance=parseFloat(n.session.user?.attribute("money")||"0");this.state.loadingBalance=!1,u.redraw()}catch(e){console.error("Error loading user balance:",e),this.state.loadingBalance=!1,u.redraw()}}async loadWithdrawalRequests(){try{const t=await F.getUserHistory();this.state.withdrawalRequests=t}catch(t){console.error("Error loading funds requests:",t),this.state.withdrawalRequests=[]}}}function z(r){const t=[];return r.name!==void 0&&(!r.name||typeof r.name!="string")&&t.push("Platform name is required"),r.symbol!==void 0&&(!r.symbol||typeof r.symbol!="string")&&t.push("Symbol is required"),t}function G(r,t){const e=[];if(r.minAmount!==void 0&&(typeof r.minAmount!="number"||r.minAmount<0)&&e.push("Minimum amount must be a non-negative number"),r.maxAmount!==void 0&&r.maxAmount!==null){(typeof r.maxAmount!="number"||r.maxAmount<0)&&e.push("Maximum amount must be a non-negative number");const s=r.minAmount??t??0;r.maxAmount<s&&e.push("Maximum amount must be greater than or equal to minimum amount")}return r.fee!==void 0&&r.fee!==null&&(typeof r.fee!="number"||r.fee<0)&&e.push("Fee must be a non-negative number"),e}function bt(r){const t=[];return r.network!==void 0&&r.network!==null&&r.network!==""&&typeof r.network!="string"&&t.push("Network must be a string"),r.address!==void 0&&r.address!==null&&r.address!==""&&typeof r.address!="string"&&t.push("Deposit address must be a string"),t}function M(r){if(r.length>0)throw new o(r.join(", "),c.VALIDATION_ERROR)}function At(r,t){const e=[...z(r),...G(r,t)];M(e)}function vt(r,t){const e=[...z(r),...G(r,t),...bt(r)];M(e)}class Nt extends a{constructor(){super(...arguments),this.name=a.attribute("name"),this.symbol=a.attribute("symbol"),this.network=a.attribute("network"),this.displayName=a.attribute("displayName"),this.minAmount=a.attribute("minAmount"),this.maxAmount=a.attribute("maxAmount"),this.fee=a.attribute("fee"),this.currencyIconUrl=a.attribute("currencyIconUrl"),this.currencyIconClass=a.attribute("currencyIconClass"),this.currencyUnicodeSymbol=a.attribute("currencyUnicodeSymbol"),this.networkIconUrl=a.attribute("networkIconUrl"),this.networkIconClass=a.attribute("networkIconClass"),this.platformSpecificIconUrl=a.attribute("platformSpecificIconUrl"),this.platformSpecificIconClass=a.attribute("platformSpecificIconClass"),this.currencyIconOverrideUrl=a.attribute("currencyIconOverrideUrl"),this.currencyIconOverrideClass=a.attribute("currencyIconOverrideClass"),this.networkIconOverrideUrl=a.attribute("networkIconOverrideUrl"),this.networkIconOverrideClass=a.attribute("networkIconOverrideClass"),this.isActive=a.attribute("isActive"),this.createdAt=a.attribute("createdAt",a.transformDate),this.updatedAt=a.attribute("updatedAt",a.transformDate),this.bestIcon=a.attribute("bestIcon"),this.currencyIcon=a.attribute("currencyIcon"),this.networkIcon=a.attribute("networkIcon")}apiEndpoint(){const t=this.id();return t?`/funds-platforms/${t}`:"/funds-platforms"}getDisplayName(){return this.displayName()||this.name()}isValidAmount(t){const e=this.minAmount(),s=this.maxAmount();return t>=e&&t<=s}getTotalCost(t){return t+this.fee()}async save(t){t&&this.validateAttributes(t);try{return await super.save(t)}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new o("You do not have permission to delete this platform",c.PERMISSION_DENIED);if(await this.isInUse())throw new o("Cannot delete platform that has pending funds requests",c.VALIDATION_ERROR);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}async toggleStatus(){if(!this.canModify())throw new o("You do not have permission to modify this platform",c.PERMISSION_DENIED);return await this.save({isActive:!this.isActive()})}clone(){const t=d.store.createRecord("funds-platforms");return t.pushAttributes({name:this.name()+" (Copy)",symbol:this.symbol(),network:this.network(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),currencyIconOverrideUrl:this.currencyIconOverrideUrl(),currencyIconOverrideClass:this.currencyIconOverrideClass(),networkIconOverrideUrl:this.networkIconOverrideUrl(),networkIconOverrideClass:this.networkIconOverrideClass(),isActive:!1}),t}validateAmount(t){const e=[];return typeof t!="number"||t<=0?(e.push("Amount must be a positive number"),{valid:!1,errors:e}):(t<this.minAmount()&&e.push(`Amount must be at least ${this.minAmount()} ${this.symbol()}`),this.maxAmount()&&t>this.maxAmount()&&e.push(`Amount cannot exceed ${this.maxAmount()} ${this.symbol()}`),{valid:e.length===0,errors:e})}validateUserBalance(t,e){const s=[],i=this.getTotalCost(t);if(e<i){const l=this.fee()>0?` (including ${this.fee()} ${this.symbol()} fee)`:"";s.push(`Insufficient balance. Required: ${i} ${this.symbol()}${l}, Available: ${e} ${this.symbol()}`)}return{valid:s.length===0,errors:s}}canModify(){const t=d.session.user;return t&&t.isAdmin()}canDelete(){const t=d.session.user;return t&&t.isAdmin()}canView(){if(this.isActive())return!0;const t=d.session.user;return t&&t.isAdmin()}async isInUse(){try{const t=await d.store.find("funds-requests",{filter:{platform:this.id(),status:"pending"}});return(Array.isArray(t)?t:[t]).length>0}catch{return!0}}getFormattedFee(){const t=this.fee();return t===0?"Free":`${t} ${this.symbol()}`}getFormattedLimits(){const t=this.minAmount(),e=this.maxAmount(),s=this.symbol();return e?`${t} - ${e} ${s}`:`Min: ${t} ${s}`}validateAttributes(t){At(t,this.minAmount())}handleSaveError(t){if(t instanceof o)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new o(e.detail||"Failed to save funds platform",c.VALIDATION_ERROR,e.code,e)}return new o(t.message||"Failed to save funds platform",c.SERVER_ERROR)}handleDeleteError(t){return t instanceof o?t:t.status===403||t.response?.status===403?new o("You do not have permission to delete this platform",c.PERMISSION_DENIED):new o(t.message||"Failed to delete funds platform",c.SERVER_ERROR)}}const D={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class Dt extends a{constructor(){super(...arguments),this.amount=a.attribute("amount"),this.accountDetails=a.attribute("accountDetails"),this.message=a.attribute("message"),this.status=a.attribute("status"),this.platformId=a.attribute("platformId"),this.userId=a.attribute("userId"),this.createdAt=a.attribute("createdAt",a.transformDate),this.updatedAt=a.attribute("updatedAt",a.transformDate),this.user=a.hasOne("user"),this.platform=a.hasOne("platform")}apiEndpoint(){const t=this.id();return t?`/funds-requests/${t}`:"/funds-requests"}isPending(){return this.status()===D.PENDING}isApproved(){return this.status()===D.APPROVED}isRejected(){return this.status()===D.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const t=this.status();return d.translator.trans(`funds.forum.status.${t}`).toString()}statusColor(){switch(this.status()){case D.APPROVED:return"success";case D.REJECTED:return"danger";case D.PENDING:default:return"warning"}}async save(t){t&&this.validateAttributes(t);try{return await super.save(t)}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new o("You do not have permission to delete this request",c.PERMISSION_DENIED);const t=d.session.user;if(t&&!t.isAdmin()&&!this.canBeModified())throw new o("This request cannot be deleted as it has already been processed",c.VALIDATION_ERROR);try{await super.delete()}catch(e){throw this.handleDeleteError(e)}}clone(){const t=d.store.createRecord("funds-requests");return t.pushAttributes({platformId:this.platformId(),amount:this.amount(),accountDetails:this.accountDetails(),message:this.message()}),t}getTotalCost(){const t=this.platform(),e=t&&t.fee()||0;return this.amount()+e}getFormattedAmount(){const t=this.platform(),e=t?t.symbol():"";return`${this.amount()} ${e}`.trim()}getFormattedTotalCost(){const t=this.platform(),e=t?t.symbol():"",s=t&&t.fee()||0;return s>0?`${this.amount()} + ${s} (fee) = ${this.getTotalCost()} ${e}`.trim():this.getFormattedAmount()}canModify(){const t=d.session.user;return t?t.isAdmin()?!0:this.userId()===t.id()&&this.canBeModified():!1}canDelete(){const t=d.session.user;return t?t.isAdmin()?!0:this.userId()===t.id()&&this.canBeModified():!1}canView(){const t=d.session.user;return t?t.isAdmin()?!0:this.userId()===t.id():!1}validateAttributes(t){const e=[];if(t.amount!==void 0&&(typeof t.amount!="number"||t.amount<=0)&&e.push("Amount must be a positive number"),t.accountDetails!==void 0&&(!t.accountDetails||typeof t.accountDetails!="string")&&e.push("Account details are required"),t.platformId!==void 0&&(!t.platformId||typeof t.platformId!="number")&&e.push("Platform selection is required"),e.length>0)throw new o(e.join(", "),c.VALIDATION_ERROR)}handleSaveError(t){if(t instanceof o)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new o(e.detail||"Failed to save funds request",c.VALIDATION_ERROR,e.code,e)}return new o(t.message||"Failed to save funds request",c.SERVER_ERROR)}handleDeleteError(t){return t instanceof o?t:t.status===403||t.response?.status===403?new o("You do not have permission to delete this request",c.PERMISSION_DENIED):new o(t.message||"Failed to delete funds request",c.SERVER_ERROR)}}class It extends a{constructor(){super(...arguments),this.name=a.attribute("name"),this.symbol=a.attribute("symbol"),this.network=a.attribute("network"),this.networkTypeId=a.attribute("networkTypeId"),this.displayName=a.attribute("displayName"),this.minAmount=a.attribute("minAmount"),this.maxAmount=a.attribute("maxAmount"),this.fee=a.attribute("fee"),this.address=a.attribute("address"),this.qrCodeImageUrl=a.attribute("qrCodeImageUrl"),this.currencyIconUrl=a.attribute("currencyIconUrl"),this.currencyIconClass=a.attribute("currencyIconClass"),this.currencyUnicodeSymbol=a.attribute("currencyUnicodeSymbol"),this.networkIconUrl=a.attribute("networkIconUrl"),this.networkIconClass=a.attribute("networkIconClass"),this.platformSpecificIconUrl=a.attribute("platformSpecificIconUrl"),this.platformSpecificIconClass=a.attribute("platformSpecificIconClass"),this.currencyIconOverrideUrl=a.attribute("currencyIconOverrideUrl"),this.currencyIconOverrideClass=a.attribute("currencyIconOverrideClass"),this.networkIconOverrideUrl=a.attribute("networkIconOverrideUrl"),this.networkIconOverrideClass=a.attribute("networkIconOverrideClass"),this.warningText=a.attribute("warningText"),this.networkConfig=a.attribute("networkConfig"),this.isActive=a.attribute("isActive"),this.createdAt=a.attribute("createdAt",a.transformDate),this.updatedAt=a.attribute("updatedAt",a.transformDate),this.networkType=a.hasOne("networkType"),this.bestIcon=a.attribute("bestIcon"),this.currencyIcon=a.attribute("currencyIcon"),this.networkIcon=a.attribute("networkIcon")}getDisplayName(){return this.displayName()||this.name()}getFullDisplayName(){const t=this.getDisplayName(),e=this.network();return e?`${t} (${e})`:t}isValidAmount(t){const e=this.minAmount()||0,s=this.maxAmount();return t>=e&&(s===null||t<=s)}getTotalCost(t){return t+(this.fee()||0)}async save(t){t&&this.validateAttributes(t);try{return await super.save(t)}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new o("You do not have permission to delete this platform",c.PERMISSION_DENIED);if(await this.isInUse())throw new o("Cannot delete platform that has pending deposit records",c.VALIDATION_ERROR);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}async toggleStatus(){if(!this.canModify())throw new o("You do not have permission to modify this platform",c.PERMISSION_DENIED);return await this.save({isActive:!this.isActive()})}clone(){const t=d.store.createRecord("deposit-platforms");return t.pushAttributes({name:this.name()+" (Copy)",symbol:this.symbol(),network:this.network(),networkTypeId:this.networkTypeId(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),address:this.address(),qrCodeImageUrl:this.qrCodeImageUrl(),iconUrl:this.iconUrl(),iconClass:this.iconClass(),warningText:this.warningText(),isActive:!1}),t}validateAmount(t){const e=[];if(typeof t!="number"||t<=0)return e.push("Amount must be a positive number"),{valid:!1,errors:e};const s=this.minAmount()||0;t<s&&e.push(`Amount must be at least ${s} ${this.symbol()}`);const i=this.maxAmount();return i&&t>i&&e.push(`Amount cannot exceed ${i} ${this.symbol()}`),{valid:e.length===0,errors:e}}canModify(){const t=d.session.user;return t&&t.isAdmin()}canDelete(){const t=d.session.user;return t&&t.isAdmin()}canView(){if(this.isActive())return!0;const t=d.session.user;return t&&t.isAdmin()}async isInUse(){try{const t=await d.store.find("deposit-records",{filter:{platform:this.id(),status:"pending"}});return(Array.isArray(t)?t:[t]).length>0}catch{return!0}}getFormattedFee(){const t=this.fee()||0;return t===0?"Free":`${t} ${this.symbol()}`}getFormattedLimits(){const t=this.minAmount()||0,e=this.maxAmount(),s=this.symbol();return e?`${t} - ${e} ${s}`:`Min: ${t} ${s}`}generateDepositAddress(t){const e=this.address();if(e)return e;throw new o("No deposit address configured for this platform",c.VALIDATION_ERROR)}validateAttributes(t){vt(t,this.minAmount())}handleSaveError(t){if(t instanceof o)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new o(e.detail||"Failed to save deposit platform",c.VALIDATION_ERROR,e.code,e)}return new o(t.message||"Failed to save deposit platform",c.SERVER_ERROR)}handleDeleteError(t){return t instanceof o?t:t.status===403||t.response?.status===403?new o("You do not have permission to delete this platform",c.PERMISSION_DENIED):new o(t.message||"Failed to delete deposit platform",c.SERVER_ERROR)}}const g=class g extends a{constructor(){super(...arguments),this.id=a.attribute("id"),this.userId=a.attribute("userId"),this.platformId=a.attribute("platformId"),this.platformAccount=a.attribute("platformAccount"),this.realName=a.attribute("realName"),this.amount=a.attribute("amount"),this.depositTime=a.attribute("depositTime",a.transformDate),this.screenshotUrl=a.attribute("screenshotUrl"),this.userMessage=a.attribute("userMessage"),this.status=a.attribute("status"),this.processedAt=a.attribute("processedAt",a.transformDate),this.processedBy=a.attribute("processedBy"),this.adminNotes=a.attribute("adminNotes"),this.creditedAmount=a.attribute("creditedAmount"),this.createdAt=a.attribute("createdAt",a.transformDate),this.updatedAt=a.attribute("updatedAt",a.transformDate),this.user=a.hasOne("user"),this.platform=a.hasOne("platform"),this.processedByUser=a.hasOne("processedByUser")}isPending(){return this.status()===g.STATUS_PENDING}isApproved(){return this.status()===g.STATUS_APPROVED}isRejected(){return this.status()===g.STATUS_REJECTED}getStatusColor(){switch(this.status()){case g.STATUS_PENDING:return"warning";case g.STATUS_APPROVED:return"success";case g.STATUS_REJECTED:return"error";default:return"secondary"}}getStatusLabel(){const t=this.status();return d.translator.trans(`funds.forum.deposit.status.${t}`).toString()}canBeModified(){return this.isPending()}async save(t){t&&this.validateAttributes(t);try{return await super.save(t)}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new o("You do not have permission to delete this deposit record",c.PERMISSION_DENIED);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}clone(){const t=d.store.createRecord("deposit-records");return t.pushAttributes({platformId:this.platformId(),amount:this.amount(),platformAccount:this.platformAccount(),realName:this.realName(),userMessage:this.userMessage(),screenshotUrl:this.screenshotUrl()}),t}getFormattedAmount(){const t=this.platform(),e=t?t.symbol():"";return`${this.amount()} ${e}`.trim()}getFinalAmount(){return this.creditedAmount()||this.amount()}getFormattedFinalAmount(){const t=this.platform(),e=t?t.symbol():"",s=this.getFinalAmount();return this.creditedAmount()&&this.creditedAmount()!==this.amount()?`${s} ${e} (credited: ${this.creditedAmount()})`.trim():`${s} ${e}`.trim()}canModify(){const t=d.session.user;return t?t.isAdmin()?!0:this.userId()===t.id()&&this.canBeModified():!1}canDelete(){const t=d.session.user;return t?t.isAdmin()?!0:this.userId()===t.id()&&this.canBeModified():!1}canView(){const t=d.session.user;return t?t.isAdmin()?!0:this.userId()===t.id():!1}canProcess(){const t=d.session.user;return t&&t.isAdmin()&&this.isPending()}async approve(t,e){if(!this.canProcess())throw new o("You do not have permission to approve this deposit",c.PERMISSION_DENIED);const s={status:g.STATUS_APPROVED,processedAt:new Date,processedBy:d.session.user?.id()};return t!==void 0&&(s.creditedAmount=t),e&&(s.adminNotes=e),await this.save(s)}async reject(t){if(!this.canProcess())throw new o("You do not have permission to reject this deposit",c.PERMISSION_DENIED);const e={status:g.STATUS_REJECTED,processedAt:new Date,processedBy:d.session.user?.id()};return t&&(e.adminNotes=t),await this.save(e)}validateAttributes(t){const e=[];if(t.amount!==void 0&&(typeof t.amount!="number"||t.amount<=0)&&e.push("Amount must be a positive number"),t.platformAccount!==void 0&&(!t.platformAccount||typeof t.platformAccount!="string")&&e.push("Platform account is required"),t.realName!==void 0&&(!t.realName||typeof t.realName!="string")&&e.push("Real name is required"),t.platformId!==void 0&&(!t.platformId||typeof t.platformId!="number")&&e.push("Platform selection is required"),t.creditedAmount!==void 0&&(typeof t.creditedAmount!="number"||t.creditedAmount<0)&&e.push("Credited amount must be a non-negative number"),e.length>0)throw new o(e.join(", "),c.VALIDATION_ERROR)}handleSaveError(t){if(t instanceof o)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new o(e.detail||"Failed to save deposit record",c.VALIDATION_ERROR,e.code,e)}return new o(t.message||"Failed to save deposit record",c.SERVER_ERROR)}handleDeleteError(t){return t instanceof o?t:t.status===403||t.response?.status===403?new o("You do not have permission to delete this record",c.PERMISSION_DENIED):new o(t.message||"Failed to delete deposit record",c.SERVER_ERROR)}};g.STATUS_PENDING="pending",g.STATUS_APPROVED="approved",g.STATUS_REJECTED="rejected";let _=g;class Pt extends a{constructor(){super(...arguments),this.userId=a.attribute("userId"),this.depositAddress=a.attribute("depositAddress"),this.qrCodeUrl=a.attribute("qrCodeUrl"),this.userMessage=a.attribute("userMessage"),this.status=a.attribute("status"),this.statusText=a.attribute("statusText"),this.processedAt=a.attribute("processedAt",a.transformDate),this.processedBy=a.attribute("processedBy"),this.adminNotes=a.attribute("adminNotes"),this.createdAt=a.attribute("createdAt",a.transformDate),this.updatedAt=a.attribute("updatedAt",a.transformDate),this.formattedCreatedAt=a.attribute("formattedCreatedAt"),this.formattedProcessedAt=a.attribute("formattedProcessedAt"),this.isPending=a.attribute("isPending"),this.isApproved=a.attribute("isApproved"),this.isRejected=a.attribute("isRejected"),this.user=a.hasOne("user"),this.processedByUser=a.hasOne("processedByUser")}getStatusColor(){switch(this.status()){case"pending":return"warning";case"approved":return"success";case"rejected":return"danger";default:return"secondary"}}getStatusIcon(){switch(this.status()){case"pending":return"fas fa-clock";case"approved":return"fas fa-check-circle";case"rejected":return"fas fa-times-circle";default:return"fas fa-question-circle"}}canEdit(t){return t?t.isAdmin()?!0:this.userId()===t.id()&&this.isPending():!1}canDelete(t){return t?t.isAdmin():!1}getDisplayAddress(){const t=this.depositAddress();return t&&t.length>20?`${t.substring(0,10)}...${t.substring(t.length-10)}`:t||""}hasQrCode(){const t=this.qrCodeUrl();return t!=null&&t.trim()!==""}}class Rt extends b{view(){if(!n.session.user)return null;const e=(n.forum.attribute("antoinefr-money.moneyname")||"[money]").replace("[money]",n.session.user.attribute("money")),s=n.forum.attribute("wusong8899-funds.moneyIconUrl");return m("div",{id:"moneyDisplayContainer",className:"client1-header-adv-wrapper clientCustomizeWithdrawalHeaderTotalMoney"},m("div",{className:"clientCustomizeWithdrawalHeaderText"},s&&s.trim()&&m("span",{style:{borderRadius:"50%",padding:"6px 8px",marginRight:"8px",display:"inline-flex",alignItems:"center",justifyContent:"center"}},m("img",{src:s,alt:"Money icon",style:{width:"20px",height:"20px"},onError:i=>{const l=i.target;l.style.display="none"}})),e),m("div",{className:"clientCustomizeWithdrawalHeaderIcon"},m("i",{className:"fas fa-wallet"})),m("div",{className:"clientCustomizeWithdrawalButtons"},m("div",{className:"clientCustomizeWithdrawalButton",onclick:this.handleWithdrawalClick.bind(this),title:"提款"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",{style:{marginLeft:"4px",fontSize:"12px"}},"提款")),m("div",{className:"clientCustomizeDepositButton",onclick:this.handleDepositClick.bind(this),title:"存款",style:{marginLeft:"8px"}},m("i",{className:"fas fa-coins"}),m("span",{style:{marginLeft:"4px",fontSize:"12px"}},"存款"))))}handleWithdrawalClick(t){t.preventDefault(),t.stopPropagation(),window.location.href="/funds?tab=funds"}handleDepositClick(t){t.preventDefault(),t.stopPropagation(),window.location.href="/funds?tab=deposit"}}class St extends b{view(){const t=n.session.user?.attribute("money")||0,e=n.forum.attribute("wusong8899-funds.moneyIconUrl");return m("div",{className:"Navigation-mobileMoneyDisplay"},m("div",{className:"Navigation-moneySection",onclick:this.handleWithdrawalClick.bind(this),title:`余额: ${t} - 点击提款`},m("div",{className:"Navigation-moneyText"},e&&e.trim()&&m("span",{style:{borderRadius:"50%",padding:"4px 6px",marginRight:"6px",display:"inline-flex",alignItems:"center",justifyContent:"center"}},m("img",{src:e,alt:"Money icon",style:{width:"18px",height:"18px"},onError:s=>{const i=s.target;i.style.display="none"}})),m("span",{className:"Navigation-moneyAmount"},t)),m("div",{className:"Navigation-withdrawalButton"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",null,"提款"))))}handleWithdrawalClick(t){t.preventDefault(),t.stopPropagation(),console.log("MobileMoneyDisplay clicked!");try{window.location.href="/funds?tab=funds"}catch(e){console.error("Navigation error:",e),window.location.href="/funds?tab=funds"}}}class I{constructor(){}static getInstance(){return I.instance||(I.instance=new I),I.instance}isTagsPage(){try{return n.current?.get("routeName")==="index"}catch{return!1}}}function U(){return window.innerWidth<=767}function x(){return window.innerWidth>=768&&window.innerWidth<=1024}function Et(){return window.innerWidth>1024}function Tt(){return U()||x()}function Ot(){return U()?"mobile":x()?"tablet":"desktop"}function Ft(){return"ontouchstart"in window||navigator.maxTouchPoints>0}const Ct={isMobile:U,isTablet:x,isDesktop:Et,isMobileOrTablet:Tt,getCurrentBreakpoint:Ot,isTouchDevice:Ft};n.initializers.add("wusong8899-funds",()=>{n.store.models["funds-platforms"]=Nt,n.store.models["funds-requests"]=Dt,n.store.models["deposit-platforms"]=It,n.store.models["deposit-records"]=_,n.store.models["simple-deposit-records"]=Pt,n.routes.funds={path:"/funds",component:C},n.routes.funds={path:"/funds",component:C},n.routes.deposit={path:"/deposit",component:C},q.extend(Z.prototype,"view",function(r){const t=I.getInstance();n.session.user&&t.isTagsPage()&&!Ct.isMobile()&&r.children.push(Rt.component())}),q.extend($.prototype,"view",function(r){if(window.innerWidth>768||n.current.get("routeName")!=="tags"||!n.session.user||!r||!r.children||!Array.isArray(r.children))return;r.children.some(s=>s&&s.attrs&&s.attrs.className&&s.attrs.className.includes("Navigation-mobileMoneyDisplay"))||r.children.push(St.component({className:"item-funds Navigation-mobileMoneyDisplay"}))})})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["forum/components/HeaderPrimary"],flarum.core.compat["common/components/Navigation"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/icon"],m,flarum.core.compat["common/Component"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/utils/withAttr"],flarum.core.compat["common/app"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=forum.js.map

module.exports={};