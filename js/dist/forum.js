(function(u,a,H,st,rt,at,P,j,N,g,l,A,Y,E,c){"use strict";const z=o=>typeof o.id=="function"?o.id():o.id,h=(o,t)=>typeof o[t]=="function"?o[t]():o.attributes?o.attributes[t]:o[t],W=o=>String(z(o)),it=(o,t)=>{const e=String(t);return o.find(s=>{const r=z(s);return String(r)===e})},_=(o,t)=>{const e=h(o,t);return e?new Date(e):new Date},G={pending:"warning",approved:"success",rejected:"danger"},R={MIN_AMOUNT:.001,MAX_AMOUNT:10,FEE:5e-4,BALANCE_PRECISION:8},b={COINS:"fas fa-coins",CHEVRON_DOWN:"fas fa-chevron-down",PASTE:"fas fa-paste",BOOKMARK:"fas fa-bookmark"};class q{view(t){const{platform:e,className:s="",size:r="medium"}=t.attrs;if(!e)return g(b.COINS,{className:`crypto-icon default ${s}`});const i=h(e,"iconUrl"),f=h(e,"iconClass"),w=h(e,"name"),p=h(e,"symbol"),y=`platform-icon-${r}`;if(i)return m("img",{src:i,alt:w||"Platform",className:`platform-icon-image ${y} ${s}`,onerror:x=>{const F=x.target;F.style.display="none";const O=document.createElement("i"),U=f||b.COINS;O.className=`${U} crypto-icon ${s}`,F.parentElement?.appendChild(O)}});const D=f||b.COINS,I=p?.toLowerCase()||"default";return g(D,{className:`crypto-icon ${I} ${y} ${s}`})}}class ot extends A{oninit(t){super.oninit(t),this.state={showDropdown:!1}}view(){const{selectedPlatform:t}=this.attrs,{showDropdown:e}=this.state;return m("div",{className:"WithdrawalPage-platformSelector"},m("div",{className:"WithdrawalPage-label"},"提取平台"),m("div",{className:"WithdrawalPage-platformDropdown",onclick:()=>this.toggleDropdown()},m("div",{className:"WithdrawalPage-platformSelected"},m("div",{className:"WithdrawalPage-platformInfo"},m("div",{className:"WithdrawalPage-platformIcon"},m(q,{platform:t,size:"medium"})),m("div",{className:"WithdrawalPage-platformDetails"},m("div",{className:"WithdrawalPage-platformName"},this.getPlatformName(t))))),g(b.CHEVRON_DOWN,{className:"WithdrawalPage-dropdownIcon"})),e&&this.renderPlatformDropdown())}toggleDropdown(){this.state.showDropdown=!this.state.showDropdown}getPlatformName(t){return t&&(h(t,"displayName")||h(t,"name"))||"请选择平台"}renderPlatformDropdown(){const{platforms:t}=this.attrs,e=(t||[]).filter(s=>!!s);return e.length===0?m("div",{className:"WithdrawalPage-dropdownMenu"},m("div",{className:"WithdrawalPage-dropdownItem WithdrawalPage-noData"},a.translator.trans("withdrawal.forum.no_platforms"))):m("div",{className:"WithdrawalPage-dropdownMenu"},e.map(s=>m("div",{key:s.id(),className:"WithdrawalPage-dropdownItem",onclick:()=>this.selectPlatform(s)},m("div",{className:"WithdrawalPage-platformIcon"},m(q,{platform:s,size:"small"})),m("div",{className:"WithdrawalPage-platformName"},h(s,"displayName")||h(s,"name")))))}selectPlatform(t){const{onPlatformSelect:e,onAmountChange:s}=this.attrs;e(t),this.state.showDropdown=!1,s&&s()}}class nt extends A{view(){const{amount:t,selectedPlatform:e,loadingBalance:s,onAmountChange:r,onFillAllAmount:i}=this.attrs,f=this.getMinAmount(e),w=this.getMaxAmount(e),p=this.getFee(e);return m("div",{className:"WithdrawalPage-amountSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-label"},a.translator.trans("withdrawal.forum.form.amount")),m("div",{className:"WithdrawalPage-amountInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:"0.00000000",value:t,oninput:y=>r(y.target.value)}),m(P,{className:"WithdrawalPage-allButton",onclick:i,disabled:s},a.translator.trans("withdrawal.forum.form.all_button"))),m("div",{className:"WithdrawalPage-amountLimits"},m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},a.translator.trans("withdrawal.forum.limits.min_max")),m("span",{className:"WithdrawalPage-limitValue"},g(b.COINS)," ",f," ~ ",w)),m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},a.translator.trans("withdrawal.forum.limits.fee")),m("span",{className:"WithdrawalPage-limitValue"},g(b.COINS)," ",p)))))}getMinAmount(t){return t&&h(t,"minAmount")||R.MIN_AMOUNT}getMaxAmount(t){return t&&h(t,"maxAmount")||R.MAX_AMOUNT}getFee(t){return t&&h(t,"fee")||R.FEE}}class lt extends A{view(){const{accountDetails:t,selectedPlatform:e,saveAddress:s,onAccountDetailsChange:r,onSaveAddressToggle:i}=this.attrs,f=this.getSymbol(e);return l("div",{className:"WithdrawalPage-addressSection"},l("div",{className:"WithdrawalPage-formGroup"},l("div",{className:"WithdrawalPage-addressHeader"},l("span",{className:"WithdrawalPage-label"},a.translator.trans("withdrawal.forum.form.address",{symbol:f}),l("span",{className:"WithdrawalPage-required"},"*")),l("div",{className:"WithdrawalPage-saveAddress",onclick:()=>i(!s)},g(b.BOOKMARK),a.translator.trans("withdrawal.forum.form.save_address"))),l("div",{className:"WithdrawalPage-addressInput"},l("input",{type:"text",className:"WithdrawalPage-input",placeholder:a.translator.trans("withdrawal.forum.form.address_placeholder"),value:t,oninput:w=>r(w.target.value)}),l("button",{className:"WithdrawalPage-pasteButton",onclick:()=>this.pasteFromClipboard()},g(b.PASTE)))))}getSymbol(t){return t&&h(t,"symbol")||""}async pasteFromClipboard(){const{onAccountDetailsChange:t}=this.attrs;try{if(navigator.clipboard&&navigator.clipboard.readText){const e=await navigator.clipboard.readText();t(e.trim()),l.redraw()}}catch(e){console.error("Failed to read from clipboard:",e),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.forum.clipboard_error"))}}}class dt extends A{view(){const{message:t,onMessageChange:e}=this.attrs;return m("div",{className:"WithdrawalPage-messageSection"},m("div",{className:"WithdrawalPage-formGroup"},m("span",{className:"WithdrawalPage-label"},a.translator.trans("withdrawal.forum.form.message")),m("textarea",{className:"WithdrawalPage-textarea",placeholder:a.translator.trans("withdrawal.forum.form.message_placeholder"),value:t,rows:3,maxlength:500,oninput:s=>e(s.target.value)}),m("div",{className:"WithdrawalPage-helperText"},a.translator.trans("withdrawal.forum.form.message_helper")," (",t.length,"/500)")))}}class ct extends A{view(){const{amount:t,selectedPlatform:e,submitting:s,canSubmit:r,onSubmit:i}=this.attrs,f=parseFloat(t)||0,w=this.getFee(e),p=Math.max(0,f-w),y=this.getSymbol(e);return m("div",{className:"WithdrawalPage-submitSection"},m(P,{className:"WithdrawalPage-submitButton",loading:s,disabled:!r,onclick:i},a.translator.trans("withdrawal.forum.form.submit")),f>0&&m("div",{className:"WithdrawalPage-finalAmount"},a.translator.trans("withdrawal.forum.final_amount",{amount:p.toFixed(R.BALANCE_PRECISION),symbol:y})))}getFee(t){return t&&h(t,"fee")||R.FEE}getSymbol(t){return t&&h(t,"symbol")||""}}class mt extends A{view(){const{platforms:t,formData:e,loadingBalance:s,submitting:r,onFormDataChange:i,onFillAllAmount:f,onSubmit:w}=this.attrs;return[m(ot,{platforms:t,selectedPlatform:e.selectedPlatform,onPlatformSelect:p=>i({selectedPlatform:p}),onAmountChange:()=>i({amount:""})}),m(nt,{amount:e.amount,selectedPlatform:e.selectedPlatform,loadingBalance:s,onAmountChange:p=>i({amount:p}),onFillAllAmount:f}),m(lt,{accountDetails:e.accountDetails,selectedPlatform:e.selectedPlatform,saveAddress:e.saveAddress,onAccountDetailsChange:p=>i({accountDetails:p}),onSaveAddressToggle:p=>i({saveAddress:p})}),m(dt,{message:e.message,onMessageChange:p=>i({message:p})}),m(ct,{amount:e.amount,selectedPlatform:e.selectedPlatform,accountDetails:e.accountDetails,submitting:r,canSubmit:this.canSubmit(),onSubmit:w})]}canSubmit(){const{formData:t,submitting:e}=this.attrs,{selectedPlatform:s,amount:r,accountDetails:i}=t;return!!(s&&r&&i&&!e&&parseFloat(r)>0)}}class ut extends A{view(){const{status:t,className:e=""}=this.attrs,s=this.getStatusClass(t),r=this.getStatusLabel(t);return m("div",{className:`WithdrawalPage-historyStatus ${s} ${e}`},r)}getStatusClass(t){return G[t]||G.pending}getStatusLabel(t){return a.translator.trans(`withdrawal.forum.status.${t}`).toString()}}class ht extends A{view(){const{iconName:t,title:e,description:s,className:r=""}=this.attrs;return m("div",{className:`WithdrawalPage-emptyState ${r}`},m("div",{className:"WithdrawalPage-emptyIcon"},g(t)),m("h3",{className:"WithdrawalPage-emptyTitle"},e),m("p",{className:"WithdrawalPage-emptyDescription"},s))}}function ft(o){const{className:t=""}=o;return m("div",{className:`WithdrawalPage-loading ${t}`},m(j,null))}class K extends A{view(t){const{transactions:e,platforms:s,loading:r,type:i}=t.attrs;return r?m(ft,{className:`${i}History-loading`}):!e||e.length===0?m(ht,{iconName:i==="withdrawal"?"fas fa-history":"fas fa-inbox",title:a.translator.trans(`${i}.forum.history.empty.title`),description:a.translator.trans(`${i}.forum.history.empty.description`),className:`${i}History-empty`}):m("div",{className:`${i}History`},m("div",{className:`${i}History-header`},m("h3",null,a.translator.trans(`${i}.forum.history.title`)),m("span",{className:`${i}History-count`},e.length," ",a.translator.trans(`${i}.forum.history.transactions`))),m("div",{className:`${i}History-list`},e.map(f=>this.renderTransaction(f,s,i))))}renderTransaction(t,e,s){const r=this.getTransactionId(t),i=this.getPlatform(t,e),f=h(t,"amount")||0,w=h(t,"status")||"pending",p=h(t,"statusColor")||this.getStatusColor(w),y=_(t,"createdAt");return s==="deposit"?this.renderDepositRecord(t,i,f,w,p,y,r):this.renderWithdrawalTransaction(t,i,f,w,y,r)}renderWithdrawalTransaction(t,e,s,r,i,f){const w=h(t,"accountDetails")||"";return m("div",{key:f,className:"WithdrawalPage-historyItem"},m("div",{className:"WithdrawalPage-historyHeader"},m("div",{className:"WithdrawalPage-historyPlatform"},m("div",{className:"WithdrawalPage-platformIcon"},m(q,{platform:e,size:"small"})),m("div",{className:"WithdrawalPage-historyInfo"},m("div",{className:"WithdrawalPage-historyPlatformName"},this.getPlatformName(e)),m("div",{className:"WithdrawalPage-historyDate"},i.toLocaleDateString()," ",i.toLocaleTimeString()))),m(ut,{status:r})),m("div",{className:"WithdrawalPage-historyDetails"},m("div",{className:"WithdrawalPage-historyAmount"},m("span",{className:"WithdrawalPage-historyLabel"},a.translator.trans("withdrawal.forum.history.amount"),":"),m("span",{className:"WithdrawalPage-historyValue"},s," ",this.getPlatformSymbol(e))),m("div",{className:"WithdrawalPage-historyAddress"},m("span",{className:"WithdrawalPage-historyLabel"},a.translator.trans("withdrawal.forum.history.address"),":"),m("span",{className:"WithdrawalPage-historyValue"},w))))}renderDepositRecord(t,e,s,r,i,f,w){const p=h(t,"platformAccount"),y=h(t,"realName"),D=_(t,"depositTime"),I=h(t,"screenshotUrl"),x=h(t,"userMessage"),F=_(t,"processedAt"),O=h(t,"adminNotes"),U=h(t,"creditedAmount");return m("div",{key:w,className:"DepositRecord-item"},m("div",{className:"DepositRecord-itemHeader"},m("div",{className:"DepositRecord-itemPlatform"},e&&m("[",null,m("div",{className:"DepositRecord-itemIcon"},this.renderPlatformIcon(e)),m("div",{className:"DepositRecord-itemInfo"},m("span",{className:"DepositRecord-itemCurrency"},h(e,"symbol")," ",h(e,"network")&&`(${h(e,"network")})`),m("span",{className:"DepositRecord-itemType"},"Manual Deposit")))),m("div",{className:"DepositRecord-itemAmount"},m("span",{className:"DepositRecord-itemAmountValue"},"+",s," ",e?h(e,"symbol"):""),m("div",{className:`DepositRecord-itemStatus status-${i}`},this.getStatusIcon(r),this.getStatusText(r)))),m("div",{className:"DepositRecord-itemDetails"},m("div",{className:"DepositRecord-itemMeta"},m("span",{className:"DepositRecord-itemTime"},"Submitted: ",f?Y(f):"Unknown time"),D&&m("span",{className:"DepositRecord-itemDepositTime"},"Deposit Time: ",D.toLocaleDateString()," ",D.toLocaleTimeString())),m("div",{className:"DepositRecord-itemInfo"},m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Platform Account:"),m("span",{className:"DepositRecord-itemValue"},p)),y&&m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Real Name:"),m("span",{className:"DepositRecord-itemValue"},y)),x&&m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Message:"),m("span",{className:"DepositRecord-itemValue"},x)),I&&m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Screenshot:"),m("a",{href:I,target:"_blank",rel:"noopener noreferrer",className:"DepositRecord-itemLink"},"View Screenshot ",g("fas fa-external-link-alt")))),F&&m("div",{className:"DepositRecord-itemProcessed"},m("div",{className:"DepositRecord-itemProcessedTime"},"Processed: ",Y(F)),U&&U!==s&&m("div",{className:"DepositRecord-itemCredited"},"Credited Amount: ",U," ",e?h(e,"symbol"):""),O&&m("div",{className:"DepositRecord-itemNotes"},m("span",{className:"DepositRecord-itemLabel"},"Admin Notes:"),m("span",{className:"DepositRecord-itemValue"},O)))))}getTransactionId(t){return typeof t.id=="function"?`transaction-${t.id()}`:`transaction-${W(t)||Math.random()}`}getPlatform(t,e){const s=this.getPlatformId(t);return it(e,s)}getPlatformId(t){return h(t,"platformId")||t.relationships?.platform?.data?.id||""}getPlatformName(t){return t&&h(t,"name")||"Unknown Platform"}getPlatformSymbol(t){return t&&h(t,"symbol")||""}getStatusColor(t){switch(t){case"pending":return"warning";case"approved":case"confirmed":case"completed":return"success";case"rejected":case"failed":case"cancelled":return"danger";default:return"secondary"}}renderPlatformIcon(t){const e=h(t,"iconUrl"),s=h(t,"iconClass"),r=h(t,"symbol");if(e)return m("img",{src:e,alt:r,className:"DepositHistory-platformImg"});if(s)return g(s);switch(r){case"USDT":return m("span",{className:"DepositHistory-currencyIcon usdt"},"₮");case"USDC":return m("span",{className:"DepositHistory-currencyIcon usdc"},"$");case"BTC":return m("span",{className:"DepositHistory-currencyIcon btc"},"₿");case"ETH":return m("span",{className:"DepositHistory-currencyIcon eth"},"Ξ");default:return g("fas fa-coins")}}getStatusIcon(t){switch(t){case"pending":return g("fas fa-clock");case"approved":case"confirmed":return g("fas fa-check-circle");case"completed":return g("fas fa-check-double");case"rejected":case"failed":return g("fas fa-times-circle");case"cancelled":return g("fas fa-ban");default:return g("fas fa-question-circle")}}getStatusText(t){switch(t){case"pending":return"Pending";case"approved":return"Approved";case"confirmed":return"Confirmed";case"completed":return"Completed";case"rejected":return"Rejected";case"failed":return"Failed";case"cancelled":return"Cancelled";default:return"Unknown"}}formatHash(t){return t.length<=16?t:`${t.substring(0,8)}...${t.substring(t.length-8)}`}}class wt extends A{constructor(){super(...arguments),this.handleOutsideClick=t=>{const e=this.element;e&&!e.contains(t.target)&&(this.state.showDropdown=!1,l.redraw())}}oninit(t){super.oninit(t),this.state={showDropdown:!1}}view(){const{selectedPlatform:t}=this.attrs,{showDropdown:e}=this.state;return l("div",{className:"FundsPage-platformSelector"},l("div",{className:"FundsPage-label"},a.translator.trans("withdrawal.forum.deposit.platform_label")),l("div",{className:"FundsPage-platformDropdown",onclick:()=>this.toggleDropdown()},l("div",{className:"FundsPage-platformSelected"},l("div",{className:"FundsPage-platformInfo"},l("div",{className:"FundsPage-platformIcon"},this.renderPlatformIcon(t)),l("div",{className:"FundsPage-platformDetails"},l("div",{className:"FundsPage-platformName"},this.getPlatformDisplayName(t)),t&&this.renderPlatformSubtext(t)))),g(b.CHEVRON_DOWN,{className:"FundsPage-dropdownIcon"})),e&&this.renderPlatformDropdown())}oncreate(t){super.oncreate(t),document.addEventListener("click",this.handleOutsideClick)}onremove(t){super.onremove(t),document.removeEventListener("click",this.handleOutsideClick)}toggleDropdown(){this.state.showDropdown=!this.state.showDropdown}getPlatformDisplayName(t){if(!t)return a.translator.trans("withdrawal.forum.deposit.select_platform").toString();const e=h(t,"name")||"",s=h(t,"network");return s?`${e} (${s})`:e}renderPlatformIcon(t){if(!t)return g("fas fa-coins");const e=h(t,"iconUrl"),s=h(t,"symbol");return e?l("img",{src:e,alt:s,className:"FundsPage-platformIconImage"}):this.getCurrencyIcon(s)}getCurrencyIcon(t){switch(t?.toUpperCase()){case"USDT":return l("span",{className:"FundsPage-currencyIcon usdt"},"₮");case"USDC":return l("span",{className:"FundsPage-currencyIcon usdc"},"$");case"BTC":return l("span",{className:"FundsPage-currencyIcon btc"},"₿");case"ETH":return l("span",{className:"FundsPage-currencyIcon eth"},"Ξ");default:return g("fas fa-coins")}}renderPlatformSubtext(t){const e=h(t,"minAmount"),s=h(t,"fee"),r=h(t,"symbol"),i=[];return e&&e>0&&i.push(a.translator.trans("withdrawal.forum.deposit.min_amount_short",{amount:e,symbol:r}).toString()),s&&s>0&&i.push(a.translator.trans("withdrawal.forum.deposit.fee_short",{fee:s,symbol:r}).toString()),i.length>0?l("div",{className:"FundsPage-platformSubtext"},i.join(" • ")):null}renderPlatformDropdown(){const{platforms:t}=this.attrs,e=this.groupPlatformsByCurrency(t);return Object.keys(e).length===0?l("div",{className:"FundsPage-dropdownMenu"},l("div",{className:"FundsPage-dropdownItem FundsPage-noData"},a.translator.trans("withdrawal.forum.deposit.no_platforms"))):l("div",{className:"FundsPage-dropdownMenu"},Object.entries(e).flatMap(([s,r])=>[l("div",{key:`${s}-header`,className:"FundsPage-dropdownHeader"},l("div",{className:"FundsPage-currencyHeader"},l("div",{className:"FundsPage-currencyIcon"},this.getCurrencyIcon(s)),l("span",{className:"FundsPage-currencyName"},s))),...r.map(i=>l("div",{key:i.id(),className:"FundsPage-dropdownItem",onclick:()=>this.selectPlatform(i)},l("div",{className:"FundsPage-platformIcon"},this.renderPlatformIcon(i)),l("div",{className:"FundsPage-platformInfo"},l("div",{className:"FundsPage-platformName"},this.getPlatformDisplayName(i)),this.renderPlatformSubtext(i))))]))}groupPlatformsByCurrency(t){const e={};return(t||[]).filter(r=>r&&h(r,"isActive")).forEach(r=>{const i=h(r,"symbol");e[i]||(e[i]=[]),e[i].push(r)}),Object.keys(e).forEach(r=>{e[r].sort((i,f)=>{const w=h(i,"network")||"",p=h(f,"network")||"";return w.localeCompare(p)})}),e}selectPlatform(t){const{onPlatformSelect:e}=this.attrs;e(t),this.state.showDropdown=!1}}class pt extends A{view(t){const{address:e,loading:s,onCopy:r}=t.attrs;return m("div",{className:"AddressDisplay"},s?m("div",{className:"AddressDisplay-loading"},m("i",{className:"fas fa-spinner fa-spin"}),m("span",null,"Generating address...")):e?m("div",{className:"AddressDisplay-content"},m("div",{className:"AddressDisplay-address",title:e},e),m("div",{className:"AddressDisplay-actions"},m("button",{className:"AddressDisplay-copyBtn",onclick:r,title:"Copy address"},g("fas fa-copy")))):m("div",{className:"AddressDisplay-placeholder"},m("span",null,"No address available")))}}class gt extends A{view(t){const{platform:e,loading:s,size:r=160}=t.attrs;return m("div",{className:"ImageDisplay",style:{width:`${r}px`,height:`${r}px`}},s?m("div",{className:"ImageDisplay-loading"},m("i",{className:"fas fa-spinner fa-spin"})):e&&e.qrCodeImageUrl()?m("img",{src:e.qrCodeImageUrl(),alt:`${e.name()} Image`,className:"ImageDisplay-image",onerror:"this.style.display='none'; this.nextElementSibling.style.display='block';"}):m("div",{className:"ImageDisplay-placeholder"},m("i",{className:"fas fa-image"}),m("div",null,"No Image")),m("div",{className:"ImageDisplay-error",style:{display:"none"}},m("i",{className:"fas fa-exclamation-triangle"}),m("div",null,"Image Load Failed")))}}class yt extends A{oninit(t){super.oninit(t);const e=new Date,s=new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString().slice(0,16);this.state={platformAccount:N(""),realName:N(""),amount:N(""),depositTime:N(s),screenshotUrl:N(""),userMessage:N("")}}view(t){const{platform:e,submitting:s}=t.attrs,r=h(e,"minAmount")||0,i=h(e,"maxAmount"),f=h(e,"symbol")||"";return m("div",{className:"DepositRecordForm"},m("div",{className:"DepositRecordForm-header"},m("div",{className:"DepositRecordForm-title"},m("i",{className:"fas fa-plus-circle"}),a.translator.trans("withdrawal.forum.deposit.record.form_title")),m("div",{className:"DepositRecordForm-platformInfo"},a.translator.trans("withdrawal.forum.deposit.record.selected_platform",{platform:h(e,"name"),symbol:f}))),m("form",{onsubmit:this.handleSubmit.bind(this),className:"DepositRecordForm-form"},m("div",{className:"DepositRecordForm-field"},m("label",{className:"DepositRecordForm-label"},a.translator.trans("withdrawal.forum.deposit.record.platform_account"),m("span",{className:"DepositRecordForm-required"},"*")),m("input",{type:"text",className:"DepositRecordForm-input",placeholder:a.translator.trans("withdrawal.forum.deposit.record.platform_account_placeholder"),value:this.state.platformAccount(),oninput:E("value",this.state.platformAccount),required:!0,disabled:s}),m("div",{className:"DepositRecordForm-help"},a.translator.trans("withdrawal.forum.deposit.record.platform_account_help"))),m("div",{className:"DepositRecordForm-field"},m("label",{className:"DepositRecordForm-label"},a.translator.trans("withdrawal.forum.deposit.record.real_name"),m("span",{className:"DepositRecordForm-optional"},"(",a.translator.trans("withdrawal.forum.deposit.record.optional"),")")),m("input",{type:"text",className:"DepositRecordForm-input",placeholder:a.translator.trans("withdrawal.forum.deposit.record.real_name_placeholder"),value:this.state.realName(),oninput:E("value",this.state.realName),disabled:s})),m("div",{className:"DepositRecordForm-field"},m("label",{className:"DepositRecordForm-label"},a.translator.trans("withdrawal.forum.deposit.record.amount")," (",f,")",m("span",{className:"DepositRecordForm-required"},"*")),m("input",{type:"number",step:"0.01",min:r,max:i,className:"DepositRecordForm-input",placeholder:a.translator.trans("withdrawal.forum.deposit.record.amount_placeholder"),value:this.state.amount(),oninput:E("value",this.state.amount),required:!0,disabled:s}),m("div",{className:"DepositRecordForm-limits"},r>0&&m("span",{className:"DepositRecordForm-limit"},a.translator.trans("withdrawal.forum.deposit.record.min_amount",{amount:r,symbol:f})),i&&m("span",{className:"DepositRecordForm-limit"},a.translator.trans("withdrawal.forum.deposit.record.max_amount",{amount:i,symbol:f})))),m("div",{className:"DepositRecordForm-field"},m("label",{className:"DepositRecordForm-label"},a.translator.trans("withdrawal.forum.deposit.record.deposit_time"),m("span",{className:"DepositRecordForm-required"},"*")),m("input",{type:"datetime-local",className:"DepositRecordForm-input",value:this.state.depositTime(),oninput:E("value",this.state.depositTime),required:!0,disabled:s}),m("div",{className:"DepositRecordForm-help"},a.translator.trans("withdrawal.forum.deposit.record.deposit_time_help"))),m("div",{className:"DepositRecordForm-field"},m("label",{className:"DepositRecordForm-label"},a.translator.trans("withdrawal.forum.deposit.record.screenshot_url"),m("span",{className:"DepositRecordForm-optional"},"(",a.translator.trans("withdrawal.forum.deposit.record.optional"),")")),m("input",{type:"url",className:"DepositRecordForm-input",placeholder:a.translator.trans("withdrawal.forum.deposit.record.screenshot_url_placeholder"),value:this.state.screenshotUrl(),oninput:E("value",this.state.screenshotUrl),disabled:s}),m("div",{className:"DepositRecordForm-help"},a.translator.trans("withdrawal.forum.deposit.record.screenshot_url_help"))),m("div",{className:"DepositRecordForm-field"},m("label",{className:"DepositRecordForm-label"},a.translator.trans("withdrawal.forum.deposit.record.user_message"),m("span",{className:"DepositRecordForm-optional"},"(",a.translator.trans("withdrawal.forum.deposit.record.optional"),")")),m("textarea",{className:"DepositRecordForm-textarea",placeholder:a.translator.trans("withdrawal.forum.deposit.record.user_message_placeholder"),value:this.state.userMessage(),oninput:E("value",this.state.userMessage),rows:3,disabled:s})),m("div",{className:"DepositRecordForm-actions"},m(P,{type:"button",className:"Button Button--secondary DepositRecordForm-cancelButton",onclick:t.attrs.onCancel,disabled:s},a.translator.trans("withdrawal.forum.deposit.record.cancel")),m(P,{type:"submit",className:"Button Button--primary DepositRecordForm-submitButton",loading:s,disabled:s},a.translator.trans("withdrawal.forum.deposit.record.submit")))))}handleSubmit(t){t.preventDefault();const{platform:e,onSubmit:s}=this.attrs;if(!this.state.platformAccount()||!this.state.amount()||!this.state.depositTime()){a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.forum.deposit.record.validation.required_fields"));return}const r=parseFloat(this.state.amount());if(isNaN(r)||r<=0){a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.forum.deposit.record.validation.invalid_amount"));return}const i=h(e,"minAmount")||0,f=h(e,"maxAmount");if(r<i){a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.forum.deposit.record.validation.amount_too_low",{amount:r,min:i,symbol:h(e,"symbol")}));return}if(f&&r>f){a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.forum.deposit.record.validation.amount_too_high",{amount:r,max:f,symbol:h(e,"symbol")}));return}const w={platformId:parseInt(W(e)),platformAccount:this.state.platformAccount(),realName:this.state.realName()||void 0,amount:r,depositTime:new Date(this.state.depositTime()),screenshotUrl:this.state.screenshotUrl()||void 0,userMessage:this.state.userMessage()||void 0};s(w)}}const kt="modulepreload",Lt=function(o){return"/"+o},Vt={},J=function(t,e,s){let r=Promise.resolve();function i(f){const w=new Event("vite:preloadError",{cancelable:!0});if(w.payload=f,window.dispatchEvent(w),!w.defaultPrevented)throw f}return r.then(f=>{for(const w of f||[])w.status==="rejected"&&i(w.reason);return t().catch(i)})};var d=(o=>(o.NETWORK_ERROR="network_error",o.PERMISSION_DENIED="permission_denied",o.VALIDATION_ERROR="validation_error",o.NOT_FOUND="not_found",o.SERVER_ERROR="server_error",o.TIMEOUT="timeout",o))(d||{});class n extends Error{constructor(t,e="server_error",s,r){super(t),this.name="ServiceError",this.type=e,this.code=s,this.details=r}}class At{constructor(){this.modelType="withdrawal-requests",this.platformModelType="withdrawal-platforms"}async find(t={}){try{const e={include:t.include||"user,platform",sort:t.sort||"-createdAt",...t};t.page&&(e.page=t.page),t.filter&&(e.filter=t.filter);const s=await u.store.find(this.modelType,e);return Array.isArray(s)?s:[s]}catch(e){throw this.handleError(e,"Failed to fetch withdrawal requests")}}async findById(t,e={}){try{const s={include:e.include||"user,platform"};return await u.store.find(this.modelType,t,s)}catch(s){if(this.isNotFoundError(s))return null;throw this.handleError(s,`Failed to fetch withdrawal request ${t}`)}}async create(t){try{return this.validateCreateAttributes(t),await u.store.createRecord(this.modelType).save(t)}catch(e){throw this.handleError(e,"Failed to create withdrawal request")}}async update(t,e){try{if(!this.canModify(t))throw new n("You do not have permission to modify this withdrawal request",d.PERMISSION_DENIED);return await t.save(e)}catch(s){throw this.handleError(s,"Failed to update withdrawal request")}}async delete(t){try{if(!this.canDelete(t))throw new n("You do not have permission to delete this withdrawal request",d.PERMISSION_DENIED);await t.delete()}catch(e){throw this.handleError(e,"Failed to delete withdrawal request")}}async submitRequest(t){try{await this.validateWithdrawalRequest(t);const e={platformId:t.platformId,amount:t.amount,accountDetails:t.accountDetails,message:t.message||"",status:"pending"};return await this.create(e)}catch(e){throw this.handleError(e,"Failed to submit withdrawal request")}}async getUserHistory(t,e={}){const s=t||u.session.user?.id();if(!s)throw new n("User not authenticated",d.PERMISSION_DENIED);const r={...e,filter:{user:s,...e.filter},include:e.include||"platform",sort:e.sort||"-createdAt"};return await this.find(r)}async getPendingRequests(t={}){if(!u.session.user?.isAdmin())throw new n("Admin permissions required",d.PERMISSION_DENIED);const e={...t,filter:{status:"pending",...t.filter},include:t.include||"user,platform",sort:t.sort||"createdAt"};return await this.find(e)}async approve(t,e){if(!u.session.user?.isAdmin())throw new n("Admin permissions required",d.PERMISSION_DENIED);if(!t.isPending())throw new n("Only pending requests can be approved",d.VALIDATION_ERROR);const s={status:"approved"};return e&&(s.adminNote=e),await this.update(t,s)}async reject(t,e){if(!u.session.user?.isAdmin())throw new n("Admin permissions required",d.PERMISSION_DENIED);if(!t.isPending())throw new n("Only pending requests can be rejected",d.VALIDATION_ERROR);const s={status:"rejected"};return e&&(s.adminNote=e),await this.update(t,s)}async cancel(t){if(!t.canBeModified())throw new n("This request cannot be cancelled",d.VALIDATION_ERROR);const e=u.session.user;if(!e||t.userId()!==e.id()&&!e.isAdmin())throw new n("You can only cancel your own requests",d.PERMISSION_DENIED);return await this.delete(t)}canModify(t){const e=u.session.user;return e?e.isAdmin()?!0:t.userId()===e.id()&&t.canBeModified():!1}canCreate(){const t=u.session.user;return t&&!t.isGuest()}canDelete(t){const e=u.session.user;return e?e.isAdmin()?!0:t.userId()===e.id()&&t.canBeModified():!1}async getPlatforms(){try{const t=await u.store.find(this.platformModelType,{filter:{isActive:!0},sort:"name"});return Array.isArray(t)?t:[t]}catch(t){throw this.handleError(t,"Failed to fetch withdrawal platforms")}}async validateWithdrawalRequest(t){const{platformId:e,amount:s}=t,r=await u.store.find(this.platformModelType,e);if(!r)throw new n("Invalid platform selected",d.VALIDATION_ERROR);if(!r.isActive())throw new n("Selected platform is not available",d.VALIDATION_ERROR);const i=r.minAmount(),f=r.maxAmount();if(s<i)throw new n(`Minimum withdrawal amount is ${i}`,d.VALIDATION_ERROR);if(f&&s>f)throw new n(`Maximum withdrawal amount is ${f}`,d.VALIDATION_ERROR);const w=u.session.user;if(w){const p=w.money?w.money():0,y=r.fee?r.fee():0,D=s+y;if(p<D)throw new n(`Insufficient balance. Required: ${D}, Available: ${p}`,d.VALIDATION_ERROR)}}validateCreateAttributes(t){const e=["platformId","amount","accountDetails"];for(const s of e)if(!t[s])throw new n(`${s} is required`,d.VALIDATION_ERROR);if(typeof t.amount!="number"||t.amount<=0)throw new n("Amount must be a positive number",d.VALIDATION_ERROR)}handleError(t,e){if(t instanceof n)return t;if(t.response&&t.response.errors){const s=t.response.errors[0];return new n(s.detail||e,d.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new n("Network error occurred",d.NETWORK_ERROR):new n(t.message||e,d.SERVER_ERROR)}isNotFoundError(t){return t.status===404||t.response?.status===404||t.message?.includes("not found")}}const k=new At;class Nt{constructor(){this.recordModelType="deposit-records",this.platformModelType="deposit-platforms",this.addressModelType="deposit-addresses"}async find(t={}){try{const e={include:t.include||"user,platform",sort:t.sort||"-createdAt",...t};t.page&&(e.page=t.page),t.filter&&(e.filter=t.filter);const s=await u.store.find(this.recordModelType,e);return Array.isArray(s)?s:[s]}catch(e){throw this.handleError(e,"Failed to fetch deposit records")}}async findById(t,e={}){try{const s={include:e.include||"user,platform"};return await u.store.find(this.recordModelType,String(t),s)}catch(s){if(this.isNotFoundError(s))return null;throw this.handleError(s,`Failed to fetch deposit record ${t}`)}}async create(t){try{return this.validateCreateAttributes(t),await u.store.createRecord(this.recordModelType).save(t)}catch(e){throw this.handleError(e,"Failed to create deposit record")}}async update(t,e){try{if(!this.canModify(t))throw new n("You do not have permission to modify this deposit record",d.PERMISSION_DENIED);return await t.save(e)}catch(s){throw this.handleError(s,"Failed to update deposit record")}}async delete(t){try{if(!this.canDelete(t))throw new n("You do not have permission to delete this deposit record",d.PERMISSION_DENIED);await t.delete()}catch(e){throw this.handleError(e,"Failed to delete deposit record")}}async generateAddress(t){try{const{addressService:e}=await J(async()=>{const{addressService:s}=await Promise.resolve().then(()=>Z);return{addressService:s}},void 0);return await e.generateAddress(t)}catch(e){throw this.handleError(e,"Failed to generate deposit address")}}async getUserHistory(t,e={}){const s=t||u.session.user?.id();if(!s)throw new n("User not authenticated",d.PERMISSION_DENIED);const r={...e,filter:{user:s,...e.filter},include:e.include||"platform",sort:e.sort||"-createdAt"};return await this.find(r)}async createRecord(t){try{await this.validateDepositRecord(t);const e={platformId:t.platformId,amount:t.amount,transactionHash:t.transactionHash,note:t.note||"",status:"pending"};return await this.create(e)}catch(e){throw this.handleError(e,"Failed to create deposit record")}}async getPendingDeposits(t={}){if(!u.session.user?.isAdmin())throw new n("Admin permissions required",d.PERMISSION_DENIED);const e={...t,filter:{status:"pending",...t.filter},include:t.include||"user,platform",sort:t.sort||"createdAt"};return await this.find(e)}async confirm(t,e){if(!u.session.user?.isAdmin())throw new n("Admin permissions required",d.PERMISSION_DENIED);const s={status:"confirmed"};return e&&e!==t.amount()&&(s.confirmedAmount=e),await this.update(t,s)}async reject(t,e){if(!u.session.user?.isAdmin())throw new n("Admin permissions required",d.PERMISSION_DENIED);const s={status:"rejected"};return e&&(s.adminNote=e),await this.update(t,s)}canModify(t){const e=u.session.user;return e?e.isAdmin()?!0:String(t.userId())===String(e.id())&&t.status()==="pending":!1}canCreate(){const t=u.session.user;return t?!t.isGuest():!1}canDelete(t){const e=u.session.user;return e?e.isAdmin()?!0:String(t.userId())===String(e.id())&&t.status()==="pending":!1}async getPlatforms(){try{const t=await u.store.find(this.platformModelType,{sort:"name"});return Array.isArray(t)?t:[t]}catch(t){throw this.handleError(t,"Failed to fetch deposit platforms")}}async getPlatformsBySymbol(){const t=await this.getPlatforms(),e={};for(const s of t){const r=s.symbol();e[r]||(e[r]=[]),e[r].push(s)}return e}async getUserAddresses(t){try{const{addressService:e}=await J(async()=>{const{addressService:s}=await Promise.resolve().then(()=>Z);return{addressService:s}},void 0);return await e.getUserAddresses(t)}catch(e){throw this.handleError(e,"Failed to fetch user deposit addresses")}}async validateDepositRecord(t){const{platformId:e,amount:s,transactionHash:r}=t,i=await u.store.find(this.platformModelType,e);if(!i)throw new n("Invalid platform selected",d.VALIDATION_ERROR);if(!i.isActive())throw new n("Selected platform is not available",d.VALIDATION_ERROR);const f=i.minAmount();if(s<f)throw new n(`Minimum deposit amount is ${f}`,d.VALIDATION_ERROR);if(!r||r.length<10)throw new n("Invalid transaction hash",d.VALIDATION_ERROR);try{if((await this.find({filter:{transactionHash:r}})).length>0)throw new n("Transaction hash already exists",d.VALIDATION_ERROR)}catch(w){if(w instanceof n&&w.type===d.VALIDATION_ERROR)throw w}}validateCreateAttributes(t){const e=["platformId","amount","transactionHash"];for(const s of e)if(!t[s])throw new n(`${s} is required`,d.VALIDATION_ERROR);if(typeof t.amount!="number"||t.amount<=0)throw new n("Amount must be a positive number",d.VALIDATION_ERROR)}handleError(t,e){if(t instanceof n)return t;if(t.response&&t.response.errors){const s=t.response.errors[0];return new n(s.detail||e,d.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new n("Network error occurred",d.NETWORK_ERROR):new n(t.message||e,d.SERVER_ERROR)}isNotFoundError(t){return t.status===404||t.response?.status===404||t.message?.includes("not found")}}const C=new Nt;class vt{constructor(){this.withdrawalModelType="withdrawal-platforms",this.depositModelType="deposit-platforms"}async find(t,e={}){const s=t==="withdrawal"?this.withdrawalModelType:this.depositModelType;try{const r={sort:e.sort||"name",...e};e.page&&(r.page=e.page),e.filter&&(r.filter=e.filter),e.include&&(r.include=e.include);const i=await u.store.find(s,r);return Array.isArray(i)?i:[i]}catch(r){throw this.handleError(r,`Failed to fetch ${t} platforms`)}}async findById(t,e,s={}){const r=t==="withdrawal"?this.withdrawalModelType:this.depositModelType;try{const i={};return s.include&&(i.include=s.include),await u.store.find(r,e,i)}catch(i){if(this.isNotFoundError(i))return null;throw this.handleError(i,`Failed to fetch ${t} platform ${e}`)}}async create(t,e){const s=t==="withdrawal"?this.withdrawalModelType:this.depositModelType;try{return this.validateCreateAttributes(t,e),await u.store.createRecord(s).save(e)}catch(r){throw this.handleError(r,`Failed to create ${t} platform`)}}async update(t,e){try{if(!this.canModify(t))throw new n("You do not have permission to modify this platform",d.PERMISSION_DENIED);return await t.save(e)}catch(s){throw this.handleError(s,"Failed to update platform")}}async delete(t){try{if(!this.canDelete(t))throw new n("You do not have permission to delete this platform",d.PERMISSION_DENIED);await t.delete()}catch(e){throw this.handleError(e,"Failed to delete platform")}}async getActive(t,e={}){const s={...e,filter:{isActive:!0,...e.filter}};return await this.find(t,s)}async toggleStatus(t){if(!u.session.user?.isAdmin())throw new n("Admin permissions required",d.PERMISSION_DENIED);const e=t.isActive();return await this.update(t,{isActive:!e})}async updateConfig(t,e){if(!u.session.user?.isAdmin())throw new n("Admin permissions required",d.PERMISSION_DENIED);return await this.update(t,e)}async getBySymbol(t,e){return await this.find(e,{filter:{symbol:t},sort:"name"})}validateAmount(t,e){const s=[];if(typeof e!="number"||e<=0)return s.push("Amount must be a positive number"),{valid:!1,errors:s};const r=t.minAmount?t.minAmount():0,i=t.maxAmount?t.maxAmount():null;return e<r&&s.push(`Amount must be at least ${r}`),i&&e>i&&s.push(`Amount cannot exceed ${i}`),{valid:s.length===0,errors:s}}async getPlatformStats(t,e){if(!u.session.user?.isAdmin())throw new n("Admin permissions required",d.PERMISSION_DENIED);const s=t==="withdrawal"?"withdrawal-requests":"deposit-records";try{const r=await u.store.find(s,{filter:{platform:e},include:"platform"}),i=Array.isArray(r)?r:[r];return{total:i.length,pending:i.filter(w=>w.status()==="pending").length,approved:i.filter(w=>w.status()==="approved"||w.status()==="confirmed").length,rejected:i.filter(w=>w.status()==="rejected").length,totalAmount:i.reduce((w,p)=>w+(p.amount()||0),0)}}catch(r){throw this.handleError(r,"Failed to fetch platform statistics")}}async getPlatformsBySymbolGrouped(t){const e=await this.getActive(t),s={};for(const r of e){const i=r.symbol();s[i]||(s[i]=[]),s[i].push(r)}return s}async getSortedPlatforms(t,e="name",s="asc"){const r=s==="desc"?`-${e}`:e;return await this.getActive(t,{sort:r})}canModify(t){const e=u.session.user;return e&&e.isAdmin()}canCreate(){const t=u.session.user;return t&&t.isAdmin()}canDelete(t){const e=u.session.user;return e&&e.isAdmin()}validateCreateAttributes(t,e){const s=["name","symbol","minAmount"],r=t==="withdrawal"?[...s,"address"]:[...s,"address"];for(const i of r)if(!e[i])throw new n(`${i} is required for ${t} platforms`,d.VALIDATION_ERROR);if(typeof e.minAmount!="number"||e.minAmount<0)throw new n("minAmount must be a non-negative number",d.VALIDATION_ERROR);if(e.maxAmount!==void 0&&(typeof e.maxAmount!="number"||e.maxAmount<e.minAmount))throw new n("maxAmount must be a number greater than or equal to minAmount",d.VALIDATION_ERROR);if(e.fee!==void 0&&(typeof e.fee!="number"||e.fee<0))throw new n("fee must be a non-negative number",d.VALIDATION_ERROR);if(typeof e.symbol!="string"||!e.symbol.trim())throw new n("Symbol is required",d.VALIDATION_ERROR)}handleError(t,e){if(t instanceof n)return t;if(t.response&&t.response.errors){const s=t.response.errors[0];return new n(s.detail||e,d.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new n("Network error occurred",d.NETWORK_ERROR):new n(t.message||e,d.SERVER_ERROR)}isNotFoundError(t){return t.status===404||t.response?.status===404||t.message?.includes("not found")}}const X=new vt;class Dt{constructor(){this.addressModelType="deposit-addresses",this.platformModelType="deposit-platforms"}async generateAddress(t,e){try{const s=e||u.session.user?.id();if(!s)throw new n("User not authenticated",d.PERMISSION_DENIED);const r=await u.store.find(this.platformModelType,t);if(!r)throw new n("Invalid platform selected",d.VALIDATION_ERROR);if(!r.isActive())throw new n("Platform is not currently active",d.VALIDATION_ERROR);const f=(await this.getUserAddresses(s)).find(w=>w.platform().id()===t&&w.isActive());return f?(await this.updateLastUsed(f),f.fullAddress()||f.address()):await this.createNewAddress(r,s)}catch(s){throw this.handleError(s,"Failed to generate deposit address")}}async getUserAddresses(t,e={}){try{const s=t||u.session.user?.id();if(!s)throw new n("User not authenticated",d.PERMISSION_DENIED);const r={...e,filter:{user:s,...e.filter},include:e.include||"platform",sort:e.sort||"-createdAt"},i=await u.store.find(this.addressModelType,r);return Array.isArray(i)?i:[i]}catch(s){throw this.handleError(s,"Failed to get user addresses")}}async getAddressForPlatform(t,e){try{const s=await this.getUserAddresses(e,{filter:{platform:t,isActive:!0}});return s.length>0?s[0]:null}catch(s){if(this.isNotFoundError(s))return null;throw this.handleError(s,`Failed to get address for platform ${t}`)}}async refreshAddress(t,e){try{const s=e||u.session.user?.id();if(!s)throw new n("User not authenticated",d.PERMISSION_DENIED);const r=await this.getAddressForPlatform(t,s);return r&&await this.deactivateAddress(parseInt(r.id())),await this.generateAddress(t,s)}catch(s){throw this.handleError(s,"Failed to refresh deposit address")}}async deactivateAddress(t){try{const e=await u.store.find(this.addressModelType,t);if(!e)throw new n("Address not found",d.VALIDATION_ERROR);if(!this.canViewAddress(e))throw new n("You do not have permission to deactivate this address",d.PERMISSION_DENIED);await e.save({isActive:!1})}catch(e){throw this.handleError(e,"Failed to deactivate address")}}canGenerateAddress(){const t=u.session.user;return t&&!t.isGuest()}canViewAddress(t){const e=u.session.user;return e?e.isAdmin()?!0:t.user()?.id()===e.id():!1}async createNewAddress(t,e){try{const s=t.generateDepositAddress(e),r=u.store.createRecord(this.addressModelType),i={userId:e,platformId:t.id(),address:s,fullAddress:s,isActive:!0,lastUsedAt:new Date};return(await r.save(i)).fullAddress()||s}catch(s){throw this.handleError(s,"Failed to create new address")}}async updateLastUsed(t){try{await t.save({lastUsedAt:new Date})}catch(e){console.warn("Failed to update address last used timestamp:",e)}}async getAddressesWithPlatforms(t){try{return(await this.getUserAddresses(t,{include:"platform",filter:{isActive:!0}})).map(s=>({address:s,platform:s.platform()})).filter(s=>s.platform)}catch(e){throw this.handleError(e,"Failed to get addresses with platform information")}}async getActiveAddressCount(t){try{return(await this.getUserAddresses(t,{filter:{isActive:!0}})).length}catch(e){throw this.handleError(e,"Failed to get active address count")}}validateAddressFormat(t,e){const s=[];if(!t||typeof t!="string")return s.push("Address must be a valid string"),{valid:!1,errors:s};const r=e.symbol()?.toLowerCase();return r==="btc"&&!t.match(/^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$/)?s.push("Invalid Bitcoin address format"):r==="eth"&&!t.match(/^0x[a-fA-F0-9]{40}$/)&&s.push("Invalid Ethereum address format"),{valid:s.length===0,errors:s}}handleError(t,e){if(t instanceof n)return t;if(t.response&&t.response.errors){const s=t.response.errors[0];return new n(s.detail||e,d.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new n("Network error occurred",d.NETWORK_ERROR):new n(t.message||e,d.SERVER_ERROR)}isNotFoundError(t){return t.status===404||t.response?.status===404||t.message?.includes("not found")}}const Rt=new Dt,Z=Object.freeze(Object.defineProperty({__proto__:null,addressService:Rt},Symbol.toStringTag,{value:"Module"}));function Q(o,t="An error occurred"){if(!o)return t;if(o.response&&o.response.errors&&Array.isArray(o.response.errors)){const e=o.response.errors[0];if(e&&e.detail)return e.detail}if(o.responseText){if(o.responseText.includes("<b>Fatal error</b>")||o.responseText.includes("<!DOCTYPE"))return"Server error occurred. Please try again later.";try{const e=JSON.parse(o.responseText);if(e.errors&&Array.isArray(e.errors))return e.errors[0].detail||t}catch{return"Server error occurred. Please try again later."}}return t}class L extends at{constructor(){super(...arguments),this.state={withdrawalPlatforms:[],withdrawalRequests:[],userBalance:0,loadingBalance:!0,submitting:!1,depositPlatforms:[],depositRecords:[],showDepositRecordForm:!1,submittingDepositRecord:!1,loading:!0,activeTab:N("withdrawal")},this.withdrawalFormData={amount:N(""),selectedPlatform:N(null),accountDetails:N(""),message:N(""),saveAddress:N(!1)},this.depositFormData={selectedPlatform:N(null),userMessage:N("")},this.depositAddressData={address:"",platform:null,loading:!1},this.availablePlatforms=[]}oninit(t){super.oninit(t);const s=new URLSearchParams(window.location.search).get("tab"),r=this.getTabFromPath();r?this.state.activeTab(r):s&&this.isValidTab(s)&&this.state.activeTab(s),this.updatePageTitle(),this.loadAllData()}getTabFromPath(){const t=window.location.pathname;return t.includes("/funds/withdrawal")?"withdrawal":t.includes("/funds/deposit")?"deposit":t.includes("/funds/withdrawal-history")?"withdrawal-history":t.includes("/funds/deposit-history")?"deposit-history":null}isValidTab(t){return["withdrawal","deposit","withdrawal-history","deposit-history"].includes(t)}updatePageTitle(){const t=this.state.activeTab();let e="withdrawal.forum.page.title";switch(t){case"withdrawal":case"withdrawal-history":e="withdrawal.forum.page.title";break;case"deposit":case"deposit-history":e="withdrawal.forum.deposit.page.title";break}const s=a.translator.trans(e);a.setTitle(typeof s=="string"?s:s.toString())}view(){return this.state.loading?l("div",{className:"FundsPage"},l("div",{className:"FundsPage-loading"},l(j,null))):l("div",{className:"FundsPage"},l("div",{className:"FundsPage-modal"},this.renderHeader(),l("div",{className:"FundsPage-content"},this.renderActiveTab())))}renderHeader(){const t=this.state.activeTab();return l("div",{className:"FundsPage-header"},l("div",{className:"FundsPage-tabs"},l("div",{className:`FundsPage-tab ${t==="withdrawal"?"active":""}`,onclick:()=>this.handleTabChange("withdrawal")},a.translator.trans("withdrawal.forum.tabs.withdrawal")),l("div",{className:`FundsPage-tab ${t==="deposit"?"active":""}`,onclick:()=>this.handleTabChange("deposit")},a.translator.trans("withdrawal.forum.deposit.tabs.deposit")),l("div",{className:`FundsPage-tab ${t==="withdrawal-history"?"active":""}`,onclick:()=>this.handleTabChange("withdrawal-history")},a.translator.trans("withdrawal.forum.tabs.history")),l("div",{className:`FundsPage-tab ${t==="deposit-history"?"active":""}`,onclick:()=>this.handleTabChange("deposit-history")},a.translator.trans("withdrawal.forum.deposit.tabs.history"))),l(P,{className:"FundsPage-close",icon:"fas fa-times",onclick:()=>a.history.back()}))}renderActiveTab(){switch(this.state.activeTab()){case"withdrawal":return this.renderWithdrawalTab();case"deposit":return this.renderDepositTab();case"withdrawal-history":return this.renderWithdrawalHistoryTab();case"deposit-history":return this.renderDepositHistoryTab();default:return this.renderWithdrawalTab()}}renderWithdrawalTab(){return(this.state.withdrawalPlatforms||[]).filter(e=>!!e).length===0?l("div",{className:"FundsPage-withdrawalTab"},l("div",{className:"WithdrawalPage-emptyState"},l("div",{className:"WithdrawalPage-emptyIcon"},g("fas fa-coins")),l("h3",{className:"WithdrawalPage-emptyTitle"},a.translator.trans("withdrawal.forum.no_platforms")),l("p",{className:"WithdrawalPage-emptyDescription"},a.translator.trans("withdrawal.forum.no_platforms_description")))):l("div",{className:"FundsPage-withdrawalTab"},l(mt,{platforms:this.state.withdrawalPlatforms,formData:this.getWithdrawalFormDataForComponent(),loadingBalance:this.state.loadingBalance,submitting:this.state.submitting,onFormDataChange:this.handleWithdrawalFormDataChange.bind(this),onFillAllAmount:this.handleFillAllAmount.bind(this),onSubmit:this.handleWithdrawalSubmit.bind(this)}))}renderDepositTab(){return(this.state.depositPlatforms||[]).filter(e=>e&&h(e,"isActive")).length===0?l("div",{className:"FundsPage-emptyState"},l("div",{className:"FundsPage-emptyIcon"},g("fas fa-coins")),l("h3",{className:"FundsPage-emptyTitle"},a.translator.trans("withdrawal.forum.deposit.no_platforms")),l("p",{className:"FundsPage-emptyDescription"},a.translator.trans("withdrawal.forum.deposit.no_platforms_description"))):l("div",{className:"FundsPage-depositTab"},this.renderDepositSelectors(),this.renderDepositInfo())}renderDepositSelectors(){return l("div",{className:"FundsPage-selectors"},l(wt,{platforms:this.availablePlatforms,selectedPlatform:this.depositFormData.selectedPlatform(),onPlatformSelect:t=>this.handlePlatformSelect(t)}))}renderDepositInfo(){const t=this.depositFormData.selectedPlatform();if(!t)return l("div",{className:"FundsPage-selectPrompt"},l("p",null,a.translator.trans("withdrawal.forum.deposit.select_platform")));const e=h(t,"minAmount")||0,s=h(t,"warningText")||a.translator.trans("withdrawal.forum.deposit.default_warning",{currency:h(t,"symbol"),network:h(t,"network"),minAmount:e});return l("div",{className:"FundsPage-depositInfo"},l("p",{className:"FundsPage-instructionText"},a.translator.trans("withdrawal.forum.deposit.scan_or_use_address")),l(pt,{address:this.depositAddressData.address,loading:this.depositAddressData.loading,onCopy:this.handleCopyAddress.bind(this)}),l("p",{className:"FundsPage-minAmountText"},a.translator.trans("withdrawal.forum.deposit.min_amount",{amount:e,currency:h(t,"symbol")})),(()=>{const r=h(t,"fee")||0;return r>0?l("p",{className:"FundsPage-feeText"},a.translator.trans("withdrawal.forum.deposit.fee",{fee:r,currency:h(t,"symbol")})):null})(),this.depositAddressData.platform&&this.depositAddressData.platform.qrCodeImageUrl&&this.depositAddressData.platform.qrCodeImageUrl()&&l("div",{className:"FundsPage-imageContainer"},l(gt,{platform:this.depositAddressData.platform,loading:this.depositAddressData.loading,size:160})),l("div",{className:"FundsPage-infoPanel"},l("i",{className:"fas fa-info-circle"}),l("span",null,s)),l("div",{className:"FundsPage-recordSection"},l("div",{className:"FundsPage-recordHeader"},l("h4",null,a.translator.trans("withdrawal.forum.deposit.record.section_title")),l(P,{className:"Button Button--primary FundsPage-recordButton",onclick:this.handleToggleDepositRecordForm.bind(this),disabled:this.state.submittingDepositRecord},this.state.showDepositRecordForm?a.translator.trans("withdrawal.forum.deposit.record.hide_form"):a.translator.trans("withdrawal.forum.deposit.record.show_form"))),this.state.showDepositRecordForm&&l(yt,{platform:t,onSubmit:this.handleDepositRecordSubmit.bind(this),onCancel:this.handleCancelDepositRecordForm.bind(this),submitting:this.state.submittingDepositRecord})))}renderWithdrawalHistoryTab(){return l("div",{className:"FundsPage-withdrawalTab"},l(K,{transactions:this.state.withdrawalRequests,platforms:this.state.withdrawalPlatforms,loading:!1,type:"withdrawal"}))}renderDepositHistoryTab(){const t=[...this.state.depositRecords];return t.sort((e,s)=>{const r=_(e,"createdAt")||new Date(0);return(_(s,"createdAt")||new Date(0)).getTime()-r.getTime()}),l(K,{transactions:t,platforms:this.state.depositPlatforms,loading:!1,type:"deposit"})}handleTabChange(t){this.state.activeTab(t),this.updatePageTitle();const e=new URL(window.location.href);e.searchParams.set("tab",t),window.history.replaceState({},"",e.toString())}getWithdrawalFormDataForComponent(){return{selectedPlatform:this.withdrawalFormData.selectedPlatform(),amount:this.withdrawalFormData.amount(),accountDetails:this.withdrawalFormData.accountDetails(),message:this.withdrawalFormData.message(),saveAddress:this.withdrawalFormData.saveAddress()}}handleWithdrawalFormDataChange(t){t.selectedPlatform!==void 0&&this.withdrawalFormData.selectedPlatform(t.selectedPlatform),t.amount!==void 0&&this.withdrawalFormData.amount(t.amount),t.accountDetails!==void 0&&this.withdrawalFormData.accountDetails(t.accountDetails),t.message!==void 0&&this.withdrawalFormData.message(t.message),t.saveAddress!==void 0&&this.withdrawalFormData.saveAddress(t.saveAddress)}async handleFillAllAmount(){const t=this.withdrawalFormData.selectedPlatform();if(t&&!this.state.loadingBalance)try{await this.loadUserBalance(!0);const e=h(t,"fee")||0,s=h(t,"maxAmount")||1/0;let r=this.state.userBalance-e;s<1/0&&r>s&&(r=s),r>0?this.withdrawalFormData.amount(r.toString()):a.alerts.show({type:"warning",dismissible:!0},a.translator.trans("withdrawal.forum.insufficient_balance"))}catch(e){console.error("Error refreshing balance:",e),a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.forum.balance_refresh_error"))}}async handleWithdrawalSubmit(){if(this.state.submitting)return;const t=this.withdrawalFormData.selectedPlatform(),e=this.withdrawalFormData.amount(),s=this.withdrawalFormData.accountDetails();if(!t||!e||!s)return;const r=parseFloat(e);if(isNaN(r)||r<=0){a.alerts.show({type:"warning",dismissible:!0},a.translator.trans("withdrawal.forum.invalid_amount"));return}this.state.submitting=!0;try{await k.submitRequest({platformId:parseInt(W(t),10),amount:r,accountDetails:s,message:this.withdrawalFormData.message()}),this.withdrawalFormData.amount(""),this.withdrawalFormData.accountDetails(""),this.withdrawalFormData.message(""),this.withdrawalFormData.saveAddress()||this.withdrawalFormData.selectedPlatform(null),await Promise.all([this.loadUserBalance(!0),this.loadWithdrawalRequests()]),a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.forum.submit_success"))}catch(i){console.error("Withdrawal request failed:",i);let f=a.translator.trans("withdrawal.forum.error").toString();i instanceof n?f=i.message:f=Q(i,f),a.alerts.show({type:"error",dismissible:!0},f)}finally{this.state.submitting=!1}}handlePlatformSelect(t){this.depositFormData.selectedPlatform(t),this.loadDepositAddress(t)}handleCopyAddress(){this.depositAddressData.address&&navigator.clipboard.writeText(this.depositAddressData.address).then(()=>{a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.forum.deposit.address_copied"))}).catch(()=>{a.alerts.show({type:"error",dismissible:!0},a.translator.trans("withdrawal.forum.deposit.copy_failed"))})}handleToggleDepositRecordForm(){this.state.showDepositRecordForm=!this.state.showDepositRecordForm,l.redraw()}handleCancelDepositRecordForm(){this.state.showDepositRecordForm=!1,l.redraw()}async handleDepositRecordSubmit(t){if(!this.state.submittingDepositRecord){this.state.submittingDepositRecord=!0,l.redraw();try{await C.create({platformId:t.platformId,platformAccount:t.platformAccount,realName:t.realName,amount:t.amount,depositTime:t.depositTime.toISOString(),screenshotUrl:t.screenshotUrl,userMessage:t.userMessage,status:"pending"}),this.state.showDepositRecordForm=!1,a.alerts.show({type:"success",dismissible:!0},a.translator.trans("withdrawal.forum.deposit.record.submit_success")),await this.loadDepositRecords()}catch(e){console.error("Deposit record submission failed:",e);let s=a.translator.trans("withdrawal.forum.deposit.record.submit_error").toString();e instanceof n?s=e.message:s=Q(e,s),a.alerts.show({type:"error",dismissible:!0},s)}finally{this.state.submittingDepositRecord=!1,l.redraw()}}}async loadAllData(){try{await Promise.all([this.loadWithdrawalData(),this.loadDepositData(),this.loadUserBalance()]),this.state.loading=!1,l.redraw()}catch(t){console.error("Error loading data:",t),this.state.loading=!1,l.redraw()}}async loadWithdrawalData(){try{const[t,e]=await Promise.all([X.getActive("withdrawal"),k.getUserHistory()]);this.state.withdrawalPlatforms=t,this.state.withdrawalRequests=e}catch(t){console.error("Error loading withdrawal data:",t),this.state.withdrawalPlatforms=[],this.state.withdrawalRequests=[]}}async loadDepositData(){try{const[t,e]=await Promise.all([X.getActive("deposit"),C.getUserHistory()]);this.state.depositPlatforms=t,this.state.depositRecords=e,this.availablePlatforms=t.filter(s=>h(s,"isActive"))}catch(t){console.error("Error loading deposit data:",t),this.state.depositPlatforms=[],this.state.depositRecords=[],this.availablePlatforms=[]}}async loadDepositRecords(){try{const t=await C.getUserHistory();this.state.depositRecords=t}catch(t){console.error("Error loading deposit records:",t),this.state.depositRecords=[]}}async loadUserBalance(t=!1){try{if(this.state.loadingBalance=!0,t&&a.session.user){const e=a.session.user.id();if(!e)throw new Error("User ID not available");const s=await a.store.find("users",e);s?this.state.userBalance=parseFloat(s.attribute("money"))||0:this.state.userBalance=0}else this.state.userBalance=parseFloat(a.session.user?.attribute("money")||"0");this.state.loadingBalance=!1,l.redraw()}catch(e){console.error("Error loading user balance:",e),this.state.loadingBalance=!1,l.redraw()}}async loadWithdrawalRequests(){try{const t=await k.getUserHistory();this.state.withdrawalRequests=t}catch(t){console.error("Error loading withdrawal requests:",t),this.state.withdrawalRequests=[]}}async loadDepositAddress(t){this.depositAddressData.loading=!0,l.redraw();try{const e=await C.generateAddress(parseInt(h(t,"id"),10));this.depositAddressData={address:e,platform:t,loading:!1},l.redraw()}catch(e){console.error("Error loading deposit address:",e),this.depositAddressData.loading=!1;let s=a.translator.trans("withdrawal.forum.deposit.address_load_error").toString();e instanceof n&&(s=e.message),a.alerts.show({type:"error",dismissible:!0},s),l.redraw()}}}function $(o){const t=[];return o.name!==void 0&&(!o.name||typeof o.name!="string")&&t.push("Platform name is required"),o.symbol!==void 0&&(!o.symbol||typeof o.symbol!="string")&&t.push("Symbol is required"),t}function tt(o,t){const e=[];if(o.minAmount!==void 0&&(typeof o.minAmount!="number"||o.minAmount<0)&&e.push("Minimum amount must be a non-negative number"),o.maxAmount!==void 0&&o.maxAmount!==null){(typeof o.maxAmount!="number"||o.maxAmount<0)&&e.push("Maximum amount must be a non-negative number");const s=o.minAmount??t??0;o.maxAmount<s&&e.push("Maximum amount must be greater than or equal to minimum amount")}return o.fee!==void 0&&o.fee!==null&&(typeof o.fee!="number"||o.fee<0)&&e.push("Fee must be a non-negative number"),e}function bt(o){const t=[];return o.network!==void 0&&(!o.network||typeof o.network!="string")&&t.push("Network is required"),o.address!==void 0&&(!o.address||typeof o.address!="string")&&t.push("Deposit address is required"),t}function et(o){if(o.length>0)throw new n(o.join(", "),d.VALIDATION_ERROR)}function It(o,t){const e=[...$(o),...tt(o,t)];et(e)}function Pt(o,t){const e=[...$(o),...tt(o,t),...bt(o)];et(e)}class Et extends c{constructor(){super(...arguments),this.name=c.attribute("name"),this.symbol=c.attribute("symbol"),this.network=c.attribute("network"),this.displayName=c.attribute("displayName"),this.minAmount=c.attribute("minAmount"),this.maxAmount=c.attribute("maxAmount"),this.fee=c.attribute("fee"),this.iconUrl=c.attribute("iconUrl"),this.iconClass=c.attribute("iconClass"),this.isActive=c.attribute("isActive"),this.createdAt=c.attribute("createdAt",c.transformDate),this.updatedAt=c.attribute("updatedAt",c.transformDate)}apiEndpoint(){return`/withdrawal-platforms/${this.id()}`}getDisplayName(){return this.displayName()||this.name()}isValidAmount(t){const e=this.minAmount(),s=this.maxAmount();return t>=e&&t<=s}getTotalCost(t){return t+this.fee()}async save(t){t&&this.validateAttributes(t);try{return await super.save(t)}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new n("You do not have permission to delete this platform",d.PERMISSION_DENIED);if(await this.isInUse())throw new n("Cannot delete platform that has pending withdrawal requests",d.VALIDATION_ERROR);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}async toggleStatus(){if(!this.canModify())throw new n("You do not have permission to modify this platform",d.PERMISSION_DENIED);return await this.save({isActive:!this.isActive()})}clone(){const t=u.store.createRecord("withdrawal-platforms");return t.pushAttributes({name:this.name()+" (Copy)",symbol:this.symbol(),network:this.network(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),iconUrl:this.iconUrl(),iconClass:this.iconClass(),isActive:!1}),t}validateAmount(t){const e=[];return typeof t!="number"||t<=0?(e.push("Amount must be a positive number"),{valid:!1,errors:e}):(t<this.minAmount()&&e.push(`Amount must be at least ${this.minAmount()} ${this.symbol()}`),this.maxAmount()&&t>this.maxAmount()&&e.push(`Amount cannot exceed ${this.maxAmount()} ${this.symbol()}`),{valid:e.length===0,errors:e})}validateUserBalance(t,e){const s=[],r=this.getTotalCost(t);if(e<r){const i=this.fee()>0?` (including ${this.fee()} ${this.symbol()} fee)`:"";s.push(`Insufficient balance. Required: ${r} ${this.symbol()}${i}, Available: ${e} ${this.symbol()}`)}return{valid:s.length===0,errors:s}}canModify(){const t=u.session.user;return t&&t.isAdmin()}canDelete(){const t=u.session.user;return t&&t.isAdmin()}canView(){if(this.isActive())return!0;const t=u.session.user;return t&&t.isAdmin()}async isInUse(){try{const t=await u.store.find("withdrawal-requests",{filter:{platform:this.id(),status:"pending"}});return(Array.isArray(t)?t:[t]).length>0}catch{return!0}}getFormattedFee(){const t=this.fee();return t===0?"Free":`${t} ${this.symbol()}`}getFormattedLimits(){const t=this.minAmount(),e=this.maxAmount(),s=this.symbol();return e?`${t} - ${e} ${s}`:`Min: ${t} ${s}`}validateAttributes(t){It(t,this.minAmount())}handleSaveError(t){if(t instanceof n)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new n(e.detail||"Failed to save withdrawal platform",d.VALIDATION_ERROR,e.code,e)}return new n(t.message||"Failed to save withdrawal platform",d.SERVER_ERROR)}handleDeleteError(t){return t instanceof n?t:t.status===403||t.response?.status===403?new n("You do not have permission to delete this platform",d.PERMISSION_DENIED):new n(t.message||"Failed to delete withdrawal platform",d.SERVER_ERROR)}}const S={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class St extends c{constructor(){super(...arguments),this.amount=c.attribute("amount"),this.accountDetails=c.attribute("accountDetails"),this.message=c.attribute("message"),this.status=c.attribute("status"),this.platformId=c.attribute("platformId"),this.userId=c.attribute("userId"),this.createdAt=c.attribute("createdAt",c.transformDate),this.updatedAt=c.attribute("updatedAt",c.transformDate),this.user=c.hasOne("user"),this.platform=c.hasOne("platform")}apiEndpoint(){return`/withdrawal-requests/${this.id()}`}isPending(){return this.status()===S.PENDING}isApproved(){return this.status()===S.APPROVED}isRejected(){return this.status()===S.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const t=this.status();return u.translator.trans(`withdrawal.forum.status.${t}`).toString()}statusColor(){switch(this.status()){case S.APPROVED:return"success";case S.REJECTED:return"danger";case S.PENDING:default:return"warning"}}async save(t){t&&this.validateAttributes(t);try{return await super.save(t)}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new n("You do not have permission to delete this request",d.PERMISSION_DENIED);if(!this.canBeModified())throw new n("This request cannot be deleted as it has already been processed",d.VALIDATION_ERROR);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}clone(){const t=u.store.createRecord("withdrawal-requests");return t.pushAttributes({platformId:this.platformId(),amount:this.amount(),accountDetails:this.accountDetails(),message:this.message()}),t}getTotalCost(){const t=this.platform(),e=t&&t.fee()||0;return this.amount()+e}getFormattedAmount(){const t=this.platform(),e=t?t.symbol():"";return`${this.amount()} ${e}`.trim()}getFormattedTotalCost(){const t=this.platform(),e=t?t.symbol():"",s=t&&t.fee()||0;return s>0?`${this.amount()} + ${s} (fee) = ${this.getTotalCost()} ${e}`.trim():this.getFormattedAmount()}canModify(){const t=u.session.user;return t?t.isAdmin()?!0:this.userId()===t.id()&&this.canBeModified():!1}canDelete(){const t=u.session.user;return t?t.isAdmin()?!0:this.userId()===t.id()&&this.canBeModified():!1}canView(){const t=u.session.user;return t?t.isAdmin()?!0:this.userId()===t.id():!1}validateAttributes(t){const e=[];if(t.amount!==void 0&&(typeof t.amount!="number"||t.amount<=0)&&e.push("Amount must be a positive number"),t.accountDetails!==void 0&&(!t.accountDetails||typeof t.accountDetails!="string"?e.push("Account details are required"):t.accountDetails.trim().length<5&&e.push("Account details must be at least 5 characters long")),t.platformId!==void 0&&(!t.platformId||typeof t.platformId!="number")&&e.push("Platform selection is required"),e.length>0)throw new n(e.join(", "),d.VALIDATION_ERROR)}handleSaveError(t){if(t instanceof n)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new n(e.detail||"Failed to save withdrawal request",d.VALIDATION_ERROR,e.code,e)}return new n(t.message||"Failed to save withdrawal request",d.SERVER_ERROR)}handleDeleteError(t){return t instanceof n?t:t.status===403||t.response?.status===403?new n("You do not have permission to delete this request",d.PERMISSION_DENIED):new n(t.message||"Failed to delete withdrawal request",d.SERVER_ERROR)}}class Tt extends c{constructor(){super(...arguments),this.name=c.attribute("name"),this.symbol=c.attribute("symbol"),this.network=c.attribute("network"),this.networkTypeId=c.attribute("networkTypeId"),this.displayName=c.attribute("displayName"),this.minAmount=c.attribute("minAmount"),this.maxAmount=c.attribute("maxAmount"),this.fee=c.attribute("fee"),this.address=c.attribute("address"),this.qrCodeImageUrl=c.attribute("qrCodeImageUrl"),this.iconUrl=c.attribute("iconUrl"),this.iconClass=c.attribute("iconClass"),this.warningText=c.attribute("warningText"),this.networkConfig=c.attribute("networkConfig"),this.isActive=c.attribute("isActive"),this.createdAt=c.attribute("createdAt",c.transformDate),this.updatedAt=c.attribute("updatedAt",c.transformDate),this.networkType=c.hasOne("networkType")}getDisplayName(){return this.displayName()||this.name()}getFullDisplayName(){const t=this.getDisplayName(),e=this.network();return e?`${t} (${e})`:t}isValidAmount(t){const e=this.minAmount()||0,s=this.maxAmount();return t>=e&&(s===null||t<=s)}getTotalCost(t){return t+(this.fee()||0)}async save(t){t&&this.validateAttributes(t);try{return await super.save(t)}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new n("You do not have permission to delete this platform",d.PERMISSION_DENIED);if(await this.isInUse())throw new n("Cannot delete platform that has pending deposit records",d.VALIDATION_ERROR);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}async toggleStatus(){if(!this.canModify())throw new n("You do not have permission to modify this platform",d.PERMISSION_DENIED);return await this.save({isActive:!this.isActive()})}clone(){const t=u.store.createRecord("deposit-platforms");return t.pushAttributes({name:this.name()+" (Copy)",symbol:this.symbol(),network:this.network(),networkTypeId:this.networkTypeId(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),address:this.address(),qrCodeImageUrl:this.qrCodeImageUrl(),iconUrl:this.iconUrl(),iconClass:this.iconClass(),warningText:this.warningText(),isActive:!1}),t}validateAmount(t){const e=[];if(typeof t!="number"||t<=0)return e.push("Amount must be a positive number"),{valid:!1,errors:e};const s=this.minAmount()||0;t<s&&e.push(`Amount must be at least ${s} ${this.symbol()}`);const r=this.maxAmount();return r&&t>r&&e.push(`Amount cannot exceed ${r} ${this.symbol()}`),{valid:e.length===0,errors:e}}canModify(){const t=u.session.user;return t&&t.isAdmin()}canDelete(){const t=u.session.user;return t&&t.isAdmin()}canView(){if(this.isActive())return!0;const t=u.session.user;return t&&t.isAdmin()}async isInUse(){try{const t=await u.store.find("deposit-records",{filter:{platform:this.id(),status:"pending"}});return(Array.isArray(t)?t:[t]).length>0}catch{return!0}}getFormattedFee(){const t=this.fee()||0;return t===0?"Free":`${t} ${this.symbol()}`}getFormattedLimits(){const t=this.minAmount()||0,e=this.maxAmount(),s=this.symbol();return e?`${t} - ${e} ${s}`:`Min: ${t} ${s}`}generateDepositAddress(t){const e=this.address();if(e)return e;throw new n("No deposit address configured for this platform",d.VALIDATION_ERROR)}validateAttributes(t){Pt(t,this.minAmount())}handleSaveError(t){if(t instanceof n)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new n(e.detail||"Failed to save deposit platform",d.VALIDATION_ERROR,e.code,e)}return new n(t.message||"Failed to save deposit platform",d.SERVER_ERROR)}handleDeleteError(t){return t instanceof n?t:t.status===403||t.response?.status===403?new n("You do not have permission to delete this platform",d.PERMISSION_DENIED):new n(t.message||"Failed to delete deposit platform",d.SERVER_ERROR)}}class Ft extends c{constructor(){super(...arguments),this.address=c.attribute("address"),this.addressTag=c.attribute("addressTag"),this.fullAddress=c.attribute("fullAddress"),this.isActive=c.attribute("isActive"),this.lastUsedAt=c.attribute("lastUsedAt",c.transformDate),this.createdAt=c.attribute("createdAt",c.transformDate),this.updatedAt=c.attribute("updatedAt",c.transformDate),this.user=c.hasOne("user"),this.platform=c.hasOne("platform")}}const v=class v extends c{constructor(){super(...arguments),this.id=c.attribute("id"),this.userId=c.attribute("userId"),this.platformId=c.attribute("platformId"),this.platformAccount=c.attribute("platformAccount"),this.realName=c.attribute("realName"),this.amount=c.attribute("amount"),this.depositTime=c.attribute("depositTime",c.transformDate),this.screenshotUrl=c.attribute("screenshotUrl"),this.userMessage=c.attribute("userMessage"),this.status=c.attribute("status"),this.processedAt=c.attribute("processedAt",c.transformDate),this.processedBy=c.attribute("processedBy"),this.adminNotes=c.attribute("adminNotes"),this.creditedAmount=c.attribute("creditedAmount"),this.createdAt=c.attribute("createdAt",c.transformDate),this.updatedAt=c.attribute("updatedAt",c.transformDate),this.user=c.hasOne("user"),this.platform=c.hasOne("platform"),this.processedByUser=c.hasOne("processedByUser")}isPending(){return this.status()===v.STATUS_PENDING}isApproved(){return this.status()===v.STATUS_APPROVED}isRejected(){return this.status()===v.STATUS_REJECTED}getStatusColor(){switch(this.status()){case v.STATUS_PENDING:return"warning";case v.STATUS_APPROVED:return"success";case v.STATUS_REJECTED:return"error";default:return"secondary"}}getStatusLabel(){const t=this.status();return u.translator.trans(`withdrawal.forum.deposit.status.${t}`).toString()}canBeModified(){return this.isPending()}async save(t){t&&this.validateAttributes(t);try{return await super.save(t)}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new n("You do not have permission to delete this deposit record",d.PERMISSION_DENIED);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}clone(){const t=u.store.createRecord("deposit-records");return t.pushAttributes({platformId:this.platformId(),amount:this.amount(),platformAccount:this.platformAccount(),realName:this.realName(),userMessage:this.userMessage(),screenshotUrl:this.screenshotUrl()}),t}getFormattedAmount(){const t=this.platform(),e=t?t.symbol():"";return`${this.amount()} ${e}`.trim()}getFinalAmount(){return this.creditedAmount()||this.amount()}getFormattedFinalAmount(){const t=this.platform(),e=t?t.symbol():"",s=this.getFinalAmount();return this.creditedAmount()&&this.creditedAmount()!==this.amount()?`${s} ${e} (credited: ${this.creditedAmount()})`.trim():`${s} ${e}`.trim()}canModify(){const t=u.session.user;return t?t.isAdmin()?!0:this.userId()===t.id()&&this.canBeModified():!1}canDelete(){const t=u.session.user;return t?t.isAdmin()?!0:this.userId()===t.id()&&this.canBeModified():!1}canView(){const t=u.session.user;return t?t.isAdmin()?!0:this.userId()===t.id():!1}canProcess(){const t=u.session.user;return t&&t.isAdmin()&&this.isPending()}async approve(t,e){if(!this.canProcess())throw new n("You do not have permission to approve this deposit",d.PERMISSION_DENIED);const s={status:v.STATUS_APPROVED,processedAt:new Date,processedBy:u.session.user?.id()};return t!==void 0&&(s.creditedAmount=t),e&&(s.adminNotes=e),await this.save(s)}async reject(t){if(!this.canProcess())throw new n("You do not have permission to reject this deposit",d.PERMISSION_DENIED);const e={status:v.STATUS_REJECTED,processedAt:new Date,processedBy:u.session.user?.id()};return t&&(e.adminNotes=t),await this.save(e)}validateAttributes(t){const e=[];if(t.amount!==void 0&&(typeof t.amount!="number"||t.amount<=0)&&e.push("Amount must be a positive number"),t.platformAccount!==void 0&&(!t.platformAccount||typeof t.platformAccount!="string")&&e.push("Platform account is required"),t.realName!==void 0&&(!t.realName||typeof t.realName!="string"?e.push("Real name is required"):t.realName.trim().length<2&&e.push("Real name must be at least 2 characters long")),t.platformId!==void 0&&(!t.platformId||typeof t.platformId!="number")&&e.push("Platform selection is required"),t.creditedAmount!==void 0&&(typeof t.creditedAmount!="number"||t.creditedAmount<0)&&e.push("Credited amount must be a non-negative number"),e.length>0)throw new n(e.join(", "),d.VALIDATION_ERROR)}handleSaveError(t){if(t instanceof n)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new n(e.detail||"Failed to save deposit record",d.VALIDATION_ERROR,e.code,e)}return new n(t.message||"Failed to save deposit record",d.SERVER_ERROR)}handleDeleteError(t){return t instanceof n?t:t.status===403||t.response?.status===403?new n("You do not have permission to delete this record",d.PERMISSION_DENIED):new n(t.message||"Failed to delete deposit record",d.SERVER_ERROR)}};v.STATUS_PENDING="pending",v.STATUS_APPROVED="approved",v.STATUS_REJECTED="rejected";let V=v;class Ot extends A{view(){if(!a.session.user)return null;const e=(a.forum.attribute("antoinefr-money.moneyname")||"[money]").replace("[money]",a.session.user.attribute("money")),s=a.forum.attribute("wusong8899-withdrawal.moneyIconUrl");return m("div",{id:"moneyDisplayContainer",className:"client1-header-adv-wrapper clientCustomizeWithdrawalHeaderTotalMoney"},m("div",{className:"clientCustomizeWithdrawalHeaderText"},s&&s.trim()&&m("span",{style:{borderRadius:"50%",padding:"6px 8px",marginRight:"8px",display:"inline-flex",alignItems:"center",justifyContent:"center"}},m("img",{src:s,alt:"Money icon",style:{width:"20px",height:"20px"},onError:r=>{const i=r.target;i.style.display="none"}})),e),m("div",{className:"clientCustomizeWithdrawalHeaderIcon"},m("i",{className:"fas fa-wallet"})),m("div",{className:"clientCustomizeWithdrawalButtons"},m("div",{className:"clientCustomizeWithdrawalButton",onclick:this.handleWithdrawalClick.bind(this),title:"提款"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",{style:{marginLeft:"4px",fontSize:"12px"}},"提款")),m("div",{className:"clientCustomizeDepositButton",onclick:this.handleDepositClick.bind(this),title:"存款",style:{marginLeft:"8px"}},m("i",{className:"fas fa-coins"}),m("span",{style:{marginLeft:"4px",fontSize:"12px"}},"存款"))))}handleWithdrawalClick(t){t.preventDefault(),t.stopPropagation(),window.location.href="/funds?tab=withdrawal"}handleDepositClick(t){t.preventDefault(),t.stopPropagation(),window.location.href="/funds?tab=deposit"}}class _t extends A{view(){const t=a.session.user?.attribute("money")||0,e=a.forum.attribute("wusong8899-withdrawal.moneyIconUrl");return m("div",{className:"Navigation-mobileMoneyDisplay"},m("div",{className:"Navigation-moneySection",onclick:this.handleWithdrawalClick.bind(this),title:`余额: ${t} - 点击提款`},m("div",{className:"Navigation-moneyText"},e&&e.trim()&&m("span",{style:{borderRadius:"50%",padding:"4px 6px",marginRight:"6px",display:"inline-flex",alignItems:"center",justifyContent:"center"}},m("img",{src:e,alt:"Money icon",style:{width:"18px",height:"18px"},onError:s=>{const r=s.target;r.style.display="none"}})),m("span",{className:"Navigation-moneyAmount"},t)),m("div",{className:"Navigation-withdrawalButton"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",null,"提款"))))}handleWithdrawalClick(t){t.preventDefault(),t.stopPropagation(),console.log("MobileMoneyDisplay clicked!");try{window.location.href="/funds?tab=withdrawal"}catch(e){console.error("Navigation error:",e),window.location.href="/funds?tab=withdrawal"}}}class T{constructor(){}static getInstance(){return T.instance||(T.instance=new T),T.instance}isTagsPage(){try{return a.current?.get("routeName")==="index"}catch{return!1}}}function M(){return window.innerWidth<=767}function B(){return window.innerWidth>=768&&window.innerWidth<=1024}function xt(){return window.innerWidth>1024}function Ut(){return M()||B()}function Ct(){return M()?"mobile":B()?"tablet":"desktop"}function Wt(){return"ontouchstart"in window||navigator.maxTouchPoints>0}const qt={isMobile:M,isTablet:B,isDesktop:xt,isMobileOrTablet:Ut,getCurrentBreakpoint:Ct,isTouchDevice:Wt};a.initializers.add("wusong8899-withdrawal",()=>{a.store.models["withdrawal-platforms"]=Et,a.store.models["withdrawal-requests"]=St,a.store.models["deposit-platforms"]=Tt,a.store.models["deposit-addresses"]=Ft,a.store.models["deposit-records"]=V,a.routes.funds={path:"/funds",component:L},a.routes.withdrawal={path:"/withdrawal",component:L},a.routes.deposit={path:"/deposit",component:L},H.extend(st.prototype,"view",function(o){const t=T.getInstance();a.session.user&&t.isTagsPage()&&!qt.isMobile()&&o.children.push(Ot.component())}),H.extend(rt.prototype,"view",function(o){if(window.innerWidth>768||a.current.get("routeName")!=="tags"||!a.session.user||!o||!o.children||!Array.isArray(o.children))return;o.children.some(s=>s&&s.attrs&&s.attrs.className&&s.attrs.className.includes("Navigation-mobileMoneyDisplay"))||o.children.push(_t.component({className:"item-withdrawal Navigation-mobileMoneyDisplay"}))})})})(flarum.core.compat["common/app"],flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["forum/components/HeaderPrimary"],flarum.core.compat["common/components/Navigation"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/icon"],m,flarum.core.compat["common/Component"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/utils/withAttr"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=forum.js.map

module.exports={};