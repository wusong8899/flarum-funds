(function(a,l,c,u,d,i,h,w,o,f){"use strict";class g extends d{constructor(){super(...arguments),this.platforms=[],this.requests=[],this.loading=!0,this.submitting=!1,this.loadingBalance=!0,this.userBalance=0,this.userSecurity={phoneVerified:!1,twoFactorEnabled:!1},this.amount=o(""),this.selectedPlatform=o(""),this.accountDetails=o("")}oninit(t){super.oninit(t),a.setTitle(a.translator.trans("withdrawal.forum.page.title")),this.loadData(),this.loadUserBalance(),this.loadUserSecurity()}view(){if(this.loading)return m("div",{className:"WithdrawalPage"},m("div",{className:"container"},m(h,null)));const t=a.forum.attribute("withdrawal.minAmount")||0,r=a.forum.attribute("withdrawal.maxAmount")||1e4,e=a.forum.attribute("withdrawal.fee")||0;return m("div",{className:"WithdrawalPage"},m("div",{className:"container"},m("div",{className:"WithdrawalPage-header"},m("h1",null,a.translator.trans("withdrawal.forum.page.title")),m("p",null,a.translator.trans("withdrawal.forum.page.description"))),m("div",{className:"WithdrawalPage-content"},this.renderBalanceSection(),this.renderInfoSection(t,r,e),m("div",{className:"WithdrawalPage-form"},m("h3",null,a.translator.trans("withdrawal.forum.form.title")),m("div",{className:"WithdrawalPage-formGroup"},m("label",null,a.translator.trans("withdrawal.forum.form.platform")),m(w,{options:this.getPlatformOptions(),value:this.selectedPlatform(),onchange:this.selectedPlatform})),m("div",{className:"WithdrawalPage-formGroup"},m("label",null,a.translator.trans("withdrawal.forum.form.amount")),m("div",{className:"WithdrawalPage-amountInput"},m("input",{type:"number",className:"FormControl",placeholder:a.translator.trans("withdrawal.forum.form.amount_placeholder"),value:this.amount(),oninput:s=>this.amount(s.target.value),min:t,max:r,step:"0.01"}),m(i,{className:"Button Button--secondary WithdrawalPage-allButton",onclick:this.fillAllAmount.bind(this)},a.translator.trans("withdrawal.forum.form.all_button")))),this.renderFinalAmountCalculation(e),m("div",{className:"WithdrawalPage-formGroup"},m("label",null,a.translator.trans("withdrawal.forum.form.account_details")),m("div",{className:"WithdrawalPage-accountInput"},m("textarea",{className:"FormControl",placeholder:a.translator.trans("withdrawal.forum.form.account_details_placeholder"),value:this.accountDetails(),oninput:s=>this.accountDetails(s.target.value),rows:3}),m(i,{className:"Button Button--secondary WithdrawalPage-pasteButton",onclick:this.pasteFromClipboard.bind(this)},a.translator.trans("withdrawal.forum.form.paste_button")))),this.renderSecuritySection(),m("div",{className:"WithdrawalPage-formGroup"},m(i,{className:"Button Button--primary",loading:this.submitting,disabled:!this.canSubmit(),onclick:this.submit.bind(this)},a.translator.trans("withdrawal.forum.form.submit")))),m("div",{className:"WithdrawalPage-history"},m("h3",null,a.translator.trans("withdrawal.forum.history.title")),this.requests.length===0?m("p",null,a.translator.trans("withdrawal.forum.history.empty")):m("div",{className:"WithdrawalPage-historyList"},this.requests.map(s=>this.renderRequest(s)))))))}renderRequest(t){const r=this.platforms.find(s=>s.id==t.relationships.platform.data.id),e=`status-${t.attributes.status}`;return m("div",{key:t.id,className:`WithdrawalRequest ${e}`},m("div",{className:"WithdrawalRequest-info"},m("span",{className:"WithdrawalRequest-amount"},"$",t.attributes.amount),m("span",{className:"WithdrawalRequest-platform"},r?.attributes.name),m("span",{className:"WithdrawalRequest-date"},f(t.attributes.createdAt).format("YYYY-MM-DD HH:mm"))),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${t.attributes.status}`},a.translator.trans(`withdrawal.forum.status.${t.attributes.status}`))))}renderBalanceSection(){return m("div",{className:"WithdrawalPage-balance"},m("h3",null,a.translator.trans("withdrawal.forum.balance.title")),m("div",{className:"WithdrawalPage-balanceAmount"},this.loadingBalance?m("span",{className:"loading"},a.translator.trans("withdrawal.forum.balance.loading")):m("span",{className:"amount"},a.translator.trans("withdrawal.forum.balance.amount",{amount:this.userBalance}))))}renderInfoSection(t,r,e){return m("div",{className:"WithdrawalPage-info"},m("div",{className:"WithdrawalPage-infoRow"},m("span",{className:"WithdrawalPage-infoIcon"},"ðŸ’°"),m("span",{className:"WithdrawalPage-infoText"},a.translator.trans("withdrawal.forum.info.minimum_amount",{amount:t}))),m("div",{className:"WithdrawalPage-infoRow"},m("span",{className:"WithdrawalPage-infoIcon"},"ðŸ’°"),m("span",{className:"WithdrawalPage-infoText"},a.translator.trans("withdrawal.forum.info.maximum_amount",{amount:r}))),m("div",{className:"WithdrawalPage-infoRow"},m("span",{className:"WithdrawalPage-infoIcon"},"ðŸ’¸"),m("span",{className:"WithdrawalPage-infoText"},a.translator.trans("withdrawal.forum.info.withdrawal_fee",{amount:e}))))}renderFinalAmountCalculation(t){const r=parseFloat(this.amount())||0,e=Math.max(0,r-t);return r>0?m("div",{className:"WithdrawalPage-finalAmount"},m("span",{className:"WithdrawalPage-finalAmountLabel"},a.translator.trans("withdrawal.forum.info.final_amount",{amount:e.toFixed(2)}))):null}renderSecuritySection(){const t=this.userSecurity.phoneVerified&&this.userSecurity.twoFactorEnabled;return m("div",{className:"WithdrawalPage-security"},m("h4",null,a.translator.trans("withdrawal.forum.security.title")),m("div",{className:"WithdrawalPage-securityItem"},m("div",{className:"WithdrawalPage-securityInfo"},m("span",{className:"WithdrawalPage-securityLabel"},a.translator.trans("withdrawal.forum.security.phone_binding")),m("span",{className:`WithdrawalPage-securityStatus ${this.userSecurity.phoneVerified?"verified":"unverified"}`},this.userSecurity.phoneVerified?a.translator.trans("withdrawal.forum.security.phone_bound"):a.translator.trans("withdrawal.forum.security.phone_unbound"))),!this.userSecurity.phoneVerified&&m(i,{className:"Button Button--link WithdrawalPage-securityAction",onclick:()=>this.redirectToPhoneBinding()},a.translator.trans("withdrawal.forum.security.phone_bind_action"))),m("div",{className:"WithdrawalPage-securityItem"},m("div",{className:"WithdrawalPage-securityInfo"},m("span",{className:"WithdrawalPage-securityLabel"},a.translator.trans("withdrawal.forum.security.two_factor")),m("span",{className:`WithdrawalPage-securityStatus ${this.userSecurity.twoFactorEnabled?"verified":"unverified"}`},this.userSecurity.twoFactorEnabled?a.translator.trans("withdrawal.forum.security.two_factor_enabled"):a.translator.trans("withdrawal.forum.security.two_factor_disabled"))),!this.userSecurity.twoFactorEnabled&&m(i,{className:"Button Button--link WithdrawalPage-securityAction",onclick:()=>this.redirectToTwoFactor()},a.translator.trans("withdrawal.forum.security.two_factor_enable_action"))),!t&&m("div",{className:"WithdrawalPage-securityWarning"},m("span",{className:"warning-icon"},"âš "),m("span",null,a.translator.trans("withdrawal.forum.security.incomplete_warning"))))}getPlatformOptions(){const t={"":a.translator.trans("withdrawal.forum.form.select_platform")};return this.platforms.forEach(r=>{t[r.id.toString()]=r.attributes.name}),t}canSubmit(){const t=this.userSecurity.phoneVerified&&this.userSecurity.twoFactorEnabled;return!!(this.selectedPlatform()&&this.amount()&&this.accountDetails()&&!this.submitting&&t)}fillAllAmount(){this.amount(this.userBalance.toString())}async pasteFromClipboard(){try{if(navigator.clipboard&&navigator.clipboard.readText){const t=await navigator.clipboard.readText();this.accountDetails(t),m.redraw()}}catch(t){console.error("Failed to read from clipboard:",t),a.alerts.show({type:"error",message:"Clipboard access not available. Please paste manually."})}}redirectToPhoneBinding(){console.log("Redirecting to phone binding page...")}redirectToTwoFactor(){console.log("Redirecting to 2FA setup page...")}async submit(){if(this.canSubmit()){this.submitting=!0;try{const t={type:"withdrawal-requests",attributes:{platformId:parseInt(this.selectedPlatform()),amount:parseFloat(this.amount()),accountDetails:this.accountDetails()}};await a.store.createRecord("withdrawal-requests").save(t),a.alerts.show({type:"success",message:a.translator.trans("withdrawal.forum.form.success")}),this.amount(""),this.selectedPlatform(""),this.accountDetails(""),this.loadRequests()}catch(t){console.error("Error submitting withdrawal request:",t),a.alerts.show({type:"error",message:a.translator.trans("withdrawal.forum.form.error")})}finally{this.submitting=!1,m.redraw()}}}async loadData(){try{await Promise.all([this.loadPlatforms(),this.loadRequests()])}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,m.redraw()}}async loadPlatforms(){const t=await a.store.find("withdrawal-platforms");this.platforms=Array.isArray(t)?t:[t]}async loadRequests(){const t=await a.store.find("withdrawal-requests");this.requests=Array.isArray(t)?t:[t]}async loadUserBalance(){try{this.userBalance=a.session.user?.attribute("money")||0,this.loadingBalance=!1,m.redraw()}catch(t){console.error("Error loading user balance:",t),this.loadingBalance=!1,m.redraw()}}async loadUserSecurity(){try{this.userSecurity={phoneVerified:a.session.user?.attribute("phoneVerified")||!1,twoFactorEnabled:a.session.user?.attribute("twoFactorEnabled")||!1},m.redraw()}catch(t){console.error("Error loading user security status:",t)}}}a.initializers.add("wusong8899-withdrawal",()=>{a.routes.withdrawal={path:"/withdrawal",component:g},l.extend(u.prototype,"items",function(n){a.session.user&&n.add("withdrawal",c.component({href:a.route("withdrawal"),icon:"fas fa-money-bill-transfer"},a.translator.trans("withdrawal.forum.header.withdrawal_button")),10)})})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["common/components/LinkButton"],flarum.core.compat["forum/components/HeaderSecondary"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/components/Select"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/utils/dayjs"]);
//# sourceMappingURL=forum.js.map

module.exports={};