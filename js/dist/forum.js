(function(i,k,Z,$,tt,I,L,D,p,l,N,V,E,u,n){"use strict";const B={pending:"warning",approved:"success",rejected:"danger"},v={MIN_AMOUNT:.001,MAX_AMOUNT:10,FEE:5e-4,BALANCE_PRECISION:8},A={COINS:"fas fa-coins",CHEVRON_DOWN:"fas fa-chevron-down",PASTE:"fas fa-paste"};function W(a){const t=a.platformIconUrl();if(t)return{type:"url",value:t,alt:a.name()||"Platform icon"};console.log("No platform icon URL found");const e=a.platformIconClass();return e?{type:"class",value:e}:(console.log("No platform icon class found"),{type:"fallback",value:"fas fa-coins"})}function H(a,t=""){const e="icon",s=t?`${e} ${t}`:e;switch(a.type){case"url":return m("img",{src:a.value,alt:a.alt||"Icon",className:`${s} icon--image`});case"class":return m("i",{className:`${s} ${a.value}`,"aria-hidden":"true"});case"fallback":default:return m("i",{className:`${s} ${a.value}`,"aria-hidden":"true"})}}class S{view(t){const{platform:e,className:s="",size:r="medium"}=t.attrs;if(!e)return p(A.COINS,{className:`crypto-icon default ${s}`});const f=`crypto-icon ${`platform-icon-${r}`} ${s}`,g=W(e);return H(g,f)}}const M=a=>typeof a.id=="function"?a.id():a.id,h=(a,t)=>typeof a[t]=="function"?a[t]():a.attributes?a.attributes[t]:a[t],j=a=>String(M(a)),et=(a,t)=>{const e=String(t);return a.find(s=>{const r=M(s);return String(r)===e})},T=(a,t)=>{const e=h(a,t);return e?new Date(e):new Date};class st extends N{oninit(t){super.oninit(t),this.state={showDropdown:!1}}view(){const{selectedPlatform:t}=this.attrs,{showDropdown:e}=this.state;return m("div",{className:"FundsPage-withdrawal-PlatformSelector"},m("div",{className:"FundsPage-withdrawal-Label"},"提取平台"),m("div",{className:"FundsPage-withdrawal-PlatformDropdown",onclick:()=>this.toggleDropdown()},m("div",{className:"FundsPage-withdrawal-PlatformSelected"},m("div",{className:"FundsPage-withdrawal-PlatformInfo"},m("div",{className:"FundsPage-withdrawal-PlatformIcon"},m(S,{platform:t,size:"medium"})),m("div",{className:"FundsPage-withdrawal-PlatformDetails"},m("div",{className:"FundsPage-withdrawal-PlatformName"},this.getPlatformName(t))))),p(A.CHEVRON_DOWN,{className:"FundsPage-withdrawal-DropdownIcon"})),e&&this.renderPlatformDropdown())}toggleDropdown(){this.state.showDropdown=!this.state.showDropdown}getPlatformName(t){return t&&(h(t,"displayName")||h(t,"name"))||"请选择平台"}renderPlatformDropdown(){const{platforms:t}=this.attrs,e=(t||[]).filter(s=>!!s);return e.length===0?m("div",{className:"FundsPage-withdrawal-DropdownMenu"},m("div",{className:"FundsPage-withdrawal-DropdownItem FundsPage-withdrawal-NoData"},i.translator.trans("funds.forum.no_platforms"))):m("div",{className:"FundsPage-withdrawal-DropdownMenu"},e.map(s=>m("div",{key:s.id(),className:"FundsPage-withdrawal-DropdownItem",onclick:()=>this.selectPlatform(s)},m("div",{className:"FundsPage-withdrawal-PlatformIcon"},m(S,{platform:s,size:"small"})),m("div",{className:"FundsPage-withdrawal-PlatformName"},h(s,"displayName")||h(s,"name")))))}selectPlatform(t){const{onPlatformSelect:e,onAmountChange:s}=this.attrs;e(t),this.state.showDropdown=!1,s&&s()}}class at extends N{view(){const{amount:t,selectedPlatform:e,loadingBalance:s,onAmountChange:r,onFillAllAmount:o}=this.attrs,f=this.getMinAmount(e),g=this.getMaxAmount(e),w=this.getFee(e);return m("div",{className:"FundsPage-withdrawal-AmountSection"},m("div",{className:"FundsPage-withdrawal-FormGroup"},m("div",{className:"FundsPage-withdrawal-Label"},i.translator.trans("funds.forum.form.amount")),m("div",{className:"FundsPage-withdrawal-AmountInput"},m("input",{type:"text",className:"FundsPage-withdrawal-Input",placeholder:"0.00000000",value:t,oninput:y=>r(y.target.value)}),m(I,{className:"FundsPage-withdrawal-AllButton",onclick:o,disabled:s},i.translator.trans("funds.forum.form.all_button"))),m("div",{className:"FundsPage-withdrawal-AmountLimits"},m("div",{className:"FundsPage-withdrawal-LimitRow"},m("span",{className:"FundsPage-withdrawal-LimitLabel"},i.translator.trans("funds.forum.limits.min_max")),m("span",{className:"FundsPage-withdrawal-LimitValue"},p(A.COINS)," ",f," ~ ",g)),m("div",{className:"FundsPage-withdrawal-LimitRow"},m("span",{className:"FundsPage-withdrawal-LimitLabel"},i.translator.trans("funds.forum.limits.fee")),m("span",{className:"FundsPage-withdrawal-LimitValue"},p(A.COINS)," ",w)))))}getMinAmount(t){return t&&h(t,"minAmount")||v.MIN_AMOUNT}getMaxAmount(t){return t&&h(t,"maxAmount")||v.MAX_AMOUNT}getFee(t){return t&&h(t,"fee")||v.FEE}}class rt extends N{view(){const{accountDetails:t,selectedPlatform:e,onAccountDetailsChange:s}=this.attrs,r=this.getSymbol(e);return l("div",{className:"FundsPage-withdrawal-AddressSection"},l("div",{className:"FundsPage-withdrawal-FormGroup"},l("div",{className:"FundsPage-withdrawal-AddressHeader"},l("span",{className:"FundsPage-withdrawal-Label"},i.translator.trans("funds.forum.form.address",{symbol:r}),l("span",{className:"FundsPage-withdrawal-Required"},"*"))),l("div",{className:"FundsPage-withdrawal-AddressInput"},l("input",{type:"text",className:"FundsPage-withdrawal-Input",placeholder:i.translator.trans("funds.forum.form.address_placeholder"),value:t,oninput:o=>s(o.target.value)}),l("button",{className:"FundsPage-withdrawal-PasteButton",onclick:()=>this.pasteFromClipboard()},p(A.PASTE)))))}getSymbol(t){return t&&h(t,"symbol")||""}async pasteFromClipboard(){const{onAccountDetailsChange:t}=this.attrs;try{if(navigator.clipboard&&navigator.clipboard.readText){const e=await navigator.clipboard.readText();t(e.trim()),l.redraw()}}catch(e){console.error("Failed to read from clipboard:",e),i.alerts.show({type:"error",dismissible:!0},i.translator.trans("funds.forum.clipboard_error"))}}}class it extends N{view(){const{message:t,onMessageChange:e}=this.attrs;return m("div",{className:"FundsPage-withdrawal-MessageSection"},m("div",{className:"FundsPage-withdrawal-FormGroup"},m("span",{className:"FundsPage-withdrawal-Label"},i.translator.trans("funds.forum.form.message")),m("textarea",{className:"FundsPage-withdrawal-Textarea",placeholder:i.translator.trans("funds.forum.form.message_placeholder"),value:t,rows:3,maxlength:500,oninput:s=>e(s.target.value)}),m("div",{className:"FundsPage-withdrawal-HelperText"},i.translator.trans("funds.forum.form.message_helper")," (",t.length,"/500)")))}}class nt extends N{view(){const{amount:t,selectedPlatform:e,submitting:s,canSubmit:r,onSubmit:o}=this.attrs,f=parseFloat(t)||0,g=this.getFee(e),w=Math.max(0,f-g),y=this.getSymbol(e);return m("div",{className:"FundsPage-withdrawal-SubmitSection"},m(I,{className:"FundsPage-withdrawal-SubmitButton",loading:s,disabled:!r,onclick:o},i.translator.trans("funds.forum.form.submit")),f>0&&m("div",{className:"FundsPage-withdrawal-FinalAmount"},i.translator.trans("funds.forum.final_amount",{amount:w.toFixed(v.BALANCE_PRECISION),symbol:y})))}getFee(t){return t&&h(t,"fee")||v.FEE}getSymbol(t){return t&&h(t,"symbol")||""}}class ot extends N{view(){const{platforms:t,formData:e,loadingBalance:s,submitting:r,onFormDataChange:o,onFillAllAmount:f,onSubmit:g}=this.attrs;return[m(st,{platforms:t,selectedPlatform:e.selectedPlatform,onPlatformSelect:w=>o({selectedPlatform:w}),onAmountChange:()=>o({amount:""})}),m(at,{amount:e.amount,selectedPlatform:e.selectedPlatform,loadingBalance:s,onAmountChange:w=>o({amount:w}),onFillAllAmount:f}),m(rt,{accountDetails:e.accountDetails,selectedPlatform:e.selectedPlatform,onAccountDetailsChange:w=>o({accountDetails:w})}),m(it,{message:e.message,onMessageChange:w=>o({message:w})}),m(nt,{amount:e.amount,selectedPlatform:e.selectedPlatform,accountDetails:e.accountDetails,submitting:r,canSubmit:this.canSubmit(),onSubmit:g})]}canSubmit(){const{formData:t,submitting:e}=this.attrs,{selectedPlatform:s,amount:r,accountDetails:o}=t;return!!(s&&r&&o&&!e&&parseFloat(r)>0)}}class lt extends N{view(){const{status:t,className:e=""}=this.attrs,s=this.getStatusClass(t),r=this.getStatusLabel(t);return m("div",{className:`FundsPage-withdrawal-HistoryStatus ${s} ${e}`},r)}getStatusClass(t){return B[t]||B.pending}getStatusLabel(t){return i.translator.trans(`funds.forum.status.${t}`).toString()}}class dt extends N{view(){const{iconName:t,title:e,description:s,className:r=""}=this.attrs;return m("div",{className:`FundsPage-emptyState ${r}`},m("div",{className:"FundsPage-emptyIcon"},p(t)),m("h3",{className:"FundsPage-emptyTitle"},e),m("p",{className:"FundsPage-emptyDescription"},s))}}function mt(a){const{className:t=""}=a;return m("div",{className:`FundsPage-loading ${t}`},m(L,null))}class R extends N{view(t){const{transactions:e,platforms:s,loading:r,type:o}=t.attrs;return r?m(mt,{className:`${o}History-loading`}):!e||e.length===0?m(dt,{iconName:o==="withdrawal"?"fas fa-history":"fas fa-inbox",title:i.translator.trans("funds.forum.history.empty.title"),description:i.translator.trans("funds.forum.history.empty.description"),className:`${o}History-empty`}):m("div",{className:`${o}History`},m("div",{className:`${o}History-header`},m("h3",null,i.translator.trans("funds.forum.history.title")),m("span",{className:`${o}History-count`},e.length," ",i.translator.trans("funds.forum.history.transactions",{count:e.length}))),m("div",{className:`${o}History-list`},e.map(f=>this.renderTransaction(f,s,o))))}renderTransaction(t,e,s){const r=this.getTransactionId(t),o=this.getPlatform(t,e),f=h(t,"amount")||0,g=h(t,"status")||"pending",w=h(t,"statusColor")||this.getStatusColor(g),y=T(t,"createdAt");return s==="deposit"?this.renderDepositRecord(t,o,f,g,w,y,r):this.renderWithdrawalTransaction(t,o,f,g,y,r)}renderWithdrawalTransaction(t,e,s,r,o,f){const g=h(t,"accountDetails")||"";return m("div",{key:f,className:"FundsPage-withdrawal-HistoryItem"},m("div",{className:"FundsPage-withdrawal-HistoryHeader"},m("div",{className:"FundsPage-withdrawal-HistoryPlatform"},m("div",{className:"FundsPage-withdrawal-PlatformIcon"},m(S,{platform:e,size:"small"})),m("div",{className:"FundsPage-withdrawal-HistoryInfo"},m("div",{className:"FundsPage-withdrawal-HistoryPlatformName"},this.getPlatformName(e)),m("div",{className:"FundsPage-withdrawal-HistoryDate"},o.toLocaleDateString()," ",o.toLocaleTimeString()))),m(lt,{status:r})),m("div",{className:"FundsPage-withdrawal-HistoryDetails"},m("div",{className:"FundsPage-withdrawal-HistoryAmount"},m("span",{className:"FundsPage-withdrawal-HistoryLabel"},i.translator.trans("funds.forum.history.amount"),":"),m("span",{className:"FundsPage-withdrawal-HistoryValue"},s," ",this.getPlatformSymbol(e))),m("div",{className:"FundsPage-withdrawal-HistoryAddress"},m("span",{className:"FundsPage-withdrawal-HistoryLabel"},i.translator.trans("funds.forum.history.address"),":"),m("span",{className:"FundsPage-withdrawal-HistoryValue"},g))))}renderDepositRecord(t,e,s,r,o,f,g){const w=T(t,"depositTime"),y=h(t,"screenshotUrl"),F=h(t,"userMessage"),X=T(t,"processedAt"),Q=h(t,"adminNotes"),U=h(t,"creditedAmount");return m("div",{key:g,className:"DepositRecord-item"},m("div",{className:"DepositRecord-itemHeader"},m("div",{className:"DepositRecord-itemPlatform"},e&&m("[",null,m("div",{className:"DepositRecord-itemIcon"},this.renderPlatformIcon(e)),m("div",{className:"DepositRecord-itemInfo"},m("span",{className:"DepositRecord-itemCurrency"},h(e,"symbol")," ",h(e,"network")&&`(${h(e,"network")})`),m("span",{className:"DepositRecord-itemType"},"Manual Deposit")))),m("div",{className:"DepositRecord-itemAmount"},m("span",{className:"DepositRecord-itemAmountValue"},"+",s," ",e?h(e,"symbol"):""),m("div",{className:`DepositRecord-itemStatus status-${o}`},this.getStatusIcon(r),this.getStatusText(r)))),m("div",{className:"DepositRecord-itemDetails"},m("div",{className:"DepositRecord-itemMeta"},m("span",{className:"DepositRecord-itemTime"},"Submitted: ",f?V(f):"Unknown time"),w&&m("span",{className:"DepositRecord-itemDepositTime"},"Deposit Time: ",w.toLocaleDateString()," ",w.toLocaleTimeString())),m("div",{className:"DepositRecord-itemInfo"},F&&m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Message:"),m("span",{className:"DepositRecord-itemValue"},F)),y&&m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Screenshot:"),m("a",{href:y,target:"_blank",rel:"noopener noreferrer",className:"DepositRecord-itemLink"},"View Screenshot ",p("fas fa-external-link-alt")))),X&&m("div",{className:"DepositRecord-itemProcessed"},m("div",{className:"DepositRecord-itemProcessedTime"},"Processed: ",V(X)),U&&U!==s&&m("div",{className:"DepositRecord-itemCredited"},"Credited Amount: ",U," ",e?h(e,"symbol"):""),Q&&m("div",{className:"DepositRecord-itemNotes"},m("span",{className:"DepositRecord-itemLabel"},"Admin Notes:"),m("span",{className:"DepositRecord-itemValue"},Q)))))}getTransactionId(t){return typeof t.id=="function"?`transaction-${t.id()}`:`transaction-${j(t)||Math.random()}`}getPlatform(t,e){const s=this.getPlatformId(t);return et(e,s)}getPlatformId(t){return h(t,"platformId")||t.relationships?.platform?.data?.id||""}getPlatformName(t){return t&&h(t,"name")||"Unknown Platform"}getPlatformSymbol(t){return t&&h(t,"symbol")||""}getStatusColor(t){switch(t){case"pending":return"warning";case"approved":case"confirmed":case"completed":return"success";case"rejected":case"failed":case"cancelled":return"danger";default:return"secondary"}}renderPlatformIcon(t){const e=h(t,"iconUrl"),s=h(t,"iconClass"),r=h(t,"symbol");return e?m("img",{src:e,alt:r,className:"DepositHistory-platformImg"}):p(s||"fas fa-coins")}getStatusIcon(t){switch(t){case"pending":return p("fas fa-clock");case"approved":case"confirmed":return p("fas fa-check-circle");case"completed":return p("fas fa-check-double");case"rejected":case"failed":return p("fas fa-times-circle");case"cancelled":return p("fas fa-ban");default:return p("fas fa-question-circle")}}getStatusText(t){switch(t){case"pending":return"Pending";case"approved":return"Approved";case"confirmed":return"Confirmed";case"completed":return"Completed";case"rejected":return"Rejected";case"failed":return"Failed";case"cancelled":return"Cancelled";default:return"Unknown"}}}class ut extends N{constructor(){super(...arguments),this.handleOutsideClick=t=>{const e=this.element;e&&!e.contains(t.target)&&(this.state.showDropdown=!1,l.redraw())}}oninit(t){super.oninit(t),this.state={showDropdown:!1}}view(){const{selectedPlatform:t}=this.attrs,{showDropdown:e}=this.state;return l("div",{className:"DepositForm-platformSelector"},l("div",{className:"DepositForm-label"},i.translator.trans("funds.forum.deposit.platform_label")),l("div",{className:"DepositForm-platformDropdown",onclick:()=>this.toggleDropdown()},l("div",{className:"DepositForm-platformSelected"},l("div",{className:"DepositForm-platformInfo"},l("div",{className:"DepositForm-platformIcon"},this.renderPlatformIcon(t)),l("div",{className:"DepositForm-platformDetails"},l("div",{className:"DepositForm-platformName"},this.getPlatformDisplayName(t))))),p(A.CHEVRON_DOWN,{className:"DepositForm-dropdownIcon"})),e&&this.renderPlatformDropdown())}oncreate(t){super.oncreate(t),document.addEventListener("click",this.handleOutsideClick)}onremove(t){super.onremove(t),document.removeEventListener("click",this.handleOutsideClick)}toggleDropdown(){this.state.showDropdown=!this.state.showDropdown}getPlatformDisplayName(t){if(!t)return i.translator.trans("funds.forum.deposit.select_platform").toString();const e=h(t,"name")||"",s=h(t,"network");return s?`${e} (${s})`:e}renderPlatformIcon(t){if(!t)return p("fas fa-coins");const e=W(t);return H(e,"platform-icon-image")}renderPlatformDropdown(){const{platforms:t}=this.attrs,e=(t||[]).filter(s=>s&&h(s,"isActive"));return e.length===0?l("div",{className:"DepositForm-dropdownMenu"},l("div",{className:"DepositForm-dropdownItem DepositForm-noData"},i.translator.trans("funds.forum.deposit.no_platforms"))):l("div",{className:"DepositForm-dropdownMenu"},e.map(s=>l("div",{key:s.id(),className:"DepositForm-dropdownItem",onclick:()=>this.selectPlatform(s)},l("div",{className:"DepositForm-platformIcon"},this.renderPlatformIcon(s)),l("div",{className:"DepositForm-platformName"},this.getPlatformDisplayName(s)))))}selectPlatform(t){const{onPlatformSelect:e}=this.attrs;e(t),this.state.showDropdown=!1}}class ct extends N{view(t){const{address:e,loading:s,onCopy:r}=t.attrs;return m("div",{className:"AddressDisplay"},s?m("div",{className:"AddressDisplay-loading"},m("i",{className:"fas fa-spinner fa-spin"}),m("span",null,"Generating address...")):e?m("div",{className:"AddressDisplay-content"},m("div",{className:"AddressDisplay-address",title:e},e),m("div",{className:"AddressDisplay-actions"},m("button",{className:"AddressDisplay-copyBtn",onclick:r,title:"Copy address"},p("fas fa-copy")))):m("div",{className:"AddressDisplay-placeholder"},m("span",null,"No address available")))}}class ht extends N{view(t){const{platform:e,loading:s}=t.attrs;return m("div",{className:"ImageDisplay"},s?m("div",{className:"ImageDisplay-loading"},m("i",{className:"fas fa-spinner fa-spin"})):e&&e.qrCodeImageUrl()?m("img",{src:e.qrCodeImageUrl(),alt:`${e.name()} Image`,className:"ImageDisplay-image",onerror:"this.style.display='none'; this.nextElementSibling.style.display='block';"}):m("div",{className:"ImageDisplay-placeholder"},m("i",{className:"fas fa-image"}),m("div",null,"No Image")),m("div",{className:"ImageDisplay-error",style:{display:"none"}},m("i",{className:"fas fa-exclamation-triangle"}),m("div",null,"Image Load Failed")))}}class ft extends N{oninit(t){super.oninit(t);const e=new Date,s=new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString().slice(0,16);this.state={selectedPlatform:D(null),amount:D(""),depositTime:D(s),userMessage:D("")}}view(t){const{platforms:e,submitting:s}=t.attrs;return m("div",{className:"DepositForm"},m("form",{onsubmit:this.handleSubmit.bind(this),className:"DepositForm-form"},m("div",{className:"DepositForm-field"},m(ut,{platforms:e,selectedPlatform:this.state.selectedPlatform(),onPlatformSelect:r=>{this.state.selectedPlatform(r)}})),this.state.selectedPlatform()&&this.renderDepositInfo(),this.state.selectedPlatform()&&m("div",{className:"DepositForm-field"},m("label",{className:"DepositForm-label"},i.translator.trans("funds.forum.deposit.record.amount"),m("span",{className:"DepositForm-required"},"*")),m("input",{type:"number",step:"0.01",min:"0.01",className:"DepositForm-input",placeholder:i.translator.trans("funds.forum.deposit.record.amount_placeholder"),value:this.state.amount(),oninput:E("value",this.state.amount),required:!0,disabled:s}),m("div",{className:"DepositForm-help"},i.translator.trans("funds.forum.deposit.record.amount_help",{symbol:h(this.state.selectedPlatform(),"symbol")||""}))),this.state.selectedPlatform()&&m("div",{className:"DepositForm-field"},m("label",{className:"DepositForm-label"},i.translator.trans("funds.forum.deposit.record.deposit_time"),m("span",{className:"DepositForm-required"},"*")),m("input",{type:"datetime-local",className:"DepositForm-input",value:this.state.depositTime(),oninput:E("value",this.state.depositTime),required:!0,disabled:s}),m("div",{className:"DepositForm-help"},i.translator.trans("funds.forum.deposit.record.deposit_time_help"))),m("div",{className:"DepositForm-field"},m("label",{className:"DepositForm-label"},i.translator.trans("funds.forum.deposit.form.user_message"),m("span",{className:"DepositForm-optional"},"(",i.translator.trans("funds.forum.deposit.form.optional"),")")),m("textarea",{className:"DepositForm-textarea",placeholder:i.translator.trans("funds.forum.deposit.form.user_message_placeholder"),value:this.state.userMessage(),oninput:E("value",this.state.userMessage),rows:4,disabled:s}),m("div",{className:"DepositForm-help"},i.translator.trans("funds.forum.deposit.form.user_message_help"))),m("div",{className:"DepositForm-actions"},m(I,{type:"button",className:"Button Button--secondary DepositForm-cancelButton",onclick:()=>i.modal.close(),disabled:s},i.translator.trans("funds.forum.deposit.form.cancel")),m(I,{type:"submit",className:"Button Button--primary DepositForm-submitButton",loading:s,disabled:s},i.translator.trans("funds.forum.deposit.form.submit")))))}renderDepositInfo(){const t=this.state.selectedPlatform();if(!t)return null;const e=h(t,"address"),s=h(t,"minAmount")||0,r=h(t,"symbol"),o=h(t,"warningText");return m("div",{className:"DepositForm-depositInfo"},m("div",{className:"DepositForm-field"},m("label",{className:"DepositForm-label"},i.translator.trans("funds.forum.deposit.form.deposit_address")),m(ct,{address:e||"",loading:!1,onCopy:()=>{e&&navigator.clipboard.writeText(e).then(()=>{i.alerts.show({type:"success",dismissible:!0},i.translator.trans("funds.forum.deposit.address_copied"))}).catch(()=>{i.alerts.show({type:"error",dismissible:!0},i.translator.trans("funds.forum.deposit.copy_failed"))})}}),m("div",{className:"DepositForm-help"},i.translator.trans("funds.forum.deposit.form.deposit_address_help"))),s>0&&m("div",{className:"DepositForm-field"},m("div",{className:"DepositForm-minAmount"},"最少存款金额：",s," ",r)),m("div",{className:"DepositForm-field"},m(ht,{platform:t,loading:!1})),o&&m("div",{className:"DepositForm-field"},m("div",{className:"DepositForm-warning"},m("i",{className:"fas fa-info-circle"}),m("span",null,o))))}handleSubmit(t){t.preventDefault();const{onSubmit:e}=this.attrs;if(!this.state.selectedPlatform()){i.alerts.show({type:"error",dismissible:!0},i.translator.trans("funds.forum.deposit.form.validation.platform_required"));return}const s=parseFloat(this.state.amount());if(!this.state.amount()||isNaN(s)||s<=0){i.alerts.show({type:"error",dismissible:!0},i.translator.trans("funds.forum.deposit.record.validation.invalid_amount"));return}if(!this.state.depositTime()){i.alerts.show({type:"error",dismissible:!0},i.translator.trans("funds.forum.deposit.record.validation.deposit_time_required"));return}const r=this.state.selectedPlatform(),o=h(r,"minAmount")||0;if(o>0&&s<o){i.alerts.show({type:"error",dismissible:!0},i.translator.trans("funds.forum.deposit.record.validation.amount_too_low",{amount:s,min:o,symbol:h(r,"symbol")}));return}const f={selectedPlatform:this.state.selectedPlatform(),amount:s,depositTime:new Date(this.state.depositTime()),userMessage:this.state.userMessage()||void 0};e(f)}resetForm(){this.state.selectedPlatform(null),this.state.amount("");const t=new Date,e=new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,16);this.state.depositTime(e),this.state.userMessage("")}}class wt{async create(t){if(!t.selectedPlatform)throw new Error("Selected platform is required");const e=parseInt(t.selectedPlatform.id());if(!e)throw new Error("Platform ID is required");if(!t.amount||t.amount<=0)throw new Error("Amount is required and must be greater than 0");if(!t.depositTime)throw new Error("Deposit time is required");const s=await u.request({method:"POST",url:u.forum.attribute("apiUrl")+"/deposit-records",body:{data:{type:"deposit-records",attributes:{platformId:e,amount:t.amount,depositTime:t.depositTime.toISOString(),userMessage:t.userMessage}}}}),r=u.store.pushPayload(s);return Array.isArray(r)?r[0]:r}async getUserHistory(){const t=await u.request({method:"GET",url:u.forum.attribute("apiUrl")+"/deposit-records",params:{include:"user,processedByUser"}});return u.store.pushPayload(t)}async getAll(t={}){const e={include:"user,processedByUser"};Object.keys(t).length>0&&(e.filter=t);const s=await u.request({method:"GET",url:u.forum.attribute("apiUrl")+"/deposit-records",params:e});return u.store.pushPayload(s)}async update(t,e){const s=await u.request({method:"PATCH",url:`${u.forum.attribute("apiUrl")}/deposit-records/${t}`,body:{data:{type:"deposit-records",id:t,attributes:e}}}),r=u.store.pushPayload(s);return Array.isArray(r)?r[0]:r}async approve(t,e){return this.update(t,{status:"approved",adminNotes:e})}async reject(t,e){return this.update(t,{status:"rejected",adminNotes:e})}async find(t={}){const e={...t};e.include&&(e.include=e.include.split(",").filter(r=>r.trim()!=="platform").join(","),e.include||delete e.include);const s=await u.request({method:"GET",url:u.forum.attribute("apiUrl")+"/deposit-records",params:e});return u.store.pushPayload(s)}async delete(t){await u.request({method:"DELETE",url:`${u.forum.attribute("apiUrl")}/deposit-records/${t.id()}`}),u.store.remove(t)}}const O=new wt;var c=(a=>(a.NETWORK_ERROR="network_error",a.PERMISSION_DENIED="permission_denied",a.VALIDATION_ERROR="validation_error",a.NOT_FOUND="not_found",a.SERVER_ERROR="server_error",a.TIMEOUT="timeout",a))(c||{});class d extends Error{constructor(t,e="server_error",s,r){super(t),this.name="ServiceError",this.type=e,this.code=s,this.details=r}}class pt{constructor(){this.modelType="withdrawal-requests",this.platformModelType="withdrawal-platforms"}async find(t={}){try{const e={include:t.include||"user,platform",sort:t.sort||"-created_at",...t};return t.page&&(e.page=t.page),t.filter&&(e.filter=t.filter),await u.store.find(this.modelType,e)}catch(e){throw this.handleError(e,"Failed to fetch funds requests")}}async findById(t,e={}){try{const s={include:e.include||"user,platform"};return await u.store.find(this.modelType,String(t),s)}catch(s){if(this.isNotFoundError(s))return null;throw this.handleError(s,`Failed to fetch funds request ${t}`)}}async create(t){try{return this.validateCreateAttributes(t),await u.store.createRecord(this.modelType).save(t)}catch(e){throw this.handleError(e,"Failed to create funds request")}}async update(t,e){try{if(!this.canModify(t))throw new d("You do not have permission to modify this funds request",c.PERMISSION_DENIED);return await t.save(e)}catch(s){throw this.handleError(s,"Failed to update funds request")}}async delete(t){try{if(!this.canDelete(t))throw new d("You do not have permission to delete this funds request",c.PERMISSION_DENIED);await t.delete()}catch(e){throw this.handleError(e,"Failed to delete funds request")}}async submitRequest(t){try{await this.validateWithdrawalRequest(t);const e={platformId:t.platformId,amount:t.amount,accountDetails:t.accountDetails,message:t.message||"",status:"pending"};return await this.create(e)}catch(e){throw this.handleError(e,"Failed to submit funds request")}}async getUserHistory(t,e={}){const s=t||u.session.user?.id();if(!s)throw new d("User not authenticated",c.PERMISSION_DENIED);const r={...e,filter:{user:s,...e.filter},include:e.include||"platform",sort:e.sort||"-created_at"};return await this.find(r)}async getPendingRequests(t={}){if(!u.session.user?.isAdmin())throw new d("Admin permissions required",c.PERMISSION_DENIED);const e={...t,filter:{status:"pending",...t.filter},include:t.include||"user,platform",sort:t.sort||"created_at"};return await this.find(e)}async approve(t,e){if(!u.session.user?.isAdmin())throw new d("Admin permissions required",c.PERMISSION_DENIED);if(!t.isPending())throw new d("Only pending requests can be approved",c.VALIDATION_ERROR);const s={status:"approved"};return e&&(s.adminNote=e),await this.update(t,s)}async reject(t,e){if(!u.session.user?.isAdmin())throw new d("Admin permissions required",c.PERMISSION_DENIED);if(!t.isPending())throw new d("Only pending requests can be rejected",c.VALIDATION_ERROR);const s={status:"rejected"};return e&&(s.adminNote=e),await this.update(t,s)}async cancel(t){if(!t.canBeModified())throw new d("This request cannot be cancelled",c.VALIDATION_ERROR);const e=u.session.user;if(!e||String(t.userId())!==e.id()&&!e.isAdmin())throw new d("You can only cancel your own requests",c.PERMISSION_DENIED);return await this.delete(t)}canModify(t){const e=u.session.user;return e?e.isAdmin()?!0:String(t.userId())===e.id()&&t.canBeModified():!1}canCreate(){return!!u.session.user}canDelete(t){const e=u.session.user;return e?e.isAdmin()?!0:String(t.userId())===e.id()&&t.canBeModified():!1}async getPlatforms(){try{return await u.store.find(this.platformModelType)}catch(t){throw this.handleError(t,"Failed to fetch funds platforms")}}async validateWithdrawalRequest(t){const{platformId:e,amount:s}=t,r=await u.store.find(this.platformModelType,String(e));if(!r)throw new d("Invalid platform selected",c.VALIDATION_ERROR);if(!r.isActive?.())throw new d("Selected platform is not available",c.VALIDATION_ERROR);const o=r.minAmount?.()||0,f=r.maxAmount?.();if(s<o)throw new d(`Minimum funds amount is ${o}`,c.VALIDATION_ERROR);if(f&&s>f)throw new d(`Maximum funds amount is ${f}`,c.VALIDATION_ERROR);const g=u.session.user;if(g){const w=parseFloat(g.attribute("money")||"0"),y=r.fee?.()||0,F=s+y;if(w<F)throw new d(`Insufficient balance. Required: ${F}, Available: ${w}`,c.VALIDATION_ERROR)}}validateCreateAttributes(t){const e=["platformId","amount","accountDetails"];for(const s of e)if(!t[s])throw new d(`${s} is required`,c.VALIDATION_ERROR);if(typeof t.amount!="number"||t.amount<=0)throw new d("Amount must be a positive number",c.VALIDATION_ERROR)}handleError(t,e){if(t instanceof d)return t;if(t.response&&t.response.errors){const s=t.response.errors[0];return new d(s.detail||e,c.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new d("Network error occurred",c.NETWORK_ERROR):new d(t.message||e,c.SERVER_ERROR)}isNotFoundError(t){return t.status===404||t.response?.status===404||t.message?.includes("not found")}}const x=new pt;class gt{constructor(){this.withdrawalModelType="withdrawal-platforms",this.depositModelType="deposit-platforms"}async find(t,e={}){const s=t==="withdrawal"?this.withdrawalModelType:this.depositModelType;try{const r={sort:e.sort||"name",...e};e.page&&(r.page=e.page),e.filter&&(r.filter=e.filter),e.include&&(r.include=e.include);const o=await u.store.find(s,r);return Array.isArray(o)?o:[o]}catch(r){throw this.handleError(r,`Failed to fetch ${t} platforms`)}}async findById(t,e,s={}){const r=t==="withdrawal"?this.withdrawalModelType:this.depositModelType;try{const o={};return s.include&&(o.include=s.include),await u.store.find(r,String(e),o)}catch(o){if(this.isNotFoundError(o))return null;throw this.handleError(o,`Failed to fetch ${t} platform ${e}`)}}async create(t,e){const s=t==="withdrawal"?this.withdrawalModelType:this.depositModelType;try{return this.validateCreateAttributes(t,e),await u.store.createRecord(s).save(e)}catch(r){throw this.handleError(r,`Failed to create ${t} platform`)}}async update(t,e){try{if(!this.canModify(t))throw new d("You do not have permission to modify this platform",c.PERMISSION_DENIED);return await t.save(e)}catch(s){throw this.handleError(s,"Failed to update platform")}}async delete(t){try{if(!this.canDelete(t))throw new d("You do not have permission to delete this platform",c.PERMISSION_DENIED);await t.delete()}catch(e){throw this.handleError(e,"Failed to delete platform")}}async getActive(t,e={}){const s={...e,filter:{isActive:!0,...e.filter}};return await this.find(t,s)}async toggleStatus(t){if(!u.session.user?.isAdmin())throw new d("Admin permissions required",c.PERMISSION_DENIED);const e=t.isActive();return await this.update(t,{isActive:!e})}async updateConfig(t,e){if(!u.session.user?.isAdmin())throw new d("Admin permissions required",c.PERMISSION_DENIED);return await this.update(t,e)}async getBySymbol(t,e){return await this.find(e,{filter:{symbol:t},sort:"name"})}validateAmount(t,e){const s=[];if(typeof e!="number"||e<=0)return s.push("Amount must be a positive number"),{valid:!1,errors:s};const r=t.minAmount?t.minAmount():0,o=t.maxAmount?t.maxAmount():null;return e<r&&s.push(`Amount must be at least ${r}`),o&&e>o&&s.push(`Amount cannot exceed ${o}`),{valid:s.length===0,errors:s}}async getPlatformStats(t,e){if(!u.session.user?.isAdmin())throw new d("Admin permissions required",c.PERMISSION_DENIED);const s=t==="withdrawal"?"withdrawal-requests":"deposit-records";try{const r=t==="withdrawal"?"platform":"user,processedByUser",o=await u.store.find(s,{filter:{platform:e.toString()},include:r}),f=Array.isArray(o)?o:[o];return{total:f.length,pending:f.filter(w=>w.status()==="pending").length,approved:f.filter(w=>{if(t==="withdrawal")return w.status()==="approved";{const y=w.status();return y==="approved"||y==="confirmed"}}).length,rejected:f.filter(w=>w.status()==="rejected").length,totalAmount:f.reduce((w,y)=>t==="withdrawal"?w+(y.amount()||0):w,0)}}catch(r){throw this.handleError(r,"Failed to fetch platform statistics")}}async getPlatformsBySymbolGrouped(t){const e=await this.getActive(t),s={};for(const r of e){const o=r.symbol();s[o]||(s[o]=[]),s[o].push(r)}return s}async getSortedPlatforms(t,e="name",s="asc"){const r=s==="desc"?`-${e}`:e;return await this.getActive(t,{sort:r})}canModify(t){const e=u.session.user;return!!(e&&e.isAdmin())}canCreate(){const t=u.session.user;return!!(t&&t.isAdmin())}canDelete(t){const e=u.session.user;return!!(e&&e.isAdmin())}validateCreateAttributes(t,e){const r=["name","symbol","minAmount"];for(const o of r)if(!e[o])throw new d(`${o} is required for ${t} platforms`,c.VALIDATION_ERROR);if(typeof e.minAmount!="number"||e.minAmount<0)throw new d("minAmount must be a non-negative number",c.VALIDATION_ERROR);if(e.maxAmount!==void 0&&(typeof e.maxAmount!="number"||e.maxAmount<e.minAmount))throw new d("maxAmount must be a number greater than or equal to minAmount",c.VALIDATION_ERROR);if(e.fee!==void 0&&(typeof e.fee!="number"||e.fee<0))throw new d("fee must be a non-negative number",c.VALIDATION_ERROR);if(typeof e.symbol!="string"||!e.symbol.trim())throw new d("Symbol is required",c.VALIDATION_ERROR)}handleError(t,e){if(t instanceof d)return t;if(t.response&&t.response.errors){const s=t.response.errors[0];return new d(s.detail||e,c.VALIDATION_ERROR,s.code,s)}return t.name==="TypeError"||t.message?.includes("fetch")?new d("Network error occurred",c.NETWORK_ERROR):new d(t.message||e,c.SERVER_ERROR)}isNotFoundError(t){return t.status===404||t.response?.status===404||t.message?.includes("not found")}}const z=new gt;function Y(a,t="An error occurred"){if(!a)return t;if(a.response&&a.response.errors&&Array.isArray(a.response.errors)){const e=a.response.errors[0];if(e&&e.detail)return e.detail}if(a.responseText){if(a.responseText.includes("<b>Fatal error</b>")||a.responseText.includes("<!DOCTYPE"))return"Server error occurred. Please try again later.";try{const e=JSON.parse(a.responseText);if(e.errors&&Array.isArray(e.errors))return e.errors[0].detail||t}catch{return"Server error occurred. Please try again later."}}return t}class _ extends tt{constructor(){super(...arguments),this.state={withdrawalPlatforms:[],withdrawalRequests:[],userBalance:0,loadingBalance:!0,submitting:!1,depositPlatforms:[],depositRecords:[],submittingDeposit:!1,loading:!0,activeTab:D("deposit")},this.withdrawalFormData={amount:D(""),selectedPlatform:D(null),accountDetails:D(""),message:D("")}}oninit(t){super.oninit(t);const s=new URLSearchParams(window.location.search).get("tab");s&&(s==="withdrawal-history"||s==="deposit-history"?this.state.activeTab("history"):this.isValidTab(s)&&this.state.activeTab(s)),this.updatePageTitle(),this.loadAllData()}isValidTab(t){return["withdrawal","deposit","history"].includes(t)}updateUrl(){const t=this.state.activeTab(),e=new URLSearchParams;e.set("tab",t);const s=`${window.location.pathname}?${e.toString()}`;window.history.replaceState({},"",s)}updatePageTitle(){const t=this.state.activeTab();let e="funds.forum.page.title";switch(t){case"withdrawal":e="funds.forum.page.title";break;case"deposit":e="funds.forum.deposit.page.title";break;case"history":e="funds.forum.history.page.title";break}const s=i.translator.trans(e);i.setTitle(typeof s=="string"?s:s.toString())}view(){return this.state.loading?l("div",{className:"FundsPage"},l("div",{className:"FundsPage-loading"},l(L,null))):l("div",{className:"FundsPage"},l("div",{className:"FundsPage-modal"},this.renderHeader(),l("div",{className:"FundsPage-content"},this.renderActiveTab())))}renderHeader(){const t=this.state.activeTab();return l("div",{className:"FundsPage-header"},l("div",{className:"FundsPage-tabs"},l("div",{className:`FundsPage-tab ${t==="deposit"?"active":""}`,onclick:()=>this.handleTabChange("deposit")},i.translator.trans("funds.forum.deposit.tabs.deposit")),l("div",{className:`FundsPage-tab ${t==="withdrawal"?"active":""}`,onclick:()=>this.handleTabChange("withdrawal")},i.translator.trans("funds.forum.tabs.funds")),l("div",{className:`FundsPage-tab ${t==="history"?"active":""}`,onclick:()=>this.handleTabChange("history")},i.translator.trans("funds.forum.tabs.history"))),l(I,{className:"FundsPage-close",icon:"fas fa-times",onclick:()=>i.history.back()}))}renderActiveTab(){switch(this.state.activeTab()){case"withdrawal":return this.renderWithdrawalTab();case"deposit":return this.renderDepositTab();case"history":return this.renderHistoryTab();default:return this.renderWithdrawalTab()}}renderWithdrawalTab(){return this.renderWithdrawalForm()}renderWithdrawalForm(){return(this.state.withdrawalPlatforms||[]).filter(e=>!!e).length===0?l("div",{className:"FundsPage-withdrawalContent"},l("div",{className:"FundsPage-emptyState"},l("div",{className:"FundsPage-emptyIcon"},p("fas fa-coins")),l("h3",{className:"FundsPage-emptyTitle"},i.translator.trans("funds.forum.no_platforms")),l("p",{className:"FundsPage-emptyDescription"},i.translator.trans("funds.forum.no_platforms_description")))):l("div",{className:"FundsPage-withdrawalContent"},l(ot,{platforms:this.state.withdrawalPlatforms,formData:this.getWithdrawalFormDataForComponent(),loadingBalance:this.state.loadingBalance,submitting:this.state.submitting,onFormDataChange:this.handleWithdrawalFormDataChange.bind(this),onFillAllAmount:this.handleFillAllAmount.bind(this),onSubmit:this.handleWithdrawalSubmit.bind(this)}))}renderWithdrawalHistory(){return l("div",{className:"FundsPage-withdrawalContent"},l(R,{transactions:this.state.withdrawalRequests,platforms:this.state.withdrawalPlatforms,loading:!1,type:"withdrawal"}))}renderDepositTab(){return this.renderDepositForm()}renderDepositForm(){return l("div",{className:"FundsPage-depositContent"},l(ft,{platforms:this.state.depositPlatforms,onSubmit:this.handleDepositSubmit.bind(this),onCancel:this.handleCancelDepositForm.bind(this),submitting:this.state.submittingDeposit}))}renderDepositHistory(){return l("div",{className:"FundsPage-depositContent"},l(R,{transactions:this.state.depositRecords,platforms:this.state.depositPlatforms,loading:!1,type:"deposit"}))}renderHistoryTab(){const t=this.state.withdrawalRequests||[],e=this.state.depositRecords||[],s=t.length>0,r=e.length>0;return!s&&!r?l("div",{className:"FundsPage-historyContent"},l("div",{className:"FundsPage-emptyState"},l("div",{className:"FundsPage-emptyIcon"},p("fas fa-history")),l("h3",{className:"FundsPage-emptyTitle"},i.translator.trans("funds.forum.history.empty.title")),l("p",{className:"FundsPage-emptyDescription"},i.translator.trans("funds.forum.history.empty.description")))):l("div",{className:"FundsPage-historyContent"},s&&l("div",{className:"FundsPage-historySection"},l(R,{transactions:t,platforms:this.state.withdrawalPlatforms,loading:!1,type:"withdrawal"})),r&&l("div",{className:"FundsPage-historySection"},l(R,{transactions:e,platforms:this.state.depositPlatforms,loading:!1,type:"deposit"})))}handleTabChange(t){this.state.activeTab(t),this.updatePageTitle(),this.updateUrl()}getWithdrawalFormDataForComponent(){return{selectedPlatform:this.withdrawalFormData.selectedPlatform(),amount:this.withdrawalFormData.amount(),accountDetails:this.withdrawalFormData.accountDetails(),message:this.withdrawalFormData.message()}}handleWithdrawalFormDataChange(t){t.selectedPlatform!==void 0&&this.withdrawalFormData.selectedPlatform(t.selectedPlatform),t.amount!==void 0&&this.withdrawalFormData.amount(t.amount),t.accountDetails!==void 0&&this.withdrawalFormData.accountDetails(t.accountDetails),t.message!==void 0&&this.withdrawalFormData.message(t.message)}async handleFillAllAmount(){const t=this.withdrawalFormData.selectedPlatform();if(t&&!this.state.loadingBalance)try{await this.loadUserBalance(!0);const e=h(t,"fee")||0,s=h(t,"maxAmount")||1/0;let r=this.state.userBalance-e;s<1/0&&r>s&&(r=s),r>0?this.withdrawalFormData.amount(r.toString()):i.alerts.show({type:"warning",dismissible:!0},i.translator.trans("funds.forum.insufficient_balance"))}catch(e){console.error("Error refreshing balance:",e),i.alerts.show({type:"error",dismissible:!0},i.translator.trans("funds.forum.balance_refresh_error"))}}async handleWithdrawalSubmit(){if(this.state.submitting)return;const t=this.withdrawalFormData.selectedPlatform(),e=this.withdrawalFormData.amount(),s=this.withdrawalFormData.accountDetails();if(!t||!e||!s)return;const r=parseFloat(e);if(isNaN(r)||r<=0){i.alerts.show({type:"warning",dismissible:!0},i.translator.trans("funds.forum.invalid_amount"));return}this.state.submitting=!0;try{await x.submitRequest({platformId:parseInt(j(t),10),amount:r,accountDetails:s,message:this.withdrawalFormData.message()}),this.withdrawalFormData.amount(""),this.withdrawalFormData.accountDetails(""),this.withdrawalFormData.message(""),this.withdrawalFormData.selectedPlatform(null),await Promise.all([this.loadUserBalance(!0),this.loadWithdrawalRequests()]),i.alerts.show({type:"success",dismissible:!0},i.translator.trans("funds.forum.submit_success"))}catch(o){console.error("Withdrawal request failed:",o);let f=i.translator.trans("funds.forum.error").toString();o instanceof d?f=o.message:f=Y(o,f),i.alerts.show({type:"error",dismissible:!0},f)}finally{this.state.submitting=!1}}handleCancelDepositForm(){l.redraw()}async handleDepositSubmit(t){if(!this.state.submittingDeposit){this.state.submittingDeposit=!0,l.redraw();try{await O.create(t),i.alerts.show({type:"success",dismissible:!0},i.translator.trans("funds.forum.deposit.form.submit_success")),await this.loadDepositRecords(),this.state.activeTab("history")}catch(e){console.error("Deposit submission failed:",e);let s=i.translator.trans("funds.forum.deposit.form.submit_error").toString();e instanceof d?s=e.message:s=Y(e,s),i.alerts.show({type:"error",dismissible:!0},s)}finally{this.state.submittingDeposit=!1,l.redraw()}}}async loadAllData(){try{await Promise.all([this.loadWithdrawalData(),this.loadDepositData(),this.loadUserBalance()]),this.state.loading=!1,l.redraw()}catch(t){console.error("Error loading data:",t),this.state.loading=!1,l.redraw()}}async loadWithdrawalData(){try{const[t,e]=await Promise.all([z.getActive("withdrawal"),x.getUserHistory()]);this.state.withdrawalPlatforms=t,this.state.withdrawalRequests=e}catch(t){console.error("Error loading withdrawal data:",t),this.state.withdrawalPlatforms=[],this.state.withdrawalRequests=[]}}async loadDepositData(){try{const[t,e]=await Promise.all([z.getActive("deposit"),O.getUserHistory()]);this.state.depositPlatforms=t,this.state.depositRecords=e}catch(t){console.error("Error loading deposit data:",t),this.state.depositPlatforms=[],this.state.depositRecords=[]}}async loadDepositRecords(){try{const t=await O.getUserHistory();this.state.depositRecords=t}catch(t){console.error("Error loading deposit records:",t),this.state.depositRecords=[]}}async loadUserBalance(t=!1){try{if(this.state.loadingBalance=!0,t&&i.session.user){const e=i.session.user.id();if(!e)throw new Error("User ID not available");const s=await i.store.find("users",e);s?this.state.userBalance=parseFloat(s.attribute("money"))||0:this.state.userBalance=0}else this.state.userBalance=parseFloat(i.session.user?.attribute("money")||"0");this.state.loadingBalance=!1,l.redraw()}catch(e){console.error("Error loading user balance:",e),this.state.loadingBalance=!1,l.redraw()}}async loadWithdrawalRequests(){try{const t=await x.getUserHistory();this.state.withdrawalRequests=t}catch(t){console.error("Error loading withdrawal requests:",t),this.state.withdrawalRequests=[]}}}function G(a){const t=[];return a.name!==void 0&&(!a.name||typeof a.name!="string")&&t.push("Platform name is required"),a.symbol!==void 0&&(!a.symbol||typeof a.symbol!="string")&&t.push("Symbol is required"),t}function J(a,t){const e=[];if(a.minAmount!==void 0&&(typeof a.minAmount!="number"||a.minAmount<0)&&e.push("Minimum amount must be a non-negative number"),a.maxAmount!==void 0&&a.maxAmount!==null){(typeof a.maxAmount!="number"||a.maxAmount<0)&&e.push("Maximum amount must be a non-negative number");const s=a.minAmount??t??0;a.maxAmount<s&&e.push("Maximum amount must be greater than or equal to minimum amount")}return a.fee!==void 0&&a.fee!==null&&(typeof a.fee!="number"||a.fee<0)&&e.push("Fee must be a non-negative number"),e}function yt(a){const t=[];return a.network!==void 0&&a.network!==null&&a.network!==""&&typeof a.network!="string"&&t.push("Network must be a string"),a.address!==void 0&&a.address!==null&&a.address!==""&&typeof a.address!="string"&&t.push("Deposit address must be a string"),t}function K(a){if(a.length>0)throw new d(a.join(", "),c.VALIDATION_ERROR)}function Nt(a,t){const e=[...G(a),...J(a,t)];K(e)}function Dt(a,t){const e=[...G(a),...J(a,t),...yt(a)];K(e)}class vt extends n{constructor(){super(...arguments),this.name=n.attribute("name"),this.symbol=n.attribute("symbol"),this.network=n.attribute("network"),this.displayName=n.attribute("displayName"),this.minAmount=n.attribute("minAmount"),this.maxAmount=n.attribute("maxAmount"),this.fee=n.attribute("fee"),this.platformIconUrl=n.attribute("platformIconUrl"),this.platformIconClass=n.attribute("platformIconClass"),this.isActive=n.attribute("isActive"),this.createdAt=n.attribute("createdAt",n.transformDate),this.updatedAt=n.attribute("updatedAt",n.transformDate),this.bestIcon=n.attribute("bestIcon")}apiEndpoint(){const t=this.id();return t?`/withdrawal-platforms/${t}`:"/withdrawal-platforms"}getDisplayName(){return this.displayName()||this.name()}isValidAmount(t){const e=this.minAmount(),s=this.maxAmount();return t>=e&&t<=s}getTotalCost(t){return t+this.fee()}async save(t){t&&this.validateAttributes(t);try{return await super.save(t||{})}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new d("You do not have permission to delete this platform",c.PERMISSION_DENIED);if(await this.isInUse())throw new d("Cannot delete platform that has pending funds requests",c.VALIDATION_ERROR);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}async toggleStatus(){if(!this.canModify())throw new d("You do not have permission to modify this platform",c.PERMISSION_DENIED);return await this.save({isActive:!this.isActive()})}clone(){const t=u.store.createRecord("withdrawal-platforms");return t.pushAttributes({name:this.name()+" (Copy)",symbol:this.symbol(),network:this.network(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),platformIconUrl:this.platformIconUrl(),platformIconClass:this.platformIconClass(),isActive:!1}),t}validateAmount(t){const e=[];return typeof t!="number"||t<=0?(e.push("Amount must be a positive number"),{valid:!1,errors:e}):(t<this.minAmount()&&e.push(`Amount must be at least ${this.minAmount()} ${this.symbol()}`),this.maxAmount()&&t>this.maxAmount()&&e.push(`Amount cannot exceed ${this.maxAmount()} ${this.symbol()}`),{valid:e.length===0,errors:e})}validateUserBalance(t,e){const s=[],r=this.getTotalCost(t);if(e<r){const o=this.fee()>0?` (including ${this.fee()} ${this.symbol()} fee)`:"";s.push(`Insufficient balance. Required: ${r} ${this.symbol()}${o}, Available: ${e} ${this.symbol()}`)}return{valid:s.length===0,errors:s}}canModify(){const t=u.session.user;return!!(t&&t.isAdmin())}canDelete(){const t=u.session.user;return!!(t&&t.isAdmin())}canView(){if(this.isActive())return!0;const t=u.session.user;return!!(t&&t.isAdmin())}async isInUse(){try{const t=this.id();if(!t)return!1;const e=await u.store.find("withdrawal-requests",{filter:{platform:t,status:"pending"}});return(Array.isArray(e)?e:[e]).length>0}catch{return!0}}getFormattedFee(){const t=this.fee();return t===0?"Free":`${t} ${this.symbol()}`}getFormattedLimits(){const t=this.minAmount(),e=this.maxAmount(),s=this.symbol();return e?`${t} - ${e} ${s}`:`Min: ${t} ${s}`}validateAttributes(t){Nt(t,this.minAmount())}handleSaveError(t){if(t instanceof d)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new d(e.detail||"Failed to save withdrawal platform",c.VALIDATION_ERROR,e.code,e)}return new d(t.message||"Failed to save withdrawal platform",c.SERVER_ERROR)}handleDeleteError(t){return t instanceof d?t:t.status===403||t.response?.status===403?new d("You do not have permission to delete this platform",c.PERMISSION_DENIED):new d(t.message||"Failed to delete withdrawal platform",c.SERVER_ERROR)}}const b={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class At extends n{constructor(){super(...arguments),this.amount=n.attribute("amount"),this.accountDetails=n.attribute("accountDetails"),this.message=n.attribute("message"),this.status=n.attribute("status"),this.platformId=n.attribute("platformId"),this.userId=n.attribute("userId"),this.createdAt=n.attribute("createdAt",t=>n.transformDate(t)),this.updatedAt=n.attribute("updatedAt",t=>n.transformDate(t)),this.user=n.hasOne("user"),this.platform=n.hasOne("platform")}apiEndpoint(){const t=this.id();return t?`/withdrawal-requests/${t}`:"/withdrawal-requests"}isPending(){return this.status()===b.PENDING}isApproved(){return this.status()===b.APPROVED}isRejected(){return this.status()===b.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const t=this.status();return u.translator.trans(`funds.forum.status.${t}`).toString()}statusColor(){switch(this.status()){case b.APPROVED:return"success";case b.REJECTED:return"danger";case b.PENDING:default:return"warning"}}async save(t){t&&this.validateAttributes(t);try{return await super.save(t||{})}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new d("You do not have permission to delete this request",c.PERMISSION_DENIED);const t=u.session.user;if(t&&!t.isAdmin()&&!this.canBeModified())throw new d("This request cannot be deleted as it has already been processed",c.VALIDATION_ERROR);try{await super.delete()}catch(e){throw this.handleDeleteError(e)}}clone(){const t=u.store.createRecord("withdrawal-requests");return t.pushAttributes({platformId:this.platformId(),amount:this.amount(),accountDetails:this.accountDetails(),message:this.message()}),t}getTotalCost(){const t=this.platform(),e=t&&t.fee()||0;return this.amount()+e}getFormattedAmount(){const t=this.platform(),e=t?t.symbol():"";return`${this.amount()} ${e}`.trim()}getFormattedTotalCost(){const t=this.platform(),e=t?t.symbol():"",s=t&&t.fee()||0;return s>0?`${this.amount()} + ${s} (fee) = ${this.getTotalCost()} ${e}`.trim():this.getFormattedAmount()}canModify(){const t=u.session.user;return t?t.isAdmin()?!0:String(this.userId())===t.id()&&this.canBeModified():!1}canDelete(){const t=u.session.user;return t?t.isAdmin()?!0:String(this.userId())===t.id()&&this.canBeModified():!1}canView(){const t=u.session.user;return t?t.isAdmin()?!0:String(this.userId())===t.id():!1}validateAttributes(t){const e=[];if(t.amount!==void 0&&(typeof t.amount!="number"||t.amount<=0)&&e.push("Amount must be a positive number"),t.accountDetails!==void 0&&(!t.accountDetails||typeof t.accountDetails!="string")&&e.push("Account details are required"),t.platformId!==void 0&&(!t.platformId||typeof t.platformId!="number")&&e.push("Platform selection is required"),e.length>0)throw new d(e.join(", "),c.VALIDATION_ERROR)}handleSaveError(t){if(t instanceof d)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new d(e.detail||"Failed to save funds request",c.VALIDATION_ERROR,e.code,e)}return new d(t.message||"Failed to save funds request",c.SERVER_ERROR)}handleDeleteError(t){return t instanceof d?t:t.status===403||t.response?.status===403?new d("You do not have permission to delete this request",c.PERMISSION_DENIED):new d(t.message||"Failed to delete funds request",c.SERVER_ERROR)}}class bt extends n{constructor(){super(...arguments),this.name=n.attribute("name"),this.symbol=n.attribute("symbol"),this.network=n.attribute("network"),this.networkTypeId=n.attribute("networkTypeId"),this.displayName=n.attribute("displayName"),this.minAmount=n.attribute("minAmount"),this.maxAmount=n.attribute("maxAmount"),this.fee=n.attribute("fee"),this.address=n.attribute("address"),this.qrCodeImageUrl=n.attribute("qrCodeImageUrl"),this.platformIconUrl=n.attribute("platformIconUrl"),this.platformIconClass=n.attribute("platformIconClass"),this.warningText=n.attribute("warningText"),this.networkConfig=n.attribute("networkConfig"),this.isActive=n.attribute("isActive"),this.createdAt=n.attribute("createdAt",t=>n.transformDate(t)),this.updatedAt=n.attribute("updatedAt",t=>n.transformDate(t)),this.networkType=n.hasOne("networkType"),this.bestIcon=n.attribute("bestIcon")}getDisplayName(){return this.displayName()||this.name()}getFullDisplayName(){const t=this.getDisplayName(),e=this.network();return e?`${t} (${e})`:t}isValidAmount(t){const e=this.minAmount()||0,s=this.maxAmount();return t>=e&&(!s||t<=s)}getTotalCost(t){return t+(this.fee()||0)}async save(t){t&&this.validateAttributes(t);try{return await super.save(t||{})}catch(e){throw this.handleSaveError(e)}}async delete(){if(!this.canDelete())throw new d("You do not have permission to delete this platform",c.PERMISSION_DENIED);if(await this.isInUse())throw new d("Cannot delete platform that has pending deposit records",c.VALIDATION_ERROR);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}async toggleStatus(){if(!this.canModify())throw new d("You do not have permission to modify this platform",c.PERMISSION_DENIED);return await this.save({isActive:!this.isActive()})}clone(){const t=u.store.createRecord("deposit-platforms");return t.pushAttributes({name:this.name()+" (Copy)",symbol:this.symbol(),network:this.network(),networkTypeId:this.networkTypeId(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),address:this.address(),qrCodeImageUrl:this.qrCodeImageUrl(),platformIconUrl:this.platformIconUrl(),platformIconClass:this.platformIconClass(),warningText:this.warningText(),isActive:!1}),t}validateAmount(t){const e=[];if(typeof t!="number"||t<=0)return e.push("Amount must be a positive number"),{valid:!1,errors:e};const s=this.minAmount()||0;t<s&&e.push(`Amount must be at least ${s} ${this.symbol()}`);const r=this.maxAmount();return r&&t>r&&e.push(`Amount cannot exceed ${r} ${this.symbol()}`),{valid:e.length===0,errors:e}}canModify(){const t=u.session.user;return!!(t&&t.isAdmin())}canDelete(){const t=u.session.user;return!!(t&&t.isAdmin())}canView(){if(this.isActive())return!0;const t=u.session.user;return!!(t&&t.isAdmin())}async isInUse(){try{const t=this.id();if(!t)return!1;const e=await u.store.find("deposit-records",{filter:{platform:t.toString(),status:"pending"}});return(Array.isArray(e)?e:[e]).length>0}catch{return!0}}getFormattedFee(){const t=this.fee()||0;return t===0?"Free":`${t} ${this.symbol()}`}getFormattedLimits(){const t=this.minAmount()||0,e=this.maxAmount(),s=this.symbol();return e?`${t} - ${e} ${s}`:`Min: ${t} ${s}`}generateDepositAddress(t){const e=this.address();if(e&&typeof e=="string")return e;throw new d("No deposit address configured for this platform",c.VALIDATION_ERROR)}validateAttributes(t){Dt(t,this.minAmount()||void 0)}handleSaveError(t){if(t instanceof d)return t;if(t.response&&t.response.errors){const e=t.response.errors[0];return new d(e.detail||"Failed to save deposit platform",c.VALIDATION_ERROR,e.code,e)}return new d(t.message||"Failed to save deposit platform",c.SERVER_ERROR)}handleDeleteError(t){return t instanceof d?t:t.status===403||t.response?.status===403?new d("You do not have permission to delete this platform",c.PERMISSION_DENIED):new d(t.message||"Failed to delete deposit platform",c.SERVER_ERROR)}}class Pt extends n{constructor(){super(...arguments),this.userId=n.attribute("userId"),this.platformId=n.attribute("platformId"),this.amount=n.attribute("amount"),this.depositTime=n.attribute("depositTime",n.transformDate),this.userMessage=n.attribute("userMessage"),this.status=n.attribute("status"),this.statusText=n.attribute("statusText"),this.processedAt=n.attribute("processedAt",n.transformDate),this.processedBy=n.attribute("processedBy"),this.adminNotes=n.attribute("adminNotes"),this.createdAt=n.attribute("createdAt",n.transformDate),this.updatedAt=n.attribute("updatedAt",n.transformDate),this.formattedCreatedAt=n.attribute("formattedCreatedAt"),this.formattedProcessedAt=n.attribute("formattedProcessedAt"),this.isPending=n.attribute("isPending"),this.isApproved=n.attribute("isApproved"),this.isRejected=n.attribute("isRejected"),this.user=n.hasOne("user"),this.processedByUser=n.hasOne("processedByUser"),this.platform=n.hasOne("platform")}getStatusColor(){switch(this.status()){case"pending":return"warning";case"approved":return"success";case"rejected":return"danger";default:return"secondary"}}getStatusIcon(){switch(this.status()){case"pending":return"fas fa-clock";case"approved":return"fas fa-check-circle";case"rejected":return"fas fa-times-circle";default:return"fas fa-question-circle"}}canEdit(t){return t?t.isAdmin()?!0:this.userId().toString()===t.id()&&this.isPending():!1}canDelete(t){return t&&t.isAdmin()||!1}getFormattedAmount(){const t=this.amount();return t?t.toFixed(2):"0.00"}getFormattedDepositTime(){const t=this.depositTime();return t?t.toLocaleDateString()+" "+t.toLocaleTimeString():""}}class It extends N{view(){if(!i.session.user)return null;const e=(i.forum.attribute("antoinefr-money.moneyname")||"[money]").replace("[money]",i.session.user.attribute("money")),s=i.forum.attribute("wusong8899-funds.moneyIconUrl");return m("div",{id:"moneyDisplayContainer",className:"client1-header-adv-wrapper clientCustomizeWithdrawalHeaderTotalMoney"},m("div",{className:"clientCustomizeWithdrawalHeaderText"},s&&s.trim()&&m("span",{style:{borderRadius:"50%",padding:"6px 8px",marginRight:"8px",display:"inline-flex",alignItems:"center",justifyContent:"center"}},m("img",{src:s,alt:"Money icon",style:{width:"20px",height:"20px"},onError:r=>{const o=r.target;o.style.display="none"}})),e),m("div",{className:"clientCustomizeWithdrawalHeaderIcon"},m("i",{className:"fas fa-wallet"})),m("div",{className:"clientCustomizeWithdrawalButtons"},m("div",{className:"clientCustomizeWithdrawalButton",onclick:this.handleWithdrawalClick.bind(this),title:"提款"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",{style:{marginLeft:"4px",fontSize:"12px"}},"提款")),m("div",{className:"clientCustomizeDepositButton",onclick:this.handleDepositClick.bind(this),title:"存款",style:{marginLeft:"8px"}},m("i",{className:"fas fa-coins"}),m("span",{style:{marginLeft:"4px",fontSize:"12px"}},"存款"))))}handleWithdrawalClick(t){t.preventDefault(),t.stopPropagation(),window.location.href="/funds?tab=funds"}handleDepositClick(t){t.preventDefault(),t.stopPropagation(),window.location.href="/funds?tab=deposit"}}class Ft extends N{view(){const t=i.session.user?.attribute("money")||0,e=i.forum.attribute("wusong8899-funds.moneyIconUrl");return m("div",{className:"Navigation-mobileMoneyDisplay"},m("div",{className:"Navigation-moneySection",onclick:this.handleWithdrawalClick.bind(this),title:`余额: ${t} - 点击提款`},m("div",{className:"Navigation-moneyText"},e&&e.trim()&&m("span",{style:{borderRadius:"50%",padding:"4px 6px",marginRight:"6px",display:"inline-flex",alignItems:"center",justifyContent:"center"}},m("img",{src:e,alt:"Money icon",style:{width:"18px",height:"18px"},onError:s=>{const r=s.target;r.style.display="none"}})),m("span",{className:"Navigation-moneyAmount"},t)),m("div",{className:"Navigation-withdrawalButton"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",null,"提款"))))}handleWithdrawalClick(t){t.preventDefault(),t.stopPropagation(),console.log("MobileMoneyDisplay clicked!");try{window.location.href="/funds?tab=funds"}catch(e){console.error("Navigation error:",e),window.location.href="/funds?tab=funds"}}}class P{constructor(){}static getInstance(){return P.instance||(P.instance=new P),P.instance}isTagsPage(){try{return i.current?.get("routeName")==="index"}catch{return!1}}}function C(){return window.innerWidth<=767}function q(){return window.innerWidth>=768&&window.innerWidth<=1024}function Rt(){return window.innerWidth>1024}function Et(){return C()||q()}function St(){return C()?"mobile":q()?"tablet":"desktop"}function Tt(){return"ontouchstart"in window||navigator.maxTouchPoints>0}const Ot={isMobile:C,isTablet:q,isDesktop:Rt,isMobileOrTablet:Et,getCurrentBreakpoint:St,isTouchDevice:Tt};i.initializers.add("wusong8899-funds",()=>{i.store.models["withdrawal-platforms"]=vt,i.store.models["withdrawal-requests"]=At,i.store.models["deposit-platforms"]=bt,i.store.models["deposit-records"]=Pt,i.routes.funds={path:"/funds",component:_},i.routes.funds={path:"/funds",component:_},i.routes.deposit={path:"/deposit",component:_},k.extend(Z.prototype,"view",function(a){const t=P.getInstance();i.session.user&&t.isTagsPage()&&!Ot.isMobile()&&a.children.push(It.component())}),k.extend($.prototype,"view",function(a){if(window.innerWidth>768||i.current.get("routeName")!=="tags"||!i.session.user||!a||!a.children||!Array.isArray(a.children))return;a.children.some(s=>s&&s.attrs&&s.attrs.className&&s.attrs.className.includes("Navigation-mobileMoneyDisplay"))||a.children.push(Ft.component({className:"item-funds Navigation-mobileMoneyDisplay"}))})})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["forum/components/HeaderPrimary"],flarum.core.compat["common/components/Navigation"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/icon"],m,flarum.core.compat["common/Component"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/utils/withAttr"],flarum.core.compat["common/app"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=forum.js.map

module.exports={};