(function(a,i,u,c,d,o,h,w,l,f){"use strict";class g extends d{constructor(){super(...arguments),this.platforms=[],this.requests=[],this.loading=!0,this.submitting=!1,this.loadingBalance=!0,this.userBalance=0,this.amount=l(""),this.selectedPlatform=l(""),this.accountDetails=l("")}oninit(t){super.oninit(t),a.setTitle(a.translator.trans("withdrawal.forum.page.title")),this.loadData(),this.loadUserBalance()}view(){if(this.loading)return m("div",{className:"WithdrawalPage"},m("div",{className:"container"},m(h,null)));const t=a.forum.attribute("withdrawal.minAmount")||0,r=a.forum.attribute("withdrawal.maxAmount")||1e4,s=a.forum.attribute("withdrawal.fee")||0;return m("div",{className:"WithdrawalPage"},m("div",{className:"container"},m("div",{className:"WithdrawalPage-header"},m("h1",null,a.translator.trans("withdrawal.forum.page.title")),m("p",null,a.translator.trans("withdrawal.forum.page.description"))),m("div",{className:"WithdrawalPage-content"},this.renderBalanceSection(),this.renderInfoSection(t,r,s),m("div",{className:"WithdrawalPage-form"},m("h3",null,a.translator.trans("withdrawal.forum.form.title")),m("div",{className:"WithdrawalPage-formGroup"},m("label",null,a.translator.trans("withdrawal.forum.form.platform")),m(w,{options:this.getPlatformOptions(),value:this.selectedPlatform(),onchange:this.selectedPlatform})),m("div",{className:"WithdrawalPage-formGroup"},m("label",null,a.translator.trans("withdrawal.forum.form.amount")),m("div",{className:"WithdrawalPage-amountInput"},m("input",{type:"number",className:"FormControl",placeholder:a.translator.trans("withdrawal.forum.form.amount_placeholder"),value:this.amount(),oninput:e=>this.amount(e.target.value),min:t,max:r,step:"0.01"}),m(o,{className:"Button Button--secondary WithdrawalPage-allButton",onclick:this.fillAllAmount.bind(this)},a.translator.trans("withdrawal.forum.form.all_button")))),this.renderFinalAmountCalculation(s),m("div",{className:"WithdrawalPage-formGroup"},m("label",null,a.translator.trans("withdrawal.forum.form.account_details")),m("div",{className:"WithdrawalPage-accountInput"},m("textarea",{className:"FormControl",placeholder:a.translator.trans("withdrawal.forum.form.account_details_placeholder"),value:this.accountDetails(),oninput:e=>this.accountDetails(e.target.value),rows:3}),m(o,{className:"Button Button--secondary WithdrawalPage-pasteButton",onclick:this.pasteFromClipboard.bind(this)},a.translator.trans("withdrawal.forum.form.paste_button")))),m("div",{className:"WithdrawalPage-formGroup"},m(o,{className:"Button Button--primary",loading:this.submitting,disabled:!this.canSubmit(),onclick:this.submit.bind(this)},a.translator.trans("withdrawal.forum.form.submit")))),m("div",{className:"WithdrawalPage-history"},m("h3",null,a.translator.trans("withdrawal.forum.history.title")),this.requests.length===0?m("p",null,a.translator.trans("withdrawal.forum.history.empty")):m("div",{className:"WithdrawalPage-historyList"},this.requests.map(e=>this.renderRequest(e)))))))}renderRequest(t){const r=this.platforms.find(e=>e.id==t.relationships.platform.data.id),s=`status-${t.attributes.status}`;return m("div",{key:t.id,className:`WithdrawalRequest ${s}`},m("div",{className:"WithdrawalRequest-info"},m("span",{className:"WithdrawalRequest-amount"},"$",t.attributes.amount),m("span",{className:"WithdrawalRequest-platform"},r?.attributes.name),m("span",{className:"WithdrawalRequest-date"},f(t.attributes.createdAt).format("YYYY-MM-DD HH:mm"))),m("div",{className:"WithdrawalRequest-status"},m("span",{className:`Badge Badge--${t.attributes.status}`},a.translator.trans(`withdrawal.forum.status.${t.attributes.status}`))))}renderBalanceSection(){return m("div",{className:"WithdrawalPage-balance"},m("h3",null,a.translator.trans("withdrawal.forum.balance.title")),m("div",{className:"WithdrawalPage-balanceAmount"},this.loadingBalance?m("span",{className:"loading"},a.translator.trans("withdrawal.forum.balance.loading")):m("span",{className:"amount"},a.translator.trans("withdrawal.forum.balance.amount",{amount:this.userBalance}))))}renderInfoSection(t,r,s){return m("div",{className:"WithdrawalPage-info"},m("div",{className:"WithdrawalPage-infoRow"},m("span",{className:"WithdrawalPage-infoIcon"},"ðŸ’°"),m("span",{className:"WithdrawalPage-infoText"},a.translator.trans("withdrawal.forum.info.minimum_amount",{amount:t}))),m("div",{className:"WithdrawalPage-infoRow"},m("span",{className:"WithdrawalPage-infoIcon"},"ðŸ’°"),m("span",{className:"WithdrawalPage-infoText"},a.translator.trans("withdrawal.forum.info.maximum_amount",{amount:r}))),m("div",{className:"WithdrawalPage-infoRow"},m("span",{className:"WithdrawalPage-infoIcon"},"ðŸ’¸"),m("span",{className:"WithdrawalPage-infoText"},a.translator.trans("withdrawal.forum.info.withdrawal_fee",{amount:s}))))}renderFinalAmountCalculation(t){const r=parseFloat(this.amount())||0,s=Math.max(0,r-t);return r>0?m("div",{className:"WithdrawalPage-finalAmount"},m("span",{className:"WithdrawalPage-finalAmountLabel"},a.translator.trans("withdrawal.forum.info.final_amount",{amount:s.toFixed(2)}))):null}getPlatformOptions(){const t={"":a.translator.trans("withdrawal.forum.form.select_platform")};return this.platforms.forEach(r=>{t[r.id.toString()]=r.attributes.name}),t}canSubmit(){return!!(this.selectedPlatform()&&this.amount()&&this.accountDetails()&&!this.submitting)}fillAllAmount(){this.amount(this.userBalance.toString())}async pasteFromClipboard(){try{if(navigator.clipboard&&navigator.clipboard.readText){const t=await navigator.clipboard.readText();this.accountDetails(t),m.redraw()}}catch(t){console.error("Failed to read from clipboard:",t),a.alerts.show({type:"error",message:"Clipboard access not available. Please paste manually."})}}async submit(){if(this.canSubmit()){this.submitting=!0;try{const t={type:"withdrawal-requests",attributes:{platformId:parseInt(this.selectedPlatform()),amount:parseFloat(this.amount()),accountDetails:this.accountDetails()}};await a.request({method:"POST",url:a.forum.attribute("apiUrl")+"/withdrawal-requests",body:{data:t}}),a.alerts.show({type:"success",message:a.translator.trans("withdrawal.forum.form.success")}),this.amount(""),this.selectedPlatform(""),this.accountDetails(""),this.loadRequests()}catch(t){console.error("Error submitting withdrawal request:",t),a.alerts.show({type:"error",message:a.translator.trans("withdrawal.forum.form.error")})}finally{this.submitting=!1,m.redraw()}}}async loadData(){try{await Promise.all([this.loadPlatforms(),this.loadRequests()])}catch(t){console.error("Error loading data:",t)}finally{this.loading=!1,m.redraw()}}async loadPlatforms(){const t=await a.request({method:"GET",url:a.forum.attribute("apiUrl")+"/withdrawal-platforms"});this.platforms=t.data||[]}async loadRequests(){const t=await a.request({method:"GET",url:a.forum.attribute("apiUrl")+"/withdrawal-requests?include=platform"});this.requests=t.data||[]}async loadUserBalance(){try{this.userBalance=a.session.user?.attribute("money")||0,this.loadingBalance=!1,m.redraw()}catch(t){console.error("Error loading user balance:",t),this.loadingBalance=!1,m.redraw()}}}a.initializers.add("wusong8899-withdrawal",()=>{a.routes.withdrawal={path:"/withdrawal",component:g},i.extend(c.prototype,"items",function(n){a.session.user&&n.add("withdrawal",u.component({href:a.route("withdrawal"),icon:"fas fa-money-bill-transfer"},a.translator.trans("withdrawal.forum.header.withdrawal_button")),10)})})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["common/components/LinkButton"],flarum.core.compat["forum/components/HeaderSecondary"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/components/Select"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/utils/dayjs"]);
//# sourceMappingURL=forum.js.map

module.exports={};