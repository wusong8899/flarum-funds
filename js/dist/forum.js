(function(u,n,j,se,re,ae,S,Y,g,y,c,v,z,I,l){"use strict";const G={pending:"warning",approved:"success",rejected:"danger"},A={MIN_AMOUNT:.001,MAX_AMOUNT:10,FEE:5e-4,BALANCE_PRECISION:8},R={COINS:"fas fa-coins",CHEVRON_DOWN:"fas fa-chevron-down",PASTE:"fas fa-paste"};function J(a){const e=a.platformSpecificIconUrl?.();if(e)return{type:"currency_url",value:e,alt:a.name?.()||"Platform icon"};const t=a.platformSpecificIconClass?.();if(t)return{type:"currency_class",value:t};const s=a.networkIconUrl?.();if(s)return{type:"currency_url",value:s,alt:a.network?.()||"Network icon"};const r=a.networkIconClass?.();if(r)return{type:"currency_class",value:r};const i=a.currencyIconUrl?.();if(i)return{type:"currency_url",value:i,alt:a.symbol?.()||"Currency icon"};const f=a.currencyIconClass?.();if(f)return{type:"currency_class",value:f};const w=a.currencyUnicodeSymbol?.();return w?{type:"currency_unicode",value:w}:{type:"fallback",value:"fas fa-coins"}}function ne(a){const e=a.currencyIconOverrideUrl?.();if(e)return{type:"currency_url",value:e,alt:a.symbol?.()||"Currency icon"};const t=a.currencyIconOverrideClass?.();if(t)return{type:"currency_class",value:t};const s=a.currencyIcon?.();if(s)return s;const r=a.currencyIconUrl?.();if(r)return{type:"currency_url",value:r,alt:a.symbol?.()||"Currency icon"};const i=a.currencyIconClass?.();if(i)return{type:"currency_class",value:i};const f=a.currencyUnicodeSymbol?.();return f?{type:"currency_unicode",value:f}:{type:"fallback",value:"fas fa-coins"}}function _(a,e=""){const t="icon",s=e?`${t} ${e}`:t;switch(a.type){case"currency_url":return m("img",{src:a.value,alt:a.alt||"Icon",className:`${s} icon--image`,style:{width:"1em",height:"1em",objectFit:"contain",display:"inline-block",verticalAlign:"middle"}});case"currency_class":return m("i",{className:`${s} ${a.value}`,"aria-hidden":"true"});case"currency_unicode":return m("span",{className:`${s} icon--unicode`,"aria-hidden":"true"},a.value);case"fallback":default:return m("i",{className:`${s} ${a.value}`,"aria-hidden":"true"})}}class C{view(e){const{platform:t,className:s="",size:r="medium"}=e.attrs;if(!t)return y(R.COINS,{className:`crypto-icon default ${s}`});const f=`crypto-icon ${`platform-icon-${r}`} ${s}`,w=J(t);return _(w,f)}}const K=a=>typeof a.id=="function"?a.id():a.id,h=(a,e)=>typeof a[e]=="function"?a[e]():a.attributes?a.attributes[e]:a[e],U=a=>String(K(a)),ie=(a,e)=>{const t=String(e);return a.find(s=>{const r=K(s);return String(r)===t})},T=(a,e)=>{const t=h(a,e);return t?new Date(t):new Date};class oe extends v{oninit(e){super.oninit(e),this.state={showDropdown:!1}}view(){const{selectedPlatform:e}=this.attrs,{showDropdown:t}=this.state;return m("div",{className:"WithdrawalPage-platformSelector"},m("div",{className:"WithdrawalPage-label"},"提取平台"),m("div",{className:"WithdrawalPage-platformDropdown",onclick:()=>this.toggleDropdown()},m("div",{className:"WithdrawalPage-platformSelected"},m("div",{className:"WithdrawalPage-platformInfo"},m("div",{className:"WithdrawalPage-platformIcon"},m(C,{platform:e,size:"medium"})),m("div",{className:"WithdrawalPage-platformDetails"},m("div",{className:"WithdrawalPage-platformName"},this.getPlatformName(e))))),y(R.CHEVRON_DOWN,{className:"WithdrawalPage-dropdownIcon"})),t&&this.renderPlatformDropdown())}toggleDropdown(){this.state.showDropdown=!this.state.showDropdown}getPlatformName(e){return e&&(h(e,"displayName")||h(e,"name"))||"请选择平台"}renderPlatformDropdown(){const{platforms:e}=this.attrs,t=(e||[]).filter(s=>!!s);return t.length===0?m("div",{className:"WithdrawalPage-dropdownMenu"},m("div",{className:"WithdrawalPage-dropdownItem WithdrawalPage-noData"},n.translator.trans("funds.forum.no_platforms"))):m("div",{className:"WithdrawalPage-dropdownMenu"},t.map(s=>m("div",{key:s.id(),className:"WithdrawalPage-dropdownItem",onclick:()=>this.selectPlatform(s)},m("div",{className:"WithdrawalPage-platformIcon"},m(C,{platform:s,size:"small"})),m("div",{className:"WithdrawalPage-platformName"},h(s,"displayName")||h(s,"name")))))}selectPlatform(e){const{onPlatformSelect:t,onAmountChange:s}=this.attrs;t(e),this.state.showDropdown=!1,s&&s()}}class le extends v{view(){const{amount:e,selectedPlatform:t,loadingBalance:s,onAmountChange:r,onFillAllAmount:i}=this.attrs,f=this.getMinAmount(t),w=this.getMaxAmount(t),p=this.getFee(t);return m("div",{className:"WithdrawalPage-amountSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-label"},n.translator.trans("funds.forum.form.amount")),m("div",{className:"WithdrawalPage-amountInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:"0.00000000",value:e,oninput:b=>r(b.target.value)}),m(S,{className:"WithdrawalPage-allButton",onclick:i,disabled:s},n.translator.trans("funds.forum.form.all_button"))),m("div",{className:"WithdrawalPage-amountLimits"},m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},n.translator.trans("funds.forum.limits.min_max")),m("span",{className:"WithdrawalPage-limitValue"},y(R.COINS)," ",f," ~ ",w)),m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},n.translator.trans("funds.forum.limits.fee")),m("span",{className:"WithdrawalPage-limitValue"},y(R.COINS)," ",p)))))}getMinAmount(e){return e&&h(e,"minAmount")||A.MIN_AMOUNT}getMaxAmount(e){return e&&h(e,"maxAmount")||A.MAX_AMOUNT}getFee(e){return e&&h(e,"fee")||A.FEE}}class ce extends v{view(){const{accountDetails:e,selectedPlatform:t,onAccountDetailsChange:s}=this.attrs,r=this.getSymbol(t);return c("div",{className:"WithdrawalPage-addressSection"},c("div",{className:"WithdrawalPage-formGroup"},c("div",{className:"WithdrawalPage-addressHeader"},c("span",{className:"WithdrawalPage-label"},n.translator.trans("funds.forum.form.address",{symbol:r}),c("span",{className:"WithdrawalPage-required"},"*"))),c("div",{className:"WithdrawalPage-addressInput"},c("input",{type:"text",className:"WithdrawalPage-input",placeholder:n.translator.trans("funds.forum.form.address_placeholder"),value:e,oninput:i=>s(i.target.value)}),c("button",{className:"WithdrawalPage-pasteButton",onclick:()=>this.pasteFromClipboard()},y(R.PASTE)))))}getSymbol(e){return e&&h(e,"symbol")||""}async pasteFromClipboard(){const{onAccountDetailsChange:e}=this.attrs;try{if(navigator.clipboard&&navigator.clipboard.readText){const t=await navigator.clipboard.readText();e(t.trim()),c.redraw()}}catch(t){console.error("Failed to read from clipboard:",t),n.alerts.show({type:"error",dismissible:!0},n.translator.trans("funds.forum.clipboard_error"))}}}class de extends v{view(){const{message:e,onMessageChange:t}=this.attrs;return m("div",{className:"WithdrawalPage-messageSection"},m("div",{className:"WithdrawalPage-formGroup"},m("span",{className:"WithdrawalPage-label"},n.translator.trans("funds.forum.form.message")),m("textarea",{className:"WithdrawalPage-textarea",placeholder:n.translator.trans("funds.forum.form.message_placeholder"),value:e,rows:3,maxlength:500,oninput:s=>t(s.target.value)}),m("div",{className:"WithdrawalPage-helperText"},n.translator.trans("funds.forum.form.message_helper")," (",e.length,"/500)")))}}class ue extends v{view(){const{amount:e,selectedPlatform:t,submitting:s,canSubmit:r,onSubmit:i}=this.attrs,f=parseFloat(e)||0,w=this.getFee(t),p=Math.max(0,f-w),b=this.getSymbol(t);return m("div",{className:"WithdrawalPage-submitSection"},m(S,{className:"WithdrawalPage-submitButton",loading:s,disabled:!r,onclick:i},n.translator.trans("funds.forum.form.submit")),f>0&&m("div",{className:"WithdrawalPage-finalAmount"},n.translator.trans("funds.forum.final_amount",{amount:p.toFixed(A.BALANCE_PRECISION),symbol:b})))}getFee(e){return e&&h(e,"fee")||A.FEE}getSymbol(e){return e&&h(e,"symbol")||""}}class me extends v{view(){const{platforms:e,formData:t,loadingBalance:s,submitting:r,onFormDataChange:i,onFillAllAmount:f,onSubmit:w}=this.attrs;return[m(oe,{platforms:e,selectedPlatform:t.selectedPlatform,onPlatformSelect:p=>i({selectedPlatform:p}),onAmountChange:()=>i({amount:""})}),m(le,{amount:t.amount,selectedPlatform:t.selectedPlatform,loadingBalance:s,onAmountChange:p=>i({amount:p}),onFillAllAmount:f}),m(ce,{accountDetails:t.accountDetails,selectedPlatform:t.selectedPlatform,onAccountDetailsChange:p=>i({accountDetails:p})}),m(de,{message:t.message,onMessageChange:p=>i({message:p})}),m(ue,{amount:t.amount,selectedPlatform:t.selectedPlatform,accountDetails:t.accountDetails,submitting:r,canSubmit:this.canSubmit(),onSubmit:w})]}canSubmit(){const{formData:e,submitting:t}=this.attrs,{selectedPlatform:s,amount:r,accountDetails:i}=e;return!!(s&&r&&i&&!t&&parseFloat(r)>0)}}class he extends v{view(){const{status:e,className:t=""}=this.attrs,s=this.getStatusClass(e),r=this.getStatusLabel(e);return m("div",{className:`WithdrawalPage-historyStatus ${s} ${t}`},r)}getStatusClass(e){return G[e]||G.pending}getStatusLabel(e){return n.translator.trans(`funds.forum.status.${e}`).toString()}}class fe extends v{view(){const{iconName:e,title:t,description:s,className:r=""}=this.attrs;return m("div",{className:`WithdrawalPage-emptyState ${r}`},m("div",{className:"WithdrawalPage-emptyIcon"},y(e)),m("h3",{className:"WithdrawalPage-emptyTitle"},t),m("p",{className:"WithdrawalPage-emptyDescription"},s))}}function we(a){const{className:e=""}=a;return m("div",{className:`WithdrawalPage-loading ${e}`},m(Y,null))}class X extends v{view(e){const{transactions:t,platforms:s,loading:r,type:i}=e.attrs;return r?m(we,{className:`${i}History-loading`}):!t||t.length===0?m(fe,{iconName:i==="funds"?"fas fa-history":"fas fa-inbox",title:n.translator.trans(`${i}.forum.history.empty.title`),description:n.translator.trans(`${i}.forum.history.empty.description`),className:`${i}History-empty`}):m("div",{className:`${i}History`},m("div",{className:`${i}History-header`},m("h3",null,n.translator.trans(`${i}.forum.history.title`)),m("span",{className:`${i}History-count`},t.length," ",n.translator.trans(`${i}.forum.history.transactions`))),m("div",{className:`${i}History-list`},t.map(f=>this.renderTransaction(f,s,i))))}renderTransaction(e,t,s){const r=this.getTransactionId(e),i=this.getPlatform(e,t),f=h(e,"amount")||0,w=h(e,"status")||"pending",p=h(e,"statusColor")||this.getStatusColor(w),b=T(e,"createdAt");return s==="deposit"?this.renderDepositRecord(e,i,f,w,p,b,r):this.renderWithdrawalTransaction(e,i,f,w,b,r)}renderWithdrawalTransaction(e,t,s,r,i,f){const w=h(e,"accountDetails")||"";return m("div",{key:f,className:"WithdrawalPage-historyItem"},m("div",{className:"WithdrawalPage-historyHeader"},m("div",{className:"WithdrawalPage-historyPlatform"},m("div",{className:"WithdrawalPage-platformIcon"},m(C,{platform:t,size:"small"})),m("div",{className:"WithdrawalPage-historyInfo"},m("div",{className:"WithdrawalPage-historyPlatformName"},this.getPlatformName(t)),m("div",{className:"WithdrawalPage-historyDate"},i.toLocaleDateString()," ",i.toLocaleTimeString()))),m(he,{status:r})),m("div",{className:"WithdrawalPage-historyDetails"},m("div",{className:"WithdrawalPage-historyAmount"},m("span",{className:"WithdrawalPage-historyLabel"},n.translator.trans("funds.forum.history.amount"),":"),m("span",{className:"WithdrawalPage-historyValue"},s," ",this.getPlatformSymbol(t))),m("div",{className:"WithdrawalPage-historyAddress"},m("span",{className:"WithdrawalPage-historyLabel"},n.translator.trans("funds.forum.history.address"),":"),m("span",{className:"WithdrawalPage-historyValue"},w))))}renderDepositRecord(e,t,s,r,i,f,w){const p=h(e,"platformAccount"),b=h(e,"realName"),D=T(e,"depositTime"),F=h(e,"screenshotUrl"),L=h(e,"userMessage"),B=T(e,"processedAt"),M=h(e,"adminNotes"),H=h(e,"creditedAmount");return m("div",{key:w,className:"DepositRecord-item"},m("div",{className:"DepositRecord-itemHeader"},m("div",{className:"DepositRecord-itemPlatform"},t&&m("[",null,m("div",{className:"DepositRecord-itemIcon"},this.renderPlatformIcon(t)),m("div",{className:"DepositRecord-itemInfo"},m("span",{className:"DepositRecord-itemCurrency"},h(t,"symbol")," ",h(t,"network")&&`(${h(t,"network")})`),m("span",{className:"DepositRecord-itemType"},"Manual Deposit")))),m("div",{className:"DepositRecord-itemAmount"},m("span",{className:"DepositRecord-itemAmountValue"},"+",s," ",t?h(t,"symbol"):""),m("div",{className:`DepositRecord-itemStatus status-${i}`},this.getStatusIcon(r),this.getStatusText(r)))),m("div",{className:"DepositRecord-itemDetails"},m("div",{className:"DepositRecord-itemMeta"},m("span",{className:"DepositRecord-itemTime"},"Submitted: ",f?z(f):"Unknown time"),D&&m("span",{className:"DepositRecord-itemDepositTime"},"Deposit Time: ",D.toLocaleDateString()," ",D.toLocaleTimeString())),m("div",{className:"DepositRecord-itemInfo"},m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Platform Account:"),m("span",{className:"DepositRecord-itemValue"},p)),b&&m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Real Name:"),m("span",{className:"DepositRecord-itemValue"},b)),L&&m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Message:"),m("span",{className:"DepositRecord-itemValue"},L)),F&&m("div",{className:"DepositRecord-itemRow"},m("span",{className:"DepositRecord-itemLabel"},"Screenshot:"),m("a",{href:F,target:"_blank",rel:"noopener noreferrer",className:"DepositRecord-itemLink"},"View Screenshot ",y("fas fa-external-link-alt")))),B&&m("div",{className:"DepositRecord-itemProcessed"},m("div",{className:"DepositRecord-itemProcessedTime"},"Processed: ",z(B)),H&&H!==s&&m("div",{className:"DepositRecord-itemCredited"},"Credited Amount: ",H," ",t?h(t,"symbol"):""),M&&m("div",{className:"DepositRecord-itemNotes"},m("span",{className:"DepositRecord-itemLabel"},"Admin Notes:"),m("span",{className:"DepositRecord-itemValue"},M)))))}getTransactionId(e){return typeof e.id=="function"?`transaction-${e.id()}`:`transaction-${U(e)||Math.random()}`}getPlatform(e,t){const s=this.getPlatformId(e);return ie(t,s)}getPlatformId(e){return h(e,"platformId")||e.relationships?.platform?.data?.id||""}getPlatformName(e){return e&&h(e,"name")||"Unknown Platform"}getPlatformSymbol(e){return e&&h(e,"symbol")||""}getStatusColor(e){switch(e){case"pending":return"warning";case"approved":case"confirmed":case"completed":return"success";case"rejected":case"failed":case"cancelled":return"danger";default:return"secondary"}}renderPlatformIcon(e){const t=h(e,"iconUrl"),s=h(e,"iconClass"),r=h(e,"symbol");return t?m("img",{src:t,alt:r,className:"DepositHistory-platformImg"}):y(s||"fas fa-coins")}getStatusIcon(e){switch(e){case"pending":return y("fas fa-clock");case"approved":case"confirmed":return y("fas fa-check-circle");case"completed":return y("fas fa-check-double");case"rejected":case"failed":return y("fas fa-times-circle");case"cancelled":return y("fas fa-ban");default:return y("fas fa-question-circle")}}getStatusText(e){switch(e){case"pending":return"Pending";case"approved":return"Approved";case"confirmed":return"Confirmed";case"completed":return"Completed";case"rejected":return"Rejected";case"failed":return"Failed";case"cancelled":return"Cancelled";default:return"Unknown"}}}class pe extends v{constructor(){super(...arguments),this.handleOutsideClick=e=>{const t=this.element;t&&!t.contains(e.target)&&(this.state.showDropdown=!1,c.redraw())}}oninit(e){super.oninit(e),this.state={showDropdown:!1}}view(){const{selectedPlatform:e}=this.attrs,{showDropdown:t}=this.state;return c("div",{className:"FundsPage-platformSelector"},c("div",{className:"FundsPage-label"},n.translator.trans("funds.forum.deposit.platform_label")),c("div",{className:"FundsPage-platformDropdown",onclick:()=>this.toggleDropdown()},c("div",{className:"FundsPage-platformSelected"},c("div",{className:"FundsPage-platformInfo"},c("div",{className:"FundsPage-platformIcon"},this.renderPlatformIcon(e)),c("div",{className:"FundsPage-platformDetails"},c("div",{className:"FundsPage-platformName"},this.getPlatformDisplayName(e)),e&&this.renderPlatformSubtext(e)))),y(R.CHEVRON_DOWN,{className:"FundsPage-dropdownIcon"})),t&&this.renderPlatformDropdown())}oncreate(e){super.oncreate(e),document.addEventListener("click",this.handleOutsideClick)}onremove(e){super.onremove(e),document.removeEventListener("click",this.handleOutsideClick)}toggleDropdown(){this.state.showDropdown=!this.state.showDropdown}getPlatformDisplayName(e){if(!e)return n.translator.trans("funds.forum.deposit.select_platform").toString();const t=h(e,"name")||"",s=h(e,"network");return s?`${t} (${s})`:t}renderPlatformIcon(e){if(!e)return y("fas fa-coins");const t=J(e);return _(t,"FundsPage-platformIconImage")}getCurrencyIconForSymbol(e,t){const s=t.find(r=>h(r,"symbol")===e);if(s){const r=ne(s);return _(r,"FundsPage-currencyIcon")}return y("fas fa-coins")}renderPlatformSubtext(e){const t=h(e,"minAmount"),s=h(e,"fee"),r=h(e,"symbol"),i=[];return t&&t>0&&i.push(n.translator.trans("funds.forum.deposit.min_amount_short",{amount:t,symbol:r}).toString()),s&&s>0&&i.push(n.translator.trans("funds.forum.deposit.fee_short",{fee:s,symbol:r}).toString()),i.length>0?c("div",{className:"FundsPage-platformSubtext"},i.join(" • ")):null}renderPlatformDropdown(){const{platforms:e}=this.attrs,t=this.groupPlatformsByCurrency(e);return Object.keys(t).length===0?c("div",{className:"FundsPage-dropdownMenu"},c("div",{className:"FundsPage-dropdownItem FundsPage-noData"},n.translator.trans("funds.forum.deposit.no_platforms"))):c("div",{className:"FundsPage-dropdownMenu"},Object.entries(t).flatMap(([s,r])=>[c("div",{key:`${s}-header`,className:"FundsPage-dropdownHeader"},c("div",{className:"FundsPage-currencyHeader"},c("div",{className:"FundsPage-currencyIcon"},this.getCurrencyIconForSymbol(s,e)),c("span",{className:"FundsPage-currencyName"},s))),...r.map(i=>c("div",{key:i.id(),className:"FundsPage-dropdownItem",onclick:()=>this.selectPlatform(i)},c("div",{className:"FundsPage-platformIcon"},this.renderPlatformIcon(i)),c("div",{className:"FundsPage-platformInfo"},c("div",{className:"FundsPage-platformName"},this.getPlatformDisplayName(i)),this.renderPlatformSubtext(i))))]))}groupPlatformsByCurrency(e){const t={};return(e||[]).filter(r=>r&&h(r,"isActive")).forEach(r=>{const i=h(r,"symbol");t[i]||(t[i]=[]),t[i].push(r)}),Object.keys(t).forEach(r=>{t[r].sort((i,f)=>{const w=h(i,"network")||"",p=h(f,"network")||"";return w.localeCompare(p)})}),t}selectPlatform(e){const{onPlatformSelect:t}=this.attrs;t(e),this.state.showDropdown=!1}}class ye extends v{view(e){const{address:t,loading:s,onCopy:r}=e.attrs;return m("div",{className:"AddressDisplay"},s?m("div",{className:"AddressDisplay-loading"},m("i",{className:"fas fa-spinner fa-spin"}),m("span",null,"Generating address...")):t?m("div",{className:"AddressDisplay-content"},m("div",{className:"AddressDisplay-address",title:t},t),m("div",{className:"AddressDisplay-actions"},m("button",{className:"AddressDisplay-copyBtn",onclick:r,title:"Copy address"},y("fas fa-copy")))):m("div",{className:"AddressDisplay-placeholder"},m("span",null,"No address available")))}}class ge extends v{view(e){const{platform:t,loading:s,size:r=160}=e.attrs;return m("div",{className:"ImageDisplay",style:{width:`${r}px`,height:`${r}px`}},s?m("div",{className:"ImageDisplay-loading"},m("i",{className:"fas fa-spinner fa-spin"})):t&&t.qrCodeImageUrl()?m("img",{src:t.qrCodeImageUrl(),alt:`${t.name()} Image`,className:"ImageDisplay-image",onerror:"this.style.display='none'; this.nextElementSibling.style.display='block';"}):m("div",{className:"ImageDisplay-placeholder"},m("i",{className:"fas fa-image"}),m("div",null,"No Image")),m("div",{className:"ImageDisplay-error",style:{display:"none"}},m("i",{className:"fas fa-exclamation-triangle"}),m("div",null,"Image Load Failed")))}}class ve extends v{oninit(e){super.oninit(e);const t=new Date,s=new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,16);this.state={platformAccount:g(""),realName:g(""),amount:g(""),depositTime:g(s),screenshotUrl:g(""),userMessage:g("")}}view(e){const{platform:t,submitting:s}=e.attrs,r=h(t,"minAmount")||0,i=h(t,"maxAmount"),f=h(t,"symbol")||"";return m("div",{className:"DepositRecordForm"},m("div",{className:"DepositRecordForm-header"},m("div",{className:"DepositRecordForm-title"},m("i",{className:"fas fa-plus-circle"}),n.translator.trans("funds.forum.deposit.record.form_title")),m("div",{className:"DepositRecordForm-platformInfo"},n.translator.trans("funds.forum.deposit.record.selected_platform",{platform:h(t,"name"),symbol:f}))),m("form",{onsubmit:this.handleSubmit.bind(this),className:"DepositRecordForm-form"},m("div",{className:"DepositRecordForm-field"},m("label",{className:"DepositRecordForm-label"},n.translator.trans("funds.forum.deposit.record.platform_account"),m("span",{className:"DepositRecordForm-required"},"*")),m("input",{type:"text",className:"DepositRecordForm-input",placeholder:n.translator.trans("funds.forum.deposit.record.platform_account_placeholder"),value:this.state.platformAccount(),oninput:I("value",this.state.platformAccount),required:!0,disabled:s}),m("div",{className:"DepositRecordForm-help"},n.translator.trans("funds.forum.deposit.record.platform_account_help"))),m("div",{className:"DepositRecordForm-field"},m("label",{className:"DepositRecordForm-label"},n.translator.trans("funds.forum.deposit.record.real_name"),m("span",{className:"DepositRecordForm-optional"},"(",n.translator.trans("funds.forum.deposit.record.optional"),")")),m("input",{type:"text",className:"DepositRecordForm-input",placeholder:n.translator.trans("funds.forum.deposit.record.real_name_placeholder"),value:this.state.realName(),oninput:I("value",this.state.realName),disabled:s})),m("div",{className:"DepositRecordForm-field"},m("label",{className:"DepositRecordForm-label"},n.translator.trans("funds.forum.deposit.record.amount")," (",f,")",m("span",{className:"DepositRecordForm-required"},"*")),m("input",{type:"number",step:"0.01",min:r,max:i,className:"DepositRecordForm-input",placeholder:n.translator.trans("funds.forum.deposit.record.amount_placeholder"),value:this.state.amount(),oninput:I("value",this.state.amount),required:!0,disabled:s}),m("div",{className:"DepositRecordForm-limits"},r>0&&m("span",{className:"DepositRecordForm-limit"},n.translator.trans("funds.forum.deposit.record.min_amount",{amount:r,symbol:f})),i&&m("span",{className:"DepositRecordForm-limit"},n.translator.trans("funds.forum.deposit.record.max_amount",{amount:i,symbol:f})))),m("div",{className:"DepositRecordForm-field"},m("label",{className:"DepositRecordForm-label"},n.translator.trans("funds.forum.deposit.record.deposit_time"),m("span",{className:"DepositRecordForm-required"},"*")),m("input",{type:"datetime-local",className:"DepositRecordForm-input",value:this.state.depositTime(),oninput:I("value",this.state.depositTime),required:!0,disabled:s}),m("div",{className:"DepositRecordForm-help"},n.translator.trans("funds.forum.deposit.record.deposit_time_help"))),m("div",{className:"DepositRecordForm-field"},m("label",{className:"DepositRecordForm-label"},n.translator.trans("funds.forum.deposit.record.screenshot_url"),m("span",{className:"DepositRecordForm-optional"},"(",n.translator.trans("funds.forum.deposit.record.optional"),")")),m("input",{type:"url",className:"DepositRecordForm-input",placeholder:n.translator.trans("funds.forum.deposit.record.screenshot_url_placeholder"),value:this.state.screenshotUrl(),oninput:I("value",this.state.screenshotUrl),disabled:s}),m("div",{className:"DepositRecordForm-help"},n.translator.trans("funds.forum.deposit.record.screenshot_url_help"))),m("div",{className:"DepositRecordForm-field"},m("label",{className:"DepositRecordForm-label"},n.translator.trans("funds.forum.deposit.record.user_message"),m("span",{className:"DepositRecordForm-optional"},"(",n.translator.trans("funds.forum.deposit.record.optional"),")")),m("textarea",{className:"DepositRecordForm-textarea",placeholder:n.translator.trans("funds.forum.deposit.record.user_message_placeholder"),value:this.state.userMessage(),oninput:I("value",this.state.userMessage),rows:3,disabled:s})),m("div",{className:"DepositRecordForm-actions"},m(S,{type:"button",className:"Button Button--secondary DepositRecordForm-cancelButton",onclick:e.attrs.onCancel,disabled:s},n.translator.trans("funds.forum.deposit.record.cancel")),m(S,{type:"submit",className:"Button Button--primary DepositRecordForm-submitButton",loading:s,disabled:s},n.translator.trans("funds.forum.deposit.record.submit")))))}handleSubmit(e){e.preventDefault();const{platform:t,onSubmit:s}=this.attrs;if(!this.state.platformAccount()||!this.state.amount()||!this.state.depositTime()){n.alerts.show({type:"error",dismissible:!0},n.translator.trans("funds.forum.deposit.record.validation.required_fields"));return}const r=parseFloat(this.state.amount());if(isNaN(r)||r<=0){n.alerts.show({type:"error",dismissible:!0},n.translator.trans("funds.forum.deposit.record.validation.invalid_amount"));return}const i=h(t,"minAmount")||0,f=h(t,"maxAmount");if(r<i){n.alerts.show({type:"error",dismissible:!0},n.translator.trans("funds.forum.deposit.record.validation.amount_too_low",{amount:r,min:i,symbol:h(t,"symbol")}));return}if(f&&r>f){n.alerts.show({type:"error",dismissible:!0},n.translator.trans("funds.forum.deposit.record.validation.amount_too_high",{amount:r,max:f,symbol:h(t,"symbol")}));return}const w={platformId:parseInt(U(t)),platformAccount:this.state.platformAccount(),realName:this.state.realName()||void 0,amount:r,depositTime:new Date(this.state.depositTime()),screenshotUrl:this.state.screenshotUrl()||void 0,userMessage:this.state.userMessage()||void 0};s(w)}}const Le="modulepreload",Be=function(a){return"/"+a},Me={},Ne=function(e,t,s){let r=Promise.resolve();function i(f){const w=new Event("vite:preloadError",{cancelable:!0});if(w.payload=f,window.dispatchEvent(w),!w.defaultPrevented)throw f}return r.then(f=>{for(const w of f||[])w.status==="rejected"&&i(w.reason);return e().catch(i)})};var d=(a=>(a.NETWORK_ERROR="network_error",a.PERMISSION_DENIED="permission_denied",a.VALIDATION_ERROR="validation_error",a.NOT_FOUND="not_found",a.SERVER_ERROR="server_error",a.TIMEOUT="timeout",a))(d||{});class o extends Error{constructor(e,t="server_error",s,r){super(e),this.name="ServiceError",this.type=t,this.code=s,this.details=r}}class be{constructor(){this.modelType="funds-requests",this.platformModelType="funds-platforms"}async find(e={}){try{const t={include:e.include||"user,platform",sort:e.sort||"-created_at",...e};e.page&&(t.page=e.page),e.filter&&(t.filter=e.filter);const s=await u.store.find(this.modelType,t);return Array.isArray(s)?s:[s]}catch(t){throw this.handleError(t,"Failed to fetch funds requests")}}async findById(e,t={}){try{const s={include:t.include||"user,platform"};return await u.store.find(this.modelType,e,s)}catch(s){if(this.isNotFoundError(s))return null;throw this.handleError(s,`Failed to fetch funds request ${e}`)}}async create(e){try{return this.validateCreateAttributes(e),await u.store.createRecord(this.modelType).save(e)}catch(t){throw this.handleError(t,"Failed to create funds request")}}async update(e,t){try{if(!this.canModify(e))throw new o("You do not have permission to modify this funds request",d.PERMISSION_DENIED);return await e.save(t)}catch(s){throw this.handleError(s,"Failed to update funds request")}}async delete(e){try{if(!this.canDelete(e))throw new o("You do not have permission to delete this funds request",d.PERMISSION_DENIED);await e.delete()}catch(t){throw this.handleError(t,"Failed to delete funds request")}}async submitRequest(e){try{await this.validateWithdrawalRequest(e);const t={platformId:e.platformId,amount:e.amount,accountDetails:e.accountDetails,message:e.message||"",status:"pending"};return await this.create(t)}catch(t){throw this.handleError(t,"Failed to submit funds request")}}async getUserHistory(e,t={}){const s=e||u.session.user?.id();if(!s)throw new o("User not authenticated",d.PERMISSION_DENIED);const r={...t,filter:{user:s,...t.filter},include:t.include||"platform",sort:t.sort||"-created_at"};return await this.find(r)}async getPendingRequests(e={}){if(!u.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);const t={...e,filter:{status:"pending",...e.filter},include:e.include||"user,platform",sort:e.sort||"created_at"};return await this.find(t)}async approve(e,t){if(!u.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);if(!e.isPending())throw new o("Only pending requests can be approved",d.VALIDATION_ERROR);const s={status:"approved"};return t&&(s.adminNote=t),await this.update(e,s)}async reject(e,t){if(!u.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);if(!e.isPending())throw new o("Only pending requests can be rejected",d.VALIDATION_ERROR);const s={status:"rejected"};return t&&(s.adminNote=t),await this.update(e,s)}async cancel(e){if(!e.canBeModified())throw new o("This request cannot be cancelled",d.VALIDATION_ERROR);const t=u.session.user;if(!t||e.userId()!==t.id()&&!t.isAdmin())throw new o("You can only cancel your own requests",d.PERMISSION_DENIED);return await this.delete(e)}canModify(e){const t=u.session.user;return t?t.isAdmin()?!0:e.userId()===t.id()&&e.canBeModified():!1}canCreate(){const e=u.session.user;return e&&!e.isGuest()}canDelete(e){const t=u.session.user;return t?t.isAdmin()?!0:e.userId()===t.id()&&e.canBeModified():!1}async getPlatforms(){try{const e=await u.store.find(this.platformModelType,{filter:{isActive:!0},sort:"name"});return Array.isArray(e)?e:[e]}catch(e){throw this.handleError(e,"Failed to fetch funds platforms")}}async validateWithdrawalRequest(e){const{platformId:t,amount:s}=e,r=await u.store.find(this.platformModelType,t);if(!r)throw new o("Invalid platform selected",d.VALIDATION_ERROR);if(!r.isActive())throw new o("Selected platform is not available",d.VALIDATION_ERROR);const i=r.minAmount(),f=r.maxAmount();if(s<i)throw new o(`Minimum funds amount is ${i}`,d.VALIDATION_ERROR);if(f&&s>f)throw new o(`Maximum funds amount is ${f}`,d.VALIDATION_ERROR);const w=u.session.user;if(w){const p=parseFloat(w.attribute("money")||"0"),b=r.fee?r.fee():0,D=s+b;if(p<D)throw new o(`Insufficient balance. Required: ${D}, Available: ${p}`,d.VALIDATION_ERROR)}}validateCreateAttributes(e){const t=["platformId","amount","accountDetails"];for(const s of t)if(!e[s])throw new o(`${s} is required`,d.VALIDATION_ERROR);if(typeof e.amount!="number"||e.amount<=0)throw new o("Amount must be a positive number",d.VALIDATION_ERROR)}handleError(e,t){if(e instanceof o)return e;if(e.response&&e.response.errors){const s=e.response.errors[0];return new o(s.detail||t,d.VALIDATION_ERROR,s.code,s)}return e.name==="TypeError"||e.message?.includes("fetch")?new o("Network error occurred",d.NETWORK_ERROR):new o(e.message||t,d.SERVER_ERROR)}isNotFoundError(e){return e.status===404||e.response?.status===404||e.message?.includes("not found")}}const x=new be;class Ae{constructor(){this.recordModelType="deposit-records",this.platformModelType="deposit-platforms",this.addressModelType="deposit-addresses"}async find(e={}){try{const t={include:e.include||"user,platform",sort:e.sort||"-created_at",...e};e.page&&(t.page=e.page),e.filter&&(t.filter=e.filter);const s=await u.store.find(this.recordModelType,t);return Array.isArray(s)?s:[s]}catch(t){throw this.handleError(t,"Failed to fetch deposit records")}}async findById(e,t={}){try{const s={include:t.include||"user,platform"};return await u.store.find(this.recordModelType,String(e),s)}catch(s){if(this.isNotFoundError(s))return null;throw this.handleError(s,`Failed to fetch deposit record ${e}`)}}async create(e){try{return this.validateCreateAttributes(e),await u.store.createRecord(this.recordModelType).save(e)}catch(t){throw this.handleError(t,"Failed to create deposit record")}}async update(e,t){try{if(!this.canModify(e))throw new o("You do not have permission to modify this deposit record",d.PERMISSION_DENIED);return await e.save(t)}catch(s){throw this.handleError(s,"Failed to update deposit record")}}async delete(e){try{if(!this.canDelete(e))throw new o("You do not have permission to delete this deposit record",d.PERMISSION_DENIED);await e.delete()}catch(t){throw this.handleError(t,"Failed to delete deposit record")}}async generateAddress(e){try{const{addressService:t}=await Ne(async()=>{const{addressService:s}=await Promise.resolve().then(()=>Pe);return{addressService:s}},void 0);return await t.generateAddress(e)}catch(t){throw this.handleError(t,"Failed to generate deposit address")}}async getUserHistory(e,t={}){const s=e||u.session.user?.id();if(!s)throw new o("User not authenticated",d.PERMISSION_DENIED);const r={...t,filter:{user:s,...t.filter},include:t.include||"platform",sort:t.sort||"-created_at"};return await this.find(r)}async createRecord(e){try{await this.validateDepositRecord(e);const t={platformId:e.platformId,amount:e.amount,note:e.note||"",status:"pending"};return await this.create(t)}catch(t){throw this.handleError(t,"Failed to create deposit record")}}async getPendingDeposits(e={}){if(!u.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);const t={...e,filter:{status:"pending",...e.filter},include:e.include||"user,platform",sort:e.sort||"created_at"};return await this.find(t)}async confirm(e,t){if(!u.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);const s={status:"confirmed"};return t&&t!==e.amount()&&(s.confirmedAmount=t),await this.update(e,s)}async reject(e,t){if(!u.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);const s={status:"rejected"};return t&&(s.adminNote=t),await this.update(e,s)}canModify(e){const t=u.session.user;return t?t.isAdmin()?!0:String(e.userId())===String(t.id())&&e.status()==="pending":!1}canCreate(){const e=u.session.user;return e?!e.isGuest():!1}canDelete(e){const t=u.session.user;return t?t.isAdmin()?!0:String(e.userId())===String(t.id())&&e.status()==="pending":!1}async getPlatforms(){try{const e=await u.store.find(this.platformModelType,{sort:"name"});return Array.isArray(e)?e:[e]}catch(e){throw this.handleError(e,"Failed to fetch deposit platforms")}}async getPlatformsBySymbol(){const e=await this.getPlatforms(),t={};for(const s of e){const r=s.symbol();t[r]||(t[r]=[]),t[r].push(s)}return t}async validateDepositRecord(e){const{platformId:t,amount:s}=e,r=await u.store.find(this.platformModelType,t);if(!r)throw new o("Invalid platform selected",d.VALIDATION_ERROR);if(!r.isActive())throw new o("Selected platform is not available",d.VALIDATION_ERROR);const i=r.minAmount();if(s<i)throw new o(`Minimum deposit amount is ${i}`,d.VALIDATION_ERROR)}validateCreateAttributes(e){const t=["platformId","amount"];for(const s of t)if(!e[s])throw new o(`${s} is required`,d.VALIDATION_ERROR);if(typeof e.amount!="number"||e.amount<=0)throw new o("Amount must be a positive number",d.VALIDATION_ERROR)}handleError(e,t){if(e instanceof o)return e;if(e.response&&e.response.errors){const s=e.response.errors[0];return new o(s.detail||t,d.VALIDATION_ERROR,s.code,s)}return e.name==="TypeError"||e.message?.includes("fetch")?new o("Network error occurred",d.NETWORK_ERROR):new o(e.message||t,d.SERVER_ERROR)}isNotFoundError(e){return e.status===404||e.response?.status===404||e.message?.includes("not found")}}const O=new Ae;class De{constructor(){this.withdrawalModelType="funds-platforms",this.depositModelType="deposit-platforms"}async find(e,t={}){const s=e==="funds"?this.withdrawalModelType:this.depositModelType;try{const r={sort:t.sort||"name",...t};t.page&&(r.page=t.page),t.filter&&(r.filter=t.filter),t.include&&(r.include=t.include);const i=await u.store.find(s,r);return Array.isArray(i)?i:[i]}catch(r){throw this.handleError(r,`Failed to fetch ${e} platforms`)}}async findById(e,t,s={}){const r=e==="funds"?this.withdrawalModelType:this.depositModelType;try{const i={};return s.include&&(i.include=s.include),await u.store.find(r,t,i)}catch(i){if(this.isNotFoundError(i))return null;throw this.handleError(i,`Failed to fetch ${e} platform ${t}`)}}async create(e,t){const s=e==="funds"?this.withdrawalModelType:this.depositModelType;try{return this.validateCreateAttributes(e,t),await u.store.createRecord(s).save(t)}catch(r){throw this.handleError(r,`Failed to create ${e} platform`)}}async update(e,t){try{if(!this.canModify(e))throw new o("You do not have permission to modify this platform",d.PERMISSION_DENIED);return await e.save(t)}catch(s){throw this.handleError(s,"Failed to update platform")}}async delete(e){try{if(!this.canDelete(e))throw new o("You do not have permission to delete this platform",d.PERMISSION_DENIED);await e.delete()}catch(t){throw this.handleError(t,"Failed to delete platform")}}async getActive(e,t={}){const s={...t,filter:{isActive:!0,...t.filter}};return await this.find(e,s)}async toggleStatus(e){if(!u.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);const t=e.isActive();return await this.update(e,{isActive:!t})}async updateConfig(e,t){if(!u.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);return await this.update(e,t)}async getBySymbol(e,t){return await this.find(t,{filter:{symbol:e},sort:"name"})}validateAmount(e,t){const s=[];if(typeof t!="number"||t<=0)return s.push("Amount must be a positive number"),{valid:!1,errors:s};const r=e.minAmount?e.minAmount():0,i=e.maxAmount?e.maxAmount():null;return t<r&&s.push(`Amount must be at least ${r}`),i&&t>i&&s.push(`Amount cannot exceed ${i}`),{valid:s.length===0,errors:s}}async getPlatformStats(e,t){if(!u.session.user?.isAdmin())throw new o("Admin permissions required",d.PERMISSION_DENIED);const s=e==="funds"?"funds-requests":"deposit-records";try{const r=await u.store.find(s,{filter:{platform:t},include:"platform"}),i=Array.isArray(r)?r:[r];return{total:i.length,pending:i.filter(w=>w.status()==="pending").length,approved:i.filter(w=>w.status()==="approved"||w.status()==="confirmed").length,rejected:i.filter(w=>w.status()==="rejected").length,totalAmount:i.reduce((w,p)=>w+(p.amount()||0),0)}}catch(r){throw this.handleError(r,"Failed to fetch platform statistics")}}async getPlatformsBySymbolGrouped(e){const t=await this.getActive(e),s={};for(const r of t){const i=r.symbol();s[i]||(s[i]=[]),s[i].push(r)}return s}async getSortedPlatforms(e,t="name",s="asc"){const r=s==="desc"?`-${t}`:t;return await this.getActive(e,{sort:r})}canModify(e){const t=u.session.user;return t&&t.isAdmin()}canCreate(){const e=u.session.user;return e&&e.isAdmin()}canDelete(e){const t=u.session.user;return t&&t.isAdmin()}validateCreateAttributes(e,t){const r=["name","symbol","minAmount"];for(const i of r)if(!t[i])throw new o(`${i} is required for ${e} platforms`,d.VALIDATION_ERROR);if(typeof t.minAmount!="number"||t.minAmount<0)throw new o("minAmount must be a non-negative number",d.VALIDATION_ERROR);if(t.maxAmount!==void 0&&(typeof t.maxAmount!="number"||t.maxAmount<t.minAmount))throw new o("maxAmount must be a number greater than or equal to minAmount",d.VALIDATION_ERROR);if(t.fee!==void 0&&(typeof t.fee!="number"||t.fee<0))throw new o("fee must be a non-negative number",d.VALIDATION_ERROR);if(typeof t.symbol!="string"||!t.symbol.trim())throw new o("Symbol is required",d.VALIDATION_ERROR)}handleError(e,t){if(e instanceof o)return e;if(e.response&&e.response.errors){const s=e.response.errors[0];return new o(s.detail||t,d.VALIDATION_ERROR,s.code,s)}return e.name==="TypeError"||e.message?.includes("fetch")?new o("Network error occurred",d.NETWORK_ERROR):new o(e.message||t,d.SERVER_ERROR)}isNotFoundError(e){return e.status===404||e.response?.status===404||e.message?.includes("not found")}}const Q=new De;class Ie{async generateAddress(e,t){try{if(!u.session.user)throw new o("User not authenticated",d.PERMISSION_DENIED);const r=await u.store.find("deposit-platforms",e);if(!r)throw new o("Invalid platform selected",d.VALIDATION_ERROR);if(!r.isActive())throw new o("Platform is not currently active",d.VALIDATION_ERROR);if(!r.address())throw new o("Platform does not have a configured deposit address",d.VALIDATION_ERROR);return r.address()}catch(s){throw this.handleError(s,"Failed to get deposit address")}}canGenerateAddress(){const e=u.session.user;return e&&!e.isGuest()}handleError(e,t){if(e instanceof o)return e;if(e.response&&e.response.errors){const s=e.response.errors[0];return new o(s.detail||t,d.VALIDATION_ERROR,s.code,s)}return e.name==="TypeError"||e.message?.includes("fetch")?new o("Network error occurred",d.NETWORK_ERROR):new o(e.message||t,d.SERVER_ERROR)}}const Re=new Ie,Pe=Object.freeze(Object.defineProperty({__proto__:null,addressService:Re},Symbol.toStringTag,{value:"Module"}));function Z(a,e="An error occurred"){if(!a)return e;if(a.response&&a.response.errors&&Array.isArray(a.response.errors)){const t=a.response.errors[0];if(t&&t.detail)return t.detail}if(a.responseText){if(a.responseText.includes("<b>Fatal error</b>")||a.responseText.includes("<!DOCTYPE"))return"Server error occurred. Please try again later.";try{const t=JSON.parse(a.responseText);if(t.errors&&Array.isArray(t.errors))return t.errors[0].detail||e}catch{return"Server error occurred. Please try again later."}}return e}class k extends ae{constructor(){super(...arguments),this.state={withdrawalPlatforms:[],withdrawalRequests:[],userBalance:0,loadingBalance:!0,submitting:!1,depositPlatforms:[],depositRecords:[],submittingDepositRecord:!1,loading:!0,activeTab:g("withdrawal"),withdrawalSubTab:g("form"),depositSubTab:g("form")},this.withdrawalFormData={amount:g(""),selectedPlatform:g(null),accountDetails:g(""),message:g("")},this.depositFormData={selectedPlatform:g(null),userMessage:g("")},this.depositAddressData={address:"",platform:null,loading:!1},this.availablePlatforms=[]}oninit(e){super.oninit(e);const s=new URLSearchParams(window.location.search).get("tab");s&&(s==="withdrawal"||s==="withdrawal-history"?(this.state.activeTab("withdrawal"),this.state.withdrawalSubTab(s==="withdrawal-history"?"history":"form")):s==="deposit"||s==="deposit-history"?(this.state.activeTab("deposit"),this.state.depositSubTab(s==="deposit-history"?"history":"form")):this.isValidTab(s)&&this.state.activeTab(s)),this.updatePageTitle(),this.loadAllData()}isValidTab(e){return["withdrawal","deposit"].includes(e)}isValidSubTab(e){return["form","history"].includes(e)}handleSubTabChange(e,t){e==="withdrawal"?this.state.withdrawalSubTab(t):e==="deposit"&&this.state.depositSubTab(t),this.updateUrl(),c.redraw()}updateUrl(){const e=this.state.activeTab(),t=new URLSearchParams;e==="withdrawal"?this.state.withdrawalSubTab()==="history"?t.set("tab","withdrawal-history"):t.set("tab","withdrawal"):e==="deposit"&&(this.state.depositSubTab()==="history"?t.set("tab","deposit-history"):t.set("tab","deposit"));const s=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",s)}updatePageTitle(){const e=this.state.activeTab();let t="withdrawal.forum.page.title";switch(e){case"withdrawal":case"withdrawal-history":t="withdrawal.forum.page.title";break;case"deposit":case"deposit-history":t="withdrawal.forum.deposit.page.title";break}const s=n.translator.trans(t);n.setTitle(typeof s=="string"?s:s.toString())}view(){return this.state.loading?c("div",{className:"FundsPage"},c("div",{className:"FundsPage-loading"},c(Y,null))):c("div",{className:"FundsPage"},c("div",{className:"FundsPage-modal"},this.renderHeader(),c("div",{className:"FundsPage-content"},this.renderActiveTab())))}renderHeader(){const e=this.state.activeTab();return c("div",{className:"FundsPage-header"},c("div",{className:"FundsPage-tabs"},c("div",{className:`FundsPage-tab ${e==="withdrawal"?"active":""}`,onclick:()=>this.handleTabChange("withdrawal")},n.translator.trans("withdrawal.forum.tabs.withdrawal")),c("div",{className:`FundsPage-tab ${e==="deposit"?"active":""}`,onclick:()=>this.handleTabChange("deposit")},n.translator.trans("withdrawal.forum.deposit.tabs.deposit"))),c(S,{className:"FundsPage-close",icon:"fas fa-times",onclick:()=>n.history.back()}))}renderActiveTab(){switch(this.state.activeTab()){case"withdrawal":return this.renderWithdrawalTab();case"deposit":return this.renderDepositTab();default:return this.renderWithdrawalTab()}}renderWithdrawalTab(){const e=this.state.withdrawalSubTab();return c("div",{className:"FundsPage-withdrawalTab"},c("div",{className:"FundsPage-subTabs"},c("div",{className:`FundsPage-subTab ${e==="form"?"active":""}`,onclick:()=>this.handleSubTabChange("withdrawal","form")},n.translator.trans("withdrawal.forum.tabs.withdrawal")),c("div",{className:`FundsPage-subTab ${e==="history"?"active":""}`,onclick:()=>this.handleSubTabChange("withdrawal","history")},n.translator.trans("withdrawal.forum.tabs.history"))),e==="form"?this.renderWithdrawalForm():this.renderWithdrawalHistory())}renderWithdrawalForm(){return(this.state.withdrawalPlatforms||[]).filter(t=>!!t).length===0?c("div",{className:"FundsPage-withdrawalContent"},c("div",{className:"WithdrawalPage-emptyState"},c("div",{className:"WithdrawalPage-emptyIcon"},y("fas fa-coins")),c("h3",{className:"WithdrawalPage-emptyTitle"},n.translator.trans("withdrawal.forum.no_platforms")),c("p",{className:"WithdrawalPage-emptyDescription"},n.translator.trans("withdrawal.forum.no_platforms_description")))):c("div",{className:"FundsPage-withdrawalContent"},c(me,{platforms:this.state.withdrawalPlatforms,formData:this.getWithdrawalFormDataForComponent(),loadingBalance:this.state.loadingBalance,submitting:this.state.submitting,onFormDataChange:this.handleWithdrawalFormDataChange.bind(this),onFillAllAmount:this.handleFillAllAmount.bind(this),onSubmit:this.handleWithdrawalSubmit.bind(this)}))}renderWithdrawalHistory(){return c("div",{className:"FundsPage-withdrawalContent"},c(X,{transactions:this.state.withdrawalRequests,platforms:this.state.withdrawalPlatforms,loading:!1,type:"withdrawal"}))}renderDepositTab(){const e=this.state.depositSubTab();return c("div",{className:"FundsPage-depositTab"},c("div",{className:"FundsPage-subTabs"},c("div",{className:`FundsPage-subTab ${e==="form"?"active":""}`,onclick:()=>this.handleSubTabChange("deposit","form")},n.translator.trans("withdrawal.forum.deposit.tabs.deposit")),c("div",{className:`FundsPage-subTab ${e==="history"?"active":""}`,onclick:()=>this.handleSubTabChange("deposit","history")},n.translator.trans("withdrawal.forum.deposit.tabs.history"))),e==="form"?this.renderDepositForm():this.renderDepositHistory())}renderDepositForm(){return(this.state.depositPlatforms||[]).filter(t=>t&&h(t,"isActive")).length===0?c("div",{className:"FundsPage-depositContent"},c("div",{className:"FundsPage-emptyState"},c("div",{className:"FundsPage-emptyIcon"},y("fas fa-coins")),c("h3",{className:"FundsPage-emptyTitle"},n.translator.trans("withdrawal.forum.deposit.no_platforms")),c("p",{className:"FundsPage-emptyDescription"},n.translator.trans("withdrawal.forum.deposit.no_platforms_description")))):c("div",{className:"FundsPage-depositContent"},this.renderDepositSelectors(),this.renderDepositInfo())}renderDepositHistory(){const e=[...this.state.depositRecords];return e.sort((t,s)=>{const r=T(t,"createdAt")||new Date(0);return(T(s,"createdAt")||new Date(0)).getTime()-r.getTime()}),c("div",{className:"FundsPage-depositContent"},c(X,{transactions:e,platforms:this.state.depositPlatforms,loading:!1,type:"deposit"}))}renderDepositSelectors(){return c("div",{className:"FundsPage-selectors"},c(pe,{platforms:this.availablePlatforms,selectedPlatform:this.depositFormData.selectedPlatform(),onPlatformSelect:e=>this.handlePlatformSelect(e)}))}renderDepositInfo(){const e=this.depositFormData.selectedPlatform();if(!e)return c("div",{className:"FundsPage-selectPrompt"},c("p",null,n.translator.trans("withdrawal.forum.deposit.select_platform")));const t=h(e,"minAmount")||0,s=h(e,"warningText")||n.translator.trans("withdrawal.forum.deposit.default_warning",{currency:h(e,"symbol"),network:h(e,"network"),minAmount:t});return c("div",{className:"FundsPage-depositInfo"},c("p",{className:"FundsPage-instructionText"},n.translator.trans("withdrawal.forum.deposit.scan_or_use_address")),c(ye,{address:this.depositAddressData.address,loading:this.depositAddressData.loading,onCopy:this.handleCopyAddress.bind(this)}),c("p",{className:"FundsPage-minAmountText"},n.translator.trans("withdrawal.forum.deposit.min_amount",{amount:t,currency:h(e,"symbol")})),(()=>{const r=h(e,"fee")||0;return r>0?c("p",{className:"FundsPage-feeText"},n.translator.trans("withdrawal.forum.deposit.fee",{fee:r,currency:h(e,"symbol")})):null})(),this.depositAddressData.platform&&this.depositAddressData.platform.qrCodeImageUrl&&this.depositAddressData.platform.qrCodeImageUrl()&&c("div",{className:"FundsPage-imageContainer"},c(ge,{platform:this.depositAddressData.platform,loading:this.depositAddressData.loading,size:160})),c("div",{className:"FundsPage-infoPanel"},c("i",{className:"fas fa-info-circle"}),c("span",null,s)),c("div",{className:"FundsPage-recordSection"},c("div",{className:"FundsPage-recordHeader"},c("h4",null,n.translator.trans("withdrawal.forum.deposit.record.section_title"))),c(ve,{platform:e,onSubmit:this.handleDepositRecordSubmit.bind(this),onCancel:this.handleCancelDepositRecordForm.bind(this),submitting:this.state.submittingDepositRecord})))}handleTabChange(e){this.state.activeTab(e),this.updatePageTitle();const t=new URL(window.location.href);t.searchParams.set("tab",e);const s=e==="withdrawal"?this.state.withdrawalSubTab():this.state.depositSubTab();t.searchParams.set("subtab",s),window.history.replaceState({},"",t.toString())}getWithdrawalFormDataForComponent(){return{selectedPlatform:this.withdrawalFormData.selectedPlatform(),amount:this.withdrawalFormData.amount(),accountDetails:this.withdrawalFormData.accountDetails(),message:this.withdrawalFormData.message()}}handleWithdrawalFormDataChange(e){e.selectedPlatform!==void 0&&this.withdrawalFormData.selectedPlatform(e.selectedPlatform),e.amount!==void 0&&this.withdrawalFormData.amount(e.amount),e.accountDetails!==void 0&&this.withdrawalFormData.accountDetails(e.accountDetails),e.message!==void 0&&this.withdrawalFormData.message(e.message)}async handleFillAllAmount(){const e=this.withdrawalFormData.selectedPlatform();if(e&&!this.state.loadingBalance)try{await this.loadUserBalance(!0);const t=h(e,"fee")||0,s=h(e,"maxAmount")||1/0;let r=this.state.userBalance-t;s<1/0&&r>s&&(r=s),r>0?this.withdrawalFormData.amount(r.toString()):n.alerts.show({type:"warning",dismissible:!0},n.translator.trans("withdrawal.forum.insufficient_balance"))}catch(t){console.error("Error refreshing balance:",t),n.alerts.show({type:"error",dismissible:!0},n.translator.trans("withdrawal.forum.balance_refresh_error"))}}async handleWithdrawalSubmit(){if(this.state.submitting)return;const e=this.withdrawalFormData.selectedPlatform(),t=this.withdrawalFormData.amount(),s=this.withdrawalFormData.accountDetails();if(!e||!t||!s)return;const r=parseFloat(t);if(isNaN(r)||r<=0){n.alerts.show({type:"warning",dismissible:!0},n.translator.trans("withdrawal.forum.invalid_amount"));return}this.state.submitting=!0;try{await x.submitRequest({platformId:parseInt(U(e),10),amount:r,accountDetails:s,message:this.withdrawalFormData.message()}),this.withdrawalFormData.amount(""),this.withdrawalFormData.accountDetails(""),this.withdrawalFormData.message(""),this.withdrawalFormData.selectedPlatform(null),await Promise.all([this.loadUserBalance(!0),this.loadWithdrawalRequests()]),n.alerts.show({type:"success",dismissible:!0},n.translator.trans("withdrawal.forum.submit_success"))}catch(i){console.error("Withdrawal request failed:",i);let f=n.translator.trans("withdrawal.forum.error").toString();i instanceof o?f=i.message:f=Z(i,f),n.alerts.show({type:"error",dismissible:!0},f)}finally{this.state.submitting=!1}}handlePlatformSelect(e){this.depositFormData.selectedPlatform(e),this.loadDepositAddress(e)}handleCopyAddress(){this.depositAddressData.address&&navigator.clipboard.writeText(this.depositAddressData.address).then(()=>{n.alerts.show({type:"success",dismissible:!0},n.translator.trans("withdrawal.forum.deposit.address_copied"))}).catch(()=>{n.alerts.show({type:"error",dismissible:!0},n.translator.trans("withdrawal.forum.deposit.copy_failed"))})}handleCancelDepositRecordForm(){c.redraw()}async handleDepositRecordSubmit(e){if(!this.state.submittingDepositRecord){this.state.submittingDepositRecord=!0,c.redraw();try{await O.create({platformId:e.platformId,platformAccount:e.platformAccount,realName:e.realName,amount:e.amount,depositTime:e.depositTime.toISOString(),screenshotUrl:e.screenshotUrl,userMessage:e.userMessage,status:"pending"}),n.alerts.show({type:"success",dismissible:!0},n.translator.trans("withdrawal.forum.deposit.record.submit_success")),await this.loadDepositRecords()}catch(t){console.error("Deposit record submission failed:",t);let s=n.translator.trans("withdrawal.forum.deposit.record.submit_error").toString();t instanceof o?s=t.message:s=Z(t,s),n.alerts.show({type:"error",dismissible:!0},s)}finally{this.state.submittingDepositRecord=!1,c.redraw()}}}async loadAllData(){try{await Promise.all([this.loadWithdrawalData(),this.loadDepositData(),this.loadUserBalance()]),this.state.loading=!1,c.redraw()}catch(e){console.error("Error loading data:",e),this.state.loading=!1,c.redraw()}}async loadWithdrawalData(){try{const[e,t]=await Promise.all([Q.getActive("withdrawal"),x.getUserHistory()]);this.state.withdrawalPlatforms=e,this.state.withdrawalRequests=t}catch(e){console.error("Error loading funds data:",e),this.state.withdrawalPlatforms=[],this.state.withdrawalRequests=[]}}async loadDepositData(){try{const[e,t]=await Promise.all([Q.getActive("deposit"),O.getUserHistory()]);this.state.depositPlatforms=e,this.state.depositRecords=t,this.availablePlatforms=e.filter(s=>h(s,"isActive"))}catch(e){console.error("Error loading deposit data:",e),this.state.depositPlatforms=[],this.state.depositRecords=[],this.availablePlatforms=[]}}async loadDepositRecords(){try{const e=await O.getUserHistory();this.state.depositRecords=e}catch(e){console.error("Error loading deposit records:",e),this.state.depositRecords=[]}}async loadUserBalance(e=!1){try{if(this.state.loadingBalance=!0,e&&n.session.user){const t=n.session.user.id();if(!t)throw new Error("User ID not available");const s=await n.store.find("users",t);s?this.state.userBalance=parseFloat(s.attribute("money"))||0:this.state.userBalance=0}else this.state.userBalance=parseFloat(n.session.user?.attribute("money")||"0");this.state.loadingBalance=!1,c.redraw()}catch(t){console.error("Error loading user balance:",t),this.state.loadingBalance=!1,c.redraw()}}async loadWithdrawalRequests(){try{const e=await x.getUserHistory();this.state.withdrawalRequests=e}catch(e){console.error("Error loading funds requests:",e),this.state.withdrawalRequests=[]}}async loadDepositAddress(e){this.depositAddressData.loading=!0,c.redraw();try{const t=await O.generateAddress(parseInt(h(e,"id"),10));this.depositAddressData={address:t,platform:e,loading:!1},c.redraw()}catch(t){console.error("Error loading deposit address:",t),this.depositAddressData.loading=!1;let s=n.translator.trans("withdrawal.forum.deposit.address_load_error").toString();t instanceof o&&(s=t.message),n.alerts.show({type:"error",dismissible:!0},s),c.redraw()}}}function $(a){const e=[];return a.name!==void 0&&(!a.name||typeof a.name!="string")&&e.push("Platform name is required"),a.symbol!==void 0&&(!a.symbol||typeof a.symbol!="string")&&e.push("Symbol is required"),e}function ee(a,e){const t=[];if(a.minAmount!==void 0&&(typeof a.minAmount!="number"||a.minAmount<0)&&t.push("Minimum amount must be a non-negative number"),a.maxAmount!==void 0&&a.maxAmount!==null){(typeof a.maxAmount!="number"||a.maxAmount<0)&&t.push("Maximum amount must be a non-negative number");const s=a.minAmount??e??0;a.maxAmount<s&&t.push("Maximum amount must be greater than or equal to minimum amount")}return a.fee!==void 0&&a.fee!==null&&(typeof a.fee!="number"||a.fee<0)&&t.push("Fee must be a non-negative number"),t}function Ee(a){const e=[];return a.network!==void 0&&a.network!==null&&a.network!==""&&typeof a.network!="string"&&e.push("Network must be a string"),a.address!==void 0&&a.address!==null&&a.address!==""&&typeof a.address!="string"&&e.push("Deposit address must be a string"),e}function te(a){if(a.length>0)throw new o(a.join(", "),d.VALIDATION_ERROR)}function Se(a,e){const t=[...$(a),...ee(a,e)];te(t)}function Te(a,e){const t=[...$(a),...ee(a,e),...Ee(a)];te(t)}class Fe extends l{constructor(){super(...arguments),this.name=l.attribute("name"),this.symbol=l.attribute("symbol"),this.network=l.attribute("network"),this.displayName=l.attribute("displayName"),this.minAmount=l.attribute("minAmount"),this.maxAmount=l.attribute("maxAmount"),this.fee=l.attribute("fee"),this.currencyIconUrl=l.attribute("currencyIconUrl"),this.currencyIconClass=l.attribute("currencyIconClass"),this.currencyUnicodeSymbol=l.attribute("currencyUnicodeSymbol"),this.networkIconUrl=l.attribute("networkIconUrl"),this.networkIconClass=l.attribute("networkIconClass"),this.platformSpecificIconUrl=l.attribute("platformSpecificIconUrl"),this.platformSpecificIconClass=l.attribute("platformSpecificIconClass"),this.currencyIconOverrideUrl=l.attribute("currencyIconOverrideUrl"),this.currencyIconOverrideClass=l.attribute("currencyIconOverrideClass"),this.networkIconOverrideUrl=l.attribute("networkIconOverrideUrl"),this.networkIconOverrideClass=l.attribute("networkIconOverrideClass"),this.isActive=l.attribute("isActive"),this.createdAt=l.attribute("createdAt",l.transformDate),this.updatedAt=l.attribute("updatedAt",l.transformDate),this.bestIcon=l.attribute("bestIcon"),this.currencyIcon=l.attribute("currencyIcon"),this.networkIcon=l.attribute("networkIcon")}apiEndpoint(){const e=this.id();return e?`/funds-platforms/${e}`:"/funds-platforms"}getDisplayName(){return this.displayName()||this.name()}isValidAmount(e){const t=this.minAmount(),s=this.maxAmount();return e>=t&&e<=s}getTotalCost(e){return e+this.fee()}async save(e){e&&this.validateAttributes(e);try{return await super.save(e)}catch(t){throw this.handleSaveError(t)}}async delete(){if(!this.canDelete())throw new o("You do not have permission to delete this platform",d.PERMISSION_DENIED);if(await this.isInUse())throw new o("Cannot delete platform that has pending funds requests",d.VALIDATION_ERROR);try{await super.delete()}catch(e){throw this.handleDeleteError(e)}}async toggleStatus(){if(!this.canModify())throw new o("You do not have permission to modify this platform",d.PERMISSION_DENIED);return await this.save({isActive:!this.isActive()})}clone(){const e=u.store.createRecord("funds-platforms");return e.pushAttributes({name:this.name()+" (Copy)",symbol:this.symbol(),network:this.network(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),currencyIconOverrideUrl:this.currencyIconOverrideUrl(),currencyIconOverrideClass:this.currencyIconOverrideClass(),networkIconOverrideUrl:this.networkIconOverrideUrl(),networkIconOverrideClass:this.networkIconOverrideClass(),isActive:!1}),e}validateAmount(e){const t=[];return typeof e!="number"||e<=0?(t.push("Amount must be a positive number"),{valid:!1,errors:t}):(e<this.minAmount()&&t.push(`Amount must be at least ${this.minAmount()} ${this.symbol()}`),this.maxAmount()&&e>this.maxAmount()&&t.push(`Amount cannot exceed ${this.maxAmount()} ${this.symbol()}`),{valid:t.length===0,errors:t})}validateUserBalance(e,t){const s=[],r=this.getTotalCost(e);if(t<r){const i=this.fee()>0?` (including ${this.fee()} ${this.symbol()} fee)`:"";s.push(`Insufficient balance. Required: ${r} ${this.symbol()}${i}, Available: ${t} ${this.symbol()}`)}return{valid:s.length===0,errors:s}}canModify(){const e=u.session.user;return e&&e.isAdmin()}canDelete(){const e=u.session.user;return e&&e.isAdmin()}canView(){if(this.isActive())return!0;const e=u.session.user;return e&&e.isAdmin()}async isInUse(){try{const e=await u.store.find("funds-requests",{filter:{platform:this.id(),status:"pending"}});return(Array.isArray(e)?e:[e]).length>0}catch{return!0}}getFormattedFee(){const e=this.fee();return e===0?"Free":`${e} ${this.symbol()}`}getFormattedLimits(){const e=this.minAmount(),t=this.maxAmount(),s=this.symbol();return t?`${e} - ${t} ${s}`:`Min: ${e} ${s}`}validateAttributes(e){Se(e,this.minAmount())}handleSaveError(e){if(e instanceof o)return e;if(e.response&&e.response.errors){const t=e.response.errors[0];return new o(t.detail||"Failed to save funds platform",d.VALIDATION_ERROR,t.code,t)}return new o(e.message||"Failed to save funds platform",d.SERVER_ERROR)}handleDeleteError(e){return e instanceof o?e:e.status===403||e.response?.status===403?new o("You do not have permission to delete this platform",d.PERMISSION_DENIED):new o(e.message||"Failed to delete funds platform",d.SERVER_ERROR)}}const P={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"};class Oe extends l{constructor(){super(...arguments),this.amount=l.attribute("amount"),this.accountDetails=l.attribute("accountDetails"),this.message=l.attribute("message"),this.status=l.attribute("status"),this.platformId=l.attribute("platformId"),this.userId=l.attribute("userId"),this.createdAt=l.attribute("createdAt",l.transformDate),this.updatedAt=l.attribute("updatedAt",l.transformDate),this.user=l.hasOne("user"),this.platform=l.hasOne("platform")}apiEndpoint(){const e=this.id();return e?`/funds-requests/${e}`:"/funds-requests"}isPending(){return this.status()===P.PENDING}isApproved(){return this.status()===P.APPROVED}isRejected(){return this.status()===P.REJECTED}canBeModified(){return this.isPending()}statusLabel(){const e=this.status();return u.translator.trans(`funds.forum.status.${e}`).toString()}statusColor(){switch(this.status()){case P.APPROVED:return"success";case P.REJECTED:return"danger";case P.PENDING:default:return"warning"}}async save(e){e&&this.validateAttributes(e);try{return await super.save(e)}catch(t){throw this.handleSaveError(t)}}async delete(){if(!this.canDelete())throw new o("You do not have permission to delete this request",d.PERMISSION_DENIED);const e=u.session.user;if(e&&!e.isAdmin()&&!this.canBeModified())throw new o("This request cannot be deleted as it has already been processed",d.VALIDATION_ERROR);try{await super.delete()}catch(t){throw this.handleDeleteError(t)}}clone(){const e=u.store.createRecord("funds-requests");return e.pushAttributes({platformId:this.platformId(),amount:this.amount(),accountDetails:this.accountDetails(),message:this.message()}),e}getTotalCost(){const e=this.platform(),t=e&&e.fee()||0;return this.amount()+t}getFormattedAmount(){const e=this.platform(),t=e?e.symbol():"";return`${this.amount()} ${t}`.trim()}getFormattedTotalCost(){const e=this.platform(),t=e?e.symbol():"",s=e&&e.fee()||0;return s>0?`${this.amount()} + ${s} (fee) = ${this.getTotalCost()} ${t}`.trim():this.getFormattedAmount()}canModify(){const e=u.session.user;return e?e.isAdmin()?!0:this.userId()===e.id()&&this.canBeModified():!1}canDelete(){const e=u.session.user;return e?e.isAdmin()?!0:this.userId()===e.id()&&this.canBeModified():!1}canView(){const e=u.session.user;return e?e.isAdmin()?!0:this.userId()===e.id():!1}validateAttributes(e){const t=[];if(e.amount!==void 0&&(typeof e.amount!="number"||e.amount<=0)&&t.push("Amount must be a positive number"),e.accountDetails!==void 0&&(!e.accountDetails||typeof e.accountDetails!="string")&&t.push("Account details are required"),e.platformId!==void 0&&(!e.platformId||typeof e.platformId!="number")&&t.push("Platform selection is required"),t.length>0)throw new o(t.join(", "),d.VALIDATION_ERROR)}handleSaveError(e){if(e instanceof o)return e;if(e.response&&e.response.errors){const t=e.response.errors[0];return new o(t.detail||"Failed to save funds request",d.VALIDATION_ERROR,t.code,t)}return new o(e.message||"Failed to save funds request",d.SERVER_ERROR)}handleDeleteError(e){return e instanceof o?e:e.status===403||e.response?.status===403?new o("You do not have permission to delete this request",d.PERMISSION_DENIED):new o(e.message||"Failed to delete funds request",d.SERVER_ERROR)}}class _e extends l{constructor(){super(...arguments),this.name=l.attribute("name"),this.symbol=l.attribute("symbol"),this.network=l.attribute("network"),this.networkTypeId=l.attribute("networkTypeId"),this.displayName=l.attribute("displayName"),this.minAmount=l.attribute("minAmount"),this.maxAmount=l.attribute("maxAmount"),this.fee=l.attribute("fee"),this.address=l.attribute("address"),this.qrCodeImageUrl=l.attribute("qrCodeImageUrl"),this.currencyIconUrl=l.attribute("currencyIconUrl"),this.currencyIconClass=l.attribute("currencyIconClass"),this.currencyUnicodeSymbol=l.attribute("currencyUnicodeSymbol"),this.networkIconUrl=l.attribute("networkIconUrl"),this.networkIconClass=l.attribute("networkIconClass"),this.platformSpecificIconUrl=l.attribute("platformSpecificIconUrl"),this.platformSpecificIconClass=l.attribute("platformSpecificIconClass"),this.currencyIconOverrideUrl=l.attribute("currencyIconOverrideUrl"),this.currencyIconOverrideClass=l.attribute("currencyIconOverrideClass"),this.networkIconOverrideUrl=l.attribute("networkIconOverrideUrl"),this.networkIconOverrideClass=l.attribute("networkIconOverrideClass"),this.warningText=l.attribute("warningText"),this.networkConfig=l.attribute("networkConfig"),this.isActive=l.attribute("isActive"),this.createdAt=l.attribute("createdAt",l.transformDate),this.updatedAt=l.attribute("updatedAt",l.transformDate),this.networkType=l.hasOne("networkType"),this.bestIcon=l.attribute("bestIcon"),this.currencyIcon=l.attribute("currencyIcon"),this.networkIcon=l.attribute("networkIcon")}getDisplayName(){return this.displayName()||this.name()}getFullDisplayName(){const e=this.getDisplayName(),t=this.network();return t?`${e} (${t})`:e}isValidAmount(e){const t=this.minAmount()||0,s=this.maxAmount();return e>=t&&(s===null||e<=s)}getTotalCost(e){return e+(this.fee()||0)}async save(e){e&&this.validateAttributes(e);try{return await super.save(e)}catch(t){throw this.handleSaveError(t)}}async delete(){if(!this.canDelete())throw new o("You do not have permission to delete this platform",d.PERMISSION_DENIED);if(await this.isInUse())throw new o("Cannot delete platform that has pending deposit records",d.VALIDATION_ERROR);try{await super.delete()}catch(e){throw this.handleDeleteError(e)}}async toggleStatus(){if(!this.canModify())throw new o("You do not have permission to modify this platform",d.PERMISSION_DENIED);return await this.save({isActive:!this.isActive()})}clone(){const e=u.store.createRecord("deposit-platforms");return e.pushAttributes({name:this.name()+" (Copy)",symbol:this.symbol(),network:this.network(),networkTypeId:this.networkTypeId(),minAmount:this.minAmount(),maxAmount:this.maxAmount(),fee:this.fee(),address:this.address(),qrCodeImageUrl:this.qrCodeImageUrl(),iconUrl:this.iconUrl(),iconClass:this.iconClass(),warningText:this.warningText(),isActive:!1}),e}validateAmount(e){const t=[];if(typeof e!="number"||e<=0)return t.push("Amount must be a positive number"),{valid:!1,errors:t};const s=this.minAmount()||0;e<s&&t.push(`Amount must be at least ${s} ${this.symbol()}`);const r=this.maxAmount();return r&&e>r&&t.push(`Amount cannot exceed ${r} ${this.symbol()}`),{valid:t.length===0,errors:t}}canModify(){const e=u.session.user;return e&&e.isAdmin()}canDelete(){const e=u.session.user;return e&&e.isAdmin()}canView(){if(this.isActive())return!0;const e=u.session.user;return e&&e.isAdmin()}async isInUse(){try{const e=await u.store.find("deposit-records",{filter:{platform:this.id(),status:"pending"}});return(Array.isArray(e)?e:[e]).length>0}catch{return!0}}getFormattedFee(){const e=this.fee()||0;return e===0?"Free":`${e} ${this.symbol()}`}getFormattedLimits(){const e=this.minAmount()||0,t=this.maxAmount(),s=this.symbol();return t?`${e} - ${t} ${s}`:`Min: ${e} ${s}`}generateDepositAddress(e){const t=this.address();if(t)return t;throw new o("No deposit address configured for this platform",d.VALIDATION_ERROR)}validateAttributes(e){Te(e,this.minAmount())}handleSaveError(e){if(e instanceof o)return e;if(e.response&&e.response.errors){const t=e.response.errors[0];return new o(t.detail||"Failed to save deposit platform",d.VALIDATION_ERROR,t.code,t)}return new o(e.message||"Failed to save deposit platform",d.SERVER_ERROR)}handleDeleteError(e){return e instanceof o?e:e.status===403||e.response?.status===403?new o("You do not have permission to delete this platform",d.PERMISSION_DENIED):new o(e.message||"Failed to delete deposit platform",d.SERVER_ERROR)}}const N=class N extends l{constructor(){super(...arguments),this.id=l.attribute("id"),this.userId=l.attribute("userId"),this.platformId=l.attribute("platformId"),this.platformAccount=l.attribute("platformAccount"),this.realName=l.attribute("realName"),this.amount=l.attribute("amount"),this.depositTime=l.attribute("depositTime",l.transformDate),this.screenshotUrl=l.attribute("screenshotUrl"),this.userMessage=l.attribute("userMessage"),this.status=l.attribute("status"),this.processedAt=l.attribute("processedAt",l.transformDate),this.processedBy=l.attribute("processedBy"),this.adminNotes=l.attribute("adminNotes"),this.creditedAmount=l.attribute("creditedAmount"),this.createdAt=l.attribute("createdAt",l.transformDate),this.updatedAt=l.attribute("updatedAt",l.transformDate),this.user=l.hasOne("user"),this.platform=l.hasOne("platform"),this.processedByUser=l.hasOne("processedByUser")}isPending(){return this.status()===N.STATUS_PENDING}isApproved(){return this.status()===N.STATUS_APPROVED}isRejected(){return this.status()===N.STATUS_REJECTED}getStatusColor(){switch(this.status()){case N.STATUS_PENDING:return"warning";case N.STATUS_APPROVED:return"success";case N.STATUS_REJECTED:return"error";default:return"secondary"}}getStatusLabel(){const e=this.status();return u.translator.trans(`funds.forum.deposit.status.${e}`).toString()}canBeModified(){return this.isPending()}async save(e){e&&this.validateAttributes(e);try{return await super.save(e)}catch(t){throw this.handleSaveError(t)}}async delete(){if(!this.canDelete())throw new o("You do not have permission to delete this deposit record",d.PERMISSION_DENIED);try{await super.delete()}catch(e){throw this.handleDeleteError(e)}}clone(){const e=u.store.createRecord("deposit-records");return e.pushAttributes({platformId:this.platformId(),amount:this.amount(),platformAccount:this.platformAccount(),realName:this.realName(),userMessage:this.userMessage(),screenshotUrl:this.screenshotUrl()}),e}getFormattedAmount(){const e=this.platform(),t=e?e.symbol():"";return`${this.amount()} ${t}`.trim()}getFinalAmount(){return this.creditedAmount()||this.amount()}getFormattedFinalAmount(){const e=this.platform(),t=e?e.symbol():"",s=this.getFinalAmount();return this.creditedAmount()&&this.creditedAmount()!==this.amount()?`${s} ${t} (credited: ${this.creditedAmount()})`.trim():`${s} ${t}`.trim()}canModify(){const e=u.session.user;return e?e.isAdmin()?!0:this.userId()===e.id()&&this.canBeModified():!1}canDelete(){const e=u.session.user;return e?e.isAdmin()?!0:this.userId()===e.id()&&this.canBeModified():!1}canView(){const e=u.session.user;return e?e.isAdmin()?!0:this.userId()===e.id():!1}canProcess(){const e=u.session.user;return e&&e.isAdmin()&&this.isPending()}async approve(e,t){if(!this.canProcess())throw new o("You do not have permission to approve this deposit",d.PERMISSION_DENIED);const s={status:N.STATUS_APPROVED,processedAt:new Date,processedBy:u.session.user?.id()};return e!==void 0&&(s.creditedAmount=e),t&&(s.adminNotes=t),await this.save(s)}async reject(e){if(!this.canProcess())throw new o("You do not have permission to reject this deposit",d.PERMISSION_DENIED);const t={status:N.STATUS_REJECTED,processedAt:new Date,processedBy:u.session.user?.id()};return e&&(t.adminNotes=e),await this.save(t)}validateAttributes(e){const t=[];if(e.amount!==void 0&&(typeof e.amount!="number"||e.amount<=0)&&t.push("Amount must be a positive number"),e.platformAccount!==void 0&&(!e.platformAccount||typeof e.platformAccount!="string")&&t.push("Platform account is required"),e.realName!==void 0&&(!e.realName||typeof e.realName!="string")&&t.push("Real name is required"),e.platformId!==void 0&&(!e.platformId||typeof e.platformId!="number")&&t.push("Platform selection is required"),e.creditedAmount!==void 0&&(typeof e.creditedAmount!="number"||e.creditedAmount<0)&&t.push("Credited amount must be a non-negative number"),t.length>0)throw new o(t.join(", "),d.VALIDATION_ERROR)}handleSaveError(e){if(e instanceof o)return e;if(e.response&&e.response.errors){const t=e.response.errors[0];return new o(t.detail||"Failed to save deposit record",d.VALIDATION_ERROR,t.code,t)}return new o(e.message||"Failed to save deposit record",d.SERVER_ERROR)}handleDeleteError(e){return e instanceof o?e:e.status===403||e.response?.status===403?new o("You do not have permission to delete this record",d.PERMISSION_DENIED):new o(e.message||"Failed to delete deposit record",d.SERVER_ERROR)}};N.STATUS_PENDING="pending",N.STATUS_APPROVED="approved",N.STATUS_REJECTED="rejected";let W=N;class Ce extends v{view(){if(!n.session.user)return null;const t=(n.forum.attribute("antoinefr-money.moneyname")||"[money]").replace("[money]",n.session.user.attribute("money")),s=n.forum.attribute("wusong8899-funds.moneyIconUrl");return m("div",{id:"moneyDisplayContainer",className:"client1-header-adv-wrapper clientCustomizeWithdrawalHeaderTotalMoney"},m("div",{className:"clientCustomizeWithdrawalHeaderText"},s&&s.trim()&&m("span",{style:{borderRadius:"50%",padding:"6px 8px",marginRight:"8px",display:"inline-flex",alignItems:"center",justifyContent:"center"}},m("img",{src:s,alt:"Money icon",style:{width:"20px",height:"20px"},onError:r=>{const i=r.target;i.style.display="none"}})),t),m("div",{className:"clientCustomizeWithdrawalHeaderIcon"},m("i",{className:"fas fa-wallet"})),m("div",{className:"clientCustomizeWithdrawalButtons"},m("div",{className:"clientCustomizeWithdrawalButton",onclick:this.handleWithdrawalClick.bind(this),title:"提款"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",{style:{marginLeft:"4px",fontSize:"12px"}},"提款")),m("div",{className:"clientCustomizeDepositButton",onclick:this.handleDepositClick.bind(this),title:"存款",style:{marginLeft:"8px"}},m("i",{className:"fas fa-coins"}),m("span",{style:{marginLeft:"4px",fontSize:"12px"}},"存款"))))}handleWithdrawalClick(e){e.preventDefault(),e.stopPropagation(),window.location.href="/funds?tab=funds"}handleDepositClick(e){e.preventDefault(),e.stopPropagation(),window.location.href="/funds?tab=deposit"}}class Ue extends v{view(){const e=n.session.user?.attribute("money")||0,t=n.forum.attribute("wusong8899-funds.moneyIconUrl");return m("div",{className:"Navigation-mobileMoneyDisplay"},m("div",{className:"Navigation-moneySection",onclick:this.handleWithdrawalClick.bind(this),title:`余额: ${e} - 点击提款`},m("div",{className:"Navigation-moneyText"},t&&t.trim()&&m("span",{style:{borderRadius:"50%",padding:"4px 6px",marginRight:"6px",display:"inline-flex",alignItems:"center",justifyContent:"center"}},m("img",{src:t,alt:"Money icon",style:{width:"18px",height:"18px"},onError:s=>{const r=s.target;r.style.display="none"}})),m("span",{className:"Navigation-moneyAmount"},e)),m("div",{className:"Navigation-withdrawalButton"},m("i",{className:"fas fa-money-bill-transfer"}),m("span",null,"提款"))))}handleWithdrawalClick(e){e.preventDefault(),e.stopPropagation(),console.log("MobileMoneyDisplay clicked!");try{window.location.href="/funds?tab=funds"}catch(t){console.error("Navigation error:",t),window.location.href="/funds?tab=funds"}}}class E{constructor(){}static getInstance(){return E.instance||(E.instance=new E),E.instance}isTagsPage(){try{return n.current?.get("routeName")==="index"}catch{return!1}}}function q(){return window.innerWidth<=767}function V(){return window.innerWidth>=768&&window.innerWidth<=1024}function xe(){return window.innerWidth>1024}function ke(){return q()||V()}function We(){return q()?"mobile":V()?"tablet":"desktop"}function qe(){return"ontouchstart"in window||navigator.maxTouchPoints>0}const Ve={isMobile:q,isTablet:V,isDesktop:xe,isMobileOrTablet:ke,getCurrentBreakpoint:We,isTouchDevice:qe};n.initializers.add("wusong8899-funds",()=>{n.store.models["funds-platforms"]=Fe,n.store.models["funds-requests"]=Oe,n.store.models["deposit-platforms"]=_e,n.store.models["deposit-records"]=W,n.routes.funds={path:"/funds",component:k},n.routes.funds={path:"/funds",component:k},n.routes.deposit={path:"/deposit",component:k},j.extend(se.prototype,"view",function(a){const e=E.getInstance();n.session.user&&e.isTagsPage()&&!Ve.isMobile()&&a.children.push(Ce.component())}),j.extend(re.prototype,"view",function(a){if(window.innerWidth>768||n.current.get("routeName")!=="tags"||!n.session.user||!a||!a.children||!Array.isArray(a.children))return;a.children.some(s=>s&&s.attrs&&s.attrs.className&&s.attrs.className.includes("Navigation-mobileMoneyDisplay"))||a.children.push(Ue.component({className:"item-funds Navigation-mobileMoneyDisplay"}))})})})(flarum.core.compat["common/app"],flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["forum/components/HeaderPrimary"],flarum.core.compat["common/components/Navigation"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/icon"],m,flarum.core.compat["common/Component"],flarum.core.compat["common/helpers/humanTime"],flarum.core.compat["common/utils/withAttr"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=forum.js.map

module.exports={};