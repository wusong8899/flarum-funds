(function(t,w,f,g,b,c,P,l,r,e,N){"use strict";class W extends b{constructor(){super(...arguments),this.platforms=[],this.requests=[],this.loading=!0,this.submitting=!1,this.loadingBalance=!0,this.userBalance=0,this.showDropdown=!1,this.amount=l(""),this.selectedPlatform=l(null),this.accountDetails=l(""),this.saveAddress=l(!1)}oninit(a){super.oninit(a),t.setTitle(t.translator.trans("withdrawal.forum.page.title")),this.loadData(),this.loadUserBalance()}view(){return this.loading?m("div",{className:"WithdrawalPage"},m("div",{className:"WithdrawalPage-loading"},m(P,null))):m("div",{className:"WithdrawalPage"},m("div",{className:"WithdrawalPage-modal"},m("div",{className:"WithdrawalPage-header"},m("div",{className:"WithdrawalPage-tabs"},m("div",{className:"WithdrawalPage-tab active"},t.translator.trans("withdrawal.forum.tabs.crypto"))),m("button",{className:"WithdrawalPage-close",onclick:()=>window.history.back()},r("fas fa-times"))),m("div",{className:"WithdrawalPage-content"},this.renderCryptoTypeToggle(),this.renderPlatformSelector(),this.renderAmountSection(),this.renderAddressSection(),this.renderSecurityNotices(),this.renderSubmitButton())))}renderCryptoTypeToggle(){return m("div",{className:"WithdrawalPage-typeToggle"},m("div",{className:"WithdrawalPage-typeOption active"},t.translator.trans("withdrawal.forum.types.crypto")),m("div",{className:"WithdrawalPage-typeOption"},t.translator.trans("withdrawal.forum.types.fiat"),m("span",{className:"WithdrawalPage-infoIcon"},r("fas fa-info-circle"))))}renderPlatformSelector(){const a=this.selectedPlatform();return m("div",{className:"WithdrawalPage-platformSelector"},m("div",{className:"WithdrawalPage-platformDropdown",onclick:()=>this.showDropdown=!this.showDropdown},m("div",{className:"WithdrawalPage-platformSelected"},m("div",{className:"WithdrawalPage-platformInfo"},m("div",{className:"WithdrawalPage-platformIcon"},a?this.renderPlatformIcon(a):r("fas fa-bitcoin",{className:"default-icon"})),m("div",{className:"WithdrawalPage-platformDetails"},m("div",{className:"WithdrawalPage-platformSymbol"},a&&a.attributes&&a.attributes.symbol||"BTC"),m("div",{className:"WithdrawalPage-platformFlow"},t.translator.trans("withdrawal.forum.remaining_flow",{amount:"0.00000000"})))),m("div",{className:"WithdrawalPage-platformName"},a&&a.attributes?a.attributes.name:"Bitcoin")),r("fas fa-chevron-down",{className:"WithdrawalPage-dropdownIcon"})),this.showDropdown&&this.renderPlatformDropdown())}renderPlatformDropdown(){const a=(this.platforms||[]).filter(s=>s&&s.attributes&&s.attributes.symbol);return a.length===0?m("div",{className:"WithdrawalPage-dropdownMenu"},m("div",{className:"WithdrawalPage-dropdownItem WithdrawalPage-noData"},t.translator.trans("withdrawal.forum.no_platforms"))):m("div",{className:"WithdrawalPage-dropdownMenu"},a.map(s=>m("div",{key:s.id,className:"WithdrawalPage-dropdownItem",onclick:()=>{this.selectedPlatform(s),this.showDropdown=!1,this.amount("")}},m("div",{className:"WithdrawalPage-platformIcon"},this.renderPlatformIcon(s)),m("div",{className:"WithdrawalPage-platformDetails"},m("div",{className:"WithdrawalPage-platformSymbol"},s.attributes.symbol),m("div",{className:"WithdrawalPage-platformName"},s.attributes.name)))))}renderPlatformIcon(a){if(!a||!a.attributes||!a.attributes.symbol)return r("fas fa-coins",{className:"crypto-icon default"});const s={BTC:"fab fa-bitcoin",ETH:"fab fa-ethereum",LTC:"fas fa-coins",USDT:"fas fa-dollar-sign",USDC:"fas fa-dollar-sign",BNB:"fas fa-coins",ADA:"fas fa-coins",DOT:"fas fa-coins",SOL:"fas fa-coins",MATIC:"fas fa-coins"},i=a.attributes.symbol,o=s[i]||"fas fa-coins";return r(o,{className:`crypto-icon ${i.toLowerCase()}`})}renderAmountSection(){const a=this.selectedPlatform(),s=a?.attributes.minAmount||.001,i=a?.attributes.maxAmount||10,o=a?.attributes.fee||5e-4;return m("div",{className:"WithdrawalPage-amountSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-balanceHeader"},m("span",{className:"WithdrawalPage-label"},t.translator.trans("withdrawal.forum.form.amount")),m("span",{className:"WithdrawalPage-balance"},t.translator.trans("withdrawal.forum.available_balance",{amount:this.loadingBalance?"0.00000000":this.userBalance.toFixed(8)}))),m("div",{className:"WithdrawalPage-amountInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:"0.00000000",value:this.amount(),oninput:d=>this.amount(d.target.value)}),m(c,{className:"WithdrawalPage-allButton",onclick:this.fillAllAmount.bind(this)},t.translator.trans("withdrawal.forum.form.all_button"))),m("div",{className:"WithdrawalPage-amountLimits"},m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},t.translator.trans("withdrawal.forum.limits.min_max")),m("span",{className:"WithdrawalPage-limitValue"},r("fas fa-coins")," ",s," ~ ",i)),m("div",{className:"WithdrawalPage-limitRow"},m("span",{className:"WithdrawalPage-limitLabel"},t.translator.trans("withdrawal.forum.limits.fee")),m("span",{className:"WithdrawalPage-limitValue"},r("fas fa-coins")," ",o)))))}renderAddressSection(){const s=this.selectedPlatform()?.attributes.symbol||"BTC";return m("div",{className:"WithdrawalPage-addressSection"},m("div",{className:"WithdrawalPage-formGroup"},m("div",{className:"WithdrawalPage-addressHeader"},m("span",{className:"WithdrawalPage-label"},t.translator.trans("withdrawal.forum.form.address",{symbol:s}),m("span",{className:"WithdrawalPage-required"},"*")),m("div",{className:"WithdrawalPage-saveAddress",onclick:()=>this.saveAddress(!this.saveAddress())},r("fas fa-bookmark"),t.translator.trans("withdrawal.forum.form.save_address"))),m("div",{className:"WithdrawalPage-addressInput"},m("input",{type:"text",className:"WithdrawalPage-input",placeholder:t.translator.trans("withdrawal.forum.form.address_placeholder"),value:this.accountDetails(),oninput:i=>this.accountDetails(i.target.value)}),m("button",{className:"WithdrawalPage-pasteButton",onclick:this.pasteFromClipboard.bind(this)},r("fas fa-paste")))))}renderSecurityNotices(){return m("div",{className:"WithdrawalPage-securityNotices"},m("div",{className:"WithdrawalPage-securityNotice",onclick:()=>this.redirectToPhoneBinding()},m("div",{className:"WithdrawalPage-noticeContent"},m("span",{className:"WithdrawalPage-noticeText"},t.translator.trans("withdrawal.forum.security.bind_phone")),m("span",{className:"WithdrawalPage-noticeAction"},"GO")),r("fas fa-chevron-right")),m("div",{className:"WithdrawalPage-securityNotice",onclick:()=>this.redirectTo2FA()},m("div",{className:"WithdrawalPage-noticeContent"},m("span",{className:"WithdrawalPage-noticeText"},t.translator.trans("withdrawal.forum.security.bind_2fa")),m("span",{className:"WithdrawalPage-noticeAction"},"GO")),r("fas fa-chevron-right")))}renderSubmitButton(){const a=parseFloat(this.amount())||0,s=this.selectedPlatform(),i=s?.attributes.fee||0,o=Math.max(0,a-i),d=s?.attributes.symbol||"BTC";return m("div",{className:"WithdrawalPage-submitSection"},m(c,{className:"WithdrawalPage-submitButton",loading:this.submitting,disabled:!this.canSubmit(),onclick:this.submit.bind(this)},t.translator.trans("withdrawal.forum.form.submit")),a>0&&m("div",{className:"WithdrawalPage-finalAmount"},t.translator.trans("withdrawal.forum.final_amount",{amount:o.toFixed(8),symbol:d})))}canSubmit(){return!!(this.selectedPlatform()&&this.amount()&&this.accountDetails()&&!this.submitting&&parseFloat(this.amount())>0)}fillAllAmount(){this.loadingBalance||this.amount(this.userBalance.toFixed(8))}async pasteFromClipboard(){try{if(navigator.clipboard&&navigator.clipboard.readText){const a=await navigator.clipboard.readText();this.accountDetails(a.trim()),m.redraw()}}catch(a){console.error("Failed to read from clipboard:",a),t.alerts.show({type:"error",dismissible:!0},t.translator.trans("withdrawal.forum.clipboard_error"))}}redirectToPhoneBinding(){t.alerts.show({type:"info",dismissible:!0},t.translator.trans("withdrawal.forum.phone_binding_redirect"))}redirectTo2FA(){t.alerts.show({type:"info",dismissible:!0},t.translator.trans("withdrawal.forum.2fa_redirect"))}async submit(){if(this.canSubmit()){this.submitting=!0;try{const a=this.selectedPlatform(),s=await t.request({method:"POST",url:t.forum.attribute("apiUrl")+"/withdrawal-requests",body:{data:{type:"withdrawal-requests",attributes:{platformId:a.id,amount:parseFloat(this.amount()),accountDetails:this.accountDetails()}}}});s&&s.data&&t.store.pushPayload(s),t.alerts.show({type:"success",dismissible:!0},t.translator.trans("withdrawal.forum.form.success")),this.amount(""),this.accountDetails(""),this.saveAddress(!1),this.loadRequests()}catch(a){console.error("Error submitting withdrawal request:",a),t.alerts.show({type:"error",dismissible:!0},t.translator.trans("withdrawal.forum.form.error"))}finally{this.submitting=!1,m.redraw()}}}async loadData(){try{await Promise.all([this.loadPlatforms(),this.loadRequests()])}catch(a){console.error("Error loading data:",a)}finally{this.loading=!1,m.redraw()}}async loadPlatforms(){try{console.log("Loading withdrawal platforms...");const a=await t.store.find("withdrawal-platforms");console.log("Platform response:",a),this.platforms=Array.isArray(a)?a.filter(s=>s!==null):a?[a]:[],console.log("Processed platforms:",this.platforms),this.platforms.length>0&&!this.selectedPlatform()&&this.selectedPlatform(this.platforms[0])}catch(a){console.error("Error loading platforms:",a),this.platforms=[]}}async loadRequests(){try{const a=await t.store.find("withdrawal-requests");this.requests=Array.isArray(a)?a.filter(s=>s!==null):a?[a]:[]}catch(a){console.error("Error loading requests:",a),this.requests=[]}}async loadUserBalance(){try{this.userBalance=t.session.user?.attribute("money")||0,this.loadingBalance=!1,m.redraw()}catch(a){console.error("Error loading user balance:",a),this.loadingBalance=!1,m.redraw()}}}class h extends e{constructor(){super(...arguments),this.name=e.attribute("name"),this.symbol=e.attribute("symbol"),this.minAmount=e.attribute("minAmount"),this.maxAmount=e.attribute("maxAmount"),this.fee=e.attribute("fee"),this.icon=e.attribute("icon"),this.isActive=e.attribute("isActive"),this.createdAt=e.attribute("createdAt",e.transformDate),this.updatedAt=e.attribute("updatedAt",e.transformDate)}}class u extends e{constructor(){super(...arguments),this.amount=e.attribute("amount"),this.accountDetails=e.attribute("accountDetails"),this.status=e.attribute("status"),this.createdAt=e.attribute("createdAt",e.transformDate),this.updatedAt=e.attribute("updatedAt",e.transformDate),this.user=e.hasOne("user"),this.platform=e.hasOne("withdrawal-platforms")}}new N.Store().add("withdrawal-platforms",h).add("withdrawal-requests",u),t.initializers.add("wusong8899-withdrawal",()=>{t.store.models["withdrawal-platforms"]=h,t.store.models["withdrawal-requests"]=u,t.routes.withdrawal={path:"/withdrawal",component:W},w.extend(g.prototype,"items",function(n){t.session.user&&n.add("withdrawal",f.component({href:t.route("withdrawal"),icon:"fas fa-money-bill-transfer"},t.translator.trans("withdrawal.forum.header.withdrawal_button")),10)})})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["common/components/LinkButton"],flarum.core.compat["forum/components/HeaderSecondary"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/icon"],flarum.core.compat["common/Model"],flarum.core.compat["common/extenders"]);
//# sourceMappingURL=forum.js.map

module.exports={};