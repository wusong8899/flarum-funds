{"version":3,"file":"admin.js","sources":["../src/common/components/shared/ConfirmModal.tsx","../src/admin/components/shared/GenericManagementPage.tsx","../src/admin/components/sections/GeneralSettingsSection.tsx","../src/common/utils/formValidators.ts","../src/admin/components/forms/AddPlatformForm.tsx","../src/admin/components/shared/GenericPlatformListItem.tsx","../src/admin/components/sections/PlatformManagementSection.tsx","../src/admin/components/items/WithdrawalRequestItem.tsx","../src/admin/components/sections/RequestManagementSection.tsx","../src/admin/components/sections/DepositRecordManagementSection.tsx","../src/admin/components/forms/AddDepositPlatformForm.tsx","../src/admin/components/sections/DepositPlatformManagementSection.tsx","../src/admin/utils/platformOperations.ts","../src/common/types/services.ts","../src/common/services/WithdrawalService.ts","../src/common/services/DepositService.ts","../src/common/services/PlatformService.ts","../src/common/services/SettingsService.ts","../src/admin/components/UnifiedManagementPage.tsx","../src/common/utils/PlatformValidation.ts","../src/common/models/WithdrawalPlatform.ts","../src/common/types/index.ts","../src/common/models/WithdrawalRequest.ts","../src/common/models/DepositPlatform.ts","../src/common/models/DepositRecord.ts","../src/admin/index.ts"],"sourcesContent":["import Modal, { IInternalModalAttrs } from 'flarum/common/components/Modal';\r\nimport Button from 'flarum/common/components/Button';\r\nimport icon from 'flarum/common/helpers/icon';\r\nimport app from 'flarum/common/app';\r\n\r\nexport interface ConfirmModalAttrs extends IInternalModalAttrs {\r\n  title: string;\r\n  message: string;\r\n  confirmText?: string;\r\n  cancelText?: string;\r\n  onConfirm: () => void;\r\n  onCancel: () => void;\r\n  dangerous?: boolean;\r\n  icon?: string;\r\n}\r\n\r\n/**\r\n * 通用确认模态框组件\r\n * 用于替代重复的删除确认、状态变更确认等模态框\r\n */\r\nexport default class ConfirmModal extends Modal<ConfirmModalAttrs> {\r\n  className() {\r\n    return 'ConfirmModal';\r\n  }\r\n\r\n  title() {\r\n    const { title, dangerous = false, icon: modalIcon = dangerous ? 'fas fa-exclamation-triangle' : 'fas fa-question-circle' } = this.attrs;\r\n    \r\n    return (\r\n      <span>\r\n        {modalIcon && (\r\n          <span className={`ConfirmModal-icon ${dangerous ? 'dangerous' : ''}`}>\r\n            {icon(modalIcon)}\r\n          </span>\r\n        )}\r\n        {title}\r\n      </span>\r\n    );\r\n  }\r\n\r\n  content() {\r\n    const { \r\n      message, \r\n      confirmText = 'Confirm',\r\n      cancelText = 'Cancel',\r\n      onConfirm, \r\n      onCancel, \r\n      dangerous = false\r\n    } = this.attrs;\r\n\r\n    return (\r\n      <div className=\"Modal-body\">\r\n        <div className=\"ConfirmModal-message\">\r\n          {message}\r\n        </div>\r\n        \r\n        <div className=\"Form-group\">\r\n          <div className=\"ButtonGroup\">\r\n            <Button\r\n              className=\"Button\"\r\n              onclick={() => {\r\n                onCancel();\r\n                app.modal.close();\r\n              }}\r\n            >\r\n              {cancelText}\r\n            </Button>\r\n            <Button\r\n              className={`Button Button--${dangerous ? 'danger' : 'primary'}`}\r\n              onclick={() => {\r\n                onConfirm();\r\n                app.modal.close();\r\n              }}\r\n            >\r\n              {confirmText}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport ExtensionPage from 'flarum/admin/components/ExtensionPage';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport m from 'mithril';\r\nimport type Mithril from 'mithril';\r\nimport ConfirmModal from '../../../common/components/shared/ConfirmModal';\r\n\r\n// Generic interfaces for platform management\r\nexport interface GenericPlatform {\r\n  id?: () => string | number;\r\n  name?: () => string;\r\n  isActive?: () => boolean;\r\n  [key: string]: any;\r\n}\r\n\r\nexport interface GenericTransaction {\r\n  id?: () => string | number;\r\n  status?: () => string;\r\n  [key: string]: any;\r\n}\r\n\r\nexport interface PlatformOperations<T extends GenericPlatform> {\r\n  create: (data: any) => Promise<T>;\r\n  toggleStatus: (platform: T) => Promise<void>;\r\n  delete: (platform: T) => Promise<void>;\r\n  load: () => Promise<T[]>;\r\n}\r\n\r\nexport interface TransactionOperations<T extends GenericTransaction> {\r\n  updateStatus: (transaction: T, status: string) => Promise<void>;\r\n  load: () => Promise<T[]>;\r\n}\r\n\r\nexport interface TabConfiguration {\r\n  key: string;\r\n  label: string;\r\n  component: Mithril.ComponentTypes<any>;\r\n  props?: () => any;\r\n}\r\n\r\nexport interface GenericManagementPageConfig<\r\n  TPlatform extends GenericPlatform,\r\n  TTransaction extends GenericTransaction\r\n> {\r\n  pageTitle: string;\r\n  extensionId: string;\r\n  \r\n  // Platform configuration\r\n  platformOperations: PlatformOperations<TPlatform>;\r\n  transactionOperations?: TransactionOperations<TTransaction>;\r\n  \r\n  // Tab configuration\r\n  tabs: TabConfiguration[];\r\n  \r\n  // Optional settings section\r\n  settingsComponent?: Mithril.ComponentTypes<any>;\r\n  \r\n  // Translation prefixes\r\n  translations: {\r\n    platformPrefix: string;\r\n    transactionPrefix?: string;\r\n  };\r\n}\r\n\r\nexport default abstract class GenericManagementPage<\r\n  TPlatform extends GenericPlatform,\r\n  TTransaction extends GenericTransaction\r\n> extends ExtensionPage {\r\n  \r\n  // State management\r\n  protected platforms: TPlatform[] = [];\r\n  protected transactions: TTransaction[] = [];\r\n  loading = true;\r\n  protected submittingPlatform = false;\r\n  protected activeTab: string;\r\n  \r\n  // Abstract configuration - must be implemented by subclasses\r\n  protected abstract getConfig(): GenericManagementPageConfig<TPlatform, TTransaction>;\r\n  \r\n  constructor() {\r\n    super();\r\n    const config = this.getConfig();\r\n    this.activeTab = config.tabs[0]?.key || '';\r\n  }\r\n\r\n  oninit(vnode: Mithril.VnodeDOM) {\r\n    super.oninit(vnode);\r\n    this.loadData();\r\n  }\r\n\r\n  content() {\r\n    if (this.loading) {\r\n      return <LoadingIndicator />;\r\n    }\r\n\r\n    const config = this.getConfig();\r\n\r\n    return (\r\n      <div className={`${config.extensionId}ManagementPage`}>\r\n        <div className=\"container\">\r\n          <h2>{config.pageTitle}</h2>\r\n          \r\n          {config.settingsComponent && (\r\n            <div className=\"SettingsSection\">\r\n              {m(config.settingsComponent, { \r\n                onSettingChange: this.saveSetting.bind(this) \r\n              })}\r\n            </div>\r\n          )}\r\n          \r\n          {config.tabs.length > 1 && (\r\n            <div className=\"AdminTabs\">\r\n              <div className=\"AdminTabs-nav\">\r\n                {config.tabs.map(tab => (\r\n                  <button \r\n                    key={tab.key}\r\n                    className={`AdminTabs-tab ${this.activeTab === tab.key ? 'active' : ''}`}\r\n                    onclick={() => { this.activeTab = tab.key; }}\r\n                  >\r\n                    {tab.label}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              \r\n              <div className=\"AdminTabs-content\">\r\n                {this.renderActiveTabContent()}\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          {config.tabs.length === 1 && (\r\n            <div className=\"SingleTabContent\">\r\n              {this.renderActiveTabContent()}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  protected renderActiveTabContent(): Mithril.Children {\r\n    const config = this.getConfig();\r\n    const activeTab = config.tabs.find(tab => tab.key === this.activeTab);\r\n    \r\n    if (!activeTab) return null;\r\n\r\n    const props = {\r\n      // Common platform management props\r\n      platforms: this.platforms,\r\n      transactions: this.transactions,\r\n      submittingPlatform: this.submittingPlatform,\r\n      \r\n      // Platform management callbacks\r\n      onAddPlatform: this.addPlatform.bind(this),\r\n      onTogglePlatformStatus: this.togglePlatformStatus.bind(this),\r\n      onDeletePlatform: this.deletePlatform.bind(this),\r\n      \r\n      // Transaction management callbacks\r\n      ...(config.transactionOperations && {\r\n        onUpdateTransactionStatus: this.updateTransactionStatus.bind(this),\r\n      }),\r\n      \r\n      // Additional props from tab configuration\r\n      ...(activeTab.props ? activeTab.props() : {})\r\n    };\r\n\r\n    return m(activeTab.component, props);\r\n  }\r\n\r\n  // Generic platform management methods\r\n  protected async addPlatform(formData: any): Promise<void> {\r\n    if (this.submittingPlatform) return;\r\n\r\n    this.submittingPlatform = true;\r\n    const config = this.getConfig();\r\n\r\n    try {\r\n      await config.platformOperations.create(formData);\r\n      await this.loadPlatforms();\r\n    } catch (error) {\r\n      console.error('Error adding platform:', error);\r\n      // Error handling is done by the platform operations\r\n    } finally {\r\n      this.submittingPlatform = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  protected async togglePlatformStatus(platform: TPlatform): Promise<void> {\r\n    const config = this.getConfig();\r\n    try {\r\n      await config.platformOperations.toggleStatus(platform);\r\n      await this.loadPlatforms();\r\n      m.redraw();\r\n    } catch (error) {\r\n      console.error('Error toggling platform status:', error);\r\n    }\r\n  }\r\n\r\n  protected deletePlatform(platform: TPlatform): void {\r\n    const config = this.getConfig();\r\n    const platformName = (typeof platform.name === 'function' ? platform.name() : platform.name) || 'Unknown Platform';\r\n    \r\n    app.modal.show(ConfirmModal, {\r\n      title: app.translator.trans(`${config.translations.platformPrefix}.delete_confirm_title`),\r\n      message: app.translator.trans(`${config.translations.platformPrefix}.delete_confirm_message`, { name: platformName }),\r\n      confirmText: app.translator.trans(`${config.translations.platformPrefix}.delete_confirm_button`),\r\n      cancelText: app.translator.trans(`${config.translations.platformPrefix}.delete_cancel_button`),\r\n      dangerous: true,\r\n      icon: 'fas fa-trash',\r\n      onConfirm: async () => {\r\n        try {\r\n          await config.platformOperations.delete(platform);\r\n          await this.loadPlatforms();\r\n          m.redraw();\r\n          \r\n          app.alerts.show(\r\n            { type: 'success', dismissible: true },\r\n            app.translator.trans(`${config.translations.platformPrefix}.delete_success`)\r\n          );\r\n        } catch (error) {\r\n          console.error('Error deleting platform:', error);\r\n          app.alerts.show(\r\n            { type: 'error', dismissible: true },\r\n            app.translator.trans(`${config.translations.platformPrefix}.delete_error`)\r\n          );\r\n        }\r\n      },\r\n      onCancel: () => {\r\n        app.modal.close();\r\n      }\r\n    });\r\n  }\r\n\r\n  // Generic transaction management methods\r\n  protected async updateTransactionStatus(transaction: TTransaction, status: string): Promise<void> {\r\n    const config = this.getConfig();\r\n    if (!config.transactionOperations) return;\r\n\r\n    try {\r\n      await config.transactionOperations.updateStatus(transaction, status);\r\n      await this.loadTransactions();\r\n      \r\n      const prefix = config.translations.transactionPrefix || config.translations.platformPrefix;\r\n      app.alerts.show(\r\n        { type: 'success', dismissible: true },\r\n        app.translator.trans(`${prefix}.${status}_success`)\r\n      );\r\n    } catch (error) {\r\n      console.error('Error updating transaction:', error);\r\n      const prefix = config.translations.transactionPrefix || config.translations.platformPrefix;\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        app.translator.trans(`${prefix}.update_error`)\r\n      );\r\n    }\r\n  }\r\n\r\n  // Data loading methods\r\n  protected async loadData(): Promise<void> {\r\n    try {\r\n      await this.loadPlatforms();\r\n      if (this.getConfig().transactionOperations) {\r\n        await this.loadTransactions();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n    } finally {\r\n      this.loading = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  protected async loadPlatforms(): Promise<void> {\r\n    const config = this.getConfig();\r\n    try {\r\n      this.platforms = await config.platformOperations.load();\r\n      console.log('Loaded platforms:', this.platforms);\r\n    } catch (error) {\r\n      console.error('Error loading platforms:', error);\r\n      this.platforms = [];\r\n    }\r\n  }\r\n\r\n  protected async loadTransactions(): Promise<void> {\r\n    const config = this.getConfig();\r\n    if (!config.transactionOperations) return;\r\n\r\n    try {\r\n      this.transactions = await config.transactionOperations.load();\r\n      console.log('Loaded transactions:', this.transactions);\r\n    } catch (error) {\r\n      console.error('Error loading transactions:', error);\r\n      this.transactions = [];\r\n    }\r\n  }\r\n\r\n  // Settings management using SettingsService\r\n  protected async saveSetting(key: string, value: string): Promise<void> {\r\n    try {\r\n      // Import SettingsService dynamically to avoid circular dependencies\r\n      const { settingsService } = await import('../../../common/services/SettingsService');\r\n      await settingsService.saveSetting(key, value);\r\n      \r\n    } catch (error) {\r\n      console.error('Error saving setting:', error);\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        error instanceof Error ? error.message : 'Failed to save setting'\r\n      );\r\n    }\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\nimport withAttr from 'flarum/common/utils/withAttr';\r\nimport type Mithril from 'mithril';\r\n\r\nexport interface GeneralSettingsSectionAttrs {\r\n  onSettingChange: (key: string, value: string) => void;\r\n}\r\n\r\nexport default class GeneralSettingsSection extends Component<GeneralSettingsSectionAttrs> {\r\n  view(): Mithril.Children {\r\n    return (\r\n      <div className=\"WithdrawalManagementPage-section\">\r\n        <h3>General Settings</h3>\r\n        \r\n        <div className=\"Form\">\r\n          <div className=\"Form-group\">\r\n            <label>{app.translator.trans('funds.admin.settings.money_icon_url')}</label>\r\n            <input\r\n              type=\"url\"\r\n              className=\"FormControl\"\r\n              placeholder=\"https://i.mji.rip/2025/08/28/cd18932c68e9bbee9502b1fb6317cba9.png\"\r\n              value={app.forum.attribute('wusong8899-funds.moneyIconUrl') || ''}\r\n              oninput={withAttr('value', (value: string) => \r\n                this.attrs.onSettingChange('wusong8899-funds.moneyIconUrl', value)\r\n              )}\r\n            />\r\n            <small className=\"helpText\">{app.translator.trans('funds.admin.settings.money_icon_url_help')}</small>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}","import app from 'flarum/common/app';\r\n\r\nexport interface ValidationError {\r\n  field: string;\r\n  message: string;\r\n}\r\n\r\nexport interface ValidationResult {\r\n  isValid: boolean;\r\n  errors: ValidationError[];\r\n  firstErrorMessage?: string;\r\n}\r\n\r\n/**\r\n * 通用表单验证工具\r\n * 统一提款和存款平台表单的验证逻辑\r\n */\r\nexport class FormValidator {\r\n  private errors: ValidationError[] = [];\r\n\r\n  /**\r\n   * 验证必填字段\r\n   */\r\n  required(value: any, fieldName: string, displayName?: string): this {\r\n    if (!value || (typeof value === 'string' && value.trim() === '')) {\r\n      this.errors.push({\r\n        field: fieldName,\r\n        message: `${displayName || fieldName} is required`\r\n      });\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 验证最小长度\r\n   */\r\n  minLength(value: string, minLength: number, fieldName: string, displayName?: string): this {\r\n    if (value && value.length < minLength) {\r\n      this.errors.push({\r\n        field: fieldName,\r\n        message: `${displayName || fieldName} must be at least ${minLength} characters`\r\n      });\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 验证数字范围\r\n   */\r\n  numberRange(value: string | number, min?: number, max?: number, fieldName?: string, displayName?: string): this {\r\n    const numValue = typeof value === 'string' ? parseFloat(value) : value;\r\n    \r\n    if (isNaN(numValue)) {\r\n      this.errors.push({\r\n        field: fieldName || 'number',\r\n        message: `${displayName || 'Value'} must be a valid number`\r\n      });\r\n      return this;\r\n    }\r\n\r\n    if (min !== undefined && numValue < min) {\r\n      this.errors.push({\r\n        field: fieldName || 'number',\r\n        message: `${displayName || 'Value'} must be at least ${min}`\r\n      });\r\n    }\r\n\r\n    if (max !== undefined && numValue > max) {\r\n      this.errors.push({\r\n        field: fieldName || 'number',\r\n        message: `${displayName || 'Value'} must be at most ${max}`\r\n      });\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 验证URL格式\r\n   */\r\n  url(value: string, fieldName: string, displayName?: string): this {\r\n    if (value && value.trim()) {\r\n      try {\r\n        const _url = new URL(value);\r\n        // URL is valid, no action needed\r\n        void _url; // Explicit void to indicate we don't need the result\r\n      } catch {\r\n        this.errors.push({\r\n          field: fieldName,\r\n          message: `${displayName || fieldName} must be a valid URL`\r\n        });\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 自定义验证规则\r\n   */\r\n  custom(condition: boolean, fieldName: string, message: string): this {\r\n    if (!condition) {\r\n      this.errors.push({\r\n        field: fieldName,\r\n        message\r\n      });\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 获取验证结果\r\n   */\r\n  getResult(): ValidationResult {\r\n    const isValid = this.errors.length === 0;\r\n    return {\r\n      isValid,\r\n      errors: this.errors,\r\n      firstErrorMessage: this.errors.length > 0 ? this.errors[0].message : undefined\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 重置验证状态\r\n   */\r\n  reset(): this {\r\n    this.errors = [];\r\n    return this;\r\n  }\r\n}\r\n\r\n/**\r\n * 提款平台表单验证\r\n */\r\nexport function validateWithdrawalPlatform(data: {\r\n  name: string;\r\n  symbol: string;\r\n  network?: string;\r\n  minAmount: string;\r\n  maxAmount: string;\r\n  fee: string;\r\n  iconUrl?: string;\r\n}): ValidationResult {\r\n  const validator = new FormValidator();\r\n\r\n  validator\r\n    .required(data.name, 'name', 'Platform Name')\r\n    .required(data.symbol, 'symbol', 'Currency Symbol')\r\n    .minLength(data.symbol, 1, 'symbol', 'Currency Symbol')\r\n    .numberRange(data.minAmount, 0, undefined, 'minAmount', 'Minimum Amount')\r\n    .numberRange(data.fee, 0, undefined, 'fee', 'Fee');\r\n\r\n  if (data.maxAmount) {\r\n    validator.numberRange(data.maxAmount, parseFloat(data.minAmount) || 0, undefined, 'maxAmount', 'Maximum Amount');\r\n  }\r\n\r\n  if (data.iconUrl) {\r\n    validator.url(data.iconUrl, 'iconUrl', 'Icon URL');\r\n  }\r\n\r\n  return validator.getResult();\r\n}\r\n\r\n/**\r\n * 存款平台表单验证\r\n */\r\nexport function validateDepositPlatform(data: {\r\n  name: string;\r\n  symbol: string;\r\n  network?: string;\r\n  address: string;\r\n  minAmount: string;\r\n  maxAmount: string;\r\n  qrCodeImageUrl?: string;\r\n  iconUrl?: string;\r\n}): ValidationResult {\r\n  const validator = new FormValidator();\r\n\r\n  validator\r\n    .required(data.name, 'name', 'Platform Name')\r\n    .required(data.symbol, 'symbol', 'Currency Symbol')\r\n    .required(data.address, 'address', 'Deposit Address')\r\n    .minLength(data.symbol, 1, 'symbol', 'Currency Symbol')\r\n    .minLength(data.address, 10, 'address', 'Deposit Address');\r\n\r\n  if (data.minAmount) {\r\n    validator.numberRange(data.minAmount, 0, undefined, 'minAmount', 'Minimum Amount');\r\n  }\r\n\r\n  if (data.maxAmount) {\r\n    const minAmountNum = parseFloat(data.minAmount) || 0;\r\n    validator.numberRange(data.maxAmount, minAmountNum, undefined, 'maxAmount', 'Maximum Amount');\r\n  }\r\n\r\n  if (data.qrCodeImageUrl) {\r\n    validator.url(data.qrCodeImageUrl, 'qrCodeImageUrl', 'QR Code Image URL');\r\n  }\r\n\r\n  if (data.iconUrl) {\r\n    validator.url(data.iconUrl, 'iconUrl', 'Icon URL');\r\n  }\r\n\r\n  return validator.getResult();\r\n}\r\n\r\n/**\r\n * 显示验证错误警告\r\n */\r\nexport function showValidationErrors(result: ValidationResult): void {\r\n  if (!result.isValid && result.firstErrorMessage) {\r\n    app.alerts.show(\r\n      { type: 'error', dismissible: true },\r\n      result.firstErrorMessage\r\n    );\r\n  }\r\n}\r\n\r\n","import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport type Mithril from 'mithril';\r\nimport { PlatformFormData } from '../types/AdminTypes';\r\nimport { FormValidator } from '../../../common/utils/formValidators';\r\nimport m from 'mithril';\r\n\r\nexport interface AddPlatformFormAttrs {\r\n  onSubmit: (formData: PlatformFormData) => Promise<void>;\r\n  submitting: boolean;\r\n}\r\n\r\nexport default class AddPlatformForm extends Component<AddPlatformFormAttrs> {\r\n  private name = Stream('');\r\n  private symbol = Stream('');\r\n  private network = Stream('');\r\n  private minAmount = Stream('');\r\n  private maxAmount = Stream('');\r\n  private fee = Stream('');\r\n  // Three-tier icon system\r\n  private currencyIconOverrideUrl = Stream('');\r\n  private currencyIconOverrideClass = Stream('');\r\n  private networkIconOverrideUrl = Stream('');\r\n  private networkIconOverrideClass = Stream('');\r\n\r\n  view(): Mithril.Children {\r\n    return (\r\n      <div className=\"WithdrawalManagementPage-addPlatform\">\r\n        <div className=\"Form-group\">\r\n          <div className=\"Form-row\">\r\n            <div className=\"Form-col\">\r\n              <label>{app.translator.trans('funds.admin.platforms.name')}</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"FormControl\"\r\n                placeholder={app.translator.trans('funds.admin.platforms.add_placeholder')}\r\n                bidi={this.name}\r\n              />\r\n            </div>\r\n            <div className=\"Form-col\">\r\n              <label>{app.translator.trans('funds.admin.platforms.symbol')}</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"FormControl\"\r\n                placeholder=\"BTC, ETH, USDT...\"\r\n                bidi={this.symbol}\r\n              />\r\n            </div>\r\n            <div className=\"Form-col\">\r\n              <label>{app.translator.trans('funds.admin.platforms.network')}</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"FormControl\"\r\n                placeholder=\"TRC20, ERC20, BSC... (optional)\"\r\n                bidi={this.network}\r\n              />\r\n              <small className=\"helpText\">{app.translator.trans('funds.admin.platforms.network_help')}</small>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"Form-row\">\r\n            <div className=\"Form-col\">\r\n              <label>{app.translator.trans('funds.admin.platforms.min_amount')}</label>\r\n              <input\r\n                type=\"number\"\r\n                step=\"0.00000001\"\r\n                className=\"FormControl\"\r\n                placeholder=\"0.001\"\r\n                bidi={this.minAmount}\r\n              />\r\n            </div>\r\n            <div className=\"Form-col\">\r\n              <label>{app.translator.trans('funds.admin.platforms.max_amount')}</label>\r\n              <input\r\n                type=\"number\"\r\n                step=\"0.00000001\"\r\n                className=\"FormControl\"\r\n                placeholder=\"10.0\"\r\n                bidi={this.maxAmount}\r\n              />\r\n            </div>\r\n            <div className=\"Form-col\">\r\n              <label>{app.translator.trans('funds.admin.platforms.fee')}</label>\r\n              <input\r\n                type=\"number\"\r\n                step=\"0.00000001\"\r\n                className=\"FormControl\"\r\n                placeholder=\"0.0005\"\r\n                bidi={this.fee}\r\n              />\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Three-tier icon system */}\r\n          <div className=\"Form-section\">\r\n            <h4>{app.translator.trans('funds.admin.platforms.icon_configuration')}</h4>\r\n            <p className=\"helpText\">{app.translator.trans('funds.admin.platforms.icon_configuration_help')}</p>\r\n            \r\n            {/* Currency Icon Override */}\r\n            <div className=\"Form-row\">\r\n              <div className=\"Form-col\">\r\n                <label>{app.translator.trans('funds.admin.platforms.currency_icon_override_url')}</label>\r\n                <input\r\n                  type=\"url\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"https://example.com/currency-icon.png\"\r\n                  bidi={this.currencyIconOverrideUrl}\r\n                />\r\n                <small className=\"helpText\">{app.translator.trans('funds.admin.platforms.currency_icon_override_url_help')}</small>\r\n              </div>\r\n              <div className=\"Form-col\">\r\n                <label>{app.translator.trans('funds.admin.platforms.currency_icon_override_class')}</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"fab fa-bitcoin\"\r\n                  bidi={this.currencyIconOverrideClass}\r\n                />\r\n                <small className=\"helpText\">{app.translator.trans('funds.admin.platforms.currency_icon_override_class_help')}</small>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Network Icon Override */}\r\n            <div className=\"Form-row\">\r\n              <div className=\"Form-col\">\r\n                <label>{app.translator.trans('funds.admin.platforms.network_icon_override_url')}</label>\r\n                <input\r\n                  type=\"url\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"https://example.com/network-icon.png\"\r\n                  bidi={this.networkIconOverrideUrl}\r\n                />\r\n                <small className=\"helpText\">{app.translator.trans('funds.admin.platforms.network_icon_override_url_help')}</small>\r\n              </div>\r\n              <div className=\"Form-col\">\r\n                <label>{app.translator.trans('funds.admin.platforms.network_icon_override_class')}</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"fas fa-network-wired\"\r\n                  bidi={this.networkIconOverrideClass}\r\n                />\r\n                <small className=\"helpText\">{app.translator.trans('funds.admin.platforms.network_icon_override_class_help')}</small>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"Form-group\">\r\n            <Button\r\n              className=\"Button Button--primary\"\r\n              loading={this.attrs.submitting}\r\n              disabled={this.attrs.submitting}\r\n              onclick={this.handleSubmit.bind(this)}\r\n            >\r\n              {app.translator.trans('funds.admin.platforms.add_button')}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private validateForm(): boolean {\r\n    const validator = new FormValidator();\r\n    \r\n    try {\r\n      // Fixed: Convert NestedStringArray to string for FormValidator\r\n      const nameLabel = app.translator.trans('funds.admin.platforms.name').toString();\r\n      const symbolLabel = app.translator.trans('funds.admin.platforms.symbol').toString();\r\n      const minAmountLabel = app.translator.trans('funds.admin.platforms.min_amount').toString();\r\n      const maxAmountLabel = app.translator.trans('funds.admin.platforms.max_amount').toString();\r\n      const feeLabel = app.translator.trans('funds.admin.platforms.fee').toString();\r\n      \r\n      validator\r\n        .required(this.name(), 'name', nameLabel)\r\n        .required(this.symbol(), 'symbol', symbolLabel)\r\n        .numberRange(this.minAmount(), 0, undefined, 'minAmount', minAmountLabel)\r\n        .numberRange(this.maxAmount(), 0, undefined, 'maxAmount', maxAmountLabel)\r\n        .numberRange(this.fee(), 0, undefined, 'fee', feeLabel);\r\n\r\n      // Custom validation for max >= min\r\n      const minVal = parseFloat(this.minAmount());\r\n      const maxVal = parseFloat(this.maxAmount());\r\n      if (maxVal < minVal) {\r\n        const errorMessage = app.translator.trans('funds.admin.platforms.max_min_error').toString();\r\n        validator.custom(false, 'maxAmount', errorMessage);\r\n      }\r\n\r\n      // Optional URL validations for three-tier icon system\r\n      if (this.currencyIconOverrideUrl() && this.currencyIconOverrideUrl().trim()) {\r\n        const currencyIconUrlLabel = app.translator.trans('funds.admin.platforms.currency_icon_override_url').toString();\r\n        validator.url(this.currencyIconOverrideUrl(), 'currencyIconOverrideUrl', currencyIconUrlLabel);\r\n      }\r\n      \r\n      if (this.networkIconOverrideUrl() && this.networkIconOverrideUrl().trim()) {\r\n        const networkIconUrlLabel = app.translator.trans('funds.admin.platforms.network_icon_override_url').toString();\r\n        validator.url(this.networkIconOverrideUrl(), 'networkIconOverrideUrl', networkIconUrlLabel);\r\n      }\r\n\r\n      const result = validator.getResult();\r\n      \r\n      if (!result.isValid && result.firstErrorMessage) {\r\n        app.alerts.show({ type: 'error', dismissible: true }, result.firstErrorMessage);\r\n      }\r\n\r\n      return result.isValid;\r\n    } catch (error) {\r\n      console.error('Form validation error:', error);\r\n      app.alerts.show({ type: 'error', dismissible: true }, 'Validation failed');\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private async handleSubmit(): Promise<void> {\r\n    if (this.attrs.submitting) return;\r\n\r\n    if (!this.validateForm()) return;\r\n\r\n    const formData: PlatformFormData = {\r\n      name: this.name(),\r\n      symbol: this.symbol(),\r\n      network: this.network(),\r\n      minAmount: this.minAmount(),\r\n      maxAmount: this.maxAmount(),\r\n      fee: this.fee(),\r\n      // Three-tier icon system\r\n      currencyIconOverrideUrl: this.currencyIconOverrideUrl(),\r\n      currencyIconOverrideClass: this.currencyIconOverrideClass(),\r\n      networkIconOverrideUrl: this.networkIconOverrideUrl(),\r\n      networkIconOverrideClass: this.networkIconOverrideClass()\r\n    };\r\n\r\n    try {\r\n      await this.attrs.onSubmit(formData);\r\n      this.clearForm();\r\n    } catch {\r\n      // Error handling is done in parent component\r\n    }\r\n  }\r\n\r\n  private clearForm(): void {\r\n    this.name('');\r\n    this.symbol('');\r\n    this.network('');\r\n    this.minAmount('');\r\n    this.maxAmount('');\r\n    this.fee('');\r\n    // Clear three-tier icon fields\r\n    this.currencyIconOverrideUrl('');\r\n    this.currencyIconOverrideClass('');\r\n    this.networkIconOverrideUrl('');\r\n    this.networkIconOverrideClass('');\r\n    m.redraw();\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport Switch from 'flarum/common/components/Switch';\r\nimport humanTime from 'flarum/common/helpers/humanTime';\r\nimport icon from 'flarum/common/helpers/icon';\r\nimport m from 'mithril';\r\nimport type Mithril from 'mithril';\r\n\r\n// Generic platform interface that can represent both funds and deposit platforms\r\ninterface GenericPlatform {\r\n  id?: () => string | number;\r\n  name?: () => string;\r\n  symbol?: () => string;\r\n  network?: () => string;\r\n  displayName?: () => string;\r\n  minAmount?: () => number;\r\n  maxAmount?: () => number;\r\n  fee?: () => number;\r\n  address?: () => string;\r\n  iconUrl?: () => string;\r\n  iconClass?: () => string;\r\n  isActive?: () => boolean;\r\n  createdAt?: () => Date;\r\n  [key: string]: any;\r\n}\r\n\r\ninterface GenericPlatformListItemAttrs {\r\n  platform: GenericPlatform;\r\n  type: 'funds' | 'deposit';\r\n  onToggleStatus: (platform?: GenericPlatform) => Promise<void>;\r\n  onDelete: (platform?: GenericPlatform) => Promise<void>;\r\n  style?: 'card' | 'list';\r\n}\r\n\r\nexport default class GenericPlatformListItem extends Component<GenericPlatformListItemAttrs> {\r\n  view(vnode: Mithril.Vnode<GenericPlatformListItemAttrs>): Mithril.Children {\r\n    const { platform, type, onToggleStatus, onDelete, style = 'card' } = vnode.attrs;\r\n\r\n    if (style === 'card') {\r\n      return this.renderCardStyle(platform, type, onToggleStatus, onDelete);\r\n    } else {\r\n      return this.renderListStyle(platform, type, onToggleStatus, onDelete);\r\n    }\r\n  }\r\n\r\n  private renderCardStyle(\r\n    platform: GenericPlatform,\r\n    type: string,\r\n    onToggleStatus: (platform?: GenericPlatform) => Promise<void>,\r\n    onDelete: (platform?: GenericPlatform) => Promise<void>\r\n  ): Mithril.Children {\r\n    const platformData = this.extractPlatformData(platform);\r\n    const translationPrefix = (type === 'funds' || type === 'withdrawal') ? 'funds.admin.platforms' : 'funds.admin.deposit.platforms';\r\n\r\n    return (\r\n      <div key={platformData.id} className={`${type}Platform`}>\r\n        <div className={`${type}Platform-info`}>\r\n          <div className={`${type}Platform-primary`}>\r\n            <span className={`${type}Platform-status ${platformData.isActive ? 'active' : 'inactive'}`}>\r\n              {platformData.isActive ? '🟢' : '🔴'}\r\n            </span>\r\n            <span className={`${type}Platform-name`}>{platformData.displayName}</span>\r\n            <span className=\"platform-id\">#{platformData.id}</span>\r\n            {platformData.network && <span className={`${type}Platform-network`}>({platformData.network})</span>}\r\n          </div>\r\n          <div className={`${type}Platform-details`}>\r\n            <span className={`${type}Platform-amounts`}>\r\n              Min: {platformData.minAmount} | Max: {platformData.maxAmount}\r\n              {` | Fee: ${platformData.fee}`}\r\n              {type === 'deposit' && ` | Address: ${platformData.address ? 'Static' : 'Template'}`}\r\n            </span>\r\n            {platformData.createdDate && (\r\n              <span className={`${type}Platform-date`}>{platformData.dateDisplay}</span>\r\n            )}\r\n          </div>\r\n        </div>\r\n        <div className={`${type}Platform-actions`}>\r\n          <Button\r\n            className={`Button ${platformData.isActive ? 'Button--secondary' : 'Button--primary'}`}\r\n            onclick={() => onToggleStatus(platform)}\r\n          >\r\n            {app.translator.trans(`${translationPrefix}.${platformData.isActive ? 'disable' : 'enable'}`)}\r\n          </Button>\r\n          <Button\r\n            className=\"Button Button--danger\"\r\n            onclick={() => onDelete(platform)}\r\n          >\r\n            {app.translator.trans(`${translationPrefix}.delete`)}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderListStyle(\r\n    platform: GenericPlatform,\r\n    type: string,\r\n    onToggleStatus: (platform?: GenericPlatform) => Promise<void>,\r\n    onDelete: (platform?: GenericPlatform) => Promise<void>\r\n  ): Mithril.Children {\r\n    const platformData = this.extractPlatformData(platform);\r\n    const translationPrefix = (type === 'funds' || type === 'withdrawal') ? 'funds.admin.platforms' : 'funds.admin.deposit.platforms';\r\n\r\n    return (\r\n      <div className={`${type}PlatformListItem`}>\r\n        <div className={`${type}PlatformListItem-content`}>\r\n          <div className={`${type}PlatformListItem-icon`}>\r\n            {this.renderPlatformIcon(platform)}\r\n          </div>\r\n          \r\n          <div className={`${type}PlatformListItem-info`}>\r\n            <div className={`${type}PlatformListItem-primary`}>\r\n              <strong>{platformData.name}</strong>\r\n              <span className={`${type}PlatformListItem-displayName`}>\r\n                {platformData.symbol}\r\n                {platformData.network && ` (${platformData.network})`}\r\n              </span>\r\n            </div>\r\n            \r\n            <div className={`${type}PlatformListItem-details`}>\r\n              <span className={`${type}PlatformListItem-detail`}>\r\n                Min: {platformData.minAmount} {platformData.symbol}\r\n              </span>\r\n              {platformData.maxAmount && (\r\n                <span className={`${type}PlatformListItem-detail`}>\r\n                  Max: {platformData.maxAmount} {platformData.symbol}\r\n                </span>\r\n              )}\r\n              {platformData.fee && (\r\n                <span className={`${type}PlatformListItem-detail`}>\r\n                  Fee: {platformData.fee} {platformData.symbol}\r\n                </span>\r\n              )}\r\n              {type === 'deposit' && (\r\n                <span className={`${type}PlatformListItem-detail`}>\r\n                  Address: {platformData.address ? 'Static' : 'Template'}\r\n                </span>\r\n              )}\r\n            </div>\r\n          </div>\r\n          \r\n          <div className={`${type}PlatformListItem-actions`}>\r\n            <Switch \r\n              state={platformData.isActive} \r\n              onchange={async () => {\r\n                await onToggleStatus(platform);\r\n                m.redraw();\r\n              }}\r\n            >\r\n              {platformData.isActive \r\n                ? app.translator.trans(`${translationPrefix}.active`)\r\n                : app.translator.trans(`${translationPrefix}.inactive`)\r\n              }\r\n            </Switch>\r\n            \r\n            <Button\r\n              className=\"Button Button--icon Button--flat\"\r\n              icon=\"fas fa-trash\"\r\n              onclick={async () => {\r\n                await onDelete(platform);\r\n                m.redraw();\r\n              }}\r\n              title={app.translator.trans(`${translationPrefix}.delete`)}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private extractPlatformData(platform: GenericPlatform) {\r\n    // Handle both Model instances and plain objects\r\n    const id = typeof platform.id === 'function' ? platform.id() : platform.id;\r\n    const name = (typeof platform.name === 'function' ? platform.name() : platform.data?.attributes?.name) || 'Unknown Platform';\r\n    const symbol = (typeof platform.symbol === 'function' ? platform.symbol() : platform.data?.attributes?.symbol) || '';\r\n    const network = (typeof platform.network === 'function' ? platform.network() : platform.data?.attributes?.network) || null;\r\n    const displayName = (typeof platform.displayName === 'function' ? platform.displayName() : platform.data?.attributes?.displayName) || name;\r\n    const minAmount = (typeof platform.minAmount === 'function' ? platform.minAmount() : platform.data?.attributes?.minAmount) || 'N/A';\r\n    const maxAmount = (typeof platform.maxAmount === 'function' ? platform.maxAmount() : platform.data?.attributes?.maxAmount) || 'N/A';\r\n    const fee = (typeof platform.fee === 'function' ? platform.fee() : platform.data?.attributes?.fee) || 'N/A';\r\n    const address = (typeof platform.address === 'function' ? platform.address() : platform.data?.attributes?.address) || null;\r\n    const isActive = (typeof platform.isActive === 'function' ? platform.isActive() : platform.data?.attributes?.isActive) ?? false;\r\n    const createdDate = (typeof platform.createdAt === 'function' ? platform.createdAt() : platform.data?.attributes?.createdAt) || null;\r\n    \r\n    let dateDisplay: Mithril.Children = 'N/A';\r\n    if (createdDate) {\r\n      try {\r\n        dateDisplay = humanTime(createdDate);\r\n      } catch (e) {\r\n        console.error('Error formatting date:', e);\r\n        dateDisplay = 'Invalid Date';\r\n      }\r\n    }\r\n\r\n    return {\r\n      id,\r\n      name,\r\n      symbol,\r\n      network,\r\n      displayName,\r\n      minAmount,\r\n      maxAmount,\r\n      fee,\r\n      address,\r\n      isActive,\r\n      createdDate,\r\n      dateDisplay\r\n    };\r\n  }\r\n\r\n  private renderPlatformIcon(platform: GenericPlatform): Mithril.Children {\r\n    const iconUrl = typeof platform.iconUrl === 'function' ? platform.iconUrl() : platform.attributes?.iconUrl;\r\n    const iconClass = typeof platform.iconClass === 'function' ? platform.iconClass() : platform.attributes?.iconClass;\r\n    const symbol = typeof platform.symbol === 'function' ? platform.symbol() : platform.attributes?.symbol;\r\n\r\n    if (iconUrl) {\r\n      return <img src={iconUrl} alt={symbol} className=\"PlatformListItem-img\" />;\r\n    }\r\n\r\n    if (iconClass) {\r\n      return icon(iconClass);\r\n    }\r\n\r\n    // Fallback to generic icon - use platform-configurable icons only\r\n    return icon('fas fa-coins');\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\nimport type Mithril from 'mithril';\r\nimport { WithdrawalPlatform, PlatformFormData } from '../types/AdminTypes';\r\nimport AddPlatformForm from '../forms/AddPlatformForm';\r\nimport GenericPlatformListItem from '../shared/GenericPlatformListItem';\r\n\r\nexport interface PlatformManagementSectionAttrs {\r\n  platforms: WithdrawalPlatform[];\r\n  submittingPlatform: boolean;\r\n  onAddPlatform: (formData: PlatformFormData) => Promise<void>;\r\n  onTogglePlatformStatus: (platform: WithdrawalPlatform) => Promise<void>;\r\n  onDeletePlatform: (platform: WithdrawalPlatform) => void;\r\n}\r\n\r\nexport default class PlatformManagementSection extends Component<PlatformManagementSectionAttrs> {\r\n  view(): Mithril.Children {\r\n    const { platforms, submittingPlatform, onAddPlatform, onTogglePlatformStatus, onDeletePlatform } = this.attrs;\r\n\r\n    return (\r\n      <div className=\"WithdrawalManagementPage-section\">\r\n        <h3>{app.translator.trans('funds.admin.platforms.title')}</h3>\r\n        \r\n        <AddPlatformForm \r\n          onSubmit={onAddPlatform}\r\n          submitting={submittingPlatform}\r\n        />\r\n\r\n        <div className=\"PlatformList\">\r\n          {platforms.length === 0 ? (\r\n            <p>{app.translator.trans('funds.admin.platforms.empty')}</p>\r\n          ) : (\r\n            platforms.map((platform) => (\r\n              <GenericPlatformListItem\r\n                key={platform.id?.() ?? platform.id ?? Math.random()}\r\n                platform={platform}\r\n                type=\"withdrawal\"\r\n                style=\"card\"\r\n                onToggleStatus={onTogglePlatformStatus}\r\n                onDelete={onDeletePlatform}\r\n              />\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport humanTime from 'flarum/common/helpers/humanTime';\r\nimport type Mithril from 'mithril';\r\nimport { WithdrawalRequest } from '../types/AdminTypes';\r\n\r\nexport interface WithdrawalRequestItemAttrs {\r\n  request: WithdrawalRequest;\r\n  showActions: boolean;\r\n  showDelete?: boolean;\r\n  onUpdateStatus?: (request: WithdrawalRequest, status: string) => Promise<void>;\r\n  onDelete?: (request: WithdrawalRequest) => void;\r\n}\r\n\r\nexport default class WithdrawalRequestItem extends Component<WithdrawalRequestItemAttrs> {\r\n  view(): Mithril.Children {\r\n    const request = this.attrs.request;\r\n    const { showActions, showDelete = false } = this.attrs;\r\n    \r\n    // Handle Flarum Model instances\r\n    const requestId = typeof request.id === 'function' ? request.id() : request.id;\r\n    const amount = typeof request.amount === 'function' ? request.amount() : (request.attributes?.amount || 0);\r\n    const status = typeof request.status === 'function' ? request.status() : (request.attributes?.status || 'pending');\r\n    const accountDetails = typeof request.accountDetails === 'function' ? request.accountDetails() : \r\n      (request.attributes?.accountDetails || request.attributes?.account_details || 'N/A');\r\n    const createdDate = typeof request.createdAt === 'function' ? request.createdAt() : (request.attributes?.createdAt || null);\r\n    \r\n    // Get user info\r\n    let userName = 'Unknown User';\r\n    if (typeof request.user === 'function') {\r\n      const userData = request.user();\r\n      if (userData && typeof userData.displayName === 'function') {\r\n        userName = userData.displayName();\r\n      } else if (userData && userData.attributes?.displayName) {\r\n        userName = userData.attributes.displayName;\r\n      }\r\n    }\r\n    \r\n    // Get platform info - simplified approach using Flarum Model relationships\r\n    let platformName = 'Unknown Platform';\r\n    let platformSymbol = 'N/A';\r\n    \r\n    if (typeof request.platform === 'function') {\r\n      const platform = request.platform();\r\n      if (platform) {\r\n        platformName = typeof platform.name === 'function' ? platform.name() : (platform.attributes?.name || 'Unknown Platform');\r\n        platformSymbol = typeof platform.symbol === 'function' ? platform.symbol() : (platform.attributes?.symbol || 'N/A');\r\n      }\r\n    }\r\n    \r\n    const statusClass = `status-${status}`;\r\n    \r\n    let dateDisplay: Mithril.Children = 'N/A';\r\n    if (createdDate) {\r\n      try {\r\n        dateDisplay = humanTime(createdDate);\r\n      } catch (e) {\r\n        console.error('Error formatting request date:', e);\r\n        dateDisplay = 'Invalid Date';\r\n      }\r\n    }\r\n\r\n    return (\r\n      <div key={requestId} className={`WithdrawalRequest ${statusClass}`}>\r\n        <div className=\"WithdrawalRequest-info\">\r\n          <div className=\"WithdrawalRequest-user\">\r\n            <strong>{userName}</strong>\r\n            <span className=\"request-id\">#{requestId}</span>\r\n          </div>\r\n          <div className=\"WithdrawalRequest-details\">\r\n            <span className=\"amount\">{amount}</span>\r\n            <span className=\"platform\">{platformName}</span>\r\n            <span className=\"symbol\">{platformSymbol}</span>\r\n            <span className=\"date\">{dateDisplay}</span>\r\n          </div>\r\n          <div className=\"WithdrawalRequest-account\">\r\n            <strong>{app.translator.trans('funds.admin.requests.account_details')}:</strong>\r\n            <span>{accountDetails}</span>\r\n          </div>\r\n          <div className=\"WithdrawalRequest-status\">\r\n            <span className={`Badge Badge--${status}`}>\r\n              {app.translator.trans(`funds.admin.requests.status.${status}`)}\r\n            </span>\r\n          </div>\r\n        </div>\r\n        \r\n        {(showActions || showDelete) && (\r\n          <div className=\"WithdrawalRequest-actions\">\r\n            {showActions && this.attrs.onUpdateStatus && (\r\n              <>\r\n                <Button\r\n                  className=\"Button Button--primary\"\r\n                  onclick={() => this.attrs.onUpdateStatus!(request, 'approved')}\r\n                >\r\n                  {app.translator.trans('funds.admin.requests.approve')}\r\n                </Button>\r\n                <Button\r\n                  className=\"Button Button--danger\"\r\n                  onclick={() => this.attrs.onUpdateStatus!(request, 'rejected')}\r\n                >\r\n                  {app.translator.trans('funds.admin.requests.reject')}\r\n                </Button>\r\n              </>\r\n            )}\r\n            {this.attrs.onDelete && (\r\n              <Button\r\n                className=\"Button Button--link\"\r\n                onclick={() => this.attrs.onDelete!(request)}\r\n              >\r\n                <i className=\"fas fa-trash\"></i>\r\n                {app.translator.trans('funds.admin.requests.delete')}\r\n              </Button>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\nimport type Mithril from 'mithril';\r\nimport { WithdrawalRequest } from '../types/AdminTypes';\r\nimport WithdrawalRequestItem from '../items/WithdrawalRequestItem';\r\n\r\nexport interface RequestManagementSectionAttrs {\r\n  requests: WithdrawalRequest[];\r\n  onUpdateRequestStatus: (request: WithdrawalRequest, status: string) => Promise<void>;\r\n  onDeleteRequest: (request: WithdrawalRequest) => void;\r\n}\r\n\r\nexport default class RequestManagementSection extends Component<RequestManagementSectionAttrs> {\r\n  view(): Mithril.Children {\r\n    const { requests, onUpdateRequestStatus, onDeleteRequest } = this.attrs;\r\n\r\n    const pendingRequests = requests.filter(r => {\r\n      const status = (typeof r.status === 'function' ? r.status() : r.attributes?.status) || 'pending';\r\n      return status === 'pending';\r\n    });\r\n    \r\n    const processedRequests = requests.filter(r => {\r\n      const status = (typeof r.status === 'function' ? r.status() : r.attributes?.status) || 'pending';\r\n      return status !== 'pending';\r\n    });\r\n\r\n    return (\r\n      <div className=\"WithdrawalManagementPage-section\">\r\n        <h3>{app.translator.trans('funds.admin.requests.title')}</h3>\r\n        \r\n        <div className=\"WithdrawalManagementPage-pendingRequests\">\r\n          <h4>{app.translator.trans('funds.admin.requests.pending_title')}</h4>\r\n          {pendingRequests.length === 0 ? (\r\n            <p>{app.translator.trans('funds.admin.requests.no_pending')}</p>\r\n          ) : (\r\n            pendingRequests.map((request) => (\r\n              <WithdrawalRequestItem\r\n                key={typeof request.id === 'function' ? request.id() : request.id}\r\n                request={request}\r\n                showActions={true}\r\n                showDelete={true}\r\n                onUpdateStatus={onUpdateRequestStatus}\r\n                onDelete={onDeleteRequest}\r\n              />\r\n            ))\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"WithdrawalManagementPage-processedRequests\">\r\n          <h4>{app.translator.trans('funds.admin.requests.processed_title')}</h4>\r\n          {processedRequests.length === 0 ? (\r\n            <p>{app.translator.trans('funds.admin.requests.no_processed')}</p>\r\n          ) : (\r\n            processedRequests.map((request) => (\r\n              <WithdrawalRequestItem\r\n                key={typeof request.id === 'function' ? request.id() : request.id}\r\n                request={request}\r\n                showActions={false}\r\n                showDelete={true}\r\n                onDelete={onDeleteRequest}\r\n              />\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport icon from 'flarum/common/helpers/icon';\r\nimport humanTime from 'flarum/common/helpers/humanTime';\r\nimport m from 'mithril';\r\nimport type Mithril from 'mithril';\r\nimport ConfirmModal from '../../../common/components/shared/ConfirmModal';\r\n\r\ninterface DepositRecord {\r\n  id(): string | number;\r\n  userId(): number;\r\n  platformId(): number;\r\n  platformAccount(): string;\r\n  realName?(): string;\r\n  amount(): number;\r\n  depositTime(): Date;\r\n  screenshotUrl?(): string;\r\n  userMessage?(): string;\r\n  status(): string;\r\n  processedAt?(): Date;\r\n  processedBy?(): number;\r\n  adminNotes?(): string;\r\n  creditedAmount?(): number;\r\n  createdAt(): Date;\r\n  updatedAt(): Date;\r\n  user?(): any; // Flarum User model - keep as any for compatibility\r\n  platform?(): any;\r\n  processedByUser?(): any;\r\n  isPending(): boolean;\r\n  isApproved(): boolean;\r\n  isRejected(): boolean;\r\n}\r\n\r\ninterface DepositRecordManagementSectionAttrs {\r\n  records: DepositRecord[];\r\n  platforms: any[];\r\n  loading?: boolean;\r\n  onApproveRecord: (record: DepositRecord, creditedAmount?: number, notes?: string) => Promise<void>;\r\n  onRejectRecord: (record: DepositRecord, reason: string) => Promise<void>;\r\n  onDeleteRecord: (record: DepositRecord) => Promise<void>;\r\n}\r\n\r\ninterface DepositRecordManagementSectionState {\r\n  processingRecords: Set<string | number>;\r\n}\r\n\r\nexport default class DepositRecordManagementSection extends Component<\r\n  DepositRecordManagementSectionAttrs,\r\n  DepositRecordManagementSectionState\r\n> {\r\n  public state: DepositRecordManagementSectionState = {\r\n    processingRecords: new Set()\r\n  };\r\n\r\n  view(vnode: Mithril.Vnode<DepositRecordManagementSectionAttrs>): Mithril.Children {\r\n    const { records, platforms, loading } = vnode.attrs;\r\n\r\n    if (loading) {\r\n      return (\r\n        <div className=\"DepositRecordManagementSection\">\r\n          <div className=\"ection-header\">\r\n            <h3>{app.translator.trans('funds.admin.deposit.records.title')}</h3>\r\n          </div>\r\n          <LoadingIndicator />\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"DepositRecordManagementSection\">\r\n        <div className=\"DepositRecordManagementSection-header\">\r\n          <h3>{app.translator.trans('funds.admin.deposit.records.title')}</h3>\r\n          <div className=\"DepositRecordManagementSection-stats\">\r\n            <span className=\"DepositRecordManagementSection-count\">\r\n              {app.translator.trans('funds.admin.deposit.records.total_count', {\r\n                count: records.length\r\n              })}\r\n            </span>\r\n            <span className=\"DepositRecordManagementSection-pending\">\r\n              {app.translator.trans('funds.admin.deposit.records.pending_count', {\r\n                count: records.filter(r => r.isPending()).length\r\n              })}\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"DepositRecordManagementSection-content\">\r\n          {records.length === 0 ? (\r\n            <div className=\"DepositRecordManagementSection-empty\">\r\n              <div className=\"DepositRecordManagementSection-emptyIcon\">\r\n                {icon('fas fa-receipt')}\r\n              </div>\r\n              <h4>{app.translator.trans('funds.admin.deposit.records.empty.title')}</h4>\r\n              <p>{app.translator.trans('funds.admin.deposit.records.empty.description')}</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"DepositRecordManagementSection-list\">\r\n              {records.map(record => this.renderRecord(record, platforms, vnode.attrs))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderRecord(\r\n    record: DepositRecord,\r\n    platforms: any[],\r\n    attrs: DepositRecordManagementSectionAttrs\r\n  ): Mithril.Children {\r\n    const recordId = record.id();\r\n    const isProcessing = this.state.processingRecords.has(recordId);\r\n    const platform = this.findPlatform(platforms, record.platformId());\r\n    const user = record.user?.();\r\n    const status = record.status();\r\n    const depositTime = record.depositTime();\r\n    const createdAt = record.createdAt();\r\n\r\n    return (\r\n      <div key={`record-${recordId}`} className={`DepositRecordItem status-${status}`}>\r\n        <div className=\"DepositRecordItem-header\">\r\n          <div className=\"DepositRecordItem-user\">\r\n            <span className=\"DepositRecordItem-username\">\r\n              {user?.displayName?.() || 'Unknown User'}\r\n            </span>\r\n            <span className=\"DepositRecordItem-userId\">\r\n              ID: {record.userId()}\r\n            </span>\r\n          </div>\r\n          \r\n          <div className=\"DepositRecordItem-amount\">\r\n            <span className=\"DepositRecordItem-amountValue\">\r\n              {record.amount()} {platform?.symbol?.() || ''}\r\n            </span>\r\n            <div className={`DepositRecordItem-status status-${this.getStatusColor(status)}`}>\r\n              {this.renderStatusIcon(status)}\r\n              {this.getStatusText(status)}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"DepositRecordItem-details\">\r\n          <div className=\"DepositRecordItem-row\">\r\n            <span className=\"DepositRecordItem-label\">Platform:</span>\r\n            <span className=\"DepositRecordItem-value\">\r\n              {platform?.name?.() || 'Unknown Platform'} {platform?.network?.() ? `(${platform.network()})` : ''}\r\n            </span>\r\n          </div>\r\n          \r\n          <div className=\"DepositRecordItem-row\">\r\n            <span className=\"DepositRecordItem-label\">Platform Account:</span>\r\n            <span className=\"DepositRecordItem-value\">{record.platformAccount()}</span>\r\n          </div>\r\n          \r\n          {record.realName?.() && (\r\n            <div className=\"DepositRecordItem-row\">\r\n              <span className=\"DepositRecordItem-label\">Real Name:</span>\r\n              <span className=\"DepositRecordItem-value\">{record.realName()}</span>\r\n            </div>\r\n          )}\r\n          \r\n          <div className=\"DepositRecordItem-row\">\r\n            <span className=\"DepositRecordItem-label\">Deposit Time:</span>\r\n            <span className=\"DepositRecordItem-value\">\r\n              {depositTime.toLocaleDateString()} {depositTime.toLocaleTimeString()}\r\n            </span>\r\n          </div>\r\n          \r\n          <div className=\"DepositRecordItem-row\">\r\n            <span className=\"DepositRecordItem-label\">Submitted:</span>\r\n            <span className=\"DepositRecordItem-value\">\r\n              {humanTime(createdAt)}\r\n            </span>\r\n          </div>\r\n          \r\n          {record.userMessage?.() && (\r\n            <div className=\"DepositRecordItem-row\">\r\n              <span className=\"DepositRecordItem-label\">Message:</span>\r\n              <span className=\"DepositRecordItem-value\">{record.userMessage()}</span>\r\n            </div>\r\n          )}\r\n          \r\n          {record.screenshotUrl?.() && (\r\n            <div className=\"DepositRecordItem-row\">\r\n              <span className=\"DepositRecordItem-label\">Screenshot:</span>\r\n              <a\r\n                href={record.screenshotUrl()}\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\"\r\n                className=\"DepositRecordItem-link\"\r\n              >\r\n                View Screenshot {icon('fas fa-external-link-alt')}\r\n              </a>\r\n            </div>\r\n          )}\r\n\r\n          {record.processedAt?.() && (\r\n            <div className=\"DepositRecordItem-processed\">\r\n              <div className=\"DepositRecordItem-row\">\r\n                <span className=\"DepositRecordItem-label\">Processed:</span>\r\n                <span className=\"DepositRecordItem-value\">\r\n                  {humanTime(record.processedAt())}\r\n                </span>\r\n              </div>\r\n              \r\n              {record.creditedAmount?.() && record.creditedAmount() !== record.amount() && (\r\n                <div className=\"DepositRecordItem-row\">\r\n                  <span className=\"DepositRecordItem-label\">Credited Amount:</span>\r\n                  <span className=\"DepositRecordItem-value\">\r\n                    {record.creditedAmount()} {platform?.symbol?.() || ''}\r\n                  </span>\r\n                </div>\r\n              )}\r\n              \r\n              {record.adminNotes?.() && (\r\n                <div className=\"DepositRecordItem-row\">\r\n                  <span className=\"DepositRecordItem-label\">Admin Notes:</span>\r\n                  <span className=\"DepositRecordItem-value\">{record.adminNotes()}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {status === 'pending' && (\r\n          <div className=\"DepositRecordItem-actions\">\r\n            <Button\r\n              className=\"Button Button--primary DepositRecordItem-approveButton\"\r\n              onclick={() => this.handleApprove(record, attrs)}\r\n              loading={isProcessing}\r\n              disabled={isProcessing}\r\n            >\r\n              {app.translator.trans('funds.admin.deposit.records.approve')}\r\n            </Button>\r\n            \r\n            <Button\r\n              className=\"Button Button--danger DepositRecordItem-rejectButton\"\r\n              onclick={() => this.handleReject(record, attrs)}\r\n              loading={isProcessing}\r\n              disabled={isProcessing}\r\n            >\r\n              {app.translator.trans('funds.admin.deposit.records.reject')}\r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"DepositRecordItem-adminActions\">\r\n          <Button\r\n            className=\"Button Button--link DepositRecordItem-deleteButton\"\r\n            onclick={() => this.handleDelete(record, attrs)}\r\n            disabled={isProcessing}\r\n          >\r\n            {icon('fas fa-trash')}\r\n            {app.translator.trans('funds.admin.deposit.records.delete')}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private findPlatform(platforms: any[], platformId: number): any | null {\r\n    return platforms.find(p => {\r\n      const id = typeof p.id === 'function' ? p.id() : p.id;\r\n      return parseInt(id) === platformId;\r\n    }) || null;\r\n  }\r\n\r\n  private getStatusColor(status: string): string {\r\n    switch (status) {\r\n      case 'pending':\r\n        return 'warning';\r\n      case 'approved':\r\n        return 'success';\r\n      case 'rejected':\r\n        return 'danger';\r\n      default:\r\n        return 'secondary';\r\n    }\r\n  }\r\n\r\n  private renderStatusIcon(status: string): Mithril.Children {\r\n    switch (status) {\r\n      case 'pending':\r\n        return icon('fas fa-clock');\r\n      case 'approved':\r\n        return icon('fas fa-check-circle');\r\n      case 'rejected':\r\n        return icon('fas fa-times-circle');\r\n      default:\r\n        return icon('fas fa-question-circle');\r\n    }\r\n  }\r\n\r\n  private getStatusText(status: string): string {\r\n    switch (status) {\r\n      case 'pending':\r\n        return app.translator.trans('funds.admin.deposit.records.status.pending').toString();\r\n      case 'approved':\r\n        return app.translator.trans('funds.admin.deposit.records.status.approved').toString();\r\n      case 'rejected':\r\n        return app.translator.trans('funds.admin.deposit.records.status.rejected').toString();\r\n      default:\r\n        return 'Unknown';\r\n    }\r\n  }\r\n\r\n  private async handleApprove(record: DepositRecord, attrs: DepositRecordManagementSectionAttrs): Promise<void> {\r\n    const recordId = record.id();\r\n    const defaultAmount = record.amount();\r\n\r\n    // Basic approval - could be enhanced with a modal for custom amounts/notes\r\n    const creditedAmount = parseFloat(\r\n      prompt(\r\n        app.translator.trans('funds.admin.deposit.records.approve_prompt', {\r\n          amount: defaultAmount\r\n        }).toString(),\r\n        defaultAmount.toString()\r\n      ) || defaultAmount.toString()\r\n    );\r\n\r\n    const notes = prompt(\r\n      app.translator.trans('funds.admin.deposit.records.approve_notes_prompt').toString()\r\n    );\r\n\r\n    if (isNaN(creditedAmount) || creditedAmount <= 0) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        app.translator.trans('funds.admin.deposit.records.invalid_amount')\r\n      );\r\n      return;\r\n    }\r\n\r\n    this.state.processingRecords.add(recordId);\r\n    m.redraw();\r\n\r\n    try {\r\n      await attrs.onApproveRecord(record, creditedAmount, notes || undefined);\r\n      // Success alert handled by parent component\r\n    } catch (error) {\r\n      console.error('Error approving deposit record:', error);\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        app.translator.trans('funds.admin.deposit.records.approve_error')\r\n      );\r\n    } finally {\r\n      this.state.processingRecords.delete(recordId);\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private async handleReject(record: DepositRecord, attrs: DepositRecordManagementSectionAttrs): Promise<void> {\r\n    const reason = prompt(\r\n      app.translator.trans('funds.admin.deposit.records.reject_reason_prompt').toString()\r\n    );\r\n\r\n    if (!reason || reason.trim() === '') {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        app.translator.trans('funds.admin.deposit.records.reject_reason_required')\r\n      );\r\n      return;\r\n    }\r\n\r\n    const recordId = record.id();\r\n    this.state.processingRecords.add(recordId);\r\n    m.redraw();\r\n\r\n    try {\r\n      await attrs.onRejectRecord(record, reason);\r\n      // Success alert handled by parent component\r\n    } catch (error) {\r\n      console.error('Error rejecting deposit record:', error);\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        app.translator.trans('funds.admin.deposit.records.reject_error')\r\n      );\r\n    } finally {\r\n      this.state.processingRecords.delete(recordId);\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private handleDelete(record: DepositRecord, attrs: DepositRecordManagementSectionAttrs): void {\r\n    const user = record.user?.();\r\n    const amount = record.amount();\r\n\r\n    app.modal.show(ConfirmModal, {\r\n      title: app.translator.trans('funds.admin.deposit.records.delete_confirm_title'),\r\n      message: app.translator.trans('funds.admin.deposit.records.delete_confirm_message', {\r\n        user: user,\r\n        amount: amount\r\n      }),\r\n      confirmText: app.translator.trans('funds.admin.deposit.records.delete_confirm_button'),\r\n      cancelText: app.translator.trans('funds.admin.deposit.records.delete_cancel_button'),\r\n      dangerous: true,\r\n      icon: 'fas fa-trash',\r\n      onConfirm: async () => {\r\n        const recordId = record.id();\r\n        this.state.processingRecords.add(recordId);\r\n        \r\n        try {\r\n          await attrs.onDeleteRecord(record);\r\n          // Success alert handled by parent component\r\n        } catch (error) {\r\n          console.error('Error deleting deposit record:', error);\r\n          app.alerts.show(\r\n            { type: 'error', dismissible: true },\r\n            app.translator.trans('funds.admin.deposit.records.delete_error')\r\n          );\r\n        } finally {\r\n          this.state.processingRecords.delete(recordId);\r\n          m.redraw();\r\n        }\r\n      },\r\n      onCancel: () => {\r\n        app.modal.close();\r\n      }\r\n    });\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Switch from 'flarum/common/components/Switch';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport type Mithril from 'mithril';\r\nimport { FormValidator } from '../../../common/utils/formValidators';\r\n\r\nexport interface DepositPlatformFormData {\r\n  name: string;\r\n  symbol: string;\r\n  network: string;\r\n  minAmount: string;\r\n  maxAmount: string;\r\n  fee: string;\r\n  address: string;\r\n  qrCodeImageUrl: string;\r\n  // Three-tier icon system (deprecating old single icon fields)\r\n  currencyIconOverrideUrl: string;\r\n  currencyIconOverrideClass: string;\r\n  networkIconOverrideUrl: string;\r\n  networkIconOverrideClass: string;\r\n  platformSpecificIconUrl: string;\r\n  platformSpecificIconClass: string;\r\n  warningText: string;\r\n  isActive: boolean;\r\n}\r\n\r\nexport interface AddDepositPlatformFormAttrs {\r\n  submitting: boolean;\r\n  onSubmit: (formData: DepositPlatformFormData) => Promise<void>;\r\n  onCancel?: () => void; // Optional since form is always visible\r\n}\r\n\r\nexport default class AddDepositPlatformForm extends Component<AddDepositPlatformFormAttrs> {\r\n  private formData = {\r\n    name: Stream(''),\r\n    symbol: Stream(''),\r\n    network: Stream(''),\r\n    minAmount: Stream(''),\r\n    maxAmount: Stream(''),\r\n    fee: Stream(''),\r\n    address: Stream(''),\r\n    qrCodeImageUrl: Stream(''),\r\n    // Three-tier icon system\r\n    currencyIconOverrideUrl: Stream(''),\r\n    currencyIconOverrideClass: Stream(''),\r\n    networkIconOverrideUrl: Stream(''),\r\n    networkIconOverrideClass: Stream(''),\r\n    platformSpecificIconUrl: Stream(''),\r\n    platformSpecificIconClass: Stream(''),\r\n    warningText: Stream(''),\r\n    isActive: Stream(true)\r\n  };\r\n\r\n  oninit(vnode: Mithril.Vnode<AddDepositPlatformFormAttrs>) {\r\n    super.oninit(vnode);\r\n  }\r\n\r\n  view(vnode: Mithril.Vnode<AddDepositPlatformFormAttrs>) {\r\n    const { submitting } = vnode.attrs;\r\n\r\n    return (\r\n      <form \r\n        id=\"deposit-platform-form\" \r\n        className=\"AddDepositPlatformForm\"\r\n        onsubmit={(e: Event) => this.handleSubmit(vnode.attrs, e)}\r\n      >\r\n        <div className=\"Form\">\r\n          <div className=\"Form-row\">\r\n            <div className=\"Form-group\">\r\n              <label>\r\n                {app.translator.trans('funds.admin.deposit.platforms.name')}\r\n                <span className=\"Form-required\">*</span>\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"FormControl\"\r\n                placeholder=\"e.g., Tether\"\r\n                bidi={this.formData.name}\r\n                disabled={submitting}\r\n              />\r\n            </div>\r\n            <div className=\"Form-group\">\r\n              <label>\r\n                {app.translator.trans('funds.admin.deposit.platforms.symbol')}\r\n                <span className=\"Form-required\">*</span>\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"FormControl\"\r\n                placeholder=\"e.g., USDT\"\r\n                bidi={this.formData.symbol}\r\n                disabled={submitting}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"Form-row\">\r\n            <div className=\"Form-group\">\r\n              <label>\r\n                {app.translator.trans('funds.admin.deposit.platforms.network')}\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"FormControl\"\r\n                placeholder=\"e.g., TRC20, ERC20, BSC (optional)\"\r\n                bidi={this.formData.network}\r\n                disabled={submitting}\r\n              />\r\n              <div className=\"helpText\">\r\n                Optional. Specify the blockchain network for this platform.\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"Form-row\">\r\n            <div className=\"Form-group\">\r\n              <label>\r\n                {app.translator.trans('funds.admin.deposit.platforms.min_amount')}\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                step=\"0.00000001\"\r\n                min=\"0\"\r\n                className=\"FormControl\"\r\n                placeholder=\"0.0\"\r\n                bidi={this.formData.minAmount}\r\n                disabled={submitting}\r\n              />\r\n            </div>\r\n            <div className=\"Form-group\">\r\n              <label>\r\n                {app.translator.trans('funds.admin.deposit.platforms.max_amount')}\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                step=\"0.00000001\"\r\n                min=\"0\"\r\n                className=\"FormControl\"\r\n                placeholder=\"Leave empty for unlimited\"\r\n                bidi={this.formData.maxAmount}\r\n                disabled={submitting}\r\n              />\r\n            </div>\r\n            <div className=\"Form-group\">\r\n              <label>\r\n                {app.translator.trans('funds.admin.deposit.platforms.fee')}\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                step=\"0.00000001\"\r\n                min=\"0\"\r\n                className=\"FormControl\"\r\n                placeholder=\"0.0\"\r\n                bidi={this.formData.fee}\r\n                disabled={submitting}\r\n              />\r\n              <div className=\"helpText\">\r\n                {app.translator.trans('funds.admin.deposit.platforms.fee_help')}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"Form-group\">\r\n            <label>\r\n              {app.translator.trans('funds.admin.deposit.platforms.address')}\r\n              <span className=\"Form-required\">*</span>\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              className=\"FormControl\"\r\n              placeholder=\"Enter deposit address for this platform\"\r\n              bidi={this.formData.address}\r\n              disabled={submitting}\r\n            />\r\n            <div className=\"helpText\">\r\n              {app.translator.trans('funds.admin.deposit.platforms.address_help')}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"Form-group\">\r\n            <label>\r\n              {app.translator.trans('funds.admin.deposit.platforms.qr_code_image_url')}\r\n            </label>\r\n            <input\r\n              type=\"url\"\r\n              className=\"FormControl\"\r\n              placeholder=\"https://example.com/qr-code.png\"\r\n              bidi={this.formData.qrCodeImageUrl}\r\n              disabled={submitting}\r\n            />\r\n            <div className=\"helpText\">\r\n              {app.translator.trans('funds.admin.deposit.platforms.qr_code_image_help')}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Three-tier icon system */}\r\n          <div className=\"Form-section\">\r\n            <h4>{app.translator.trans('funds.admin.platforms.icon_configuration')}</h4>\r\n            <p className=\"helpText\">{app.translator.trans('funds.admin.platforms.icon_configuration_help')}</p>\r\n            \r\n            {/* Currency Icon Override */}\r\n            <div className=\"Form-row\">\r\n              <div className=\"Form-group\">\r\n                <label>{app.translator.trans('funds.admin.platforms.currency_icon_override_url')}</label>\r\n                <input\r\n                  type=\"url\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"https://example.com/usdt-icon.png\"\r\n                  bidi={this.formData.currencyIconOverrideUrl}\r\n                  disabled={submitting}\r\n                />\r\n                <div className=\"helpText\">{app.translator.trans('funds.admin.platforms.currency_icon_override_url_help')}</div>\r\n              </div>\r\n              <div className=\"Form-group\">\r\n                <label>{app.translator.trans('funds.admin.platforms.currency_icon_override_class')}</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"fab fa-bitcoin\"\r\n                  bidi={this.formData.currencyIconOverrideClass}\r\n                  disabled={submitting}\r\n                />\r\n                <div className=\"helpText\">{app.translator.trans('funds.admin.platforms.currency_icon_override_class_help')}</div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Network Icon Override */}\r\n            <div className=\"Form-row\">\r\n              <div className=\"Form-group\">\r\n                <label>{app.translator.trans('funds.admin.platforms.network_icon_override_url')}</label>\r\n                <input\r\n                  type=\"url\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"https://example.com/trc20-icon.png\"\r\n                  bidi={this.formData.networkIconOverrideUrl}\r\n                  disabled={submitting}\r\n                />\r\n                <div className=\"helpText\">{app.translator.trans('funds.admin.platforms.network_icon_override_url_help')}</div>\r\n              </div>\r\n              <div className=\"Form-group\">\r\n                <label>{app.translator.trans('funds.admin.platforms.network_icon_override_class')}</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"fas fa-network-wired\"\r\n                  bidi={this.formData.networkIconOverrideClass}\r\n                  disabled={submitting}\r\n                />\r\n                <div className=\"helpText\">{app.translator.trans('funds.admin.platforms.network_icon_override_class_help')}</div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Platform-Specific Icon */}\r\n            <div className=\"Form-row\">\r\n              <div className=\"Form-group\">\r\n                <label>{app.translator.trans('funds.admin.platforms.platform_specific_icon_url')}</label>\r\n                <input\r\n                  type=\"url\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"https://example.com/platform-specific-icon.png\"\r\n                  bidi={this.formData.platformSpecificIconUrl}\r\n                  disabled={submitting}\r\n                />\r\n                <div className=\"helpText\">{app.translator.trans('funds.admin.platforms.platform_specific_icon_url_help')}</div>\r\n              </div>\r\n              <div className=\"Form-group\">\r\n                <label>{app.translator.trans('funds.admin.platforms.platform_specific_icon_class')}</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"fas fa-building\"\r\n                  bidi={this.formData.platformSpecificIconClass}\r\n                  disabled={submitting}\r\n                />\r\n                <div className=\"helpText\">{app.translator.trans('funds.admin.platforms.platform_specific_icon_class_help')}</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n\r\n          <div className=\"Form-group\">\r\n            <label>\r\n              {app.translator.trans('funds.admin.deposit.platforms.warning_text')}\r\n            </label>\r\n            <textarea\r\n              className=\"FormControl\"\r\n              rows={3}\r\n              placeholder=\"Network-specific warning for users\"\r\n              bidi={this.formData.warningText}\r\n              disabled={submitting}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"Form-group\">\r\n            <Switch state={this.formData.isActive()} onchange={this.formData.isActive} disabled={submitting}>\r\n              {app.translator.trans('funds.admin.deposit.platforms.is_active')}\r\n            </Switch>\r\n          </div>\r\n\r\n        </div>\r\n      </form>\r\n    );\r\n  }\r\n\r\n\r\n  private validateForm(): boolean {\r\n    const validator = new FormValidator();\r\n    \r\n    try {\r\n      // Fixed: Convert NestedStringArray to string for FormValidator\r\n      const nameLabel = app.translator.trans('funds.admin.deposit.platforms.name').toString();\r\n      const symbolLabel = app.translator.trans('funds.admin.deposit.platforms.symbol').toString();\r\n      const addressLabel = app.translator.trans('funds.admin.deposit.platforms.address').toString();\r\n      \r\n      validator\r\n        .required(this.formData.name(), 'name', nameLabel)\r\n        .required(this.formData.symbol(), 'symbol', symbolLabel)\r\n        .required(this.formData.address(), 'address', addressLabel);\r\n\r\n      // Optional numeric fields validation\r\n      if (this.formData.minAmount() && this.formData.minAmount().trim()) {\r\n        const minAmountLabel = app.translator.trans('funds.admin.deposit.platforms.min_amount').toString();\r\n        validator.numberRange(this.formData.minAmount(), 0, undefined, 'minAmount', minAmountLabel);\r\n      }\r\n      \r\n      if (this.formData.maxAmount() && this.formData.maxAmount().trim()) {\r\n        const maxAmountLabel = app.translator.trans('funds.admin.deposit.platforms.max_amount').toString();\r\n        validator.numberRange(this.formData.maxAmount(), 0, undefined, 'maxAmount', maxAmountLabel);\r\n      }\r\n\r\n      if (this.formData.fee() && this.formData.fee().trim()) {\r\n        const feeLabel = app.translator.trans('funds.admin.deposit.platforms.fee').toString();\r\n        validator.numberRange(this.formData.fee(), 0, undefined, 'fee', feeLabel);\r\n      }\r\n\r\n      // Custom validation for max >= min if both are provided\r\n      if (this.formData.minAmount() && this.formData.maxAmount()) {\r\n        const minVal = parseFloat(this.formData.minAmount());\r\n        const maxVal = parseFloat(this.formData.maxAmount());\r\n        if (!isNaN(minVal) && !isNaN(maxVal) && maxVal < minVal) {\r\n          const errorMessage = app.translator.trans('funds.admin.platforms.max_min_error').toString();\r\n          validator.custom(false, 'maxAmount', errorMessage);\r\n        }\r\n      }\r\n\r\n      // Optional URL validations for three-tier icon system\r\n      if (this.formData.currencyIconOverrideUrl() && this.formData.currencyIconOverrideUrl().trim()) {\r\n        const currencyIconUrlLabel = app.translator.trans('funds.admin.platforms.currency_icon_override_url').toString();\r\n        validator.url(this.formData.currencyIconOverrideUrl(), 'currencyIconOverrideUrl', currencyIconUrlLabel);\r\n      }\r\n      \r\n      if (this.formData.networkIconOverrideUrl() && this.formData.networkIconOverrideUrl().trim()) {\r\n        const networkIconUrlLabel = app.translator.trans('funds.admin.platforms.network_icon_override_url').toString();\r\n        validator.url(this.formData.networkIconOverrideUrl(), 'networkIconOverrideUrl', networkIconUrlLabel);\r\n      }\r\n      \r\n      if (this.formData.platformSpecificIconUrl() && this.formData.platformSpecificIconUrl().trim()) {\r\n        const platformIconUrlLabel = app.translator.trans('funds.admin.platforms.platform_specific_icon_url').toString();\r\n        validator.url(this.formData.platformSpecificIconUrl(), 'platformSpecificIconUrl', platformIconUrlLabel);\r\n      }\r\n      \r\n      if (this.formData.qrCodeImageUrl() && this.formData.qrCodeImageUrl().trim()) {\r\n        const qrCodeLabel = app.translator.trans('funds.admin.deposit.platforms.qr_code_image_url').toString();\r\n        validator.url(this.formData.qrCodeImageUrl(), 'qrCodeImageUrl', qrCodeLabel);\r\n      }\r\n\r\n      const result = validator.getResult();\r\n      \r\n      if (!result.isValid && result.firstErrorMessage) {\r\n        app.alerts.show({ type: 'error', dismissible: true }, result.firstErrorMessage);\r\n      }\r\n\r\n      return result.isValid;\r\n    } catch (error) {\r\n      console.error('Form validation error:', error);\r\n      app.alerts.show({ type: 'error', dismissible: true }, 'Validation failed');\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public clearForm(): void {\r\n    this.formData.name('');\r\n    this.formData.symbol('');\r\n    this.formData.network('');\r\n    this.formData.minAmount('');\r\n    this.formData.maxAmount('');\r\n    this.formData.fee('');\r\n    this.formData.address('');\r\n    this.formData.qrCodeImageUrl('');\r\n    // Clear three-tier icon fields\r\n    this.formData.currencyIconOverrideUrl('');\r\n    this.formData.currencyIconOverrideClass('');\r\n    this.formData.networkIconOverrideUrl('');\r\n    this.formData.networkIconOverrideClass('');\r\n    this.formData.platformSpecificIconUrl('');\r\n    this.formData.platformSpecificIconClass('');\r\n    this.formData.warningText('');\r\n    this.formData.isActive(true);\r\n  }\r\n\r\n  private async handleSubmit(attrs: AddDepositPlatformFormAttrs, e: Event): Promise<void> {\r\n    e.preventDefault();\r\n\r\n    if (!this.validateForm()) {\r\n      return;\r\n    }\r\n\r\n    const formData: DepositPlatformFormData = {\r\n      name: this.formData.name(),\r\n      symbol: this.formData.symbol(),\r\n      network: this.formData.network(),\r\n      minAmount: this.formData.minAmount(),\r\n      maxAmount: this.formData.maxAmount(),\r\n      fee: this.formData.fee(),\r\n      address: this.formData.address(),\r\n      qrCodeImageUrl: this.formData.qrCodeImageUrl(),\r\n      // Three-tier icon system\r\n      currencyIconOverrideUrl: this.formData.currencyIconOverrideUrl(),\r\n      currencyIconOverrideClass: this.formData.currencyIconOverrideClass(),\r\n      networkIconOverrideUrl: this.formData.networkIconOverrideUrl(),\r\n      networkIconOverrideClass: this.formData.networkIconOverrideClass(),\r\n      platformSpecificIconUrl: this.formData.platformSpecificIconUrl(),\r\n      platformSpecificIconClass: this.formData.platformSpecificIconClass(),\r\n      warningText: this.formData.warningText(),\r\n      isActive: this.formData.isActive()\r\n    };\r\n\r\n    try {\r\n      await attrs.onSubmit(formData);\r\n      // Clear form after successful submission\r\n      this.clearForm();\r\n    } catch (error) {\r\n      // Error handling is done by parent component\r\n      console.error('Form submission error:', error);\r\n    }\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport type Mithril from 'mithril';\r\nimport Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport AddDepositPlatformForm from '../forms/AddDepositPlatformForm';\r\nimport GenericPlatformListItem from '../shared/GenericPlatformListItem';\r\nimport type { GenericPlatform } from '../shared/GenericManagementPage';\r\n\r\ninterface DepositPlatformManagementSectionAttrs {\r\n  platforms: GenericPlatform[];\r\n  submittingPlatform: boolean;\r\n  onAddPlatform: (formData: any) => Promise<void>;\r\n  onTogglePlatformStatus: (platform: GenericPlatform) => Promise<void>;\r\n  onDeletePlatform: (platform: GenericPlatform) => Promise<void>;\r\n}\r\n\r\nexport default class DepositPlatformManagementSection extends Component<DepositPlatformManagementSectionAttrs> {\r\n  view(vnode: Mithril.Vnode<DepositPlatformManagementSectionAttrs>): Mithril.Children {\r\n    const { platforms, submittingPlatform, onAddPlatform, onTogglePlatformStatus, onDeletePlatform } = vnode.attrs;\r\n\r\n    return (\r\n      <div className=\"DepositPlatformManagementSection\">\r\n        <div className=\"Section-header\">\r\n          <h3>{app.translator.trans('funds.admin.deposit.platforms.title')}</h3>\r\n        </div>\r\n\r\n        <div className=\"DepositPlatformManagementSection-layout\">\r\n          {/* Always visible form */}\r\n          <div className=\"DepositPlatformManagementSection-form\">\r\n            <div className=\"DepositPlatformManagementSection-formHeader\">\r\n              <h4>Add New Platform</h4>\r\n              <Button\r\n                className=\"Button Button--primary DepositPlatformManagementSection-addButton\"\r\n                icon=\"fas fa-plus\"\r\n                type=\"submit\"\r\n                form=\"deposit-platform-form\"\r\n                loading={submittingPlatform}\r\n                disabled={submittingPlatform}\r\n              >\r\n                {app.translator.trans('funds.admin.deposit.platforms.add_button')}\r\n              </Button>\r\n            </div>\r\n            \r\n            <AddDepositPlatformForm\r\n              onSubmit={onAddPlatform}\r\n              onCancel={() => {}} // Not needed since form is always visible\r\n              submitting={submittingPlatform}\r\n            />\r\n          </div>\r\n\r\n          {/* Existing platforms list */}\r\n          <div className=\"DepositPlatformManagementSection-list\">\r\n            <h4>Existing Platforms</h4>\r\n            <div className=\"Section-content\">\r\n              {platforms.length === 0 ? (\r\n                <div className=\"helpText\">\r\n                  {app.translator.trans('funds.admin.deposit.platforms.empty')}\r\n                </div>\r\n              ) : (\r\n                <div className=\"PlatformList\">\r\n                  {platforms.map((platform) => (\r\n                    <GenericPlatformListItem\r\n                      key={typeof platform.id === 'function' ? platform.id() : platform.id}\r\n                      platform={platform}\r\n                      type=\"deposit\"\r\n                      onToggleStatus={() => onTogglePlatformStatus(platform)}\r\n                      onDelete={() => onDeletePlatform(platform)}\r\n                    />\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport type { PlatformOperations, TransactionOperations } from '../components/shared/GenericManagementPage';\r\n\r\n// Withdrawal platform operations - now using service layer\r\nexport const createWithdrawalPlatformOperations = (): PlatformOperations<any> => ({\r\n  async create(formData: any) {\r\n    try {\r\n      // Import PlatformService dynamically to avoid circular dependencies\r\n      const { platformService } = await import('../../common/services/PlatformService');\r\n      \r\n      const attributes = {\r\n        name: formData.name,\r\n        symbol: formData.symbol,\r\n        network: formData.network || null,\r\n        minAmount: parseFloat(formData.minAmount),\r\n        maxAmount: parseFloat(formData.maxAmount),\r\n        fee: parseFloat(formData.fee || '0'),\r\n        iconUrl: formData.iconUrl || null,\r\n        iconClass: formData.iconClass || null,\r\n        isActive: true\r\n      };\r\n      \r\n      const result = await platformService.create('funds', attributes);\r\n      \r\n      app.alerts.show(\r\n        { type: 'success', dismissible: true },\r\n        app.translator.trans('funds.admin.platforms.add_success').toString()\r\n      );\r\n      \r\n      return result;\r\n    } catch (error) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        error instanceof Error ? error.message : app.translator.trans('funds.admin.platforms.add_error').toString()\r\n      );\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  async toggleStatus(platform: any) {\r\n    try {\r\n      // Import PlatformService dynamically\r\n      const { platformService } = await import('../../common/services/PlatformService');\r\n      \r\n      const result = await platformService.toggleStatus(platform);\r\n      const newStatus = result.isActive();\r\n      \r\n      app.alerts.show(\r\n        { type: 'success', dismissible: true },\r\n        app.translator.trans(`funds.admin.platforms.${newStatus ? 'enable' : 'disable'}_success`)\r\n      );\r\n      \r\n      return result;\r\n    } catch (error) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        error instanceof Error ? error.message : 'Failed to toggle platform status'\r\n      );\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  async delete(platform: any) {\r\n    try {\r\n      // Import PlatformService dynamically\r\n      const { platformService } = await import('../../common/services/PlatformService');\r\n      \r\n      await platformService.delete(platform);\r\n      \r\n      app.alerts.show(\r\n        { type: 'success', dismissible: true },\r\n        app.translator.trans('funds.admin.platforms.delete_success').toString()\r\n      );\r\n    } catch (error) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        error instanceof Error ? error.message : 'Failed to delete platform'\r\n      );\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  async load() {\r\n    try {\r\n      // Import PlatformService dynamically\r\n      const { platformService } = await import('../../common/services/PlatformService');\r\n      return await platformService.find('funds');\r\n    } catch (error) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        app.translator.trans('funds.admin.platforms.load_error').toString()\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n});\r\n\r\n// Deposit platform operations - now using service layer\r\nexport const createDepositPlatformOperations = (): PlatformOperations<any> => ({\r\n  async create(formData: any) {\r\n    try {\r\n      // Import PlatformService dynamically\r\n      const { platformService } = await import('../../common/services/PlatformService');\r\n      \r\n      const attributes = {\r\n        name: formData.name,\r\n        symbol: formData.symbol,\r\n        network: formData.network,\r\n        minAmount: parseFloat(formData.minAmount) || 0,\r\n        maxAmount: formData.maxAmount ? parseFloat(formData.maxAmount) : null,\r\n        address: formData.address || null,\r\n        qrCodeImageUrl: formData.qrCodeImageUrl || null,\r\n        iconUrl: formData.iconUrl || null,\r\n        iconClass: formData.iconClass || null,\r\n        warningText: formData.warningText || null,\r\n        isActive: formData.isActive\r\n      };\r\n      \r\n      const result = await platformService.create('deposit', attributes);\r\n      \r\n      // Success message is handled by the calling component (UnifiedManagementPage)\r\n      // to avoid duplicate messages\r\n      \r\n      return result;\r\n    } catch (error) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        error instanceof Error ? error.message : app.translator.trans('funds.admin.deposit.platforms.add_error').toString()\r\n      );\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  async toggleStatus(platform: any) {\r\n    try {\r\n      // Import PlatformService dynamically\r\n      const { platformService } = await import('../../common/services/PlatformService');\r\n      \r\n      const result = await platformService.toggleStatus(platform);\r\n      \r\n      // Success message is handled by the calling component (UnifiedManagementPage)\r\n      // to avoid duplicate messages\r\n      \r\n      return result;\r\n    } catch (error) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        error instanceof Error ? error.message : app.translator.trans('funds.admin.deposit.platforms.toggle_error').toString()\r\n      );\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  async delete(platform: any) {\r\n    try {\r\n      // Import PlatformService dynamically\r\n      const { platformService } = await import('../../common/services/PlatformService');\r\n      \r\n      await platformService.delete(platform);\r\n      \r\n      // Success message is handled by the calling component (UnifiedManagementPage)\r\n      // to avoid duplicate messages\r\n    } catch (error) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        error instanceof Error ? error.message : app.translator.trans('funds.admin.deposit.platforms.delete_error').toString()\r\n      );\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  async load() {\r\n    try {\r\n      // Import PlatformService dynamically\r\n      const { platformService } = await import('../../common/services/PlatformService');\r\n      return await platformService.find('deposit');\r\n    } catch (error) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        app.translator.trans('funds.admin.deposit.platforms.load_error').toString()\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n});\r\n\r\n// Withdrawal request operations - now using service layer\r\nexport const createWithdrawalRequestOperations = (): TransactionOperations<any> => ({\r\n  async updateStatus(request: any, status: string) {\r\n    try {\r\n      // Import WithdrawalService dynamically\r\n      const { withdrawalService } = await import('../../common/services/WithdrawalService');\r\n      \r\n      const result = await withdrawalService.update(request, { status });\r\n      \r\n      // Success message is handled by the calling component (GenericManagementPage)\r\n      // to avoid duplicate messages\r\n      \r\n      return result;\r\n    } catch (error) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        error instanceof Error ? error.message : `Failed to update request status to ${status}`\r\n      );\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  async load() {\r\n    try {\r\n      // Import WithdrawalService dynamically\r\n      const { withdrawalService } = await import('../../common/services/WithdrawalService');\r\n      return await withdrawalService.find({ include: 'user,platform' });\r\n    } catch (error) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        app.translator.trans('funds.admin.requests.load_error').toString()\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n});\r\n\r\n// Deposit record operations - now using service layer\r\nexport const createDepositRecordOperations = (): TransactionOperations<any> => ({\r\n  async updateStatus(record: any, status: string) {\r\n    try {\r\n      // Import DepositService dynamically\r\n      const { depositService } = await import('../../common/services/DepositService');\r\n      \r\n      const result = await depositService.update(record, { status });\r\n      \r\n      // Success message is handled by the calling component\r\n      // to avoid duplicate messages\r\n      \r\n      return result;\r\n    } catch (error) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        error instanceof Error ? error.message : app.translator.trans('funds.admin.deposit.records.update_error').toString()\r\n      );\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  async load() {\r\n    try {\r\n      // Import DepositService dynamically\r\n      const { depositService } = await import('../../common/services/DepositService');\r\n      return await depositService.find();\r\n    } catch (error) {\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        app.translator.trans('funds.admin.deposit.records.load_error').toString()\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n});","import Model from 'flarum/common/Model';\r\n\r\n/**\r\n * Standard pagination parameters for Flarum API requests\r\n */\r\nexport interface PaginationOptions {\r\n  limit?: number;\r\n  offset?: number;\r\n  page?: {\r\n    limit?: number;\r\n    offset?: number;\r\n  };\r\n}\r\n\r\n/**\r\n * Standard filter options for API requests\r\n */\r\nexport interface FilterOptions {\r\n  [key: string]: any;\r\n}\r\n\r\n/**\r\n * Standard sort options for API requests\r\n */\r\nexport interface SortOptions {\r\n  field: string;\r\n  direction: 'asc' | 'desc';\r\n}\r\n\r\n/**\r\n * Standard query options for finding records\r\n */\r\nexport interface QueryOptions {\r\n  include?: string | string[];\r\n  filter?: FilterOptions;\r\n  sort?: string | SortOptions | SortOptions[];\r\n  page?: PaginationOptions;\r\n}\r\n\r\n/**\r\n * Service response wrapper for better error handling\r\n */\r\nexport interface ServiceResponse<T> {\r\n  data: T;\r\n  meta?: {\r\n    total?: number;\r\n    count?: number;\r\n    hasMore?: boolean;\r\n  };\r\n  errors?: Array<{\r\n    detail: string;\r\n    source?: any;\r\n  }>;\r\n}\r\n\r\n/**\r\n * Base service interface that all services should implement\r\n */\r\nexport interface BaseService<TModel extends Model> {\r\n  /**\r\n   * Find multiple records\r\n   */\r\n  find(options?: QueryOptions): Promise<TModel[]>;\r\n\r\n  /**\r\n   * Find a single record by ID\r\n   */\r\n  findById(id: string | number, options?: QueryOptions): Promise<TModel | null>;\r\n\r\n  /**\r\n   * Create a new record\r\n   */\r\n  create(attributes: Record<string, any>): Promise<TModel>;\r\n\r\n  /**\r\n   * Update an existing record\r\n   */\r\n  update(model: TModel, attributes: Record<string, any>): Promise<TModel>;\r\n\r\n  /**\r\n   * Delete a record\r\n   */\r\n  delete(model: TModel): Promise<void>;\r\n\r\n  /**\r\n   * Check if a record can be modified by current user\r\n   */\r\n  canModify(model: TModel): boolean;\r\n\r\n  /**\r\n   * Check if current user can create new records\r\n   */\r\n  canCreate(): boolean;\r\n\r\n  /**\r\n   * Check if current user can delete a record\r\n   */\r\n  canDelete(model: TModel): boolean;\r\n}\r\n\r\n/**\r\n * Withdrawal-specific service interface\r\n */\r\nexport interface WithdrawalServiceInterface extends BaseService<any> {\r\n  /**\r\n   * Submit a funds request\r\n   */\r\n  submitRequest(data: {\r\n    platformId: number;\r\n    amount: number;\r\n    accountDetails: string;\r\n    message?: string;\r\n  }): Promise<any>;\r\n\r\n  /**\r\n   * Get user's funds history\r\n   */\r\n  getUserHistory(userId?: number, options?: QueryOptions): Promise<any[]>;\r\n\r\n  /**\r\n   * Get pending requests (admin only)\r\n   */\r\n  getPendingRequests(options?: QueryOptions): Promise<any[]>;\r\n\r\n  /**\r\n   * Approve a funds request (admin only)\r\n   */\r\n  approve(request: any, message?: string): Promise<any>;\r\n\r\n  /**\r\n   * Reject a funds request (admin only)\r\n   */\r\n  reject(request: any, reason?: string): Promise<any>;\r\n\r\n  /**\r\n   * Cancel a pending request (user only)\r\n   */\r\n  cancel(request: any): Promise<any>;\r\n}\r\n\r\n/**\r\n * Deposit-specific service interface\r\n */\r\nexport interface DepositServiceInterface extends BaseService<any> {\r\n  /**\r\n   * Generate deposit address for user\r\n   */\r\n  generateAddress(platformId: number): Promise<string>;\r\n\r\n  /**\r\n   * Get user's deposit history\r\n   */\r\n  getUserHistory(userId?: number, options?: QueryOptions): Promise<any[]>;\r\n\r\n  /**\r\n   * Create deposit record\r\n   */\r\n  createRecord(data: {\r\n    platformId: number;\r\n    amount: number;\r\n    note?: string;\r\n  }): Promise<any>;\r\n\r\n  /**\r\n   * Get pending deposits (admin only)\r\n   */\r\n  getPendingDeposits(options?: QueryOptions): Promise<any[]>;\r\n\r\n  /**\r\n   * Confirm a deposit (admin only)\r\n   */\r\n  confirm(deposit: any, confirmedAmount?: number): Promise<any>;\r\n}\r\n\r\n/**\r\n * Platform service interface for both funds and deposit platforms\r\n */\r\nexport interface PlatformServiceInterface extends BaseService<any> {\r\n  /**\r\n   * Get active platforms only\r\n   */\r\n  getActive(type: 'funds' | 'deposit', options?: QueryOptions): Promise<any[]>;\r\n\r\n  /**\r\n   * Toggle platform status (admin only)\r\n   */\r\n  toggleStatus(platform: any): Promise<any>;\r\n\r\n  /**\r\n   * Update platform configuration (admin only)\r\n   */\r\n  updateConfig(platform: any, config: Record<string, any>): Promise<any>;\r\n\r\n  /**\r\n   * Get platforms by symbol\r\n   */\r\n  getBySymbol(symbol: string, type: 'funds' | 'deposit'): Promise<any[]>;\r\n}\r\n\r\n/**\r\n * Settings service interface for managing Flarum admin settings\r\n */\r\nexport interface SettingsServiceInterface {\r\n  getSetting(key: string, defaultValue?: any): Promise<any>;\r\n  saveSetting(key: string, value: any): Promise<void>;\r\n  saveSettings(settings: Record<string, any>): Promise<void>;\r\n  deleteSetting(key: string): Promise<void>;\r\n  getSettingsWithPrefix(prefix: string): Promise<Record<string, any>>;\r\n  canManageSettings(): boolean;\r\n  getExtensionSetting(extension: string, key: string, defaultValue?: any): Promise<any>;\r\n  saveExtensionSetting(extension: string, key: string, value: any): Promise<void>;\r\n  getWithdrawalSetting(key: string, defaultValue?: any): Promise<any>;\r\n  saveWithdrawalSetting(key: string, value: any): Promise<void>;\r\n  getAllWithdrawalSettings(): Promise<Record<string, any>>;\r\n}\r\n\r\n/**\r\n * Address service interface for managing deposit addresses\r\n */\r\nexport interface AddressServiceInterface {\r\n  generateAddress(platformId: number, userId?: number): Promise<string>;\r\n  canGenerateAddress(): boolean;\r\n}\r\n\r\n/**\r\n * Cache service for managing local data storage\r\n */\r\nexport interface CacheOptions {\r\n  ttl?: number; // Time to live in milliseconds\r\n  key?: string; // Custom cache key\r\n  refresh?: boolean; // Force refresh from server\r\n}\r\n\r\n/**\r\n * Common service configuration\r\n */\r\nexport interface ServiceConfig {\r\n  apiUrl?: string;\r\n  timeout?: number;\r\n  retries?: number;\r\n  cache?: boolean;\r\n  defaultPageSize?: number;\r\n}\r\n\r\n/**\r\n * Service error types\r\n */\r\nexport enum ServiceErrorType {\r\n  NETWORK_ERROR = 'network_error',\r\n  PERMISSION_DENIED = 'permission_denied',\r\n  VALIDATION_ERROR = 'validation_error',\r\n  NOT_FOUND = 'not_found',\r\n  SERVER_ERROR = 'server_error',\r\n  TIMEOUT = 'timeout'\r\n}\r\n\r\n/**\r\n * Service error class\r\n */\r\nexport class ServiceError extends Error {\r\n  public type: ServiceErrorType;\r\n  public code?: string;\r\n  public details?: any;\r\n\r\n  constructor(\r\n    message: string, \r\n    type: ServiceErrorType = ServiceErrorType.SERVER_ERROR, \r\n    code?: string, \r\n    details?: any\r\n  ) {\r\n    super(message);\r\n    this.name = 'ServiceError';\r\n    this.type = type;\r\n    this.code = code;\r\n    this.details = details;\r\n  }\r\n}","import app from 'flarum/common/app';\r\nimport WithdrawalRequest from '../models/WithdrawalRequest';\r\nimport WithdrawalPlatform from '../models/WithdrawalPlatform';\r\nimport { \r\n  WithdrawalServiceInterface, \r\n  QueryOptions, \r\n  ServiceError, \r\n  ServiceErrorType\r\n} from '../types/services';\r\n\r\n/**\r\n * Service for managing funds requests with proper CRUD operations\r\n */\r\nexport default class WithdrawalService implements WithdrawalServiceInterface {\r\n  private readonly modelType = 'funds-requests';\r\n  private readonly platformModelType = 'funds-platforms';\r\n\r\n  /**\r\n   * Find multiple funds requests\r\n   */\r\n  async find(options: QueryOptions = {}): Promise<WithdrawalRequest[]> {\r\n    try {\r\n      const queryParams: any = {\r\n        include: options.include || 'user,platform',\r\n        sort: options.sort || '-created_at',\r\n        ...options\r\n      };\r\n\r\n      // Add pagination if specified\r\n      if (options.page) {\r\n        queryParams.page = options.page;\r\n      }\r\n\r\n      // Add filters if specified\r\n      if (options.filter) {\r\n        queryParams.filter = options.filter;\r\n      }\r\n\r\n      const results = await app.store.find(this.modelType, queryParams);\r\n      return Array.isArray(results) ? results : [results];\r\n    } catch (error) {\r\n      throw this.handleError(error, 'Failed to fetch funds requests');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find a single funds request by ID\r\n   */\r\n  async findById(id: string | number, options: QueryOptions = {}): Promise<WithdrawalRequest | null> {\r\n    try {\r\n      const queryParams: any = {\r\n        include: options.include || 'user,platform'\r\n      };\r\n\r\n      const result = await app.store.find(this.modelType, id, queryParams);\r\n      return result as WithdrawalRequest;\r\n    } catch (error) {\r\n      if (this.isNotFoundError(error)) {\r\n        return null;\r\n      }\r\n      throw this.handleError(error, `Failed to fetch funds request ${id}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new funds request\r\n   */\r\n  async create(attributes: Record<string, any>): Promise<WithdrawalRequest> {\r\n    try {\r\n      // Validate required fields\r\n      this.validateCreateAttributes(attributes);\r\n\r\n      const request = app.store.createRecord(this.modelType) as WithdrawalRequest;\r\n      \r\n      const savedRequest = await request.save(attributes);\r\n      return savedRequest as WithdrawalRequest;\r\n    } catch (error) {\r\n      throw this.handleError(error, 'Failed to create funds request');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update an existing funds request\r\n   */\r\n  async update(model: WithdrawalRequest, attributes: Record<string, any>): Promise<WithdrawalRequest> {\r\n    try {\r\n      if (!this.canModify(model)) {\r\n        throw new ServiceError(\r\n          'You do not have permission to modify this funds request',\r\n          ServiceErrorType.PERMISSION_DENIED\r\n        );\r\n      }\r\n\r\n      const updatedModel = await model.save(attributes);\r\n      return updatedModel as WithdrawalRequest;\r\n    } catch (error) {\r\n      throw this.handleError(error, 'Failed to update funds request');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a funds request\r\n   */\r\n  async delete(model: WithdrawalRequest): Promise<void> {\r\n    try {\r\n      if (!this.canDelete(model)) {\r\n        throw new ServiceError(\r\n          'You do not have permission to delete this funds request',\r\n          ServiceErrorType.PERMISSION_DENIED\r\n        );\r\n      }\r\n\r\n      await model.delete();\r\n    } catch (error) {\r\n      throw this.handleError(error, 'Failed to delete funds request');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Submit a new funds request with validation\r\n   */\r\n  async submitRequest(data: {\r\n    platformId: number;\r\n    amount: number;\r\n    accountDetails: string;\r\n    message?: string;\r\n  }): Promise<WithdrawalRequest> {\r\n    try {\r\n      // Validate user balance and platform limits\r\n      await this.validateWithdrawalRequest(data);\r\n\r\n      const attributes = {\r\n        platformId: data.platformId,\r\n        amount: data.amount,\r\n        accountDetails: data.accountDetails,\r\n        message: data.message || '',\r\n        status: 'pending'\r\n      };\r\n\r\n      return await this.create(attributes);\r\n    } catch (error) {\r\n      throw this.handleError(error, 'Failed to submit funds request');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get user's funds history\r\n   */\r\n  async getUserHistory(userId?: number, options: QueryOptions = {}): Promise<WithdrawalRequest[]> {\r\n    const targetUserId = userId || app.session.user?.id();\r\n    \r\n    if (!targetUserId) {\r\n      throw new ServiceError(\r\n        'User not authenticated',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    const queryOptions = {\r\n      ...options,\r\n      filter: {\r\n        user: targetUserId,\r\n        ...options.filter\r\n      },\r\n      include: options.include || 'platform',\r\n      sort: options.sort || '-created_at'\r\n    };\r\n\r\n    return await this.find(queryOptions);\r\n  }\r\n\r\n  /**\r\n   * Get pending requests (admin only)\r\n   */\r\n  async getPendingRequests(options: QueryOptions = {}): Promise<WithdrawalRequest[]> {\r\n    if (!app.session.user?.isAdmin()) {\r\n      throw new ServiceError(\r\n        'Admin permissions required',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    const queryOptions = {\r\n      ...options,\r\n      filter: {\r\n        status: 'pending',\r\n        ...options.filter\r\n      },\r\n      include: options.include || 'user,platform',\r\n      sort: options.sort || 'created_at'\r\n    };\r\n\r\n    return await this.find(queryOptions);\r\n  }\r\n\r\n  /**\r\n   * Approve a funds request (admin only)\r\n   */\r\n  async approve(request: WithdrawalRequest, message?: string): Promise<WithdrawalRequest> {\r\n    if (!app.session.user?.isAdmin()) {\r\n      throw new ServiceError(\r\n        'Admin permissions required',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    if (!request.isPending()) {\r\n      throw new ServiceError(\r\n        'Only pending requests can be approved',\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n\r\n    const attributes: any = {\r\n      status: 'approved'\r\n    };\r\n\r\n    if (message) {\r\n      attributes.adminNote = message;\r\n    }\r\n\r\n    return await this.update(request, attributes);\r\n  }\r\n\r\n  /**\r\n   * Reject a funds request (admin only)\r\n   */\r\n  async reject(request: WithdrawalRequest, reason?: string): Promise<WithdrawalRequest> {\r\n    if (!app.session.user?.isAdmin()) {\r\n      throw new ServiceError(\r\n        'Admin permissions required',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    if (!request.isPending()) {\r\n      throw new ServiceError(\r\n        'Only pending requests can be rejected',\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n\r\n    const attributes: any = {\r\n      status: 'rejected'\r\n    };\r\n\r\n    if (reason) {\r\n      attributes.adminNote = reason;\r\n    }\r\n\r\n    return await this.update(request, attributes);\r\n  }\r\n\r\n  /**\r\n   * Cancel a pending request (user only)\r\n   */\r\n  async cancel(request: WithdrawalRequest): Promise<any> {\r\n    if (!request.canBeModified()) {\r\n      throw new ServiceError(\r\n        'This request cannot be cancelled',\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n\r\n    const currentUser = app.session.user;\r\n    if (!currentUser || (request.userId() !== currentUser.id() && !currentUser.isAdmin())) {\r\n      throw new ServiceError(\r\n        'You can only cancel your own requests',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    return await this.delete(request);\r\n  }\r\n\r\n  /**\r\n   * Check if current user can modify a funds request\r\n   */\r\n  canModify(model: WithdrawalRequest): boolean {\r\n    const currentUser = app.session.user;\r\n    if (!currentUser) return false;\r\n\r\n    // Admin can modify any request\r\n    if (currentUser.isAdmin()) return true;\r\n\r\n    // Users can only modify their own pending requests\r\n    return model.userId() === currentUser.id() && model.canBeModified();\r\n  }\r\n\r\n  /**\r\n   * Check if current user can create new funds requests\r\n   */\r\n  canCreate(): boolean {\r\n    const currentUser = app.session.user;\r\n    return currentUser && !currentUser.isGuest();\r\n  }\r\n\r\n  /**\r\n   * Check if current user can delete a funds request\r\n   */\r\n  canDelete(model: WithdrawalRequest): boolean {\r\n    const currentUser = app.session.user;\r\n    if (!currentUser) return false;\r\n\r\n    // Admin can delete any request\r\n    if (currentUser.isAdmin()) return true;\r\n\r\n    // Users can only delete their own pending requests\r\n    return model.userId() === currentUser.id() && model.canBeModified();\r\n  }\r\n\r\n  /**\r\n   * Get available funds platforms\r\n   */\r\n  async getPlatforms(): Promise<WithdrawalPlatform[]> {\r\n    try {\r\n      const platforms = await app.store.find(this.platformModelType, {\r\n        filter: { isActive: true },\r\n        sort: 'name'\r\n      });\r\n      \r\n      return Array.isArray(platforms) ? platforms : [platforms];\r\n    } catch (error) {\r\n      throw this.handleError(error, 'Failed to fetch funds platforms');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validate funds request data\r\n   */\r\n  private async validateWithdrawalRequest(data: any): Promise<void> {\r\n    const { platformId, amount } = data;\r\n\r\n    // Get platform details\r\n    const platform = await app.store.find(this.platformModelType, platformId);\r\n    if (!platform) {\r\n      throw new ServiceError(\r\n        'Invalid platform selected',\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n\r\n    // Check if platform is active\r\n    if (!platform.isActive()) {\r\n      throw new ServiceError(\r\n        'Selected platform is not available',\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n\r\n    // Validate amount limits\r\n    const minAmount = platform.minAmount();\r\n    const maxAmount = platform.maxAmount();\r\n    \r\n    if (amount < minAmount) {\r\n      throw new ServiceError(\r\n        `Minimum funds amount is ${minAmount}`,\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n\r\n    if (maxAmount && amount > maxAmount) {\r\n      throw new ServiceError(\r\n        `Maximum funds amount is ${maxAmount}`,\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n\r\n    // Check user balance\r\n    const currentUser = app.session.user;\r\n    if (currentUser) {\r\n      const userBalance = parseFloat(currentUser.attribute('money') || '0');\r\n      const fee = platform.fee ? platform.fee() : 0;\r\n      const totalRequired = amount + fee;\r\n\r\n      if (userBalance < totalRequired) {\r\n        throw new ServiceError(\r\n          `Insufficient balance. Required: ${totalRequired}, Available: ${userBalance}`,\r\n          ServiceErrorType.VALIDATION_ERROR\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validate create attributes\r\n   */\r\n  private validateCreateAttributes(attributes: any): void {\r\n    const required = ['platformId', 'amount', 'accountDetails'];\r\n    \r\n    for (const field of required) {\r\n      if (!attributes[field]) {\r\n        throw new ServiceError(\r\n          `${field} is required`,\r\n          ServiceErrorType.VALIDATION_ERROR\r\n        );\r\n      }\r\n    }\r\n\r\n    if (typeof attributes.amount !== 'number' || attributes.amount <= 0) {\r\n      throw new ServiceError(\r\n        'Amount must be a positive number',\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle service errors with proper typing\r\n   */\r\n  private handleError(error: any, defaultMessage: string): ServiceError {\r\n    if (error instanceof ServiceError) {\r\n      return error;\r\n    }\r\n\r\n    // Handle Flarum API errors\r\n    if (error.response && error.response.errors) {\r\n      const apiError = error.response.errors[0];\r\n      return new ServiceError(\r\n        apiError.detail || defaultMessage,\r\n        ServiceErrorType.VALIDATION_ERROR,\r\n        apiError.code,\r\n        apiError\r\n      );\r\n    }\r\n\r\n    // Handle network errors\r\n    if (error.name === 'TypeError' || error.message?.includes('fetch')) {\r\n      return new ServiceError(\r\n        'Network error occurred',\r\n        ServiceErrorType.NETWORK_ERROR\r\n      );\r\n    }\r\n\r\n    // Default error handling\r\n    return new ServiceError(\r\n      error.message || defaultMessage,\r\n      ServiceErrorType.SERVER_ERROR\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Check if error is a not found error\r\n   */\r\n  private isNotFoundError(error: any): boolean {\r\n    return error.status === 404 || \r\n           error.response?.status === 404 ||\r\n           error.message?.includes('not found');\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const withdrawalService = new WithdrawalService();","import app from 'flarum/common/app';\r\nimport DepositRecord from '../models/DepositRecord';\r\nimport { DepositFormData } from '../../forum/components/deposit/forms/DepositForm';\r\n\r\nexport interface DepositService {\r\n  /**\r\n   * 创建新的存款记录\r\n   */\r\n  create(data: DepositFormData): Promise<DepositRecord>;\r\n\r\n  /**\r\n   * 获取用户的存款历史记录\r\n   */\r\n  getUserHistory(): Promise<DepositRecord[]>;\r\n\r\n  /**\r\n   * 获取所有存款记录（管理员）\r\n   */\r\n  getAll(filters?: DepositFilters): Promise<DepositRecord[]>;\r\n\r\n  /**\r\n   * 更新存款记录\r\n   */\r\n  update(recordId: number, data: Partial<DepositUpdateData>): Promise<DepositRecord>;\r\n\r\n  /**\r\n   * 审核存款记录（管理员）\r\n   */\r\n  approve(recordId: number, adminNotes?: string): Promise<DepositRecord>;\r\n\r\n  /**\r\n   * 拒绝存款记录（管理员）\r\n   */\r\n  reject(recordId: number, adminNotes?: string): Promise<DepositRecord>;\r\n}\r\n\r\nexport interface DepositFilters {\r\n  status?: string;\r\n  user?: number;\r\n  search?: string;\r\n  createdAfter?: string;\r\n  createdBefore?: string;\r\n}\r\n\r\nexport interface DepositUpdateData {\r\n  depositAddress?: string;\r\n  qrCodeUrl?: string;\r\n  userMessage?: string;\r\n  status?: string;\r\n  adminNotes?: string;\r\n}\r\n\r\nclass DepositServiceImpl implements DepositService {\r\n  async create(data: DepositFormData): Promise<DepositRecord> {\r\n    const response = await app.request({\r\n      method: 'POST',\r\n      url: app.forum.attribute('apiUrl') + '/deposit-records',\r\n      body: {\r\n        data: {\r\n          type: 'deposit-records',\r\n          attributes: {\r\n            depositAddress: data.depositAddress,\r\n            qrCodeUrl: data.qrCodeUrl,\r\n            userMessage: data.userMessage\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    const record = app.store.pushPayload<DepositRecord>(response);\r\n    return Array.isArray(record) ? record[0] : record;\r\n  }\r\n\r\n  async getUserHistory(): Promise<DepositRecord[]> {\r\n    const response = await app.request({\r\n      method: 'GET',\r\n      url: app.forum.attribute('apiUrl') + '/deposit-records',\r\n      params: {\r\n        include: 'user,processedByUser'\r\n      }\r\n    });\r\n\r\n    return app.store.pushPayload<DepositRecord[]>(response);\r\n  }\r\n\r\n  async getAll(filters: DepositFilters = {}): Promise<DepositRecord[]> {\r\n    const params: any = {\r\n      include: 'user,processedByUser'\r\n    };\r\n\r\n    // 应用过滤器\r\n    if (Object.keys(filters).length > 0) {\r\n      params.filter = filters;\r\n    }\r\n\r\n    const response = await app.request({\r\n      method: 'GET',\r\n      url: app.forum.attribute('apiUrl') + '/deposit-records',\r\n      params\r\n    });\r\n\r\n    return app.store.pushPayload<DepositRecord[]>(response);\r\n  }\r\n\r\n  async update(recordId: number, data: Partial<DepositUpdateData>): Promise<DepositRecord> {\r\n    const response = await app.request({\r\n      method: 'PATCH',\r\n      url: `${app.forum.attribute('apiUrl')}/deposit-records/${recordId}`,\r\n      body: {\r\n        data: {\r\n          type: 'deposit-records',\r\n          id: recordId,\r\n          attributes: data\r\n        }\r\n      }\r\n    });\r\n\r\n    const record = app.store.pushPayload<DepositRecord>(response);\r\n    return Array.isArray(record) ? record[0] : record;\r\n  }\r\n\r\n  async approve(recordId: number, adminNotes?: string): Promise<DepositRecord> {\r\n    return this.update(recordId, {\r\n      status: 'approved',\r\n      adminNotes\r\n    });\r\n  }\r\n\r\n  async reject(recordId: number, adminNotes?: string): Promise<DepositRecord> {\r\n    return this.update(recordId, {\r\n      status: 'rejected',\r\n      adminNotes\r\n    });\r\n  }\r\n}\r\n\r\n// 导出单例服务实例\r\nexport const depositService: DepositService = new DepositServiceImpl();\r\nexport default depositService;","import app from 'flarum/common/app';\r\nimport { \r\n  PlatformServiceInterface, \r\n  QueryOptions, \r\n  ServiceError, \r\n  ServiceErrorType \r\n} from '../types/services';\r\n\r\n/**\r\n * Service for managing both funds and deposit platforms\r\n */\r\nexport default class PlatformService implements PlatformServiceInterface {\r\n  private readonly withdrawalModelType = 'funds-platforms';\r\n  private readonly depositModelType = 'deposit-platforms';\r\n\r\n  /**\r\n   * Find multiple platforms of specified type\r\n   */\r\n  async find(type: 'funds' | 'deposit', options: QueryOptions = {}): Promise<any[]> {\r\n    const modelType = type === 'funds' ? this.withdrawalModelType : this.depositModelType;\r\n    \r\n    try {\r\n      const queryParams: any = {\r\n        sort: options.sort || 'name',\r\n        ...options\r\n      };\r\n\r\n      // Add pagination if specified\r\n      if (options.page) {\r\n        queryParams.page = options.page;\r\n      }\r\n\r\n      // Add filters if specified\r\n      if (options.filter) {\r\n        queryParams.filter = options.filter;\r\n      }\r\n\r\n      // Include relationships if specified\r\n      if (options.include) {\r\n        queryParams.include = options.include;\r\n      }\r\n\r\n      const results = await app.store.find(modelType, queryParams);\r\n      return Array.isArray(results) ? results : [results];\r\n    } catch (error) {\r\n      throw this.handleError(error, `Failed to fetch ${type} platforms`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find a single platform by ID\r\n   */\r\n  async findById(\r\n    type: 'funds' | 'deposit', \r\n    id: string | number, \r\n    options: QueryOptions = {}\r\n  ): Promise<any | null> {\r\n    const modelType = type === 'funds' ? this.withdrawalModelType : this.depositModelType;\r\n    \r\n    try {\r\n      const queryParams: any = {};\r\n      \r\n      // Include relationships if specified\r\n      if (options.include) {\r\n        queryParams.include = options.include;\r\n      }\r\n\r\n      const result = await app.store.find(modelType, id, queryParams);\r\n      return result;\r\n    } catch (error) {\r\n      if (this.isNotFoundError(error)) {\r\n        return null;\r\n      }\r\n      throw this.handleError(error, `Failed to fetch ${type} platform ${id}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new platform\r\n   */\r\n  async create(type: 'funds' | 'deposit', attributes: Record<string, any>): Promise<any> {\r\n    const modelType = type === 'funds' ? this.withdrawalModelType : this.depositModelType;\r\n    \r\n    try {\r\n      // Validate required fields based on platform type\r\n      this.validateCreateAttributes(type, attributes);\r\n\r\n      const platform = app.store.createRecord(modelType);\r\n      \r\n      const savedPlatform = await platform.save(attributes);\r\n      return savedPlatform;\r\n    } catch (error) {\r\n      throw this.handleError(error, `Failed to create ${type} platform`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update an existing platform\r\n   */\r\n  async update(platform: any, attributes: Record<string, any>): Promise<any> {\r\n    try {\r\n      if (!this.canModify(platform)) {\r\n        throw new ServiceError(\r\n          'You do not have permission to modify this platform',\r\n          ServiceErrorType.PERMISSION_DENIED\r\n        );\r\n      }\r\n\r\n      const updatedPlatform = await platform.save(attributes);\r\n      return updatedPlatform;\r\n    } catch (error) {\r\n      throw this.handleError(error, 'Failed to update platform');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a platform\r\n   */\r\n  async delete(platform: any): Promise<void> {\r\n    try {\r\n      if (!this.canDelete(platform)) {\r\n        throw new ServiceError(\r\n          'You do not have permission to delete this platform',\r\n          ServiceErrorType.PERMISSION_DENIED\r\n        );\r\n      }\r\n\r\n      await platform.delete();\r\n    } catch (error) {\r\n      throw this.handleError(error, 'Failed to delete platform');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get active platforms only\r\n   */\r\n  async getActive(type: 'funds' | 'deposit', options: QueryOptions = {}): Promise<any[]> {\r\n    const queryOptions = {\r\n      ...options,\r\n      filter: {\r\n        isActive: true,\r\n        ...options.filter\r\n      }\r\n    };\r\n\r\n    return await this.find(type, queryOptions);\r\n  }\r\n\r\n  /**\r\n   * Toggle platform status (admin only)\r\n   */\r\n  async toggleStatus(platform: any): Promise<any> {\r\n    if (!app.session.user?.isAdmin()) {\r\n      throw new ServiceError(\r\n        'Admin permissions required',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    const currentStatus = platform.isActive();\r\n    return await this.update(platform, { isActive: !currentStatus });\r\n  }\r\n\r\n  /**\r\n   * Update platform configuration (admin only)\r\n   */\r\n  async updateConfig(platform: any, config: Record<string, any>): Promise<any> {\r\n    if (!app.session.user?.isAdmin()) {\r\n      throw new ServiceError(\r\n        'Admin permissions required',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    return await this.update(platform, config);\r\n  }\r\n\r\n  /**\r\n   * Get platforms by symbol\r\n   */\r\n  async getBySymbol(symbol: string, type: 'funds' | 'deposit'): Promise<any[]> {\r\n    return await this.find(type, {\r\n      filter: { symbol: symbol },\r\n      sort: 'name'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Validate platform limits for an amount\r\n   */\r\n  validateAmount(platform: any, amount: number): { valid: boolean; errors: string[] } {\r\n    const errors: string[] = [];\r\n\r\n    if (typeof amount !== 'number' || amount <= 0) {\r\n      errors.push('Amount must be a positive number');\r\n      return { valid: false, errors };\r\n    }\r\n\r\n    const minAmount = platform.minAmount ? platform.minAmount() : 0;\r\n    const maxAmount = platform.maxAmount ? platform.maxAmount() : null;\r\n\r\n    if (amount < minAmount) {\r\n      errors.push(`Amount must be at least ${minAmount}`);\r\n    }\r\n\r\n    if (maxAmount && amount > maxAmount) {\r\n      errors.push(`Amount cannot exceed ${maxAmount}`);\r\n    }\r\n\r\n    return { valid: errors.length === 0, errors };\r\n  }\r\n\r\n  /**\r\n   * Get platform statistics (admin only)\r\n   */\r\n  async getPlatformStats(type: 'funds' | 'deposit', platformId: number): Promise<any> {\r\n    if (!app.session.user?.isAdmin()) {\r\n      throw new ServiceError(\r\n        'Admin permissions required',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    const requestType = type === 'funds' ? 'funds-requests' : 'deposit-records';\r\n    \r\n    try {\r\n      // Get all requests/records for this platform\r\n      const records = await app.store.find(requestType, {\r\n        filter: { platform: platformId },\r\n        include: 'platform'\r\n      });\r\n\r\n      const recordArray = Array.isArray(records) ? records : [records];\r\n\r\n      // Calculate statistics\r\n      const stats = {\r\n        total: recordArray.length,\r\n        pending: recordArray.filter(r => r.status() === 'pending').length,\r\n        approved: recordArray.filter(r => r.status() === 'approved' || r.status() === 'confirmed').length,\r\n        rejected: recordArray.filter(r => r.status() === 'rejected').length,\r\n        totalAmount: recordArray.reduce((sum, r) => sum + (r.amount() || 0), 0)\r\n      };\r\n\r\n      return stats;\r\n    } catch (error) {\r\n      throw this.handleError(error, 'Failed to fetch platform statistics');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get platforms grouped by symbol\r\n   */\r\n  async getPlatformsBySymbolGrouped(type: 'funds' | 'deposit'): Promise<Record<string, any[]>> {\r\n    const platforms = await this.getActive(type);\r\n    const grouped: Record<string, any[]> = {};\r\n\r\n    for (const platform of platforms) {\r\n      const symbol = platform.symbol();\r\n      if (!grouped[symbol]) {\r\n        grouped[symbol] = [];\r\n      }\r\n      grouped[symbol].push(platform);\r\n    }\r\n\r\n    return grouped;\r\n  }\r\n\r\n  /**\r\n   * Sort platforms by criteria\r\n   */\r\n  async getSortedPlatforms(\r\n    type: 'funds' | 'deposit', \r\n    sortBy: 'name' | 'symbol' | 'createdAt' | 'fee' = 'name',\r\n    direction: 'asc' | 'desc' = 'asc'\r\n  ): Promise<any[]> {\r\n    const sortString = direction === 'desc' ? `-${sortBy}` : sortBy;\r\n    \r\n    return await this.getActive(type, {\r\n      sort: sortString\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Check if current user can modify platforms\r\n   */\r\n  canModify(_platform: any): boolean {\r\n    const currentUser = app.session.user;\r\n    return currentUser && currentUser.isAdmin();\r\n  }\r\n\r\n  /**\r\n   * Check if current user can create new platforms\r\n   */\r\n  canCreate(): boolean {\r\n    const currentUser = app.session.user;\r\n    return currentUser && currentUser.isAdmin();\r\n  }\r\n\r\n  /**\r\n   * Check if current user can delete platforms\r\n   */\r\n  canDelete(_platform: any): boolean {\r\n    const currentUser = app.session.user;\r\n    return currentUser && currentUser.isAdmin();\r\n  }\r\n\r\n  /**\r\n   * Validate create attributes based on platform type\r\n   */\r\n  private validateCreateAttributes(type: 'funds' | 'deposit', attributes: any): void {\r\n    const commonRequired = ['name', 'symbol', 'minAmount'];\r\n    \r\n    // Only common fields are required (removed address requirement)\r\n    const required = commonRequired;\r\n\r\n    for (const field of required) {\r\n      if (!attributes[field]) {\r\n        throw new ServiceError(\r\n          `${field} is required for ${type} platforms`,\r\n          ServiceErrorType.VALIDATION_ERROR\r\n        );\r\n      }\r\n    }\r\n\r\n    if (typeof attributes.minAmount !== 'number' || attributes.minAmount < 0) {\r\n      throw new ServiceError(\r\n        'minAmount must be a non-negative number',\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n\r\n    if (attributes.maxAmount !== undefined) {\r\n      if (typeof attributes.maxAmount !== 'number' || attributes.maxAmount < attributes.minAmount) {\r\n        throw new ServiceError(\r\n          'maxAmount must be a number greater than or equal to minAmount',\r\n          ServiceErrorType.VALIDATION_ERROR\r\n        );\r\n      }\r\n    }\r\n\r\n    if (attributes.fee !== undefined) {\r\n      if (typeof attributes.fee !== 'number' || attributes.fee < 0) {\r\n        throw new ServiceError(\r\n          'fee must be a non-negative number',\r\n          ServiceErrorType.VALIDATION_ERROR\r\n        );\r\n      }\r\n    }\r\n\r\n    // Validate symbol format (basic validation)\r\n    if (typeof attributes.symbol !== 'string' || !attributes.symbol.trim()) {\r\n      throw new ServiceError(\r\n        'Symbol is required',\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle service errors with proper typing\r\n   */\r\n  private handleError(error: any, defaultMessage: string): ServiceError {\r\n    if (error instanceof ServiceError) {\r\n      return error;\r\n    }\r\n\r\n    // Handle Flarum API errors\r\n    if (error.response && error.response.errors) {\r\n      const apiError = error.response.errors[0];\r\n      return new ServiceError(\r\n        apiError.detail || defaultMessage,\r\n        ServiceErrorType.VALIDATION_ERROR,\r\n        apiError.code,\r\n        apiError\r\n      );\r\n    }\r\n\r\n    // Handle network errors\r\n    if (error.name === 'TypeError' || error.message?.includes('fetch')) {\r\n      return new ServiceError(\r\n        'Network error occurred',\r\n        ServiceErrorType.NETWORK_ERROR\r\n      );\r\n    }\r\n\r\n    // Default error handling\r\n    return new ServiceError(\r\n      error.message || defaultMessage,\r\n      ServiceErrorType.SERVER_ERROR\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Check if error is a not found error\r\n   */\r\n  private isNotFoundError(error: any): boolean {\r\n    return error.status === 404 || \r\n           error.response?.status === 404 ||\r\n           error.message?.includes('not found');\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const platformService = new PlatformService();","import app from 'flarum/common/app';\r\nimport { \r\n  ServiceError, \r\n  ServiceErrorType,\r\n  SettingsServiceInterface \r\n} from '../types/services';\r\n\r\n/**\r\n * Service for managing Flarum admin settings\r\n * Provides type-safe settings operations with proper error handling\r\n */\r\nexport default class SettingsService implements SettingsServiceInterface {\r\n  private readonly settingsEndpoint = '/settings';\r\n\r\n  /**\r\n   * Get a setting value\r\n   */\r\n  async getSetting(key: string, defaultValue?: any): Promise<any> {\r\n    try {\r\n      // First try to get from forum attributes (cached)\r\n      if (app.forum) {\r\n        const cachedValue = app.forum.attribute(key);\r\n        if (cachedValue !== undefined && cachedValue !== null) {\r\n          return cachedValue;\r\n        }\r\n      }\r\n\r\n      // If not cached or forum not available, return default\r\n      return defaultValue;\r\n    } catch (error) {\r\n      throw this.handleError(error, `Failed to get setting: ${key}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save a setting value\r\n   */\r\n  async saveSetting(key: string, value: any): Promise<void> {\r\n    try {\r\n      // Validate inputs\r\n      if (!key || typeof key !== 'string') {\r\n        throw new ServiceError(\r\n          'Setting key must be a non-empty string',\r\n          ServiceErrorType.VALIDATION_ERROR\r\n        );\r\n      }\r\n\r\n      // Prepare the value for storage\r\n      const storageValue = this.prepareValueForStorage(value);\r\n\r\n      // Make the API request using Flarum's store mechanism\r\n      const settings = app.store.createRecord('settings');\r\n      await settings.save({ [key]: storageValue });\r\n      \r\n      // Update the forum attribute immediately for UI consistency\r\n      if (app.forum) {\r\n        app.forum.pushAttributes({ [key]: value });\r\n      }\r\n\r\n    } catch (error) {\r\n      throw this.handleError(error, `Failed to save setting: ${key}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save multiple settings at once\r\n   */\r\n  async saveSettings(settings: Record<string, any>): Promise<void> {\r\n    try {\r\n      // Validate inputs\r\n      if (!settings || typeof settings !== 'object') {\r\n        throw new ServiceError(\r\n          'Settings must be an object',\r\n          ServiceErrorType.VALIDATION_ERROR\r\n        );\r\n      }\r\n\r\n      // Prepare all values for storage\r\n      const preparedSettings: Record<string, any> = {};\r\n      const forumAttributes: Record<string, any> = {};\r\n\r\n      for (const [key, value] of Object.entries(settings)) {\r\n        if (!key || typeof key !== 'string') {\r\n          throw new ServiceError(\r\n            `Setting key '${key}' must be a non-empty string`,\r\n            ServiceErrorType.VALIDATION_ERROR\r\n          );\r\n        }\r\n        preparedSettings[key] = this.prepareValueForStorage(value);\r\n        forumAttributes[key] = value;\r\n      }\r\n\r\n      // Make the API request\r\n      const settingsRecord = app.store.createRecord('settings');\r\n      await settingsRecord.save(preparedSettings);\r\n      \r\n      // Update forum attributes\r\n      if (app.forum) {\r\n        app.forum.pushAttributes(forumAttributes);\r\n      }\r\n\r\n    } catch (error) {\r\n      throw this.handleError(error, 'Failed to save multiple settings');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a setting\r\n   */\r\n  async deleteSetting(key: string): Promise<void> {\r\n    try {\r\n      if (!key || typeof key !== 'string') {\r\n        throw new ServiceError(\r\n          'Setting key must be a non-empty string',\r\n          ServiceErrorType.VALIDATION_ERROR\r\n        );\r\n      }\r\n\r\n      // Set to null to delete the setting\r\n      await this.saveSetting(key, null);\r\n\r\n    } catch (error) {\r\n      throw this.handleError(error, `Failed to delete setting: ${key}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all settings with a prefix\r\n   */\r\n  async getSettingsWithPrefix(prefix: string): Promise<Record<string, any>> {\r\n    try {\r\n      if (!prefix || typeof prefix !== 'string') {\r\n        throw new ServiceError(\r\n          'Prefix must be a non-empty string',\r\n          ServiceErrorType.VALIDATION_ERROR\r\n        );\r\n      }\r\n\r\n      const settings: Record<string, any> = {};\r\n      \r\n      if (app.forum) {\r\n        const attributes = app.forum.data.attributes;\r\n        for (const [key, value] of Object.entries(attributes)) {\r\n          if (key.startsWith(prefix)) {\r\n            settings[key] = value;\r\n          }\r\n        }\r\n      }\r\n\r\n      return settings;\r\n\r\n    } catch (error) {\r\n      throw this.handleError(error, `Failed to get settings with prefix: ${prefix}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if current user can manage settings\r\n   */\r\n  canManageSettings(): boolean {\r\n    const currentUser = app.session.user;\r\n    return currentUser && currentUser.isAdmin();\r\n  }\r\n\r\n  /**\r\n   * Get extension-specific setting with proper namespace\r\n   */\r\n  async getExtensionSetting(extension: string, key: string, defaultValue?: any): Promise<any> {\r\n    const fullKey = `${extension}.${key}`;\r\n    return await this.getSetting(fullKey, defaultValue);\r\n  }\r\n\r\n  /**\r\n   * Save extension-specific setting with proper namespace\r\n   */\r\n  async saveExtensionSetting(extension: string, key: string, value: any): Promise<void> {\r\n    const fullKey = `${extension}.${key}`;\r\n    return await this.saveSetting(fullKey, value);\r\n  }\r\n\r\n  /**\r\n   * Get funds extension settings\r\n   */\r\n  async getWithdrawalSetting(key: string, defaultValue?: any): Promise<any> {\r\n    return await this.getExtensionSetting('wusong8899-funds', key, defaultValue);\r\n  }\r\n\r\n  /**\r\n   * Save funds extension setting\r\n   */\r\n  async saveWithdrawalSetting(key: string, value: any): Promise<void> {\r\n    return await this.saveExtensionSetting('wusong8899-funds', key, value);\r\n  }\r\n\r\n  /**\r\n   * Get all funds extension settings\r\n   */\r\n  async getAllWithdrawalSettings(): Promise<Record<string, any>> {\r\n    return await this.getSettingsWithPrefix('wusong8899-funds.');\r\n  }\r\n\r\n  /**\r\n   * Prepare value for storage (handle objects, arrays, booleans)\r\n   */\r\n  private prepareValueForStorage(value: any): string {\r\n    if (value === null || value === undefined) {\r\n      return '';\r\n    }\r\n    \r\n    if (typeof value === 'string') {\r\n      return value;\r\n    }\r\n    \r\n    if (typeof value === 'boolean') {\r\n      return value ? '1' : '0';\r\n    }\r\n    \r\n    if (typeof value === 'number') {\r\n      return String(value);\r\n    }\r\n    \r\n    // Objects and arrays get JSON stringified\r\n    return JSON.stringify(value);\r\n  }\r\n\r\n  /**\r\n   * Handle service errors with proper typing\r\n   */\r\n  private handleError(error: any, defaultMessage: string): ServiceError {\r\n    if (error instanceof ServiceError) {\r\n      return error;\r\n    }\r\n\r\n    // Handle permission errors\r\n    if (error.status === 403 || error.response?.status === 403) {\r\n      return new ServiceError(\r\n        'Admin permissions required to manage settings',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    // Handle Flarum API errors\r\n    if (error.response && error.response.errors) {\r\n      const apiError = error.response.errors[0];\r\n      return new ServiceError(\r\n        apiError.detail || defaultMessage,\r\n        ServiceErrorType.VALIDATION_ERROR,\r\n        apiError.code,\r\n        apiError\r\n      );\r\n    }\r\n\r\n    // Handle network errors\r\n    if (error.name === 'TypeError' || error.message?.includes('fetch')) {\r\n      return new ServiceError(\r\n        'Network error occurred while managing settings',\r\n        ServiceErrorType.NETWORK_ERROR\r\n      );\r\n    }\r\n\r\n    // Default error handling\r\n    return new ServiceError(\r\n      error.message || defaultMessage,\r\n      ServiceErrorType.SERVER_ERROR\r\n    );\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const settingsService = new SettingsService();","import app from 'flarum/admin/app';\r\nimport m from 'mithril';\r\nimport type Mithril from 'mithril';\r\nimport GenericManagementPage, { \r\n  type GenericManagementPageConfig, \r\n  type GenericPlatform, \r\n  type GenericTransaction \r\n} from './shared/GenericManagementPage';\r\nimport GeneralSettingsSection from './sections/GeneralSettingsSection';\r\nimport PlatformManagementSection from './sections/PlatformManagementSection';\r\nimport RequestManagementSection from './sections/RequestManagementSection';\r\nimport DepositRecordManagementSection from './sections/DepositRecordManagementSection';\r\nimport DepositPlatformManagementSection from './sections/DepositPlatformManagementSection';\r\nimport ConfirmModal from '../../common/components/shared/ConfirmModal';\r\nimport { \r\n  createWithdrawalPlatformOperations,\r\n  createWithdrawalRequestOperations\r\n} from '../utils/platformOperations';\r\n\r\n// Import services\r\nimport { depositService, platformService } from '../../common/services';\r\nimport { ServiceError } from '../../common/types/services';\r\nimport Component from 'flarum/common/Component';\r\n\r\n// Placeholder components for custom tabs\r\nclass WithdrawalTabPlaceholder extends Component {\r\n  view() {\r\n    return <div>Withdrawals Content</div>;\r\n  }\r\n}\r\n\r\nclass DepositsTabPlaceholder extends Component {\r\n  view() {\r\n    return <div>Deposits Content</div>;\r\n  }\r\n}\r\n\r\n\r\nexport default class UnifiedManagementPage extends GenericManagementPage<GenericPlatform, GenericTransaction> {\r\n  \r\n  // Additional state for complex scenarios\r\n  private depositPlatforms: GenericPlatform[] = [];\r\n  private depositRecords: GenericTransaction[] = [];\r\n  private users: { [key: number]: any } = {};\r\n\r\n  protected getConfig(): GenericManagementPageConfig<GenericPlatform, GenericTransaction> {\r\n    return {\r\n      pageTitle: app.translator.trans('funds.admin.page.title').toString(),\r\n      extensionId: 'WithdrawalManagement',\r\n      \r\n      // Primary platform operations (funds)\r\n      platformOperations: createWithdrawalPlatformOperations(),\r\n      transactionOperations: createWithdrawalRequestOperations(),\r\n      \r\n      // Settings component\r\n      settingsComponent: GeneralSettingsSection,\r\n      \r\n      // Tab configuration\r\n      tabs: [\r\n        {\r\n          key: 'withdrawals',\r\n          label: app.translator.trans('funds.admin.tabs.withdrawals').toString(),\r\n          component: WithdrawalTabPlaceholder\r\n        },\r\n        {\r\n          key: 'deposits',\r\n          label: app.translator.trans('funds.admin.tabs.deposits').toString(),\r\n          component: DepositsTabPlaceholder\r\n        }\r\n      ],\r\n      \r\n      translations: {\r\n        platformPrefix: 'funds.admin.platforms',\r\n        transactionPrefix: 'funds.admin.requests'\r\n      }\r\n    };\r\n  }\r\n\r\n  // Override renderActiveTabContent to handle the complex withdrawals and deposits tabs  \r\n  protected renderActiveTabContent(): Mithril.Children {\r\n    if (this.activeTab === 'withdrawals') {\r\n      return (\r\n        <div>\r\n          <PlatformManagementSection\r\n            platforms={this.platforms}\r\n            submittingPlatform={this.submittingPlatform}\r\n            onAddPlatform={this.addPlatform.bind(this)}\r\n            onTogglePlatformStatus={this.togglePlatformStatus.bind(this)}\r\n            onDeletePlatform={this.deletePlatform.bind(this)}\r\n          />\r\n          \r\n          <RequestManagementSection\r\n            requests={this.transactions as any}\r\n            onUpdateRequestStatus={this.updateTransactionStatus.bind(this)}\r\n            onDeleteRequest={this.deleteWithdrawalRequest.bind(this)}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n    \r\n    if (this.activeTab === 'deposits') {\r\n      return (\r\n        <div>\r\n          <DepositPlatformManagementSection\r\n            platforms={this.depositPlatforms}\r\n            submittingPlatform={this.submittingPlatform}\r\n            onAddPlatform={this.addDepositPlatform.bind(this)}\r\n            onTogglePlatformStatus={this.toggleDepositPlatformStatus.bind(this)}\r\n            onDeletePlatform={this.deleteDepositPlatform.bind(this)}\r\n          />\r\n          \r\n          <DepositRecordManagementSection\r\n            platforms={this.depositPlatforms}\r\n            records={this.depositRecords}\r\n            loading={this.loading}\r\n            onApproveRecord={this.approveDepositRecord.bind(this)}\r\n            onRejectRecord={this.rejectDepositRecord.bind(this)}\r\n            onDeleteRecord={this.deleteDepositRecord.bind(this)}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n    \r\n    // For other tabs, use the parent implementation\r\n    return super.renderActiveTabContent();\r\n  }\r\n\r\n  // Override loadData to handle unified funds and deposit data loading\r\n  protected async loadData(): Promise<void> {\r\n    try {\r\n      // Load funds data (handled by parent)\r\n      await this.loadPlatforms();\r\n      await this.loadTransactions();\r\n      \r\n      // Load additional user data for requests\r\n      await this.loadUserData();\r\n      \r\n      // Load deposit data\r\n      await this.loadDepositPlatforms();\r\n      await this.loadDepositRecords();\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n    } finally {\r\n      this.loading = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  // Deposit platform management methods\r\n  private async addDepositPlatform(formData: any): Promise<void> {\r\n    if (this.submittingPlatform) return;\r\n\r\n    this.submittingPlatform = true;\r\n    m.redraw();\r\n\r\n    try {\r\n      // Convert numeric fields from strings to numbers\r\n      const attributes = {\r\n        ...formData,\r\n        minAmount: parseFloat(formData.minAmount) || 0,\r\n        maxAmount: formData.maxAmount && formData.maxAmount.trim() ? parseFloat(formData.maxAmount) : null,\r\n        fee: formData.fee && formData.fee.trim() ? parseFloat(formData.fee) : 0,\r\n        isActive: formData.isActive !== undefined ? formData.isActive : true\r\n      };\r\n      \r\n      await platformService.create('deposit', attributes);\r\n      await this.loadDepositPlatforms();\r\n      \r\n      app.alerts.show(\r\n        { type: 'success', dismissible: true },\r\n        app.translator.trans('funds.admin.deposit.platforms.add_success')\r\n      );\r\n    } catch (error) {\r\n      console.error('Error adding deposit platform:', error);\r\n      \r\n      let errorMessage = app.translator.trans('funds.admin.deposit.platforms.add_error').toString();\r\n      \r\n      if (error instanceof ServiceError) {\r\n        errorMessage = error.message;\r\n      }\r\n      \r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        errorMessage\r\n      );\r\n    } finally {\r\n      this.submittingPlatform = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private async toggleDepositPlatformStatus(platform: GenericPlatform): Promise<void> {\r\n    try {\r\n      await platformService.toggleStatus(platform);\r\n      await this.loadDepositPlatforms();\r\n      \r\n      app.alerts.show(\r\n        { type: 'success', dismissible: true },\r\n        app.translator.trans('funds.admin.deposit.platforms.status_updated')\r\n      );\r\n      \r\n      m.redraw();\r\n    } catch (error) {\r\n      console.error('Error toggling deposit platform status:', error);\r\n      \r\n      let errorMessage = app.translator.trans('funds.admin.deposit.platforms.status_error').toString();\r\n      \r\n      if (error instanceof ServiceError) {\r\n        errorMessage = error.message;\r\n      }\r\n      \r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        errorMessage\r\n      );\r\n    }\r\n  }\r\n\r\n  private async deleteDepositPlatform(platform: GenericPlatform): Promise<void> {\r\n    const platformName = (typeof platform.name === 'function' ? platform.name() : platform.name) || 'Unknown Platform';\r\n    \r\n    app.modal.show(ConfirmModal, {\r\n      title: app.translator.trans('funds.admin.platforms.delete_confirm_title'),\r\n      message: app.translator.trans('funds.admin.platforms.delete_confirm_message', { name: platformName }),\r\n      confirmText: app.translator.trans('funds.admin.platforms.delete_confirm_button'),\r\n      cancelText: app.translator.trans('funds.admin.platforms.delete_cancel_button'),\r\n      dangerous: true,\r\n      icon: 'fas fa-trash',\r\n      onConfirm: async () => {\r\n        try {\r\n          await platformService.delete(platform);\r\n          await this.loadDepositPlatforms();\r\n          \r\n          app.alerts.show(\r\n            { type: 'success', dismissible: true },\r\n            app.translator.trans('funds.admin.deposit.platforms.delete_success')\r\n          );\r\n        } catch (error) {\r\n          console.error('Error deleting deposit platform:', error);\r\n          \r\n          let errorMessage = app.translator.trans('funds.admin.deposit.platforms.delete_error').toString();\r\n          \r\n          if (error instanceof ServiceError) {\r\n            errorMessage = error.message;\r\n          }\r\n          \r\n          app.alerts.show(\r\n            { type: 'error', dismissible: true },\r\n            errorMessage\r\n          );\r\n        }\r\n        m.redraw();\r\n      },\r\n      onCancel: () => {\r\n        app.modal.close();\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  private async updateDepositRecordStatus(record: GenericTransaction, status: string): Promise<void> {\r\n    try {\r\n      await depositService.update(record as any, { status });\r\n      await this.loadDepositRecords();\r\n      \r\n      app.alerts.show(\r\n        { type: 'success', dismissible: true },\r\n        app.translator.trans('funds.admin.deposit.records.status_updated')\r\n      );\r\n      \r\n      m.redraw();\r\n    } catch (error) {\r\n      console.error('Error updating deposit record:', error);\r\n      \r\n      let errorMessage = app.translator.trans('funds.admin.deposit.records.status_error').toString();\r\n      \r\n      if (error instanceof ServiceError) {\r\n        errorMessage = error.message;\r\n      }\r\n      \r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        errorMessage\r\n      );\r\n    }\r\n  }\r\n\r\n  // Deletion method for funds requests  \r\n  private deleteWithdrawalRequest(request: any): void {\r\n    const requestId = typeof request.id === 'function' ? request.id() : request.id;\r\n    const amount = typeof request.amount === 'function' ? request.amount() : (request.attributes?.amount || 0);\r\n    \r\n    // Get user name for display in confirmation\r\n    let userName = 'Unknown User';\r\n    if (typeof request.user === 'function') {\r\n      const userData = request.user();\r\n      if (userData && typeof userData.displayName === 'function') {\r\n        userName = userData.displayName();\r\n      } else if (userData && userData.attributes?.displayName) {\r\n        userName = userData.attributes.displayName;\r\n      }\r\n    }\r\n    \r\n    app.modal.show(ConfirmModal, {\r\n      title: app.translator.trans('funds.admin.requests.delete_confirm_title'),\r\n      message: app.translator.trans('funds.admin.requests.delete_confirm_message', { info: `${userName} - ${amount}` }),\r\n      confirmText: app.translator.trans('funds.admin.requests.delete_confirm_button'),\r\n      cancelText: app.translator.trans('funds.admin.requests.delete_cancel_button'),\r\n      dangerous: true,\r\n      icon: 'fas fa-trash',\r\n      onConfirm: async () => {\r\n        try {\r\n          const record = app.store.getById('funds-requests', requestId);\r\n          if (record) {\r\n            await record.delete();\r\n            await this.loadTransactions();\r\n            \r\n            app.alerts.show(\r\n              { type: 'success', dismissible: true },\r\n              app.translator.trans('funds.admin.requests.delete_success')\r\n            );\r\n          }\r\n        } catch (error) {\r\n          console.error('Error deleting request:', error);\r\n          app.alerts.show(\r\n            { type: 'error', dismissible: true },\r\n            app.translator.trans('funds.admin.requests.delete_error')\r\n          );\r\n        }\r\n      },\r\n      onCancel: () => {\r\n        app.modal.close();\r\n      }\r\n    });\r\n  }\r\n\r\n  // Additional data loading methods\r\n  private async loadDepositPlatforms(): Promise<void> {\r\n    try {\r\n      this.depositPlatforms = await platformService.find('deposit', {\r\n        sort: 'name'\r\n      });\r\n      console.log('Loaded deposit platforms:', this.depositPlatforms);\r\n    } catch (error) {\r\n      console.error('Error loading deposit platforms:', error);\r\n      this.depositPlatforms = [];\r\n    }\r\n  }\r\n\r\n\r\n  private async loadUserData(): Promise<void> {\r\n    // Skip if no requests\r\n    if (this.transactions.length === 0) return;\r\n    \r\n    const userIds = [...new Set(this.transactions\r\n      .map(r => {\r\n        // Check both data.relationships and direct relationships structures\r\n        const userRelation = (r as any)?.data?.relationships?.user?.data || (r as any)?.relationships?.user?.data;\r\n        if (userRelation) {\r\n          return userRelation.id;\r\n        }\r\n        return null;\r\n      })\r\n      .filter(id => id !== null && id !== undefined)\r\n    )];\r\n    const usersToLoad = userIds.filter(userId => !this.users[userId]);\r\n    \r\n    if (usersToLoad.length > 0) {\r\n      try {\r\n        const userPromises = usersToLoad.map(userId => \r\n          app.store.find('users', userId).catch(error => {\r\n            console.error(`Error loading user ${userId}:`, error);\r\n            return null;\r\n          })\r\n        );\r\n        \r\n        const loadedUsers = await Promise.all(userPromises);\r\n        \r\n        usersToLoad.forEach((userId, index) => {\r\n          if (loadedUsers[index]) {\r\n            this.users[userId] = loadedUsers[index];\r\n          }\r\n        });\r\n      } catch (error) {\r\n        console.error('Error loading users:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Deposit record management methods\r\n  private async loadDepositRecords(): Promise<void> {\r\n    try {\r\n      // For admin, get all deposit records (not just user's own)\r\n      const records = await depositService.find({\r\n        include: 'user,platform',\r\n        sort: '-createdAt'\r\n      });\r\n      \r\n      this.depositRecords = records as GenericTransaction[];\r\n      console.log('Loaded deposit records:', this.depositRecords);\r\n    } catch (error) {\r\n      console.error('Error loading deposit records:', error);\r\n      this.depositRecords = [];\r\n    }\r\n  }\r\n\r\n  private async approveDepositRecord(record: any, creditedAmount?: number, notes?: string): Promise<void> {\r\n    try {\r\n      const attributes: any = {\r\n        status: 'approved'\r\n      };\r\n      \r\n      if (creditedAmount !== undefined) {\r\n        attributes.creditedAmount = creditedAmount;\r\n      }\r\n      \r\n      if (notes) {\r\n        attributes.adminNotes = notes;\r\n      }\r\n      \r\n      await depositService.update(record, attributes);\r\n      await this.loadDepositRecords();\r\n      \r\n      app.alerts.show(\r\n        { type: 'success', dismissible: true },\r\n        app.translator.trans('funds.admin.deposit.records.approve_success')\r\n      );\r\n      \r\n      m.redraw();\r\n    } catch (error) {\r\n      console.error('Error approving deposit record:', error);\r\n      \r\n      let errorMessage = app.translator.trans('funds.admin.deposit.records.approve_error').toString();\r\n      \r\n      if (error instanceof ServiceError) {\r\n        errorMessage = error.message;\r\n      }\r\n      \r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        errorMessage\r\n      );\r\n      \r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async rejectDepositRecord(record: any, reason: string): Promise<void> {\r\n    try {\r\n      await depositService.update(record, {\r\n        status: 'rejected',\r\n        adminNotes: reason\r\n      });\r\n      \r\n      await this.loadDepositRecords();\r\n      \r\n      app.alerts.show(\r\n        { type: 'success', dismissible: true },\r\n        app.translator.trans('funds.admin.deposit.records.reject_success')\r\n      );\r\n      \r\n      m.redraw();\r\n    } catch (error) {\r\n      console.error('Error rejecting deposit record:', error);\r\n      \r\n      let errorMessage = app.translator.trans('funds.admin.deposit.records.reject_error').toString();\r\n      \r\n      if (error instanceof ServiceError) {\r\n        errorMessage = error.message;\r\n      }\r\n      \r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        errorMessage\r\n      );\r\n      \r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async deleteDepositRecord(record: any): Promise<void> {\r\n    try {\r\n      await depositService.delete(record);\r\n      await this.loadDepositRecords();\r\n      \r\n      app.alerts.show(\r\n        { type: 'success', dismissible: true },\r\n        app.translator.trans('funds.admin.deposit.records.delete_success')\r\n      );\r\n      \r\n      m.redraw();\r\n    } catch (error) {\r\n      console.error('Error deleting deposit record:', error);\r\n      \r\n      let errorMessage = app.translator.trans('funds.admin.deposit.records.delete_error').toString();\r\n      \r\n      if (error instanceof ServiceError) {\r\n        errorMessage = error.message;\r\n      }\r\n      \r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        errorMessage\r\n      );\r\n      \r\n      throw error;\r\n    }\r\n  }\r\n}","import { ServiceError, ServiceErrorType } from '../types/services';\r\n\r\n/**\r\n * Validate common platform fields\r\n */\r\nexport function validateCommonFields(attributes: Record<string, any>): string[] {\r\n  const errors: string[] = [];\r\n\r\n  // Name validation\r\n  if (attributes.name !== undefined) {\r\n    if (!attributes.name || typeof attributes.name !== 'string') {\r\n      errors.push('Platform name is required');\r\n    }\r\n  }\r\n\r\n  // Symbol validation\r\n  if (attributes.symbol !== undefined) {\r\n    if (!attributes.symbol || typeof attributes.symbol !== 'string') {\r\n      errors.push('Symbol is required');\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate amount fields (min/max/fee)\r\n */\r\nexport function validateAmountFields(attributes: Record<string, any>, currentMinAmount?: number): string[] {\r\n  const errors: string[] = [];\r\n\r\n  // Min amount validation\r\n  if (attributes.minAmount !== undefined) {\r\n    if (typeof attributes.minAmount !== 'number' || attributes.minAmount < 0) {\r\n      errors.push('Minimum amount must be a non-negative number');\r\n    }\r\n  }\r\n\r\n  // Max amount validation\r\n  if (attributes.maxAmount !== undefined && attributes.maxAmount !== null) {\r\n    if (typeof attributes.maxAmount !== 'number' || attributes.maxAmount < 0) {\r\n      errors.push('Maximum amount must be a non-negative number');\r\n    }\r\n    \r\n    const minAmount = attributes.minAmount ?? currentMinAmount ?? 0;\r\n    if (attributes.maxAmount < minAmount) {\r\n      errors.push('Maximum amount must be greater than or equal to minimum amount');\r\n    }\r\n  }\r\n\r\n  // Fee validation\r\n  if (attributes.fee !== undefined && attributes.fee !== null) {\r\n    if (typeof attributes.fee !== 'number' || attributes.fee < 0) {\r\n      errors.push('Fee must be a non-negative number');\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate deposit-specific fields\r\n */\r\nexport function validateDepositFields(attributes: Record<string, any>): string[] {\r\n  const errors: string[] = [];\r\n\r\n  // Network validation (for deposit platforms) - only validate if provided\r\n  if (attributes.network !== undefined && attributes.network !== null && attributes.network !== '') {\r\n    if (typeof attributes.network !== 'string') {\r\n      errors.push('Network must be a string');\r\n    }\r\n  }\r\n\r\n  // Address validation (for deposit platforms) - only validate if provided\r\n  if (attributes.address !== undefined && attributes.address !== null && attributes.address !== '') {\r\n    if (typeof attributes.address !== 'string') {\r\n      errors.push('Deposit address must be a string');\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Throw validation error if there are any errors\r\n */\r\nexport function throwIfErrors(errors: string[]): void {\r\n  if (errors.length > 0) {\r\n    throw new ServiceError(\r\n      errors.join(', '),\r\n      ServiceErrorType.VALIDATION_ERROR\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Complete validation for funds platforms\r\n */\r\nexport function validateWithdrawalPlatform(attributes: Record<string, any>, currentMinAmount?: number): void {\r\n  const errors = [\r\n    ...validateCommonFields(attributes),\r\n    ...validateAmountFields(attributes, currentMinAmount)\r\n  ];\r\n  \r\n  throwIfErrors(errors);\r\n}\r\n\r\n/**\r\n * Complete validation for deposit platforms\r\n */\r\nexport function validateDepositPlatform(attributes: Record<string, any>, currentMinAmount?: number): void {\r\n  const errors = [\r\n    ...validateCommonFields(attributes),\r\n    ...validateAmountFields(attributes, currentMinAmount),\r\n    ...validateDepositFields(attributes)\r\n  ];\r\n  \r\n  throwIfErrors(errors);\r\n}","import Model from 'flarum/common/Model';\r\nimport { ServiceError, ServiceErrorType } from '../types/services';\r\nimport { validateWithdrawalPlatform } from '../utils/PlatformValidation';\r\nimport { IconRepresentation } from './CurrencyIcon';\r\nimport app from 'flarum/common/app';\r\n\r\n/**\r\n * WithdrawalPlatform model for Flarum\r\n * \r\n * This model represents a funds platform that users can use\r\n * to withdraw their virtual currency with enhanced CRUD capabilities.\r\n */\r\nexport default class WithdrawalPlatform extends Model {\r\n  // Basic attributes\r\n  name = Model.attribute<string>('name');\r\n  symbol = Model.attribute<string>('symbol');\r\n  network = Model.attribute<string | null>('network');\r\n  displayName = Model.attribute<string>('displayName');\r\n  minAmount = Model.attribute<number>('minAmount');\r\n  maxAmount = Model.attribute<number>('maxAmount');\r\n  fee = Model.attribute<number>('fee');\r\n  \r\n  // Three-tier icon system - computed properties\r\n  currencyIconUrl = Model.attribute<string>('currencyIconUrl');\r\n  currencyIconClass = Model.attribute<string>('currencyIconClass');\r\n  currencyUnicodeSymbol = Model.attribute<string>('currencyUnicodeSymbol');\r\n  networkIconUrl = Model.attribute<string>('networkIconUrl');\r\n  networkIconClass = Model.attribute<string>('networkIconClass');\r\n  platformSpecificIconUrl = Model.attribute<string>('platformSpecificIconUrl');\r\n  platformSpecificIconClass = Model.attribute<string>('platformSpecificIconClass');\r\n  \r\n  // Override fields for admin configuration\r\n  currencyIconOverrideUrl = Model.attribute<string>('currencyIconOverrideUrl');\r\n  currencyIconOverrideClass = Model.attribute<string>('currencyIconOverrideClass');\r\n  networkIconOverrideUrl = Model.attribute<string>('networkIconOverrideUrl');\r\n  networkIconOverrideClass = Model.attribute<string>('networkIconOverrideClass');\r\n  \r\n  // Status\r\n  isActive = Model.attribute<boolean>('isActive');\r\n  \r\n  // Timestamps\r\n  createdAt = Model.attribute('createdAt', Model.transformDate);\r\n  updatedAt = Model.attribute('updatedAt', Model.transformDate);\r\n\r\n  // Icon representations from serializer\r\n  bestIcon = Model.attribute<IconRepresentation>('bestIcon');\r\n  currencyIcon = Model.attribute<IconRepresentation>('currencyIcon');\r\n  networkIcon = Model.attribute<IconRepresentation>('networkIcon');\r\n  \r\n  // Computed properties\r\n  apiEndpoint() {\r\n    const id = this.id();\r\n    return id ? `/funds-platforms/${id}` : '/funds-platforms';\r\n  }\r\n  \r\n  // Helper methods\r\n  getDisplayName(): string {\r\n    return this.displayName() || this.name();\r\n  }\r\n  \r\n  isValidAmount(amount: number): boolean {\r\n    const min = this.minAmount();\r\n    const max = this.maxAmount();\r\n    return amount >= min && amount <= max;\r\n  }\r\n  \r\n  getTotalCost(amount: number): number {\r\n    return amount + this.fee();\r\n  }\r\n\r\n  // Enhanced CRUD methods\r\n\r\n  /**\r\n   * Save this platform with enhanced validation\r\n   */\r\n  async save(attributes?: Record<string, any>): Promise<WithdrawalPlatform> {\r\n    // Validate before saving if attributes provided\r\n    if (attributes) {\r\n      this.validateAttributes(attributes);\r\n    }\r\n\r\n    try {\r\n      const result = await super.save(attributes);\r\n      return result as WithdrawalPlatform;\r\n    } catch (error) {\r\n      throw this.handleSaveError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete this platform with permission check\r\n   */\r\n  async delete(): Promise<void> {\r\n    if (!this.canDelete()) {\r\n      throw new ServiceError(\r\n        'You do not have permission to delete this platform',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    // Check if platform is in use\r\n    if (await this.isInUse()) {\r\n      throw new ServiceError(\r\n        'Cannot delete platform that has pending funds requests',\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n\r\n    try {\r\n      await super.delete();\r\n    } catch (error) {\r\n      throw this.handleDeleteError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle platform status\r\n   */\r\n  async toggleStatus(): Promise<WithdrawalPlatform> {\r\n    if (!this.canModify()) {\r\n      throw new ServiceError(\r\n        'You do not have permission to modify this platform',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    return await this.save({\r\n      isActive: !this.isActive()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clone this platform for creating a similar one\r\n   */\r\n  clone(): WithdrawalPlatform {\r\n    const cloned = app.store.createRecord('funds-platforms') as WithdrawalPlatform;\r\n    \r\n    // Copy relevant attributes but not id/timestamps\r\n    cloned.pushAttributes({\r\n      name: this.name() + ' (Copy)',\r\n      symbol: this.symbol(),\r\n      network: this.network(),\r\n      minAmount: this.minAmount(),\r\n      maxAmount: this.maxAmount(),\r\n      fee: this.fee(),\r\n      // Copy three-tier icon fields\r\n      currencyIconOverrideUrl: this.currencyIconOverrideUrl(),\r\n      currencyIconOverrideClass: this.currencyIconOverrideClass(),\r\n      networkIconOverrideUrl: this.networkIconOverrideUrl(),\r\n      networkIconOverrideClass: this.networkIconOverrideClass(),\r\n      isActive: false // Clone as inactive by default\r\n    });\r\n\r\n    return cloned;\r\n  }\r\n\r\n  // Validation methods\r\n\r\n  /**\r\n   * Validate amount against platform limits\r\n   */\r\n  validateAmount(amount: number): { valid: boolean; errors: string[] } {\r\n    const errors: string[] = [];\r\n\r\n    if (typeof amount !== 'number' || amount <= 0) {\r\n      errors.push('Amount must be a positive number');\r\n      return { valid: false, errors };\r\n    }\r\n\r\n    if (amount < this.minAmount()) {\r\n      errors.push(`Amount must be at least ${this.minAmount()} ${this.symbol()}`);\r\n    }\r\n\r\n    if (this.maxAmount() && amount > this.maxAmount()) {\r\n      errors.push(`Amount cannot exceed ${this.maxAmount()} ${this.symbol()}`);\r\n    }\r\n\r\n    return { valid: errors.length === 0, errors };\r\n  }\r\n\r\n  /**\r\n   * Check if user has sufficient balance for funds\r\n   */\r\n  validateUserBalance(amount: number, userBalance: number): { valid: boolean; errors: string[] } {\r\n    const errors: string[] = [];\r\n    const totalCost = this.getTotalCost(amount);\r\n\r\n    if (userBalance < totalCost) {\r\n      const feeText = this.fee() > 0 ? ` (including ${this.fee()} ${this.symbol()} fee)` : '';\r\n      errors.push(`Insufficient balance. Required: ${totalCost} ${this.symbol()}${feeText}, Available: ${userBalance} ${this.symbol()}`);\r\n    }\r\n\r\n    return { valid: errors.length === 0, errors };\r\n  }\r\n\r\n  // Permission methods\r\n\r\n  /**\r\n   * Check if current user can modify this platform\r\n   */\r\n  canModify(): boolean {\r\n    const currentUser = app.session.user;\r\n    return currentUser && currentUser.isAdmin();\r\n  }\r\n\r\n  /**\r\n   * Check if current user can delete this platform\r\n   */\r\n  canDelete(): boolean {\r\n    const currentUser = app.session.user;\r\n    return currentUser && currentUser.isAdmin();\r\n  }\r\n\r\n  /**\r\n   * Check if current user can view this platform\r\n   */\r\n  canView(): boolean {\r\n    // All authenticated users can view active platforms\r\n    if (this.isActive()) return true;\r\n    \r\n    // Only admins can view inactive platforms\r\n    const currentUser = app.session.user;\r\n    return currentUser && currentUser.isAdmin();\r\n  }\r\n\r\n  // Utility methods\r\n\r\n  /**\r\n   * Check if this platform is currently in use\r\n   */\r\n  async isInUse(): Promise<boolean> {\r\n    try {\r\n      const requests = await app.store.find('funds-requests', {\r\n        filter: { platform: this.id(), status: 'pending' }\r\n      });\r\n      \r\n      const requestsArray = Array.isArray(requests) ? requests : [requests];\r\n      return requestsArray.length > 0;\r\n    } catch {\r\n      // If we can't check, assume it's in use to be safe\r\n      return true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get formatted fee display\r\n   */\r\n  getFormattedFee(): string {\r\n    const fee = this.fee();\r\n    if (fee === 0) {\r\n      return 'Free';\r\n    }\r\n    return `${fee} ${this.symbol()}`;\r\n  }\r\n\r\n  /**\r\n   * Get formatted limits display\r\n   */\r\n  getFormattedLimits(): string {\r\n    const min = this.minAmount();\r\n    const max = this.maxAmount();\r\n    const symbol = this.symbol();\r\n\r\n    if (max) {\r\n      return `${min} - ${max} ${symbol}`;\r\n    }\r\n    return `Min: ${min} ${symbol}`;\r\n  }\r\n\r\n  // Private validation methods\r\n\r\n  /**\r\n   * Validate attributes before saving\r\n   */\r\n  private validateAttributes(attributes: Record<string, any>): void {\r\n    validateWithdrawalPlatform(attributes, this.minAmount());\r\n  }\r\n\r\n  /**\r\n   * Handle save errors with proper typing\r\n   */\r\n  private handleSaveError(error: any): ServiceError {\r\n    if (error instanceof ServiceError) {\r\n      return error;\r\n    }\r\n\r\n    // Handle Flarum API validation errors\r\n    if (error.response && error.response.errors) {\r\n      const apiError = error.response.errors[0];\r\n      return new ServiceError(\r\n        apiError.detail || 'Failed to save funds platform',\r\n        ServiceErrorType.VALIDATION_ERROR,\r\n        apiError.code,\r\n        apiError\r\n      );\r\n    }\r\n\r\n    return new ServiceError(\r\n      error.message || 'Failed to save funds platform',\r\n      ServiceErrorType.SERVER_ERROR\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle delete errors with proper typing\r\n   */\r\n  private handleDeleteError(error: any): ServiceError {\r\n    if (error instanceof ServiceError) {\r\n      return error;\r\n    }\r\n\r\n    // Handle permission errors\r\n    if (error.status === 403 || error.response?.status === 403) {\r\n      return new ServiceError(\r\n        'You do not have permission to delete this platform',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    return new ServiceError(\r\n      error.message || 'Failed to delete funds platform',\r\n      ServiceErrorType.SERVER_ERROR\r\n    );\r\n  }\r\n}","/**\r\n * Shared type definitions for the Withdrawal extension\r\n */\r\n\r\n/**\r\n * Withdrawal platform data structure\r\n */\r\nexport interface WithdrawalPlatformData {\r\n  id: string | number;\r\n  name: string;\r\n  symbol: string;\r\n  minAmount: number;\r\n  maxAmount: number;\r\n  fee: number;\r\n  iconUrl?: string | null;\r\n  iconClass?: string | null;\r\n  isActive: boolean;\r\n  createdAt?: string;\r\n  updatedAt?: string;\r\n}\r\n\r\n/**\r\n * Withdrawal request data structure\r\n */\r\nexport interface WithdrawalRequestData {\r\n  id: string | number;\r\n  amount: number;\r\n  accountDetails: string;\r\n  status: 'pending' | 'approved' | 'rejected';\r\n  platformId: number;\r\n  userId: number;\r\n  createdAt?: string;\r\n  updatedAt?: string;\r\n}\r\n\r\n/**\r\n * User funds data extension\r\n */\r\nexport interface UserWithdrawalData {\r\n  money?: number;\r\n  withdrawalRequests?: WithdrawalRequestData[];\r\n}\r\n\r\n/**\r\n * API response structures\r\n */\r\nexport interface ApiSuccessResponse<T = any> {\r\n  data: T;\r\n}\r\n\r\nexport interface ApiErrorResponse {\r\n  errors: Array<{\r\n    status: string;\r\n    code: string;\r\n    title: string;\r\n    detail?: string;\r\n  }>;\r\n}\r\n\r\n/**\r\n * Form validation errors\r\n */\r\nexport interface ValidationErrors {\r\n  [field: string]: string[];\r\n}\r\n\r\n/**\r\n * Configuration constants\r\n */\r\nexport const WITHDRAWAL_STATUS = {\r\n  PENDING: 'pending',\r\n  APPROVED: 'approved',\r\n  REJECTED: 'rejected',\r\n} as const;\r\n\r\nexport type WithdrawalStatus = typeof WITHDRAWAL_STATUS[keyof typeof WITHDRAWAL_STATUS];\r\n\r\n/**\r\n * Default values\r\n */\r\nexport const DEFAULT_MIN_AMOUNT = 0.001;\r\nexport const DEFAULT_MAX_AMOUNT = 10;\r\nexport const DEFAULT_FEE = 0.0005;\r\n\r\n/**\r\n * Helper type guards\r\n */\r\nexport function isWithdrawalPlatform(obj: any): obj is WithdrawalPlatformData {\r\n  return obj &&\r\n    typeof obj === 'object' &&\r\n    'id' in obj &&\r\n    'name' in obj &&\r\n    'symbol' in obj &&\r\n    'minAmount' in obj &&\r\n    'maxAmount' in obj;\r\n}\r\n\r\nexport function isWithdrawalRequest(obj: any): obj is WithdrawalRequestData {\r\n  return obj &&\r\n    typeof obj === 'object' &&\r\n    'id' in obj &&\r\n    'amount' in obj &&\r\n    'accountDetails' in obj &&\r\n    'status' in obj &&\r\n    'platformId' in obj &&\r\n    'userId' in obj;\r\n}","import Model from 'flarum/common/Model';\r\nimport User from 'flarum/common/models/User';\r\nimport WithdrawalPlatform from './WithdrawalPlatform';\r\nimport { WithdrawalStatus, WITHDRAWAL_STATUS } from '../types';\r\nimport { ServiceError, ServiceErrorType } from '../types/services';\r\nimport app from 'flarum/common/app';\r\n\r\n/**\r\n * WithdrawalRequest model for Flarum\r\n * \r\n * This model represents a user's funds request with enhanced CRUD capabilities.\r\n */\r\nexport default class WithdrawalRequest extends Model {\r\n  // Basic attributes\r\n  amount = Model.attribute<number>('amount');\r\n  accountDetails = Model.attribute<string>('accountDetails');\r\n  message = Model.attribute<string>('message');\r\n  status = Model.attribute<WithdrawalStatus>('status');\r\n  \r\n  // Foreign keys\r\n  platformId = Model.attribute<number>('platformId');\r\n  userId = Model.attribute<number>('userId');\r\n  \r\n  // Timestamps\r\n  createdAt = Model.attribute('createdAt', Model.transformDate);\r\n  updatedAt = Model.attribute('updatedAt', Model.transformDate);\r\n  \r\n  // Relationships\r\n  user = Model.hasOne<User>('user');\r\n  platform = Model.hasOne<WithdrawalPlatform>('platform');\r\n  \r\n  // Computed properties\r\n  apiEndpoint() {\r\n    const id = this.id();\r\n    return id ? `/funds-requests/${id}` : '/funds-requests';\r\n  }\r\n  \r\n  // Status helpers\r\n  isPending(): boolean {\r\n    return this.status() === WITHDRAWAL_STATUS.PENDING;\r\n  }\r\n  \r\n  isApproved(): boolean {\r\n    return this.status() === WITHDRAWAL_STATUS.APPROVED;\r\n  }\r\n  \r\n  isRejected(): boolean {\r\n    return this.status() === WITHDRAWAL_STATUS.REJECTED;\r\n  }\r\n  \r\n  canBeModified(): boolean {\r\n    return this.isPending();\r\n  }\r\n  \r\n  // Display helpers\r\n  statusLabel(): string {\r\n    const status = this.status();\r\n    return app.translator.trans(`funds.forum.status.${status}`).toString();\r\n  }\r\n  \r\n  statusColor(): string {\r\n    const status = this.status();\r\n    switch (status) {\r\n      case WITHDRAWAL_STATUS.APPROVED:\r\n        return 'success';\r\n      case WITHDRAWAL_STATUS.REJECTED:\r\n        return 'danger';\r\n      case WITHDRAWAL_STATUS.PENDING:\r\n      default:\r\n        return 'warning';\r\n    }\r\n  }\r\n\r\n  // Enhanced CRUD methods\r\n\r\n  /**\r\n   * Save this funds request with enhanced validation\r\n   */\r\n  async save(attributes?: Record<string, any>): Promise<WithdrawalRequest> {\r\n    // Validate before saving if attributes provided\r\n    if (attributes) {\r\n      this.validateAttributes(attributes);\r\n    }\r\n\r\n    try {\r\n      const result = await super.save(attributes);\r\n      return result as WithdrawalRequest;\r\n    } catch (error) {\r\n      throw this.handleSaveError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete this funds request with permission check\r\n   */\r\n  async delete(): Promise<void> {\r\n    if (!this.canDelete()) {\r\n      throw new ServiceError(\r\n        'You do not have permission to delete this request',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    // Only check if request can be modified for non-admin users\r\n    const currentUser = app.session.user;\r\n    if (currentUser && !currentUser.isAdmin() && !this.canBeModified()) {\r\n      throw new ServiceError(\r\n        'This request cannot be deleted as it has already been processed',\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n\r\n    try {\r\n      await super.delete();\r\n    } catch (error) {\r\n      throw this.handleDeleteError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clone this request for resubmission\r\n   */\r\n  clone(): WithdrawalRequest {\r\n    const cloned = app.store.createRecord('funds-requests') as WithdrawalRequest;\r\n    \r\n    // Copy relevant attributes but not status/timestamps\r\n    cloned.pushAttributes({\r\n      platformId: this.platformId(),\r\n      amount: this.amount(),\r\n      accountDetails: this.accountDetails(),\r\n      message: this.message()\r\n    });\r\n\r\n    return cloned;\r\n  }\r\n\r\n  /**\r\n   * Get total cost including fees\r\n   */\r\n  getTotalCost(): number {\r\n    const platform = this.platform();\r\n    const fee = platform ? platform.fee() || 0 : 0;\r\n    return this.amount() + fee;\r\n  }\r\n\r\n  /**\r\n   * Get formatted amount string\r\n   */\r\n  getFormattedAmount(): string {\r\n    const platform = this.platform();\r\n    const symbol = platform ? platform.symbol() : '';\r\n    return `${this.amount()} ${symbol}`.trim();\r\n  }\r\n\r\n  /**\r\n   * Get formatted total cost string including fees\r\n   */\r\n  getFormattedTotalCost(): string {\r\n    const platform = this.platform();\r\n    const symbol = platform ? platform.symbol() : '';\r\n    const fee = platform ? platform.fee() || 0 : 0;\r\n    \r\n    if (fee > 0) {\r\n      return `${this.amount()} + ${fee} (fee) = ${this.getTotalCost()} ${symbol}`.trim();\r\n    }\r\n    \r\n    return this.getFormattedAmount();\r\n  }\r\n\r\n  // Permission methods\r\n\r\n  /**\r\n   * Check if current user can modify this request\r\n   */\r\n  canModify(): boolean {\r\n    const currentUser = app.session.user;\r\n    if (!currentUser) return false;\r\n\r\n    // Admin can modify any request\r\n    if (currentUser.isAdmin()) return true;\r\n\r\n    // Users can only modify their own pending requests\r\n    return this.userId() === currentUser.id() && this.canBeModified();\r\n  }\r\n\r\n  /**\r\n   * Check if current user can delete this request\r\n   */\r\n  canDelete(): boolean {\r\n    const currentUser = app.session.user;\r\n    if (!currentUser) return false;\r\n\r\n    // Admin can delete any request\r\n    if (currentUser.isAdmin()) return true;\r\n\r\n    // Users can only delete their own pending requests\r\n    return this.userId() === currentUser.id() && this.canBeModified();\r\n  }\r\n\r\n  /**\r\n   * Check if current user can view this request's details\r\n   */\r\n  canView(): boolean {\r\n    const currentUser = app.session.user;\r\n    if (!currentUser) return false;\r\n\r\n    // Admin can view any request\r\n    if (currentUser.isAdmin()) return true;\r\n\r\n    // Users can only view their own requests\r\n    return this.userId() === currentUser.id();\r\n  }\r\n\r\n  // Validation methods\r\n\r\n  /**\r\n   * Validate attributes before saving\r\n   */\r\n  private validateAttributes(attributes: Record<string, any>): void {\r\n    const errors: string[] = [];\r\n\r\n    if (attributes.amount !== undefined) {\r\n      if (typeof attributes.amount !== 'number' || attributes.amount <= 0) {\r\n        errors.push('Amount must be a positive number');\r\n      }\r\n    }\r\n\r\n    if (attributes.accountDetails !== undefined) {\r\n      if (!attributes.accountDetails || typeof attributes.accountDetails !== 'string') {\r\n        errors.push('Account details are required');\r\n      }\r\n    }\r\n\r\n    if (attributes.platformId !== undefined) {\r\n      if (!attributes.platformId || typeof attributes.platformId !== 'number') {\r\n        errors.push('Platform selection is required');\r\n      }\r\n    }\r\n\r\n    if (errors.length > 0) {\r\n      throw new ServiceError(\r\n        errors.join(', '),\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle save errors with proper typing\r\n   */\r\n  private handleSaveError(error: any): ServiceError {\r\n    if (error instanceof ServiceError) {\r\n      return error;\r\n    }\r\n\r\n    // Handle Flarum API validation errors\r\n    if (error.response && error.response.errors) {\r\n      const apiError = error.response.errors[0];\r\n      return new ServiceError(\r\n        apiError.detail || 'Failed to save funds request',\r\n        ServiceErrorType.VALIDATION_ERROR,\r\n        apiError.code,\r\n        apiError\r\n      );\r\n    }\r\n\r\n    return new ServiceError(\r\n      error.message || 'Failed to save funds request',\r\n      ServiceErrorType.SERVER_ERROR\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle delete errors with proper typing\r\n   */\r\n  private handleDeleteError(error: any): ServiceError {\r\n    if (error instanceof ServiceError) {\r\n      return error;\r\n    }\r\n\r\n    // Handle permission errors\r\n    if (error.status === 403 || error.response?.status === 403) {\r\n      return new ServiceError(\r\n        'You do not have permission to delete this request',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    return new ServiceError(\r\n      error.message || 'Failed to delete funds request',\r\n      ServiceErrorType.SERVER_ERROR\r\n    );\r\n  }\r\n}","import Model from 'flarum/common/Model';\r\nimport { ServiceError, ServiceErrorType } from '../types/services';\r\nimport { validateDepositPlatform } from '../utils/PlatformValidation';\r\nimport { IconRepresentation } from './CurrencyIcon';\r\nimport app from 'flarum/common/app';\r\n\r\nexport default class DepositPlatform extends Model {\r\n  name = Model.attribute<string>('name');\r\n  symbol = Model.attribute<string>('symbol');\r\n  network = Model.attribute<string>('network');\r\n  networkTypeId = Model.attribute('networkTypeId');\r\n  displayName = Model.attribute<string>('displayName');\r\n  minAmount = Model.attribute('minAmount');\r\n  maxAmount = Model.attribute('maxAmount');\r\n  fee = Model.attribute('fee');\r\n  address = Model.attribute('address');\r\n  qrCodeImageUrl = Model.attribute<string>('qrCodeImageUrl');\r\n  // Three-tier icon system - computed properties\r\n  currencyIconUrl = Model.attribute<string>('currencyIconUrl');\r\n  currencyIconClass = Model.attribute<string>('currencyIconClass');\r\n  currencyUnicodeSymbol = Model.attribute<string>('currencyUnicodeSymbol');\r\n  networkIconUrl = Model.attribute<string>('networkIconUrl');\r\n  networkIconClass = Model.attribute<string>('networkIconClass');\r\n  platformSpecificIconUrl = Model.attribute<string>('platformSpecificIconUrl');\r\n  platformSpecificIconClass = Model.attribute<string>('platformSpecificIconClass');\r\n  \r\n  // Override fields for admin configuration\r\n  currencyIconOverrideUrl = Model.attribute<string>('currencyIconOverrideUrl');\r\n  currencyIconOverrideClass = Model.attribute<string>('currencyIconOverrideClass');\r\n  networkIconOverrideUrl = Model.attribute<string>('networkIconOverrideUrl');\r\n  networkIconOverrideClass = Model.attribute<string>('networkIconOverrideClass');\r\n  warningText = Model.attribute<string>('warningText');\r\n  networkConfig = Model.attribute('networkConfig');\r\n  isActive = Model.attribute('isActive');\r\n  createdAt = Model.attribute('createdAt', Model.transformDate);\r\n  updatedAt = Model.attribute('updatedAt', Model.transformDate);\r\n\r\n  // Relationships\r\n  networkType = Model.hasOne('networkType');\r\n\r\n  // Icon representations from serializer\r\n  bestIcon = Model.attribute<IconRepresentation>('bestIcon');\r\n  currencyIcon = Model.attribute<IconRepresentation>('currencyIcon');\r\n  networkIcon = Model.attribute<IconRepresentation>('networkIcon');\r\n\r\n  // Helper methods\r\n  getDisplayName(): string {\r\n    return this.displayName() || this.name();\r\n  }\r\n\r\n  getFullDisplayName(): string {\r\n    const name = this.getDisplayName();\r\n    const network = this.network();\r\n    return network ? `${name} (${network})` : name;\r\n  }\r\n\r\n  isValidAmount(amount: number): boolean {\r\n    const min = this.minAmount() || 0;\r\n    const max = this.maxAmount();\r\n    return amount >= min && (max === null || amount <= max);\r\n  }\r\n\r\n  getTotalCost(amount: number): number {\r\n    return amount + (this.fee() || 0);\r\n  }\r\n\r\n  // Enhanced CRUD methods\r\n\r\n  /**\r\n   * Save this platform with enhanced validation\r\n   */\r\n  async save(attributes?: Record<string, any>): Promise<DepositPlatform> {\r\n    // Validate before saving if attributes provided\r\n    if (attributes) {\r\n      this.validateAttributes(attributes);\r\n    }\r\n\r\n    try {\r\n      const result = await super.save(attributes);\r\n      return result as DepositPlatform;\r\n    } catch (error) {\r\n      throw this.handleSaveError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete this platform with permission check\r\n   */\r\n  async delete(): Promise<void> {\r\n    if (!this.canDelete()) {\r\n      throw new ServiceError(\r\n        'You do not have permission to delete this platform',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    // Check if platform is in use\r\n    if (await this.isInUse()) {\r\n      throw new ServiceError(\r\n        'Cannot delete platform that has pending deposit records',\r\n        ServiceErrorType.VALIDATION_ERROR\r\n      );\r\n    }\r\n\r\n    try {\r\n      await super.delete();\r\n    } catch (error) {\r\n      throw this.handleDeleteError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle platform status\r\n   */\r\n  async toggleStatus(): Promise<DepositPlatform> {\r\n    if (!this.canModify()) {\r\n      throw new ServiceError(\r\n        'You do not have permission to modify this platform',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    return await this.save({\r\n      isActive: !this.isActive()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clone this platform for creating a similar one\r\n   */\r\n  clone(): DepositPlatform {\r\n    const cloned = app.store.createRecord('deposit-platforms') as DepositPlatform;\r\n    \r\n    // Copy relevant attributes but not id/timestamps\r\n    cloned.pushAttributes({\r\n      name: this.name() + ' (Copy)',\r\n      symbol: this.symbol(),\r\n      network: this.network(),\r\n      networkTypeId: this.networkTypeId(),\r\n      minAmount: this.minAmount(),\r\n      maxAmount: this.maxAmount(),\r\n      fee: this.fee(),\r\n      address: this.address(),\r\n      qrCodeImageUrl: this.qrCodeImageUrl(),\r\n      iconUrl: this.iconUrl(),\r\n      iconClass: this.iconClass(),\r\n      warningText: this.warningText(),\r\n      isActive: false // Clone as inactive by default\r\n    });\r\n\r\n    return cloned;\r\n  }\r\n\r\n  // Validation methods\r\n\r\n  /**\r\n   * Validate amount against platform limits\r\n   */\r\n  validateAmount(amount: number): { valid: boolean; errors: string[] } {\r\n    const errors: string[] = [];\r\n\r\n    if (typeof amount !== 'number' || amount <= 0) {\r\n      errors.push('Amount must be a positive number');\r\n      return { valid: false, errors };\r\n    }\r\n\r\n    const min = this.minAmount() || 0;\r\n    if (amount < min) {\r\n      errors.push(`Amount must be at least ${min} ${this.symbol()}`);\r\n    }\r\n\r\n    const max = this.maxAmount();\r\n    if (max && amount > max) {\r\n      errors.push(`Amount cannot exceed ${max} ${this.symbol()}`);\r\n    }\r\n\r\n    return { valid: errors.length === 0, errors };\r\n  }\r\n\r\n  // Permission methods\r\n\r\n  /**\r\n   * Check if current user can modify this platform\r\n   */\r\n  canModify(): boolean {\r\n    const currentUser = app.session.user;\r\n    return currentUser && currentUser.isAdmin();\r\n  }\r\n\r\n  /**\r\n   * Check if current user can delete this platform\r\n   */\r\n  canDelete(): boolean {\r\n    const currentUser = app.session.user;\r\n    return currentUser && currentUser.isAdmin();\r\n  }\r\n\r\n  /**\r\n   * Check if current user can view this platform\r\n   */\r\n  canView(): boolean {\r\n    // All authenticated users can view active platforms\r\n    if (this.isActive()) return true;\r\n    \r\n    // Only admins can view inactive platforms\r\n    const currentUser = app.session.user;\r\n    return currentUser && currentUser.isAdmin();\r\n  }\r\n\r\n  // Utility methods\r\n\r\n  /**\r\n   * Check if this platform is currently in use\r\n   */\r\n  async isInUse(): Promise<boolean> {\r\n    try {\r\n      const records = await app.store.find('deposit-records', {\r\n        filter: { platform: this.id(), status: 'pending' }\r\n      });\r\n      \r\n      const recordsArray = Array.isArray(records) ? records : [records];\r\n      return recordsArray.length > 0;\r\n    } catch {\r\n      // If we can't check, assume it's in use to be safe\r\n      return true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get formatted fee display\r\n   */\r\n  getFormattedFee(): string {\r\n    const fee = this.fee() || 0;\r\n    if (fee === 0) {\r\n      return 'Free';\r\n    }\r\n    return `${fee} ${this.symbol()}`;\r\n  }\r\n\r\n  /**\r\n   * Get formatted limits display\r\n   */\r\n  getFormattedLimits(): string {\r\n    const min = this.minAmount() || 0;\r\n    const max = this.maxAmount();\r\n    const symbol = this.symbol();\r\n\r\n    if (max) {\r\n      return `${min} - ${max} ${symbol}`;\r\n    }\r\n    return `Min: ${min} ${symbol}`;\r\n  }\r\n\r\n  /**\r\n   * Generate deposit address for user\r\n   */\r\n  generateDepositAddress(_userId?: number): string {\r\n    const address = this.address();\r\n    \r\n    // For now, we return the static address\r\n    // In the future, this could be enhanced to support dynamic address generation\r\n    if (address) {\r\n      return address;\r\n    }\r\n    \r\n    throw new ServiceError(\r\n      'No deposit address configured for this platform',\r\n      ServiceErrorType.VALIDATION_ERROR\r\n    );\r\n  }\r\n\r\n  // Private validation methods\r\n\r\n  /**\r\n   * Validate attributes before saving\r\n   */\r\n  private validateAttributes(attributes: Record<string, any>): void {\r\n    validateDepositPlatform(attributes, this.minAmount());\r\n  }\r\n\r\n  /**\r\n   * Handle save errors with proper typing\r\n   */\r\n  private handleSaveError(error: any): ServiceError {\r\n    if (error instanceof ServiceError) {\r\n      return error;\r\n    }\r\n\r\n    // Handle Flarum API validation errors\r\n    if (error.response && error.response.errors) {\r\n      const apiError = error.response.errors[0];\r\n      return new ServiceError(\r\n        apiError.detail || 'Failed to save deposit platform',\r\n        ServiceErrorType.VALIDATION_ERROR,\r\n        apiError.code,\r\n        apiError\r\n      );\r\n    }\r\n\r\n    return new ServiceError(\r\n      error.message || 'Failed to save deposit platform',\r\n      ServiceErrorType.SERVER_ERROR\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle delete errors with proper typing\r\n   */\r\n  private handleDeleteError(error: any): ServiceError {\r\n    if (error instanceof ServiceError) {\r\n      return error;\r\n    }\r\n\r\n    // Handle permission errors\r\n    if (error.status === 403 || error.response?.status === 403) {\r\n      return new ServiceError(\r\n        'You do not have permission to delete this platform',\r\n        ServiceErrorType.PERMISSION_DENIED\r\n      );\r\n    }\r\n\r\n    return new ServiceError(\r\n      error.message || 'Failed to delete deposit platform',\r\n      ServiceErrorType.SERVER_ERROR\r\n    );\r\n  }\r\n}","import Model from 'flarum/common/Model';\r\nimport User from 'flarum/common/models/User';\r\n\r\nexport default class DepositRecord extends Model {\r\n  // 属性\r\n  userId = Model.attribute<number>('userId');\r\n  depositAddress = Model.attribute<string>('depositAddress');\r\n  qrCodeUrl = Model.attribute<string>('qrCodeUrl');\r\n  userMessage = Model.attribute<string>('userMessage');\r\n  status = Model.attribute<string>('status');\r\n  statusText = Model.attribute<string>('statusText');\r\n  processedAt = Model.attribute('processedAt', Model.transformDate);\r\n  processedBy = Model.attribute<number>('processedBy');\r\n  adminNotes = Model.attribute<string>('adminNotes');\r\n  createdAt = Model.attribute('createdAt', Model.transformDate);\r\n  updatedAt = Model.attribute('updatedAt', Model.transformDate);\r\n  formattedCreatedAt = Model.attribute<string>('formattedCreatedAt');\r\n  formattedProcessedAt = Model.attribute<string>('formattedProcessedAt');\r\n  isPending = Model.attribute<boolean>('isPending');\r\n  isApproved = Model.attribute<boolean>('isApproved');\r\n  isRejected = Model.attribute<boolean>('isRejected');\r\n\r\n  // 关联\r\n  user = Model.hasOne<User>('user');\r\n  processedByUser = Model.hasOne<User>('processedByUser');\r\n\r\n  // 辅助方法\r\n  getStatusColor(): string {\r\n    switch (this.status()) {\r\n      case 'pending':\r\n        return 'warning';\r\n      case 'approved':\r\n        return 'success';\r\n      case 'rejected':\r\n        return 'danger';\r\n      default:\r\n        return 'secondary';\r\n    }\r\n  }\r\n\r\n  getStatusIcon(): string {\r\n    switch (this.status()) {\r\n      case 'pending':\r\n        return 'fas fa-clock';\r\n      case 'approved':\r\n        return 'fas fa-check-circle';\r\n      case 'rejected':\r\n        return 'fas fa-times-circle';\r\n      default:\r\n        return 'fas fa-question-circle';\r\n    }\r\n  }\r\n\r\n  canEdit(currentUser?: User): boolean {\r\n    if (!currentUser) return false;\r\n    \r\n    // 管理员可以编辑任何记录\r\n    if (currentUser.isAdmin()) return true;\r\n    \r\n    // 用户只能编辑自己的待处理记录\r\n    return this.userId().toString() === currentUser.id() && this.isPending();\r\n  }\r\n\r\n  canDelete(currentUser?: User): boolean {\r\n    if (!currentUser) return false;\r\n    \r\n    // 只有管理员可以删除\r\n    return currentUser.isAdmin() || false;\r\n  }\r\n\r\n  getDisplayAddress(): string {\r\n    const address = this.depositAddress();\r\n    if (address && address.length > 20) {\r\n      return `${address.substring(0, 10)}...${address.substring(address.length - 10)}`;\r\n    }\r\n    return address || '';\r\n  }\r\n\r\n  hasQrCode(): boolean {\r\n    const qrUrl = this.qrCodeUrl();\r\n    return qrUrl !== null && qrUrl !== undefined && qrUrl.trim() !== '';\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport UnifiedManagementPage from './components/UnifiedManagementPage';\r\nimport WithdrawalPlatform from '../common/models/WithdrawalPlatform';\r\nimport WithdrawalRequest from '../common/models/WithdrawalRequest';\r\nimport DepositPlatform from '../common/models/DepositPlatform';\r\nimport DepositRecord from '../common/models/DepositRecord';\r\n\r\napp.initializers.add('wusong8899-funds', () => {\r\n  // Register models in store\r\n  app.store.models['funds-platforms'] = WithdrawalPlatform;\r\n  app.store.models['funds-requests'] = WithdrawalRequest;\r\n  app.store.models['deposit-platforms'] = DepositPlatform;\r\n  app.store.models['deposit-records'] = DepositRecord;\r\n\r\n  app.extensionData\r\n    .for('wusong8899-funds')\r\n    .registerPage(UnifiedManagementPage);\r\n});"],"names":["ConfirmModal","Modal","title","dangerous","modalIcon","icon","message","confirmText","cancelText","onConfirm","onCancel","Button","app","GenericManagementPage","ExtensionPage","config","vnode","LoadingIndicator","m","tab","activeTab","props","formData","error","platform","platformName","transaction","status","prefix","key","value","settingsService","__vitePreload","SettingsService$1","GeneralSettingsSection","Component","withAttr","FormValidator","fieldName","displayName","minLength","min","max","numValue","_url","condition","AddPlatformForm","Stream","validator","nameLabel","symbolLabel","minAmountLabel","maxAmountLabel","feeLabel","minVal","errorMessage","currencyIconUrlLabel","networkIconUrlLabel","result","GenericPlatformListItem","type","onToggleStatus","onDelete","style","platformData","translationPrefix","Switch","id","name","symbol","network","minAmount","maxAmount","fee","address","isActive","createdDate","dateDisplay","humanTime","e","iconUrl","iconClass","PlatformManagementSection","platforms","submittingPlatform","onAddPlatform","onTogglePlatformStatus","onDeletePlatform","WithdrawalRequestItem","request","showActions","showDelete","requestId","amount","accountDetails","userName","userData","platformSymbol","statusClass","RequestManagementSection","requests","onUpdateRequestStatus","onDeleteRequest","pendingRequests","r","processedRequests","DepositRecordManagementSection","records","loading","record","attrs","recordId","isProcessing","user","depositTime","createdAt","platformId","p","defaultAmount","creditedAmount","notes","reason","AddDepositPlatformForm","submitting","addressLabel","maxVal","platformIconUrlLabel","qrCodeLabel","DepositPlatformManagementSection","createWithdrawalPlatformOperations","platformService","PlatformService$1","attributes","newStatus","createWithdrawalRequestOperations","withdrawalService","WithdrawalService$1","ServiceErrorType","ServiceError","code","details","WithdrawalService","options","queryParams","results","model","data","userId","targetUserId","queryOptions","currentUser","userBalance","totalRequired","required","field","defaultMessage","apiError","DepositServiceImpl","response","filters","params","adminNotes","depositService","PlatformService","modelType","currentStatus","errors","requestType","recordArray","sum","grouped","sortBy","direction","sortString","_platform","SettingsService","defaultValue","cachedValue","storageValue","settings","preparedSettings","forumAttributes","extension","fullKey","WithdrawalTabPlaceholder","DepositsTabPlaceholder","UnifiedManagementPage","usersToLoad","userRelation","userPromises","loadedUsers","index","validateCommonFields","validateAmountFields","currentMinAmount","validateDepositFields","throwIfErrors","validateWithdrawalPlatform","validateDepositPlatform","WithdrawalPlatform","Model","cloned","totalCost","feeText","WITHDRAWAL_STATUS","WithdrawalRequest","DepositPlatform","_userId","DepositRecord","qrUrl"],"mappings":"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"}