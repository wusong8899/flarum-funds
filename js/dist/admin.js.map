{"version":3,"file":"admin.js","sources":["../src/admin/components/WithdrawalManagementPage.tsx","../src/common/models/WithdrawalPlatform.ts","../src/common/models/WithdrawalRequest.ts","../src/admin/index.ts"],"sourcesContent":["import app from 'flarum/admin/app';\r\nimport ExtensionPage from 'flarum/admin/components/ExtensionPage';\r\nimport Button from 'flarum/common/components/Button';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport humanTime from 'flarum/common/helpers/humanTime';\r\nimport Modal from 'flarum/common/components/Modal';\r\nimport type Mithril from 'mithril';\r\n\r\ninterface WithdrawalPlatform {\r\n  id: number;\r\n  attributes: {\r\n    name: string;\r\n    symbol?: string;\r\n    minAmount?: number;\r\n    maxAmount?: number;\r\n    fee?: number;\r\n    iconUrl?: string;\r\n    iconClass?: string;\r\n    isActive?: boolean;\r\n    createdAt?: string;\r\n    created_at?: string;\r\n  };\r\n}\r\n\r\ninterface WithdrawalRequest {\r\n  id: number;\r\n  attributes: {\r\n    amount: number;\r\n    accountDetails?: string;\r\n    account_details?: string;\r\n    status: string;\r\n    createdAt?: string;\r\n    created_at?: string;\r\n  };\r\n  relationships?: {\r\n    user?: {\r\n      data: { id: number };\r\n    };\r\n    platform?: {\r\n      data: { id: number };\r\n    };\r\n  };\r\n}\r\n\r\ninterface User {\r\n  id: number;\r\n  attributes: {\r\n    displayName: string;\r\n  };\r\n}\r\n\r\nexport default class WithdrawalManagementPage extends ExtensionPage {\r\n  private platforms: WithdrawalPlatform[] = [];\r\n  private requests: WithdrawalRequest[] = [];\r\n  private users: { [key: number]: User } = {};\r\n  private loading = true;\r\n  private newPlatformName = Stream('');\r\n  private newPlatformSymbol = Stream('');\r\n  private newPlatformMinAmount = Stream('');\r\n  private newPlatformMaxAmount = Stream('');\r\n  private newPlatformFee = Stream('');\r\n  private newPlatformIconUrl = Stream('');\r\n  private newPlatformIconClass = Stream('');\r\n  private submittingPlatform = false;\r\n\r\n  oninit(vnode: Mithril.VnodeDOM) {\r\n    super.oninit(vnode);\r\n    this.loadData();\r\n  }\r\n\r\n  content() {\r\n    if (this.loading) {\r\n      return <LoadingIndicator />;\r\n    }\r\n\r\n    return (\r\n      <div className=\"WithdrawalManagementPage\">\r\n        <div className=\"container\">\r\n          <h2>{app.translator.trans('withdrawal.admin.page.title')}</h2>\r\n          \r\n          {this.renderPlatformManagement()}\r\n          {this.renderRequestManagement()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n\r\n  private renderPlatformManagement(): Mithril.Children {\r\n    return (\r\n      <div className=\"WithdrawalManagementPage-section\">\r\n        <h3>{app.translator.trans('withdrawal.admin.platforms.title')}</h3>\r\n        \r\n        <div className=\"WithdrawalManagementPage-addPlatform\">\r\n          <div className=\"Form-group\">\r\n            <div className=\"Form-row\">\r\n              <div className=\"Form-col\">\r\n                <label>{app.translator.trans('withdrawal.admin.platforms.name')}</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"FormControl\"\r\n                  placeholder={app.translator.trans('withdrawal.admin.platforms.add_placeholder')}\r\n                  value={this.newPlatformName()}\r\n                  oninput={(e: Event) => this.newPlatformName((e.target as HTMLInputElement).value)}\r\n                />\r\n              </div>\r\n              <div className=\"Form-col\">\r\n                <label>{app.translator.trans('withdrawal.admin.platforms.symbol')}</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"BTC, ETH, USDT...\"\r\n                  value={this.newPlatformSymbol()}\r\n                  oninput={(e: Event) => this.newPlatformSymbol((e.target as HTMLInputElement).value)}\r\n                />\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"Form-row\">\r\n              <div className=\"Form-col\">\r\n                <label>{app.translator.trans('withdrawal.admin.platforms.min_amount')}</label>\r\n                <input\r\n                  type=\"number\"\r\n                  step=\"0.00000001\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"0.001\"\r\n                  value={this.newPlatformMinAmount()}\r\n                  oninput={(e: Event) => this.newPlatformMinAmount((e.target as HTMLInputElement).value)}\r\n                />\r\n              </div>\r\n              <div className=\"Form-col\">\r\n                <label>{app.translator.trans('withdrawal.admin.platforms.max_amount')}</label>\r\n                <input\r\n                  type=\"number\"\r\n                  step=\"0.00000001\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"10.0\"\r\n                  value={this.newPlatformMaxAmount()}\r\n                  oninput={(e: Event) => this.newPlatformMaxAmount((e.target as HTMLInputElement).value)}\r\n                />\r\n              </div>\r\n              <div className=\"Form-col\">\r\n                <label>{app.translator.trans('withdrawal.admin.platforms.fee')}</label>\r\n                <input\r\n                  type=\"number\"\r\n                  step=\"0.00000001\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"0.0005\"\r\n                  value={this.newPlatformFee()}\r\n                  oninput={(e: Event) => this.newPlatformFee((e.target as HTMLInputElement).value)}\r\n                />\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"Form-row\">\r\n              <div className=\"Form-col\">\r\n                <label>{app.translator.trans('withdrawal.admin.platforms.icon_url')}</label>\r\n                <input\r\n                  type=\"url\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"https://example.com/icon.png\"\r\n                  value={this.newPlatformIconUrl()}\r\n                  oninput={(e: Event) => this.newPlatformIconUrl((e.target as HTMLInputElement).value)}\r\n                />\r\n                <small className=\"helpText\">{app.translator.trans('withdrawal.admin.platforms.icon_url_help')}</small>\r\n              </div>\r\n              <div className=\"Form-col\">\r\n                <label>{app.translator.trans('withdrawal.admin.platforms.icon_class')}</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"FormControl\"\r\n                  placeholder=\"fas fa-coins\"\r\n                  value={this.newPlatformIconClass()}\r\n                  oninput={(e: Event) => this.newPlatformIconClass((e.target as HTMLInputElement).value)}\r\n                />\r\n                <small className=\"helpText\">{app.translator.trans('withdrawal.admin.platforms.icon_class_help')}</small>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"Form-group\">\r\n              <Button\r\n                className=\"Button Button--primary\"\r\n                loading={this.submittingPlatform}\r\n                disabled={!this.canSubmitPlatform()}\r\n                onclick={this.addPlatform.bind(this)}\r\n              >\r\n                {app.translator.trans('withdrawal.admin.platforms.add_button')}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"WithdrawalManagementPage-platformList\">\r\n          {this.platforms.length === 0 ? (\r\n            <p>{app.translator.trans('withdrawal.admin.platforms.empty')}</p>\r\n          ) : (\r\n            this.platforms.map((platform) => this.renderPlatform(platform))\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderPlatform(platform: WithdrawalPlatform): Mithril.Children {\r\n    // Handle both Model instances and plain objects\r\n    const platformId = typeof platform.id === 'function' ? platform.id() : platform.id;\r\n    const platformName = (typeof platform.name === 'function' ? platform.name() : platform.attributes?.name) || 'Unknown Platform';\r\n    const symbol = (typeof platform.symbol === 'function' ? platform.symbol() : platform.attributes?.symbol) || 'N/A';\r\n    const minAmount = (typeof platform.minAmount === 'function' ? platform.minAmount() : platform.attributes?.minAmount) || 'N/A';\r\n    const maxAmount = (typeof platform.maxAmount === 'function' ? platform.maxAmount() : platform.attributes?.maxAmount) || 'N/A';\r\n    const fee = (typeof platform.fee === 'function' ? platform.fee() : platform.attributes?.fee) || 'N/A';\r\n    const isActive = (typeof platform.isActive === 'function' ? platform.isActive() : platform.attributes?.isActive) ?? false;\r\n    const createdDate = (typeof platform.createdAt === 'function' ? platform.createdAt() : platform.attributes?.createdAt) || null;\r\n    \r\n    let dateDisplay: Mithril.Children = 'N/A';\r\n    if (createdDate) {\r\n      try {\r\n        dateDisplay = humanTime(createdDate);\r\n      } catch (e) {\r\n        console.error('Error formatting date:', e);\r\n        dateDisplay = 'Invalid Date';\r\n      }\r\n    }\r\n    \r\n    return (\r\n      <div key={platformId} className=\"WithdrawalPlatform\">\r\n        <div className=\"WithdrawalPlatform-info\">\r\n          <div className=\"WithdrawalPlatform-primary\">\r\n            <span className={`WithdrawalPlatform-status ${isActive ? 'active' : 'inactive'}`}>\r\n              {isActive ? 'ðŸŸ¢' : 'ðŸ”´'}\r\n            </span>\r\n            <span className=\"WithdrawalPlatform-name\">{platformName}</span>\r\n            <span className={`WithdrawalPlatform-symbol ${symbol}`}>{symbol}</span>\r\n          </div>\r\n          <div className=\"WithdrawalPlatform-details\">\r\n            <span className=\"WithdrawalPlatform-amounts\">\r\n              Min: {minAmount} | Max: {maxAmount} | Fee: {fee}\r\n            </span>\r\n            <span className=\"WithdrawalPlatform-date\">{dateDisplay}</span>\r\n          </div>\r\n        </div>\r\n        <div className=\"WithdrawalPlatform-actions\">\r\n          <Button\r\n            className={`Button ${isActive ? 'Button--secondary' : 'Button--primary'}`}\r\n            onclick={() => this.togglePlatformStatus(platform)}\r\n          >\r\n            {app.translator.trans(`withdrawal.admin.platforms.${isActive ? 'disable' : 'enable'}`)}\r\n          </Button>\r\n          <Button\r\n            className=\"Button Button--danger\"\r\n            onclick={() => this.deletePlatform(platform)}\r\n          >\r\n            {app.translator.trans('withdrawal.admin.platforms.delete')}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private canSubmitPlatform(): boolean {\r\n    return !!(\r\n      this.newPlatformName() &&\r\n      this.newPlatformName().trim() &&\r\n      this.newPlatformSymbol() &&\r\n      this.newPlatformSymbol().trim() &&\r\n      this.newPlatformMinAmount() &&\r\n      this.newPlatformMaxAmount() &&\r\n      parseFloat(this.newPlatformMinAmount()) > 0 &&\r\n      parseFloat(this.newPlatformMaxAmount()) > 0 &&\r\n      parseFloat(this.newPlatformMaxAmount()) >= parseFloat(this.newPlatformMinAmount())\r\n    );\r\n  }\r\n\r\n  private renderRequestManagement(): Mithril.Children {\r\n    const pendingRequests = this.requests.filter(r => {\r\n      const status = (typeof r.status === 'function' ? r.status() : r.attributes?.status) || 'pending';\r\n      return status === 'pending';\r\n    });\r\n    const processedRequests = this.requests.filter(r => {\r\n      const status = (typeof r.status === 'function' ? r.status() : r.attributes?.status) || 'pending';\r\n      return status !== 'pending';\r\n    });\r\n\r\n    return (\r\n      <div className=\"WithdrawalManagementPage-section\">\r\n        <h3>{app.translator.trans('withdrawal.admin.requests.title')}</h3>\r\n        \r\n        <div className=\"WithdrawalManagementPage-pendingRequests\">\r\n          <h4>{app.translator.trans('withdrawal.admin.requests.pending_title')}</h4>\r\n          {pendingRequests.length === 0 ? (\r\n            <p>{app.translator.trans('withdrawal.admin.requests.no_pending')}</p>\r\n          ) : (\r\n            pendingRequests.map((request) => this.renderRequest(request, true, true))\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"WithdrawalManagementPage-processedRequests\">\r\n          <h4>{app.translator.trans('withdrawal.admin.requests.processed_title')}</h4>\r\n          {processedRequests.length === 0 ? (\r\n            <p>{app.translator.trans('withdrawal.admin.requests.no_processed')}</p>\r\n          ) : (\r\n            processedRequests.map((request) => this.renderRequest(request, false, true))\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderRequest(request: WithdrawalRequest, showActions: boolean, showDelete: boolean = false): Mithril.Children {\r\n    // Handle Flarum Model instances\r\n    const requestId = typeof request.id === 'function' ? request.id() : request.id;\r\n    const amount = typeof request.amount === 'function' ? request.amount() : (request.attributes?.amount || 0);\r\n    const status = typeof request.status === 'function' ? request.status() : (request.attributes?.status || 'pending');\r\n    const accountDetails = typeof request.accountDetails === 'function' ? request.accountDetails() : \r\n      (request.attributes?.accountDetails || request.attributes?.account_details || 'N/A');\r\n    const createdDate = typeof request.createdAt === 'function' ? request.createdAt() : (request.attributes?.createdAt || null);\r\n    \r\n    // Get user info\r\n    let userName = 'Unknown User';\r\n    if (typeof request.user === 'function') {\r\n      const userData = request.user();\r\n      if (userData && typeof userData.displayName === 'function') {\r\n        userName = userData.displayName();\r\n      } else if (userData && userData.attributes?.displayName) {\r\n        userName = userData.attributes.displayName;\r\n      }\r\n    }\r\n    \r\n    // Get platform info - simplified approach using Flarum Model relationships\r\n    let platformName = 'Unknown Platform';\r\n    let platformSymbol = 'N/A';\r\n    \r\n    if (typeof request.platform === 'function') {\r\n      const platform = request.platform();\r\n      if (platform) {\r\n        platformName = typeof platform.name === 'function' ? platform.name() : (platform.attributes?.name || 'Unknown Platform');\r\n        platformSymbol = typeof platform.symbol === 'function' ? platform.symbol() : (platform.attributes?.symbol || 'N/A');\r\n      }\r\n    }\r\n    \r\n    const statusClass = `status-${status}`;\r\n    \r\n    let dateDisplay: Mithril.Children = 'N/A';\r\n    if (createdDate) {\r\n      try {\r\n        dateDisplay = humanTime(createdDate);\r\n      } catch (e) {\r\n        console.error('Error formatting request date:', e);\r\n        dateDisplay = 'Invalid Date';\r\n      }\r\n    }\r\n\r\n    return (\r\n      <div key={requestId} className={`WithdrawalRequest ${statusClass}`}>\r\n        <div className=\"WithdrawalRequest-info\">\r\n          <div className=\"WithdrawalRequest-user\">\r\n            <strong>{userName}</strong>\r\n          </div>\r\n          <div className=\"WithdrawalRequest-details\">\r\n            <span className=\"amount\">{amount}</span>\r\n            <span className=\"platform\">{platformName}</span>\r\n            <span className=\"symbol\">{platformSymbol}</span>\r\n            <span className=\"date\">{dateDisplay}</span>\r\n          </div>\r\n          <div className=\"WithdrawalRequest-account\">\r\n            <strong>{app.translator.trans('withdrawal.admin.requests.account_details')}:</strong>\r\n            <span>{accountDetails}</span>\r\n          </div>\r\n          <div className=\"WithdrawalRequest-status\">\r\n            <span className={`Badge Badge--${status}`}>\r\n              {app.translator.trans(`withdrawal.admin.requests.status.${status}`)}\r\n            </span>\r\n          </div>\r\n        </div>\r\n        \r\n        {(showActions || showDelete) && (\r\n          <div className=\"WithdrawalRequest-actions\">\r\n            {showActions && (\r\n              <>\r\n                <Button\r\n                  className=\"Button Button--primary\"\r\n                  onclick={() => this.updateRequestStatus(request, 'approved')}\r\n                >\r\n                  {app.translator.trans('withdrawal.admin.requests.approve')}\r\n                </Button>\r\n                <Button\r\n                  className=\"Button Button--danger\"\r\n                  onclick={() => this.updateRequestStatus(request, 'rejected')}\r\n                >\r\n                  {app.translator.trans('withdrawal.admin.requests.reject')}\r\n                </Button>\r\n              </>\r\n            )}\r\n            <Button\r\n              className=\"Button Button--link\"\r\n              onclick={() => this.deleteRequest(request)}\r\n            >\r\n              <i className=\"fas fa-trash\"></i>\r\n              {app.translator.trans('withdrawal.admin.requests.delete')}\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private async addPlatform(): Promise<void> {\r\n    if (!this.canSubmitPlatform() || this.submittingPlatform) return;\r\n\r\n    this.submittingPlatform = true;\r\n\r\n    try {\r\n      const response = await app.request({\r\n        method: 'POST',\r\n        url: app.forum.attribute('apiUrl') + '/withdrawal-platforms',\r\n        body: {\r\n          data: {\r\n            type: 'withdrawal-platforms',\r\n            attributes: {\r\n              name: this.newPlatformName(),\r\n              symbol: this.newPlatformSymbol(),\r\n              minAmount: parseFloat(this.newPlatformMinAmount()),\r\n              maxAmount: parseFloat(this.newPlatformMaxAmount()),\r\n              fee: parseFloat(this.newPlatformFee() || '0'),\r\n              iconUrl: this.newPlatformIconUrl() || null,\r\n              iconClass: this.newPlatformIconClass() || null,\r\n              isActive: true\r\n            }\r\n          }\r\n        }\r\n      });\r\n      \r\n      if (response && response.data) {\r\n        app.store.pushPayload(response);\r\n      }\r\n      \r\n      // Clear form\r\n      this.newPlatformName('');\r\n      this.newPlatformSymbol('');\r\n      this.newPlatformMinAmount('');\r\n      this.newPlatformMaxAmount('');\r\n      this.newPlatformFee('');\r\n      this.newPlatformIconUrl('');\r\n      this.newPlatformIconClass('');\r\n      \r\n      await this.loadPlatforms();\r\n      \r\n      app.alerts.show(\r\n        { type: 'success', dismissible: true },\r\n        app.translator.trans('withdrawal.admin.platforms.add_success')\r\n      );\r\n    } catch (error) {\r\n      console.error('Error adding platform:', error);\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        app.translator.trans('withdrawal.admin.platforms.add_error')\r\n      );\r\n    } finally {\r\n      this.submittingPlatform = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private async togglePlatformStatus(platform: WithdrawalPlatform): Promise<void> {\r\n    try {\r\n      const platformId = typeof platform.id === 'function' ? platform.id() : platform.id;\r\n      const currentStatus = (typeof platform.isActive === 'function' ? platform.isActive() : platform.attributes?.isActive) ?? false;\r\n      const record = app.store.getById('withdrawal-platforms', platformId);\r\n      \r\n      if (record) {\r\n        await record.save({ isActive: !currentStatus });\r\n        await this.loadPlatforms();\r\n        \r\n        app.alerts.show(\r\n          { type: 'success', dismissible: true },\r\n          app.translator.trans(`withdrawal.admin.platforms.${!currentStatus ? 'enable' : 'disable'}_success`)\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error('Error toggling platform status:', error);\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        app.translator.trans('withdrawal.admin.platforms.toggle_error')\r\n      );\r\n    }\r\n  }\r\n\r\n  private deletePlatform(platform: WithdrawalPlatform): void {\r\n    const platformName = (typeof platform.name === 'function' ? platform.name() : platform.attributes?.name) || 'Unknown Platform';\r\n    \r\n    app.modal.show(ConfirmDeleteModal, {\r\n      platformName: platformName,\r\n      onConfirm: async () => {\r\n        try {\r\n          const platformId = typeof platform.id === 'function' ? platform.id() : platform.id;\r\n          const record = app.store.getById('withdrawal-platforms', platformId);\r\n          if (record) {\r\n            await record.delete();\r\n            await this.loadPlatforms();\r\n            \r\n            app.alerts.show(\r\n              { type: 'success', dismissible: true },\r\n              app.translator.trans('withdrawal.admin.platforms.delete_success')\r\n            );\r\n          }\r\n        } catch (error) {\r\n          console.error('Error deleting platform:', error);\r\n          app.alerts.show(\r\n            { type: 'error', dismissible: true },\r\n            app.translator.trans('withdrawal.admin.platforms.delete_error')\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private async updateRequestStatus(request: WithdrawalRequest, status: string): Promise<void> {\r\n    try {\r\n      const requestId = typeof request.id === 'function' ? request.id() : request.id;\r\n      const record = app.store.getById('withdrawal-requests', requestId);\r\n      if (record) {\r\n        await record.save({ status });\r\n        await this.loadRequests();\r\n        \r\n        app.alerts.show(\r\n          { type: 'success', dismissible: true },\r\n          app.translator.trans(`withdrawal.admin.requests.${status}_success`)\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating request:', error);\r\n      app.alerts.show(\r\n        { type: 'error', dismissible: true },\r\n        app.translator.trans('withdrawal.admin.requests.update_error')\r\n      );\r\n    }\r\n  }\r\n\r\n  private deleteRequest(request: WithdrawalRequest): void {\r\n    const requestId = typeof request.id === 'function' ? request.id() : request.id;\r\n    const amount = typeof request.amount === 'function' ? request.amount() : (request.attributes?.amount || 0);\r\n    \r\n    // Get user name for display in confirmation\r\n    let userName = 'Unknown User';\r\n    if (typeof request.user === 'function') {\r\n      const userData = request.user();\r\n      if (userData && typeof userData.displayName === 'function') {\r\n        userName = userData.displayName();\r\n      } else if (userData && userData.attributes?.displayName) {\r\n        userName = userData.attributes.displayName;\r\n      }\r\n    }\r\n    \r\n    app.modal.show(ConfirmDeleteRequestModal, {\r\n      requestInfo: `${userName} - ${amount}`,\r\n      onConfirm: async () => {\r\n        try {\r\n          const record = app.store.getById('withdrawal-requests', requestId);\r\n          if (record) {\r\n            await record.delete();\r\n            await this.loadRequests();\r\n            \r\n            app.alerts.show(\r\n              { type: 'success', dismissible: true },\r\n              app.translator.trans('withdrawal.admin.requests.delete_success')\r\n            );\r\n          }\r\n        } catch (error) {\r\n          console.error('Error deleting request:', error);\r\n          app.alerts.show(\r\n            { type: 'error', dismissible: true },\r\n            app.translator.trans('withdrawal.admin.requests.delete_error')\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private async loadData(): Promise<void> {\r\n    try {\r\n      // Load platforms first to ensure they're in the store\r\n      await this.loadPlatforms();\r\n      // Then load requests which reference platforms\r\n      await this.loadRequests();\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n    } finally {\r\n      this.loading = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private async loadPlatforms(): Promise<void> {\r\n    try {\r\n      const response = await app.store.find('withdrawal-platforms');\r\n      this.platforms = Array.isArray(response) ? response.filter(p => p !== null) : (response ? [response] : []);\r\n      \r\n      console.log('Loaded platforms:', this.platforms);\r\n    } catch (error) {\r\n      console.error('Error loading platforms:', error);\r\n      this.platforms = [];\r\n    }\r\n  }\r\n\r\n  private async loadRequests(): Promise<void> {\r\n    try {\r\n      const response = await app.store.find('withdrawal-requests', {\r\n        include: 'user,platform'\r\n      });\r\n      this.requests = Array.isArray(response) ? response.filter(r => r !== null) : (response ? [response] : []);\r\n      \r\n      console.log('Loaded requests:', this.requests);\r\n    } catch (error) {\r\n      console.error('Error loading requests:', error);\r\n      this.requests = [];\r\n    }\r\n    \r\n    // Load user data for each request - skip if no requests\r\n    if (this.requests.length === 0) {\r\n      return;\r\n    }\r\n    \r\n    const userIds = [...new Set(this.requests\r\n      .map(r => {\r\n        // Check both data.relationships and direct relationships structures\r\n        const userRelation = r?.data?.relationships?.user?.data || r?.relationships?.user?.data;\r\n        if (userRelation) {\r\n          return userRelation.id;\r\n        }\r\n        return null;\r\n      })\r\n      .filter(id => id !== null && id !== undefined)\r\n    )];\r\n    const usersToLoad = userIds.filter(userId => !this.users[userId]);\r\n    \r\n    if (usersToLoad.length > 0) {\r\n      try {\r\n        const userPromises = usersToLoad.map(userId => \r\n          app.store.find('users', userId).catch(error => {\r\n            console.error(`Error loading user ${userId}:`, error);\r\n            return null;\r\n          })\r\n        );\r\n        \r\n        const loadedUsers = await Promise.all(userPromises);\r\n        \r\n        usersToLoad.forEach((userId, index) => {\r\n          if (loadedUsers[index]) {\r\n            this.users[userId] = loadedUsers[index];\r\n          }\r\n        });\r\n      } catch (error) {\r\n        console.error('Error loading users:', error);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass ConfirmDeleteModal extends Modal {\r\n  private platformName: string;\r\n  private onConfirm: () => void;\r\n\r\n  constructor(vnode: any) {\r\n    super(vnode);\r\n    this.platformName = vnode.attrs.platformName;\r\n    this.onConfirm = vnode.attrs.onConfirm;\r\n  }\r\n\r\n  className() {\r\n    return 'ConfirmDeleteModal Modal--small';\r\n  }\r\n\r\n  title() {\r\n    return app.translator.trans('withdrawal.admin.platforms.delete_confirm_title');\r\n  }\r\n\r\n  content() {\r\n    return (\r\n      <div className=\"Modal-body\">\r\n        <p>{app.translator.trans('withdrawal.admin.platforms.delete_confirm_message', { name: this.platformName })}</p>\r\n        <div className=\"Form-group\">\r\n          <Button \r\n            className=\"Button Button--primary\" \r\n            onclick={this.confirm.bind(this)}\r\n          >\r\n            {app.translator.trans('withdrawal.admin.platforms.delete_confirm_button')}\r\n          </Button>\r\n          <Button \r\n            className=\"Button\" \r\n            onclick={this.hide.bind(this)}\r\n          >\r\n            {app.translator.trans('withdrawal.admin.platforms.delete_cancel_button')}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  confirm() {\r\n    this.onConfirm();\r\n    this.hide();\r\n  }\r\n}\r\n\r\nclass ConfirmDeleteRequestModal extends Modal {\r\n  private requestInfo: string;\r\n  private onConfirm: () => void;\r\n\r\n  constructor(vnode: any) {\r\n    super(vnode);\r\n    this.requestInfo = vnode.attrs.requestInfo;\r\n    this.onConfirm = vnode.attrs.onConfirm;\r\n  }\r\n\r\n  className() {\r\n    return 'ConfirmDeleteRequestModal Modal--small';\r\n  }\r\n\r\n  title() {\r\n    return app.translator.trans('withdrawal.admin.requests.delete_confirm_title');\r\n  }\r\n\r\n  content() {\r\n    return (\r\n      <div className=\"Modal-body\">\r\n        <p>{app.translator.trans('withdrawal.admin.requests.delete_confirm_message', { info: this.requestInfo })}</p>\r\n        <div className=\"Form-group\">\r\n          <Button \r\n            className=\"Button Button--danger\" \r\n            onclick={this.confirm.bind(this)}\r\n          >\r\n            {app.translator.trans('withdrawal.admin.requests.delete_confirm_button')}\r\n          </Button>\r\n          <Button \r\n            className=\"Button\" \r\n            onclick={this.hide.bind(this)}\r\n          >\r\n            {app.translator.trans('withdrawal.admin.requests.delete_cancel_button')}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  confirm() {\r\n    this.onConfirm();\r\n    this.hide();\r\n  }\r\n}","import Model from 'flarum/common/Model';\r\n\r\nexport default class WithdrawalPlatform extends Model {\r\n  name = Model.attribute('name');\r\n  symbol = Model.attribute('symbol');\r\n  minAmount = Model.attribute('minAmount');\r\n  maxAmount = Model.attribute('maxAmount');\r\n  fee = Model.attribute('fee');\r\n  iconUrl = Model.attribute('iconUrl');\r\n  iconClass = Model.attribute('iconClass');\r\n  isActive = Model.attribute('isActive');\r\n  createdAt = Model.attribute('createdAt', Model.transformDate);\r\n  updatedAt = Model.attribute('updatedAt', Model.transformDate);\r\n}","import Model from 'flarum/common/Model';\r\n\r\nexport default class WithdrawalRequest extends Model {\r\n  amount = Model.attribute('amount');\r\n  accountDetails = Model.attribute('accountDetails');\r\n  status = Model.attribute('status');\r\n  platformId = Model.attribute('platformId');\r\n  userId = Model.attribute('userId');\r\n  createdAt = Model.attribute('createdAt', Model.transformDate);\r\n  updatedAt = Model.attribute('updatedAt', Model.transformDate);\r\n  \r\n  user = Model.hasOne('user');\r\n  platform = Model.hasOne('platform');\r\n}","import app from 'flarum/admin/app';\r\nimport WithdrawalManagementPage from './components/WithdrawalManagementPage';\r\nimport WithdrawalPlatform from '../common/models/WithdrawalPlatform';\r\nimport WithdrawalRequest from '../common/models/WithdrawalRequest';\r\n\r\napp.initializers.add('wusong8899-withdrawal', () => {\r\n  // Register models in store\r\n  app.store.models['withdrawal-platforms'] = WithdrawalPlatform;\r\n  app.store.models['withdrawal-requests'] = WithdrawalRequest;\r\n  \r\n  app.extensionData\r\n    .for('wusong8899-withdrawal')\r\n    .registerPage(WithdrawalManagementPage);\r\n});"],"names":["WithdrawalManagementPage","ExtensionPage","Stream","vnode","LoadingIndicator","app","e","Button","platform","platformId","platformName","symbol","minAmount","maxAmount","fee","isActive","createdDate","dateDisplay","humanTime","pendingRequests","r","processedRequests","request","showActions","showDelete","requestId","amount","status","accountDetails","userName","userData","platformSymbol","statusClass","response","error","currentStatus","record","ConfirmDeleteModal","ConfirmDeleteRequestModal","p","usersToLoad","userRelation","id","userId","userPromises","loadedUsers","index","Modal","WithdrawalPlatform","Model","WithdrawalRequest"],"mappings":"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"}